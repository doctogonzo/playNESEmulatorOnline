!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:this,function(t,e){function i(t){var e=!!t&&"length"in t&&t.length,i=rt.type(t);return"function"!==i&&!rt.isWindow(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}function n(t,e,i){if(rt.isFunction(e))return rt.grep(t,function(t,n){return!!e.call(t,n,t)!==i});if(e.nodeType)return rt.grep(t,function(t){return t===e!==i});if("string"==typeof e){if(mt.test(e))return rt.filter(e,t,i);e=rt.filter(e,t)}return rt.grep(t,function(t){return Q.call(e,t)>-1!==i})}function s(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function r(t){var e={};return rt.each(t.match(_t)||[],function(t,i){e[i]=!0}),e}function o(){$.removeEventListener("DOMContentLoaded",o),t.removeEventListener("load",o),rt.ready()}function a(){this.expando=rt.expando+a.uid++}function h(t,e,i){var n;if(void 0===i&&1===t.nodeType)if(n="data-"+e.replace(Dt,"-$&").toLowerCase(),i=t.getAttribute(n),"string"==typeof i){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:At.test(i)?rt.parseJSON(i):i)}catch(s){}wt.set(t,e,i)}else i=void 0;return i}function u(t,e,i,n){var s,r=1,o=20,a=n?function(){return n.cur()}:function(){return rt.css(t,e,"")},h=a(),u=i&&i[3]||(rt.cssNumber[e]?"":"px"),c=(rt.cssNumber[e]||"px"!==u&&+h)&&Nt.exec(rt.css(t,e));if(c&&c[3]!==u){u=u||c[3],i=i||[],c=+h||1;do r=r||".5",c/=r,rt.style(t,e,c+u);while(r!==(r=a()/h)&&1!==r&&--o)}return i&&(c=+c||+h||0,s=i[1]?c+(i[1]+1)*i[2]:+i[2],n&&(n.unit=u,n.start=c,n.end=s)),s}function c(t,e){var i="undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e||"*"):"undefined"!=typeof t.querySelectorAll?t.querySelectorAll(e||"*"):[];return void 0===e||e&&rt.nodeName(t,e)?rt.merge([t],i):i}function l(t,e){for(var i=0,n=t.length;i<n;i++)Et.set(t[i],"globalEval",!e||Et.get(e[i],"globalEval"))}function p(t,e,i,n,s){for(var r,o,a,h,u,p,d=e.createDocumentFragment(),f=[],m=0,g=t.length;m<g;m++)if(r=t[m],r||0===r)if("object"===rt.type(r))rt.merge(f,r.nodeType?[r]:r);else if(Ft.test(r)){for(o=o||d.appendChild(e.createElement("div")),a=(Ot.exec(r)||["",""])[1].toLowerCase(),h=Lt[a]||Lt._default,o.innerHTML=h[1]+rt.htmlPrefilter(r)+h[2],p=h[0];p--;)o=o.lastChild;rt.merge(f,o.childNodes),o=d.firstChild,o.textContent=""}else f.push(e.createTextNode(r));for(d.textContent="",m=0;r=f[m++];)if(n&&rt.inArray(r,n)>-1)s&&s.push(r);else if(u=rt.contains(r.ownerDocument,r),o=c(d.appendChild(r),"script"),u&&l(o),i)for(p=0;r=o[p++];)Mt.test(r.type||"")&&i.push(r);return d}function d(){return!0}function f(){return!1}function m(){try{return $.activeElement}catch(t){}}function g(t,e,i,n,s,r){var o,a;if("object"==typeof e){"string"!=typeof i&&(n=n||i,i=void 0);for(a in e)g(t,a,i,n,e[a],r);return t}if(null==n&&null==s?(s=i,n=i=void 0):null==s&&("string"==typeof i?(s=n,n=void 0):(s=n,n=i,i=void 0)),s===!1)s=f;else if(!s)return t;return 1===r&&(o=s,s=function(t){return rt().off(t),o.apply(this,arguments)},s.guid=o.guid||(o.guid=rt.guid++)),t.each(function(){rt.event.add(this,e,s,n,i)})}function v(t,e){return rt.nodeName(t,"table")&&rt.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function y(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function b(t){var e=Ut.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function S(t,e){var i,n,s,r,o,a,h,u;if(1===e.nodeType){if(Et.hasData(t)&&(r=Et.access(t),o=Et.set(e,r),u=r.events)){delete o.handle,o.events={};for(s in u)for(i=0,n=u[s].length;i<n;i++)rt.event.add(e,s,u[s][i])}wt.hasData(t)&&(a=wt.access(t),h=rt.extend({},a),wt.set(e,h))}}function _(t,e){var i=e.nodeName.toLowerCase();"input"===i&&Pt.test(t.type)?e.checked=t.checked:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue)}function R(t,e,i,n){e=Z.apply([],e);var s,r,o,a,h,u,l=0,d=t.length,f=d-1,m=e[0],g=rt.isFunction(m);if(g||d>1&&"string"==typeof m&&!nt.checkClone&&Ht.test(m))return t.each(function(s){var r=t.eq(s);g&&(e[0]=m.call(this,s,r.html())),R(r,e,i,n)});if(d&&(s=p(e,t[0].ownerDocument,!1,t,n),r=s.firstChild,1===s.childNodes.length&&(s=r),r||n)){for(o=rt.map(c(s,"script"),y),a=o.length;l<d;l++)h=s,l!==f&&(h=rt.clone(h,!0,!0),a&&rt.merge(o,c(h,"script"))),i.call(t[l],h,l);if(a)for(u=o[o.length-1].ownerDocument,rt.map(o,b),l=0;l<a;l++)h=o[l],Mt.test(h.type||"")&&!Et.access(h,"globalEval")&&rt.contains(u,h)&&(h.src?rt._evalUrl&&rt._evalUrl(h.src):rt.globalEval(h.textContent.replace(Xt,"")))}return t}function C(t,e,i){for(var n,s=e?rt.filter(e,t):t,r=0;null!=(n=s[r]);r++)i||1!==n.nodeType||rt.cleanData(c(n)),n.parentNode&&(i&&rt.contains(n.ownerDocument,n)&&l(c(n,"script")),n.parentNode.removeChild(n));return t}function T(t,e){var i=rt(e.createElement(t)).appendTo(e.body),n=rt.css(i[0],"display");return i.detach(),n}function E(t){var e=$,i=Wt[t];return i||(i=T(t,e),"none"!==i&&i||(Yt=(Yt||rt("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement),e=Yt[0].contentDocument,e.write(),e.close(),i=T(t,e),Yt.detach()),Wt[t]=i),i}function w(t,e,i){var n,s,r,o,a=t.style;return i=i||Kt(t),o=i?i.getPropertyValue(e)||i[e]:void 0,""!==o&&void 0!==o||rt.contains(t.ownerDocument,t)||(o=rt.style(t,e)),i&&!nt.pixelMarginRight()&&$t.test(o)&&Jt.test(e)&&(n=a.width,s=a.minWidth,r=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=i.width,a.width=n,a.minWidth=s,a.maxWidth=r),void 0!==o?o+"":o}function A(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}function D(t){if(t in ne)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=ie.length;i--;)if(t=ie[i]+e,t in ne)return t}function x(t,e,i){var n=Nt.exec(e);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):e}function N(t,e,i,n,s){for(var r=i===(n?"border":"content")?4:"width"===e?1:0,o=0;r<4;r+=2)"margin"===i&&(o+=rt.css(t,i+It[r],!0,s)),n?("content"===i&&(o-=rt.css(t,"padding"+It[r],!0,s)),"margin"!==i&&(o-=rt.css(t,"border"+It[r]+"Width",!0,s))):(o+=rt.css(t,"padding"+It[r],!0,s),"padding"!==i&&(o+=rt.css(t,"border"+It[r]+"Width",!0,s)));return o}function I(t,e,i){var n=!0,s="width"===e?t.offsetWidth:t.offsetHeight,r=Kt(t),o="border-box"===rt.css(t,"boxSizing",!1,r);if(s<=0||null==s){if(s=w(t,e,r),(s<0||null==s)&&(s=t.style[e]),$t.test(s))return s;n=o&&(nt.boxSizingReliable()||s===t.style[e]),s=parseFloat(s)||0}return s+N(t,e,i||(o?"border":"content"),n,r)+"px"}function k(t,e){for(var i,n,s,r=[],o=0,a=t.length;o<a;o++)n=t[o],n.style&&(r[o]=Et.get(n,"olddisplay"),i=n.style.display,e?(r[o]||"none"!==i||(n.style.display=""),""===n.style.display&&kt(n)&&(r[o]=Et.access(n,"olddisplay",E(n.nodeName)))):(s=kt(n),"none"===i&&s||Et.set(n,"olddisplay",s?i:rt.css(n,"display"))));for(o=0;o<a;o++)n=t[o],n.style&&(e&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=e?r[o]||"":"none"));return t}function P(t,e,i,n,s){return new P.prototype.init(t,e,i,n,s)}function O(){return t.setTimeout(function(){se=void 0}),se=rt.now()}function M(t,e){var i,n=0,s={height:t};for(e=e?1:0;n<4;n+=2-e)i=It[n],s["margin"+i]=s["padding"+i]=t;return e&&(s.opacity=s.width=t),s}function L(t,e,i){for(var n,s=(B.tweeners[e]||[]).concat(B.tweeners["*"]),r=0,o=s.length;r<o;r++)if(n=s[r].call(i,e,t))return n}function F(t,e,i){var n,s,r,o,a,h,u,c,l=this,p={},d=t.style,f=t.nodeType&&kt(t),m=Et.get(t,"fxshow");i.queue||(a=rt._queueHooks(t,"fx"),null==a.unqueued&&(a.unqueued=0,h=a.empty.fire,a.empty.fire=function(){a.unqueued||h()}),a.unqueued++,l.always(function(){l.always(function(){a.unqueued--,rt.queue(t,"fx").length||a.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[d.overflow,d.overflowX,d.overflowY],u=rt.css(t,"display"),c="none"===u?Et.get(t,"olddisplay")||E(t.nodeName):u,"inline"===c&&"none"===rt.css(t,"float")&&(d.display="inline-block")),i.overflow&&(d.overflow="hidden",l.always(function(){d.overflow=i.overflow[0],d.overflowX=i.overflow[1],d.overflowY=i.overflow[2]}));for(n in e)if(s=e[n],oe.exec(s)){if(delete e[n],r=r||"toggle"===s,s===(f?"hide":"show")){if("show"!==s||!m||void 0===m[n])continue;f=!0}p[n]=m&&m[n]||rt.style(t,n)}else u=void 0;if(rt.isEmptyObject(p))"inline"===("none"===u?E(t.nodeName):u)&&(d.display=u);else{m?"hidden"in m&&(f=m.hidden):m=Et.access(t,"fxshow",{}),r&&(m.hidden=!f),f?rt(t).show():l.done(function(){rt(t).hide()}),l.done(function(){var e;Et.remove(t,"fxshow");for(e in p)rt.style(t,e,p[e])});for(n in p)o=L(f?m[n]:0,n,l),n in m||(m[n]=o.start,f&&(o.end=o.start,o.start="width"===n||"height"===n?1:0))}}function q(t,e){var i,n,s,r,o;for(i in t)if(n=rt.camelCase(i),s=e[n],r=t[i],rt.isArray(r)&&(s=r[1],r=t[i]=r[0]),i!==n&&(t[n]=r,delete t[i]),o=rt.cssHooks[n],o&&"expand"in o){r=o.expand(r),delete t[n];for(i in r)i in t||(t[i]=r[i],e[i]=s)}else e[n]=s}function B(t,e,i){var n,s,r=0,o=B.prefilters.length,a=rt.Deferred().always(function(){delete h.elem}),h=function(){if(s)return!1;for(var e=se||O(),i=Math.max(0,u.startTime+u.duration-e),n=i/u.duration||0,r=1-n,o=0,h=u.tweens.length;o<h;o++)u.tweens[o].run(r);return a.notifyWith(t,[u,r,i]),r<1&&h?i:(a.resolveWith(t,[u]),!1)},u=a.promise({elem:t,props:rt.extend({},e),opts:rt.extend(!0,{specialEasing:{},easing:rt.easing._default},i),originalProperties:e,originalOptions:i,startTime:se||O(),duration:i.duration,tweens:[],createTween:function(e,i){var n=rt.Tween(t,u.opts,e,i,u.opts.specialEasing[e]||u.opts.easing);return u.tweens.push(n),n},stop:function(e){var i=0,n=e?u.tweens.length:0;if(s)return this;for(s=!0;i<n;i++)u.tweens[i].run(1);return e?(a.notifyWith(t,[u,1,0]),a.resolveWith(t,[u,e])):a.rejectWith(t,[u,e]),this}}),c=u.props;for(q(c,u.opts.specialEasing);r<o;r++)if(n=B.prefilters[r].call(u,t,c,u.opts))return rt.isFunction(n.stop)&&(rt._queueHooks(u.elem,u.opts.queue).stop=rt.proxy(n.stop,n)),n;return rt.map(c,L,u),rt.isFunction(u.opts.start)&&u.opts.start.call(t,u),rt.fx.timer(rt.extend(h,{elem:t,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function G(t){return t.getAttribute&&t.getAttribute("class")||""}function V(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,s=0,r=e.toLowerCase().match(_t)||[];if(rt.isFunction(i))for(;n=r[s++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function j(t,e,i,n){function s(a){var h;return r[a]=!0,rt.each(t[a]||[],function(t,a){var u=a(e,i,n);return"string"!=typeof u||o||r[u]?o?!(h=u):void 0:(e.dataTypes.unshift(u),s(u),!1)}),h}var r={},o=t===we;return s(e.dataTypes[0])||!r["*"]&&s("*")}function H(t,e){var i,n,s=rt.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((s[i]?t:n||(n={}))[i]=e[i]);return n&&rt.extend(!0,t,n),t}function U(t,e,i){for(var n,s,r,o,a=t.contents,h=t.dataTypes;"*"===h[0];)h.shift(),void 0===n&&(n=t.mimeType||e.getResponseHeader("Content-Type"));if(n)for(s in a)if(a[s]&&a[s].test(n)){h.unshift(s);break}if(h[0]in i)r=h[0];else{for(s in i){if(!h[0]||t.converters[s+" "+h[0]]){r=s;break}o||(o=s)}r=r||o}if(r)return r!==h[0]&&h.unshift(r),i[r]}function X(t,e,i,n){var s,r,o,a,h,u={},c=t.dataTypes.slice();if(c[1])for(o in t.converters)u[o.toLowerCase()]=t.converters[o];for(r=c.shift();r;)if(t.responseFields[r]&&(i[t.responseFields[r]]=e),!h&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),h=r,r=c.shift())if("*"===r)r=h;else if("*"!==h&&h!==r){if(o=u[h+" "+r]||u["* "+r],!o)for(s in u)if(a=s.split(" "),a[1]===r&&(o=u[h+" "+a[0]]||u["* "+a[0]])){o===!0?o=u[s]:u[s]!==!0&&(r=a[0],c.unshift(a[1]));break}if(o!==!0)if(o&&t["throws"])e=o(e);else try{e=o(e)}catch(l){return{state:"parsererror",error:o?l:"No conversion from "+h+" to "+r}}}return{state:"success",data:e}}function Y(t,e,i,n){var s;if(rt.isArray(e))rt.each(e,function(e,s){i||Ne.test(t)?n(t,s):Y(t+"["+("object"==typeof s&&null!=s?e:"")+"]",s,i,n)});else if(i||"object"!==rt.type(e))n(t,e);else for(s in e)Y(t+"["+s+"]",e[s],i,n)}function W(t){return rt.isWindow(t)?t:9===t.nodeType&&t.defaultView}var J=[],$=t.document,K=J.slice,Z=J.concat,z=J.push,Q=J.indexOf,tt={},et=tt.toString,it=tt.hasOwnProperty,nt={},st="2.2.4",rt=function(t,e){return new rt.fn.init(t,e)},ot=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,at=/^-ms-/,ht=/-([\da-z])/gi,ut=function(t,e){return e.toUpperCase()};rt.fn=rt.prototype={jquery:st,constructor:rt,selector:"",length:0,toArray:function(){return K.call(this)},get:function(t){return null!=t?t<0?this[t+this.length]:this[t]:K.call(this)},pushStack:function(t){var e=rt.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t){return rt.each(this,t)},map:function(t){return this.pushStack(rt.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack(K.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:z,sort:J.sort,splice:J.splice},rt.extend=rt.fn.extend=function(){var t,e,i,n,s,r,o=arguments[0]||{},a=1,h=arguments.length,u=!1;for("boolean"==typeof o&&(u=o,o=arguments[a]||{},a++),"object"==typeof o||rt.isFunction(o)||(o={}),a===h&&(o=this,a--);a<h;a++)if(null!=(t=arguments[a]))for(e in t)i=o[e],n=t[e],o!==n&&(u&&n&&(rt.isPlainObject(n)||(s=rt.isArray(n)))?(s?(s=!1,r=i&&rt.isArray(i)?i:[]):r=i&&rt.isPlainObject(i)?i:{},o[e]=rt.extend(u,r,n)):void 0!==n&&(o[e]=n));return o},rt.extend({expando:"jQuery"+(st+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===rt.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){var e=t&&t.toString();return!rt.isArray(t)&&e-parseFloat(e)+1>=0},isPlainObject:function(t){var e;if("object"!==rt.type(t)||t.nodeType||rt.isWindow(t))return!1;if(t.constructor&&!it.call(t,"constructor")&&!it.call(t.constructor.prototype||{},"isPrototypeOf"))return!1;for(e in t);return void 0===e||it.call(t,e)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?tt[et.call(t)]||"object":typeof t},globalEval:function(t){var e,i=eval;t=rt.trim(t),t&&(1===t.indexOf("use strict")?(e=$.createElement("script"),e.text=t,$.head.appendChild(e).parentNode.removeChild(e)):i(t))},camelCase:function(t){return t.replace(at,"ms-").replace(ht,ut)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e){var n,s=0;if(i(t))for(n=t.length;s<n&&e.call(t[s],s,t[s])!==!1;s++);else for(s in t)if(e.call(t[s],s,t[s])===!1)break;return t},trim:function(t){return null==t?"":(t+"").replace(ot,"")},makeArray:function(t,e){var n=e||[];return null!=t&&(i(Object(t))?rt.merge(n,"string"==typeof t?[t]:t):z.call(n,t)),n},inArray:function(t,e,i){return null==e?-1:Q.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,s=t.length;n<i;n++)t[s++]=e[n];return t.length=s,t},grep:function(t,e,i){for(var n,s=[],r=0,o=t.length,a=!i;r<o;r++)n=!e(t[r],r),n!==a&&s.push(t[r]);return s},map:function(t,e,n){var s,r,o=0,a=[];if(i(t))for(s=t.length;o<s;o++)r=e(t[o],o,n),null!=r&&a.push(r);else for(o in t)r=e(t[o],o,n),null!=r&&a.push(r);return Z.apply([],a)},guid:1,proxy:function(t,e){var i,n,s;if("string"==typeof e&&(i=t[e],e=t,t=i),rt.isFunction(t))return n=K.call(arguments,2),s=function(){return t.apply(e||this,n.concat(K.call(arguments)))},s.guid=t.guid=t.guid||rt.guid++,s},now:Date.now,support:nt}),"function"==typeof Symbol&&(rt.fn[Symbol.iterator]=J[Symbol.iterator]),rt.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(t,e){tt["[object "+e+"]"]=e.toLowerCase()});var ct=function(t){function e(t,e,i,n){var s,r,o,a,h,u,l,d,f=e&&e.ownerDocument,m=e?e.nodeType:9;if(i=i||[],"string"!=typeof t||!t||1!==m&&9!==m&&11!==m)return i;if(!n&&((e?e.ownerDocument||e:G)!==k&&I(e),e=e||k,O)){if(11!==m&&(u=vt.exec(t)))if(s=u[1]){if(9===m){if(!(o=e.getElementById(s)))return i;if(o.id===s)return i.push(o),i}else if(f&&(o=f.getElementById(s))&&q(e,o)&&o.id===s)return i.push(o),i}else{if(u[2])return z.apply(i,e.getElementsByTagName(t)),i;if((s=u[3])&&_.getElementsByClassName&&e.getElementsByClassName)return z.apply(i,e.getElementsByClassName(s)),i}if(_.qsa&&!X[t+" "]&&(!M||!M.test(t))){if(1!==m)f=e,d=t;else if("object"!==e.nodeName.toLowerCase()){for((a=e.getAttribute("id"))?a=a.replace(bt,"\\$&"):e.setAttribute("id",a=B),l=E(t),r=l.length,h=pt.test(a)?"#"+a:"[id='"+a+"']";r--;)l[r]=h+" "+p(l[r]);d=l.join(","),f=yt.test(t)&&c(e.parentNode)||e}if(d)try{return z.apply(i,f.querySelectorAll(d)),i}catch(g){}finally{a===B&&e.removeAttribute("id")}}}return A(t.replace(at,"$1"),e,i,n)}function i(){function t(i,n){return e.push(i+" ")>R.cacheLength&&delete t[e.shift()],t[i+" "]=n}var e=[];return t}function n(t){return t[B]=!0,t}function s(t){var e=k.createElement("div");try{return!!t(e)}catch(i){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function r(t,e){for(var i=t.split("|"),n=i.length;n--;)R.attrHandle[i[n]]=e}function o(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||W)-(~t.sourceIndex||W);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function a(t){return function(e){var i=e.nodeName.toLowerCase();return"input"===i&&e.type===t}}function h(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function u(t){return n(function(e){return e=+e,n(function(i,n){for(var s,r=t([],i.length,e),o=r.length;o--;)i[s=r[o]]&&(i[s]=!(n[s]=i[s]))})})}function c(t){return t&&"undefined"!=typeof t.getElementsByTagName&&t}function l(){}function p(t){for(var e=0,i=t.length,n="";e<i;e++)n+=t[e].value;return n}function d(t,e,i){var n=e.dir,s=i&&"parentNode"===n,r=j++;return e.first?function(e,i,r){for(;e=e[n];)if(1===e.nodeType||s)return t(e,i,r)}:function(e,i,o){var a,h,u,c=[V,r];if(o){for(;e=e[n];)if((1===e.nodeType||s)&&t(e,i,o))return!0}else for(;e=e[n];)if(1===e.nodeType||s){if(u=e[B]||(e[B]={}),h=u[e.uniqueID]||(u[e.uniqueID]={}),(a=h[n])&&a[0]===V&&a[1]===r)return c[2]=a[2];if(h[n]=c,c[2]=t(e,i,o))return!0}}}function f(t){return t.length>1?function(e,i,n){for(var s=t.length;s--;)if(!t[s](e,i,n))return!1;return!0}:t[0]}function m(t,i,n){for(var s=0,r=i.length;s<r;s++)e(t,i[s],n);return n}function g(t,e,i,n,s){for(var r,o=[],a=0,h=t.length,u=null!=e;a<h;a++)(r=t[a])&&(i&&!i(r,n,s)||(o.push(r),u&&e.push(a)));return o}function v(t,e,i,s,r,o){return s&&!s[B]&&(s=v(s)),r&&!r[B]&&(r=v(r,o)),n(function(n,o,a,h){var u,c,l,p=[],d=[],f=o.length,v=n||m(e||"*",a.nodeType?[a]:a,[]),y=!t||!n&&e?v:g(v,p,t,a,h),b=i?r||(n?t:f||s)?[]:o:y;if(i&&i(y,b,a,h),s)for(u=g(b,d),s(u,[],a,h),c=u.length;c--;)(l=u[c])&&(b[d[c]]=!(y[d[c]]=l));if(n){if(r||t){if(r){for(u=[],c=b.length;c--;)(l=b[c])&&u.push(y[c]=l);r(null,b=[],u,h)}for(c=b.length;c--;)(l=b[c])&&(u=r?tt(n,l):p[c])>-1&&(n[u]=!(o[u]=l))}}else b=g(b===o?b.splice(f,b.length):b),r?r(null,o,b,h):z.apply(o,b)})}function y(t){for(var e,i,n,s=t.length,r=R.relative[t[0].type],o=r||R.relative[" "],a=r?1:0,h=d(function(t){return t===e},o,!0),u=d(function(t){return tt(e,t)>-1},o,!0),c=[function(t,i,n){var s=!r&&(n||i!==D)||((e=i).nodeType?h(t,i,n):u(t,i,n));return e=null,s}];a<s;a++)if(i=R.relative[t[a].type])c=[d(f(c),i)];else{if(i=R.filter[t[a].type].apply(null,t[a].matches),i[B]){for(n=++a;n<s&&!R.relative[t[n].type];n++);return v(a>1&&f(c),a>1&&p(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(at,"$1"),i,a<n&&y(t.slice(a,n)),n<s&&y(t=t.slice(n)),n<s&&p(t))}c.push(i)}return f(c)}function b(t,i){var s=i.length>0,r=t.length>0,o=function(n,o,a,h,u){var c,l,p,d=0,f="0",m=n&&[],v=[],y=D,b=n||r&&R.find.TAG("*",u),S=V+=null==y?1:Math.random()||.1,_=b.length;for(u&&(D=o===k||o||u);f!==_&&null!=(c=b[f]);f++){if(r&&c){for(l=0,o||c.ownerDocument===k||(I(c),a=!O);p=t[l++];)if(p(c,o||k,a)){h.push(c);break}u&&(V=S)}s&&((c=!p&&c)&&d--,n&&m.push(c))}if(d+=f,s&&f!==d){for(l=0;p=i[l++];)p(m,v,o,a);if(n){if(d>0)for(;f--;)m[f]||v[f]||(v[f]=K.call(h));v=g(v)}z.apply(h,v),u&&!n&&v.length>0&&d+i.length>1&&e.uniqueSort(h)}return u&&(V=S,D=y),m};return s?n(o):o}var S,_,R,C,T,E,w,A,D,x,N,I,k,P,O,M,L,F,q,B="sizzle"+1*new Date,G=t.document,V=0,j=0,H=i(),U=i(),X=i(),Y=function(t,e){return t===e&&(N=!0),0},W=1<<31,J={}.hasOwnProperty,$=[],K=$.pop,Z=$.push,z=$.push,Q=$.slice,tt=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",it="[\\x20\\t\\r\\n\\f]",nt="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",st="\\["+it+"*("+nt+")(?:"+it+"*([*^$|!~]?=)"+it+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+nt+"))|)"+it+"*\\]",rt=":("+nt+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+st+")*)|.*)\\)|)",ot=new RegExp(it+"+","g"),at=new RegExp("^"+it+"+|((?:^|[^\\\\])(?:\\\\.)*)"+it+"+$","g"),ht=new RegExp("^"+it+"*,"+it+"*"),ut=new RegExp("^"+it+"*([>+~]|"+it+")"+it+"*"),ct=new RegExp("="+it+"*([^\\]'\"]*?)"+it+"*\\]","g"),lt=new RegExp(rt),pt=new RegExp("^"+nt+"$"),dt={ID:new RegExp("^#("+nt+")"),CLASS:new RegExp("^\\.("+nt+")"),TAG:new RegExp("^("+nt+"|[*])"),ATTR:new RegExp("^"+st),PSEUDO:new RegExp("^"+rt),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+it+"*(even|odd|(([+-]|)(\\d*)n|)"+it+"*(?:([+-]|)"+it+"*(\\d+)|))"+it+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+it+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+it+"*((?:-\\d)?\\d*)"+it+"*\\)|)(?=[^-]|$)","i")},ft=/^(?:input|select|textarea|button)$/i,mt=/^h\d$/i,gt=/^[^{]+\{\s*\[native \w/,vt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,yt=/[+~]/,bt=/'|\\/g,St=new RegExp("\\\\([\\da-f]{1,6}"+it+"?|("+it+")|.)","ig"),_t=function(t,e,i){var n="0x"+e-65536;return n!==n||i?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},Rt=function(){I()};try{z.apply($=Q.call(G.childNodes),G.childNodes),$[G.childNodes.length].nodeType}catch(Ct){z={apply:$.length?function(t,e){Z.apply(t,Q.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}_=e.support={},T=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},I=e.setDocument=function(t){var e,i,n=t?t.ownerDocument||t:G;return n!==k&&9===n.nodeType&&n.documentElement?(k=n,P=k.documentElement,O=!T(k),(i=k.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",Rt,!1):i.attachEvent&&i.attachEvent("onunload",Rt)),_.attributes=s(function(t){return t.className="i",!t.getAttribute("className")}),_.getElementsByTagName=s(function(t){return t.appendChild(k.createComment("")),!t.getElementsByTagName("*").length}),_.getElementsByClassName=gt.test(k.getElementsByClassName),_.getById=s(function(t){return P.appendChild(t).id=B,!k.getElementsByName||!k.getElementsByName(B).length}),_.getById?(R.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&O){var i=e.getElementById(t);return i?[i]:[]}},R.filter.ID=function(t){var e=t.replace(St,_t);return function(t){return t.getAttribute("id")===e}}):(delete R.find.ID,R.filter.ID=function(t){var e=t.replace(St,_t);return function(t){var i="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}}),R.find.TAG=_.getElementsByTagName?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):_.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],s=0,r=e.getElementsByTagName(t);if("*"===t){for(;i=r[s++];)1===i.nodeType&&n.push(i);return n}return r},R.find.CLASS=_.getElementsByClassName&&function(t,e){if("undefined"!=typeof e.getElementsByClassName&&O)return e.getElementsByClassName(t)},L=[],M=[],(_.qsa=gt.test(k.querySelectorAll))&&(s(function(t){P.appendChild(t).innerHTML="<a id='"+B+"'></a><select id='"+B+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&M.push("[*^$]="+it+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||M.push("\\["+it+"*(?:value|"+et+")"),t.querySelectorAll("[id~="+B+"-]").length||M.push("~="),t.querySelectorAll(":checked").length||M.push(":checked"),t.querySelectorAll("a#"+B+"+*").length||M.push(".#.+[+~]")}),s(function(t){var e=k.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&M.push("name"+it+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||M.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),M.push(",.*:")})),(_.matchesSelector=gt.test(F=P.matches||P.webkitMatchesSelector||P.mozMatchesSelector||P.oMatchesSelector||P.msMatchesSelector))&&s(function(t){_.disconnectedMatch=F.call(t,"div"),F.call(t,"[s!='']:x"),L.push("!=",rt)}),M=M.length&&new RegExp(M.join("|")),L=L.length&&new RegExp(L.join("|")),e=gt.test(P.compareDocumentPosition),q=e||gt.test(P.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},Y=e?function(t,e){if(t===e)return N=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i?i:(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!_.sortDetached&&e.compareDocumentPosition(t)===i?t===k||t.ownerDocument===G&&q(G,t)?-1:e===k||e.ownerDocument===G&&q(G,e)?1:x?tt(x,t)-tt(x,e):0:4&i?-1:1)}:function(t,e){if(t===e)return N=!0,0;var i,n=0,s=t.parentNode,r=e.parentNode,a=[t],h=[e];if(!s||!r)return t===k?-1:e===k?1:s?-1:r?1:x?tt(x,t)-tt(x,e):0;if(s===r)return o(t,e);for(i=t;i=i.parentNode;)a.unshift(i);for(i=e;i=i.parentNode;)h.unshift(i);for(;a[n]===h[n];)n++;return n?o(a[n],h[n]):a[n]===G?-1:h[n]===G?1:0},k):k},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if((t.ownerDocument||t)!==k&&I(t),i=i.replace(ct,"='$1']"),_.matchesSelector&&O&&!X[i+" "]&&(!L||!L.test(i))&&(!M||!M.test(i)))try{var n=F.call(t,i);if(n||_.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(s){}return e(i,k,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==k&&I(t),q(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==k&&I(t);var i=R.attrHandle[e.toLowerCase()],n=i&&J.call(R.attrHandle,e.toLowerCase())?i(t,e,!O):void 0;return void 0!==n?n:_.attributes||!O?t.getAttribute(e):(n=t.getAttributeNode(e))&&n.specified?n.value:null},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],n=0,s=0;if(N=!_.detectDuplicates,x=!_.sortStable&&t.slice(0),t.sort(Y),N){for(;e=t[s++];)e===t[s]&&(n=i.push(s));for(;n--;)t.splice(i[n],1)}return x=null,t},C=e.getText=function(t){var e,i="",n=0,s=t.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=C(t)}else if(3===s||4===s)return t.nodeValue}else for(;e=t[n++];)i+=C(e);return i},R=e.selectors={cacheLength:50,createPseudo:n,match:dt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(St,_t),t[3]=(t[3]||t[4]||t[5]||"").replace(St,_t),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return dt.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&lt.test(i)&&(e=E(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(St,_t).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=H[t+" "];return e||(e=new RegExp("(^|"+it+")"+t+"("+it+"|$)"))&&H(t,function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,i,n){return function(s){var r=e.attr(s,t);return null==r?"!="===i:!i||(r+="","="===i?r===n:"!="===i?r!==n:"^="===i?n&&0===r.indexOf(n):"*="===i?n&&r.indexOf(n)>-1:"$="===i?n&&r.slice(-n.length)===n:"~="===i?(" "+r.replace(ot," ")+" ").indexOf(n)>-1:"|="===i&&(r===n||r.slice(0,n.length+1)===n+"-"))}},CHILD:function(t,e,i,n,s){var r="nth"!==t.slice(0,3),o="last"!==t.slice(-4),a="of-type"===e;return 1===n&&0===s?function(t){return!!t.parentNode}:function(e,i,h){var u,c,l,p,d,f,m=r!==o?"nextSibling":"previousSibling",g=e.parentNode,v=a&&e.nodeName.toLowerCase(),y=!h&&!a,b=!1;if(g){if(r){for(;m;){for(p=e;p=p[m];)if(a?p.nodeName.toLowerCase()===v:1===p.nodeType)return!1;f=m="only"===t&&!f&&"nextSibling"}return!0}if(f=[o?g.firstChild:g.lastChild],o&&y){for(p=g,l=p[B]||(p[B]={}),c=l[p.uniqueID]||(l[p.uniqueID]={}),u=c[t]||[],d=u[0]===V&&u[1],b=d&&u[2],p=d&&g.childNodes[d];p=++d&&p&&p[m]||(b=d=0)||f.pop();)if(1===p.nodeType&&++b&&p===e){c[t]=[V,d,b];break}}else if(y&&(p=e,l=p[B]||(p[B]={}),c=l[p.uniqueID]||(l[p.uniqueID]={}),u=c[t]||[],d=u[0]===V&&u[1],b=d),b===!1)for(;(p=++d&&p&&p[m]||(b=d=0)||f.pop())&&((a?p.nodeName.toLowerCase()!==v:1!==p.nodeType)||!++b||(y&&(l=p[B]||(p[B]={}),c=l[p.uniqueID]||(l[p.uniqueID]={}),c[t]=[V,b]),p!==e)););return b-=s,b===n||b%n===0&&b/n>=0}}},PSEUDO:function(t,i){var s,r=R.pseudos[t]||R.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return r[B]?r(i):r.length>1?(s=[t,t,"",i],R.setFilters.hasOwnProperty(t.toLowerCase())?n(function(t,e){for(var n,s=r(t,i),o=s.length;o--;)n=tt(t,s[o]),t[n]=!(e[n]=s[o])}):function(t){return r(t,0,s)}):r}},pseudos:{not:n(function(t){var e=[],i=[],s=w(t.replace(at,"$1"));return s[B]?n(function(t,e,i,n){for(var r,o=s(t,null,n,[]),a=t.length;a--;)(r=o[a])&&(t[a]=!(e[a]=r))}):function(t,n,r){return e[0]=t,s(e,null,r,i),e[0]=null,!i.pop()}}),has:n(function(t){return function(i){return e(t,i).length>0}}),contains:n(function(t){return t=t.replace(St,_t),function(e){return(e.textContent||e.innerText||C(e)).indexOf(t)>-1}}),lang:n(function(t){return pt.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(St,_t).toLowerCase(),function(e){var i;do if(i=O?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return i=i.toLowerCase(),i===t||0===i.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===P},focus:function(t){return t===k.activeElement&&(!k.hasFocus||k.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!R.pseudos.empty(t)},header:function(t){return mt.test(t.nodeName)},input:function(t){return ft.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:u(function(){return[0]}),last:u(function(t,e){return[e-1]}),eq:u(function(t,e,i){return[i<0?i+e:i]}),even:u(function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t}),odd:u(function(t,e){for(var i=1;i<e;i+=2)t.push(i);
return t}),lt:u(function(t,e,i){for(var n=i<0?i+e:i;--n>=0;)t.push(n);return t}),gt:u(function(t,e,i){for(var n=i<0?i+e:i;++n<e;)t.push(n);return t})}},R.pseudos.nth=R.pseudos.eq;for(S in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})R.pseudos[S]=a(S);for(S in{submit:!0,reset:!0})R.pseudos[S]=h(S);return l.prototype=R.filters=R.pseudos,R.setFilters=new l,E=e.tokenize=function(t,i){var n,s,r,o,a,h,u,c=U[t+" "];if(c)return i?0:c.slice(0);for(a=t,h=[],u=R.preFilter;a;){n&&!(s=ht.exec(a))||(s&&(a=a.slice(s[0].length)||a),h.push(r=[])),n=!1,(s=ut.exec(a))&&(n=s.shift(),r.push({value:n,type:s[0].replace(at," ")}),a=a.slice(n.length));for(o in R.filter)!(s=dt[o].exec(a))||u[o]&&!(s=u[o](s))||(n=s.shift(),r.push({value:n,type:o,matches:s}),a=a.slice(n.length));if(!n)break}return i?a.length:a?e.error(t):U(t,h).slice(0)},w=e.compile=function(t,e){var i,n=[],s=[],r=X[t+" "];if(!r){for(e||(e=E(t)),i=e.length;i--;)r=y(e[i]),r[B]?n.push(r):s.push(r);r=X(t,b(s,n)),r.selector=t}return r},A=e.select=function(t,e,i,n){var s,r,o,a,h,u="function"==typeof t&&t,l=!n&&E(t=u.selector||t);if(i=i||[],1===l.length){if(r=l[0]=l[0].slice(0),r.length>2&&"ID"===(o=r[0]).type&&_.getById&&9===e.nodeType&&O&&R.relative[r[1].type]){if(e=(R.find.ID(o.matches[0].replace(St,_t),e)||[])[0],!e)return i;u&&(e=e.parentNode),t=t.slice(r.shift().value.length)}for(s=dt.needsContext.test(t)?0:r.length;s--&&(o=r[s],!R.relative[a=o.type]);)if((h=R.find[a])&&(n=h(o.matches[0].replace(St,_t),yt.test(r[0].type)&&c(e.parentNode)||e))){if(r.splice(s,1),t=n.length&&p(r),!t)return z.apply(i,n),i;break}}return(u||w(t,l))(n,e,!O,i,!e||yt.test(t)&&c(e.parentNode)||e),i},_.sortStable=B.split("").sort(Y).join("")===B,_.detectDuplicates=!!N,I(),_.sortDetached=s(function(t){return 1&t.compareDocumentPosition(k.createElement("div"))}),s(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||r("type|href|height|width",function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),_.attributes&&s(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||r("value",function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue}),s(function(t){return null==t.getAttribute("disabled")})||r(et,function(t,e,i){var n;if(!i)return t[e]===!0?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null}),e}(t);rt.find=ct,rt.expr=ct.selectors,rt.expr[":"]=rt.expr.pseudos,rt.uniqueSort=rt.unique=ct.uniqueSort,rt.text=ct.getText,rt.isXMLDoc=ct.isXML,rt.contains=ct.contains;var lt=function(t,e,i){for(var n=[],s=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(s&&rt(t).is(i))break;n.push(t)}return n},pt=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},dt=rt.expr.match.needsContext,ft=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,mt=/^.[^:#\[\.,]*$/;rt.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?rt.find.matchesSelector(n,t)?[n]:[]:rt.find.matches(t,rt.grep(e,function(t){return 1===t.nodeType}))},rt.fn.extend({find:function(t){var e,i=this.length,n=[],s=this;if("string"!=typeof t)return this.pushStack(rt(t).filter(function(){for(e=0;e<i;e++)if(rt.contains(s[e],this))return!0}));for(e=0;e<i;e++)rt.find(t,s[e],n);return n=this.pushStack(i>1?rt.unique(n):n),n.selector=this.selector?this.selector+" "+t:t,n},filter:function(t){return this.pushStack(n(this,t||[],!1))},not:function(t){return this.pushStack(n(this,t||[],!0))},is:function(t){return!!n(this,"string"==typeof t&&dt.test(t)?rt(t):t||[],!1).length}});var gt,vt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,yt=rt.fn.init=function(t,e,i){var n,s;if(!t)return this;if(i=i||gt,"string"==typeof t){if(n="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:vt.exec(t),!n||!n[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(n[1]){if(e=e instanceof rt?e[0]:e,rt.merge(this,rt.parseHTML(n[1],e&&e.nodeType?e.ownerDocument||e:$,!0)),ft.test(n[1])&&rt.isPlainObject(e))for(n in e)rt.isFunction(this[n])?this[n](e[n]):this.attr(n,e[n]);return this}return s=$.getElementById(n[2]),s&&s.parentNode&&(this.length=1,this[0]=s),this.context=$,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):rt.isFunction(t)?void 0!==i.ready?i.ready(t):t(rt):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),rt.makeArray(t,this))};yt.prototype=rt.fn,gt=rt($);var bt=/^(?:parents|prev(?:Until|All))/,St={children:!0,contents:!0,next:!0,prev:!0};rt.fn.extend({has:function(t){var e=rt(t,this),i=e.length;return this.filter(function(){for(var t=0;t<i;t++)if(rt.contains(this,e[t]))return!0})},closest:function(t,e){for(var i,n=0,s=this.length,r=[],o=dt.test(t)||"string"!=typeof t?rt(t,e||this.context):0;n<s;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&rt.find.matchesSelector(i,t))){r.push(i);break}return this.pushStack(r.length>1?rt.uniqueSort(r):r)},index:function(t){return t?"string"==typeof t?Q.call(rt(t),this[0]):Q.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(rt.uniqueSort(rt.merge(this.get(),rt(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),rt.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return lt(t,"parentNode")},parentsUntil:function(t,e,i){return lt(t,"parentNode",i)},next:function(t){return s(t,"nextSibling")},prev:function(t){return s(t,"previousSibling")},nextAll:function(t){return lt(t,"nextSibling")},prevAll:function(t){return lt(t,"previousSibling")},nextUntil:function(t,e,i){return lt(t,"nextSibling",i)},prevUntil:function(t,e,i){return lt(t,"previousSibling",i)},siblings:function(t){return pt((t.parentNode||{}).firstChild,t)},children:function(t){return pt(t.firstChild)},contents:function(t){return t.contentDocument||rt.merge([],t.childNodes)}},function(t,e){rt.fn[t]=function(i,n){var s=rt.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(s=rt.filter(n,s)),this.length>1&&(St[t]||rt.uniqueSort(s),bt.test(t)&&s.reverse()),this.pushStack(s)}});var _t=/\S+/g;rt.Callbacks=function(t){t="string"==typeof t?r(t):rt.extend({},t);var e,i,n,s,o=[],a=[],h=-1,u=function(){for(s=t.once,n=e=!0;a.length;h=-1)for(i=a.shift();++h<o.length;)o[h].apply(i[0],i[1])===!1&&t.stopOnFalse&&(h=o.length,i=!1);t.memory||(i=!1),e=!1,s&&(o=i?[]:"")},c={add:function(){return o&&(i&&!e&&(h=o.length-1,a.push(i)),function n(e){rt.each(e,function(e,i){rt.isFunction(i)?t.unique&&c.has(i)||o.push(i):i&&i.length&&"string"!==rt.type(i)&&n(i)})}(arguments),i&&!e&&u()),this},remove:function(){return rt.each(arguments,function(t,e){for(var i;(i=rt.inArray(e,o,i))>-1;)o.splice(i,1),i<=h&&h--}),this},has:function(t){return t?rt.inArray(t,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return s=a=[],o=i="",this},disabled:function(){return!o},lock:function(){return s=a=[],i||(o=i=""),this},locked:function(){return!!s},fireWith:function(t,i){return s||(i=i||[],i=[t,i.slice?i.slice():i],a.push(i),e||u()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!n}};return c},rt.extend({Deferred:function(t){var e=[["resolve","done",rt.Callbacks("once memory"),"resolved"],["reject","fail",rt.Callbacks("once memory"),"rejected"],["notify","progress",rt.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var t=arguments;return rt.Deferred(function(i){rt.each(e,function(e,r){var o=rt.isFunction(t[e])&&t[e];s[r[1]](function(){var t=o&&o.apply(this,arguments);t&&rt.isFunction(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[r[0]+"With"](this===n?i.promise():this,o?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?rt.extend(t,n):n}},s={};return n.pipe=n.then,rt.each(e,function(t,r){var o=r[2],a=r[3];n[r[1]]=o.add,a&&o.add(function(){i=a},e[1^t][2].disable,e[2][2].lock),s[r[0]]=function(){return s[r[0]+"With"](this===s?n:this,arguments),this},s[r[0]+"With"]=o.fireWith}),n.promise(s),t&&t.call(s,s),s},when:function(t){var e,i,n,s=0,r=K.call(arguments),o=r.length,a=1!==o||t&&rt.isFunction(t.promise)?o:0,h=1===a?t:rt.Deferred(),u=function(t,i,n){return function(s){i[t]=this,n[t]=arguments.length>1?K.call(arguments):s,n===e?h.notifyWith(i,n):--a||h.resolveWith(i,n)}};if(o>1)for(e=new Array(o),i=new Array(o),n=new Array(o);s<o;s++)r[s]&&rt.isFunction(r[s].promise)?r[s].promise().progress(u(s,i,e)).done(u(s,n,r)).fail(h.reject):--a;return a||h.resolveWith(n,r),h.promise()}});var Rt;rt.fn.ready=function(t){return rt.ready.promise().done(t),this},rt.extend({isReady:!1,readyWait:1,holdReady:function(t){t?rt.readyWait++:rt.ready(!0)},ready:function(t){(t===!0?--rt.readyWait:rt.isReady)||(rt.isReady=!0,t!==!0&&--rt.readyWait>0||(Rt.resolveWith($,[rt]),rt.fn.triggerHandler&&(rt($).triggerHandler("ready"),rt($).off("ready"))))}}),rt.ready.promise=function(e){return Rt||(Rt=rt.Deferred(),"complete"===$.readyState||"loading"!==$.readyState&&!$.documentElement.doScroll?t.setTimeout(rt.ready):($.addEventListener("DOMContentLoaded",o),t.addEventListener("load",o))),Rt.promise(e)},rt.ready.promise();var Ct=function(t,e,i,n,s,r,o){var a=0,h=t.length,u=null==i;if("object"===rt.type(i)){s=!0;for(a in i)Ct(t,e,a,i[a],!0,r,o)}else if(void 0!==n&&(s=!0,rt.isFunction(n)||(o=!0),u&&(o?(e.call(t,n),e=null):(u=e,e=function(t,e,i){return u.call(rt(t),i)})),e))for(;a<h;a++)e(t[a],i,o?n:n.call(t[a],a,e(t[a],i)));return s?t:u?e.call(t):h?e(t[0],i):r},Tt=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};a.uid=1,a.prototype={register:function(t,e){var i=e||{};return t.nodeType?t[this.expando]=i:Object.defineProperty(t,this.expando,{value:i,writable:!0,configurable:!0}),t[this.expando]},cache:function(t){if(!Tt(t))return{};var e=t[this.expando];return e||(e={},Tt(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var n,s=this.cache(t);if("string"==typeof e)s[e]=i;else for(n in e)s[n]=e[n];return s},get:function(t,e){return void 0===e?this.cache(t):t[this.expando]&&t[this.expando][e]},access:function(t,e,i){var n;return void 0===e||e&&"string"==typeof e&&void 0===i?(n=this.get(t,e),void 0!==n?n:this.get(t,rt.camelCase(e))):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,n,s,r=t[this.expando];if(void 0!==r){if(void 0===e)this.register(t);else{rt.isArray(e)?n=e.concat(e.map(rt.camelCase)):(s=rt.camelCase(e),e in r?n=[e,s]:(n=s,n=n in r?[n]:n.match(_t)||[])),i=n.length;for(;i--;)delete r[n[i]]}(void 0===e||rt.isEmptyObject(r))&&(t.nodeType?t[this.expando]=void 0:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return void 0!==e&&!rt.isEmptyObject(e)}};var Et=new a,wt=new a,At=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Dt=/[A-Z]/g;rt.extend({hasData:function(t){return wt.hasData(t)||Et.hasData(t)},data:function(t,e,i){return wt.access(t,e,i)},removeData:function(t,e){wt.remove(t,e)},_data:function(t,e,i){return Et.access(t,e,i)},_removeData:function(t,e){Et.remove(t,e)}}),rt.fn.extend({data:function(t,e){var i,n,s,r=this[0],o=r&&r.attributes;if(void 0===t){if(this.length&&(s=wt.get(r),1===r.nodeType&&!Et.get(r,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&(n=o[i].name,0===n.indexOf("data-")&&(n=rt.camelCase(n.slice(5)),h(r,n,s[n])));Et.set(r,"hasDataAttrs",!0)}return s}return"object"==typeof t?this.each(function(){wt.set(this,t)}):Ct(this,function(e){var i,n;if(r&&void 0===e){if(i=wt.get(r,t)||wt.get(r,t.replace(Dt,"-$&").toLowerCase()),void 0!==i)return i;if(n=rt.camelCase(t),i=wt.get(r,n),void 0!==i)return i;if(i=h(r,n,void 0),void 0!==i)return i}else n=rt.camelCase(t),this.each(function(){var i=wt.get(this,n);wt.set(this,n,e),t.indexOf("-")>-1&&void 0!==i&&wt.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){wt.remove(this,t)})}}),rt.extend({queue:function(t,e,i){var n;if(t)return e=(e||"fx")+"queue",n=Et.get(t,e),i&&(!n||rt.isArray(i)?n=Et.access(t,e,rt.makeArray(i)):n.push(i)),n||[]},dequeue:function(t,e){e=e||"fx";var i=rt.queue(t,e),n=i.length,s=i.shift(),r=rt._queueHooks(t,e),o=function(){rt.dequeue(t,e)};"inprogress"===s&&(s=i.shift(),n--),s&&("fx"===e&&i.unshift("inprogress"),delete r.stop,s.call(t,o,r)),!n&&r&&r.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return Et.get(t,i)||Et.access(t,i,{empty:rt.Callbacks("once memory").add(function(){Et.remove(t,[e+"queue",i])})})}}),rt.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?rt.queue(this[0],t):void 0===e?this:this.each(function(){var i=rt.queue(this,t,e);rt._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&rt.dequeue(this,t)})},dequeue:function(t){return this.each(function(){rt.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,n=1,s=rt.Deferred(),r=this,o=this.length,a=function(){--n||s.resolveWith(r,[r])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)i=Et.get(r[o],t+"queueHooks"),i&&i.empty&&(n++,i.empty.add(a));return a(),s.promise(e)}});var xt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Nt=new RegExp("^(?:([+-])=|)("+xt+")([a-z%]*)$","i"),It=["Top","Right","Bottom","Left"],kt=function(t,e){return t=e||t,"none"===rt.css(t,"display")||!rt.contains(t.ownerDocument,t)},Pt=/^(?:checkbox|radio)$/i,Ot=/<([\w:-]+)/,Mt=/^$|\/(?:java|ecma)script/i,Lt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Lt.optgroup=Lt.option,Lt.tbody=Lt.tfoot=Lt.colgroup=Lt.caption=Lt.thead,Lt.th=Lt.td;var Ft=/<|&#?\w+;/;!function(){var t=$.createDocumentFragment(),e=t.appendChild($.createElement("div")),i=$.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),e.appendChild(i),nt.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",nt.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var qt=/^key/,Bt=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Gt=/^([^.]*)(?:\.(.+)|)/;rt.event={global:{},add:function(t,e,i,n,s){var r,o,a,h,u,c,l,p,d,f,m,g=Et.get(t);if(g)for(i.handler&&(r=i,i=r.handler,s=r.selector),i.guid||(i.guid=rt.guid++),(h=g.events)||(h=g.events={}),(o=g.handle)||(o=g.handle=function(e){return"undefined"!=typeof rt&&rt.event.triggered!==e.type?rt.event.dispatch.apply(t,arguments):void 0}),e=(e||"").match(_t)||[""],u=e.length;u--;)a=Gt.exec(e[u])||[],d=m=a[1],f=(a[2]||"").split(".").sort(),d&&(l=rt.event.special[d]||{},d=(s?l.delegateType:l.bindType)||d,l=rt.event.special[d]||{},c=rt.extend({type:d,origType:m,data:n,handler:i,guid:i.guid,selector:s,needsContext:s&&rt.expr.match.needsContext.test(s),namespace:f.join(".")},r),(p=h[d])||(p=h[d]=[],p.delegateCount=0,l.setup&&l.setup.call(t,n,f,o)!==!1||t.addEventListener&&t.addEventListener(d,o)),l.add&&(l.add.call(t,c),c.handler.guid||(c.handler.guid=i.guid)),s?p.splice(p.delegateCount++,0,c):p.push(c),rt.event.global[d]=!0)},remove:function(t,e,i,n,s){var r,o,a,h,u,c,l,p,d,f,m,g=Et.hasData(t)&&Et.get(t);if(g&&(h=g.events)){for(e=(e||"").match(_t)||[""],u=e.length;u--;)if(a=Gt.exec(e[u])||[],d=m=a[1],f=(a[2]||"").split(".").sort(),d){for(l=rt.event.special[d]||{},d=(n?l.delegateType:l.bindType)||d,p=h[d]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=r=p.length;r--;)c=p[r],!s&&m!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||n&&n!==c.selector&&("**"!==n||!c.selector)||(p.splice(r,1),c.selector&&p.delegateCount--,l.remove&&l.remove.call(t,c));o&&!p.length&&(l.teardown&&l.teardown.call(t,f,g.handle)!==!1||rt.removeEvent(t,d,g.handle),delete h[d])}else for(d in h)rt.event.remove(t,d+e[u],i,n,!0);rt.isEmptyObject(h)&&Et.remove(t,"handle events")}},dispatch:function(t){t=rt.event.fix(t);var e,i,n,s,r,o=[],a=K.call(arguments),h=(Et.get(this,"events")||{})[t.type]||[],u=rt.event.special[t.type]||{};if(a[0]=t,t.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,t)!==!1){for(o=rt.event.handlers.call(this,t,h),e=0;(s=o[e++])&&!t.isPropagationStopped();)for(t.currentTarget=s.elem,i=0;(r=s.handlers[i++])&&!t.isImmediatePropagationStopped();)t.rnamespace&&!t.rnamespace.test(r.namespace)||(t.handleObj=r,t.data=r.data,n=((rt.event.special[r.origType]||{}).handle||r.handler).apply(s.elem,a),void 0!==n&&(t.result=n)===!1&&(t.preventDefault(),t.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,t),t.result}},handlers:function(t,e){var i,n,s,r,o=[],a=e.delegateCount,h=t.target;if(a&&h.nodeType&&("click"!==t.type||isNaN(t.button)||t.button<1))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&(h.disabled!==!0||"click"!==t.type)){for(n=[],i=0;i<a;i++)r=e[i],s=r.selector+" ",void 0===n[s]&&(n[s]=r.needsContext?rt(s,this).index(h)>-1:rt.find(s,this,null,[h]).length),n[s]&&n.push(r);n.length&&o.push({elem:h,handlers:n})}return a<e.length&&o.push({elem:this,handlers:e.slice(a)}),o},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var i,n,s,r=e.button;return null==t.pageX&&null!=e.clientX&&(i=t.target.ownerDocument||$,n=i.documentElement,s=i.body,t.pageX=e.clientX+(n&&n.scrollLeft||s&&s.scrollLeft||0)-(n&&n.clientLeft||s&&s.clientLeft||0),t.pageY=e.clientY+(n&&n.scrollTop||s&&s.scrollTop||0)-(n&&n.clientTop||s&&s.clientTop||0)),t.which||void 0===r||(t.which=1&r?1:2&r?3:4&r?2:0),t}},fix:function(t){if(t[rt.expando])return t;var e,i,n,s=t.type,r=t,o=this.fixHooks[s];for(o||(this.fixHooks[s]=o=Bt.test(s)?this.mouseHooks:qt.test(s)?this.keyHooks:{}),n=o.props?this.props.concat(o.props):this.props,t=new rt.Event(r),e=n.length;e--;)i=n[e],t[i]=r[i];return t.target||(t.target=$),3===t.target.nodeType&&(t.target=t.target.parentNode),o.filter?o.filter(t,r):t},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==m()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===m()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&rt.nodeName(this,"input"))return this.click(),!1},_default:function(t){return rt.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},rt.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},rt.Event=function(t,e){return this instanceof rt.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&t.returnValue===!1?d:f):this.type=t,e&&rt.extend(this,e),this.timeStamp=t&&t.timeStamp||rt.now(),void(this[rt.expando]=!0)):new rt.Event(t,e)},rt.Event.prototype={constructor:rt.Event,isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=d,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=d,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=d,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},rt.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){rt.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=this,s=t.relatedTarget,r=t.handleObj;return s&&(s===n||rt.contains(n,s))||(t.type=r.origType,i=r.handler.apply(this,arguments),t.type=e),i}}}),rt.fn.extend({on:function(t,e,i,n){return g(this,t,e,i,n)},one:function(t,e,i,n){return g(this,t,e,i,n,1)},off:function(t,e,i){var n,s;if(t&&t.preventDefault&&t.handleObj)return n=t.handleObj,rt(t.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof t){for(s in t)this.off(s,e,t[s]);return this}return e!==!1&&"function"!=typeof e||(i=e,e=void 0),i===!1&&(i=f),this.each(function(){rt.event.remove(this,t,i,e)})}});var Vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,jt=/<script|<style|<link/i,Ht=/checked\s*(?:[^=]|=\s*.checked.)/i,Ut=/^true\/(.*)/,Xt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;rt.extend({htmlPrefilter:function(t){return t.replace(Vt,"<$1></$2>")},clone:function(t,e,i){var n,s,r,o,a=t.cloneNode(!0),h=rt.contains(t.ownerDocument,t);if(!(nt.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||rt.isXMLDoc(t)))for(o=c(a),r=c(t),n=0,s=r.length;n<s;n++)_(r[n],o[n]);if(e)if(i)for(r=r||c(t),o=o||c(a),n=0,s=r.length;n<s;n++)S(r[n],o[n]);else S(t,a);return o=c(a,"script"),o.length>0&&l(o,!h&&c(t,"script")),a},cleanData:function(t){for(var e,i,n,s=rt.event.special,r=0;void 0!==(i=t[r]);r++)if(Tt(i)){if(e=i[Et.expando]){if(e.events)for(n in e.events)s[n]?rt.event.remove(i,n):rt.removeEvent(i,n,e.handle);i[Et.expando]=void 0}i[wt.expando]&&(i[wt.expando]=void 0)}}}),rt.fn.extend({domManip:R,detach:function(t){return C(this,t,!0)},remove:function(t){return C(this,t)},text:function(t){return Ct(this,function(t){return void 0===t?rt.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)})},null,t,arguments.length)},append:function(){return R(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=v(this,t);e.appendChild(t)}})},prepend:function(){return R(this,arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=v(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return R(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return R(this,arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(rt.cleanData(c(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return rt.clone(this,t,e)})},html:function(t){return Ct(this,function(t){var e=this[0]||{},i=0,n=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!jt.test(t)&&!Lt[(Ot.exec(t)||["",""])[1].toLowerCase()]){t=rt.htmlPrefilter(t);try{for(;i<n;i++)e=this[i]||{},1===e.nodeType&&(rt.cleanData(c(e,!1)),e.innerHTML=t);e=0}catch(s){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=[];return R(this,arguments,function(e){var i=this.parentNode;rt.inArray(this,t)<0&&(rt.cleanData(c(this)),i&&i.replaceChild(e,this))},t)}}),rt.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){rt.fn[t]=function(t){for(var i,n=[],s=rt(t),r=s.length-1,o=0;o<=r;o++)i=o===r?this:this.clone(!0),rt(s[o])[e](i),z.apply(n,i.get());return this.pushStack(n)}});var Yt,Wt={HTML:"block",BODY:"block"},Jt=/^margin/,$t=new RegExp("^("+xt+")(?!px)[a-z%]+$","i"),Kt=function(e){var i=e.ownerDocument.defaultView;return i&&i.opener||(i=t),i.getComputedStyle(e)},Zt=function(t,e,i,n){var s,r,o={};for(r in e)o[r]=t.style[r],t.style[r]=e[r];s=i.apply(t,n||[]);for(r in e)t.style[r]=o[r];return s},zt=$.documentElement;!function(){function e(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",a.innerHTML="",zt.appendChild(o);var e=t.getComputedStyle(a);i="1%"!==e.top,r="2px"===e.marginLeft,n="4px"===e.width,a.style.marginRight="50%",s="4px"===e.marginRight,zt.removeChild(o)}var i,n,s,r,o=$.createElement("div"),a=$.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",nt.clearCloneStyle="content-box"===a.style.backgroundClip,o.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",o.appendChild(a),rt.extend(nt,{pixelPosition:function(){return e(),i},boxSizingReliable:function(){return null==n&&e(),n},pixelMarginRight:function(){return null==n&&e(),s},reliableMarginLeft:function(){return null==n&&e(),r},reliableMarginRight:function(){var e,i=a.appendChild($.createElement("div"));return i.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",a.style.width="1px",zt.appendChild(o),e=!parseFloat(t.getComputedStyle(i).marginRight),zt.removeChild(o),a.removeChild(i),e}}))}();var Qt=/^(none|table(?!-c[ea]).+)/,te={position:"absolute",visibility:"hidden",display:"block"},ee={letterSpacing:"0",fontWeight:"400"},ie=["Webkit","O","Moz","ms"],ne=$.createElement("div").style;rt.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=w(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(t,e,i,n){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var s,r,o,a=rt.camelCase(e),h=t.style;return e=rt.cssProps[a]||(rt.cssProps[a]=D(a)||a),o=rt.cssHooks[e]||rt.cssHooks[a],void 0===i?o&&"get"in o&&void 0!==(s=o.get(t,!1,n))?s:h[e]:(r=typeof i,"string"===r&&(s=Nt.exec(i))&&s[1]&&(i=u(t,e,s),r="number"),null!=i&&i===i&&("number"===r&&(i+=s&&s[3]||(rt.cssNumber[a]?"":"px")),nt.clearCloneStyle||""!==i||0!==e.indexOf("background")||(h[e]="inherit"),o&&"set"in o&&void 0===(i=o.set(t,i,n))||(h[e]=i)),void 0)}},css:function(t,e,i,n){var s,r,o,a=rt.camelCase(e);return e=rt.cssProps[a]||(rt.cssProps[a]=D(a)||a),o=rt.cssHooks[e]||rt.cssHooks[a],o&&"get"in o&&(s=o.get(t,!0,i)),void 0===s&&(s=w(t,e,n)),"normal"===s&&e in ee&&(s=ee[e]),""===i||i?(r=parseFloat(s),i===!0||isFinite(r)?r||0:s):s}}),rt.each(["height","width"],function(t,e){rt.cssHooks[e]={get:function(t,i,n){if(i)return Qt.test(rt.css(t,"display"))&&0===t.offsetWidth?Zt(t,te,function(){return I(t,e,n)}):I(t,e,n)},set:function(t,i,n){var s,r=n&&Kt(t),o=n&&N(t,e,n,"border-box"===rt.css(t,"boxSizing",!1,r),r);return o&&(s=Nt.exec(i))&&"px"!==(s[3]||"px")&&(t.style[e]=i,i=rt.css(t,e)),x(t,i,o)}}}),rt.cssHooks.marginLeft=A(nt.reliableMarginLeft,function(t,e){if(e)return(parseFloat(w(t,"marginLeft"))||t.getBoundingClientRect().left-Zt(t,{marginLeft:0},function(){return t.getBoundingClientRect().left}))+"px"}),rt.cssHooks.marginRight=A(nt.reliableMarginRight,function(t,e){if(e)return Zt(t,{display:"inline-block"},w,[t,"marginRight"])}),rt.each({margin:"",padding:"",border:"Width"},function(t,e){rt.cssHooks[t+e]={expand:function(i){for(var n=0,s={},r="string"==typeof i?i.split(" "):[i];n<4;n++)s[t+It[n]+e]=r[n]||r[n-2]||r[0];return s}},Jt.test(t)||(rt.cssHooks[t+e].set=x)}),rt.fn.extend({css:function(t,e){return Ct(this,function(t,e,i){var n,s,r={},o=0;if(rt.isArray(e)){for(n=Kt(t),s=e.length;o<s;o++)r[e[o]]=rt.css(t,e[o],!1,n);return r}return void 0!==i?rt.style(t,e,i):rt.css(t,e)},t,e,arguments.length>1)},show:function(){return k(this,!0)},hide:function(){return k(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){kt(this)?rt(this).show():rt(this).hide()})}}),rt.Tween=P,P.prototype={constructor:P,init:function(t,e,i,n,s,r){this.elem=t,this.prop=i,this.easing=s||rt.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=r||(rt.cssNumber[i]?"":"px")},cur:function(){var t=P.propHooks[this.prop];return t&&t.get?t.get(this):P.propHooks._default.get(this)},run:function(t){var e,i=P.propHooks[this.prop];return this.options.duration?this.pos=e=rt.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):P.propHooks._default.set(this),this}},P.prototype.init.prototype=P.prototype,P.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=rt.css(t.elem,t.prop,""),e&&"auto"!==e?e:0)},set:function(t){rt.fx.step[t.prop]?rt.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[rt.cssProps[t.prop]]&&!rt.cssHooks[t.prop]?t.elem[t.prop]=t.now:rt.style(t.elem,t.prop,t.now+t.unit)}}},P.propHooks.scrollTop=P.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},rt.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},rt.fx=P.prototype.init,rt.fx.step={};var se,re,oe=/^(?:toggle|show|hide)$/,ae=/queueHooks$/;rt.Animation=rt.extend(B,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return u(i.elem,t,Nt.exec(e),i),i}]},tweener:function(t,e){rt.isFunction(t)?(e=t,t=["*"]):t=t.match(_t);for(var i,n=0,s=t.length;n<s;n++)i=t[n],B.tweeners[i]=B.tweeners[i]||[],B.tweeners[i].unshift(e)},prefilters:[F],prefilter:function(t,e){e?B.prefilters.unshift(t):B.prefilters.push(t)}}),rt.speed=function(t,e,i){var n=t&&"object"==typeof t?rt.extend({},t):{complete:i||!i&&e||rt.isFunction(t)&&t,duration:t,easing:i&&e||e&&!rt.isFunction(e)&&e};return n.duration=rt.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in rt.fx.speeds?rt.fx.speeds[n.duration]:rt.fx.speeds._default,null!=n.queue&&n.queue!==!0||(n.queue="fx"),n.old=n.complete,n.complete=function(){rt.isFunction(n.old)&&n.old.call(this),n.queue&&rt.dequeue(this,n.queue)},n},rt.fn.extend({fadeTo:function(t,e,i,n){return this.filter(kt).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var s=rt.isEmptyObject(t),r=rt.speed(e,i,n),o=function(){var e=B(this,rt.extend({},t),r);(s||Et.get(this,"finish"))&&e.stop(!0)};return o.finish=o,s||r.queue===!1?this.each(o):this.queue(r.queue,o)},stop:function(t,e,i){var n=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,s=null!=t&&t+"queueHooks",r=rt.timers,o=Et.get(this);if(s)o[s]&&o[s].stop&&n(o[s]);else for(s in o)o[s]&&o[s].stop&&ae.test(s)&&n(o[s]);for(s=r.length;s--;)r[s].elem!==this||null!=t&&r[s].queue!==t||(r[s].anim.stop(i),e=!1,r.splice(s,1));!e&&i||rt.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,i=Et.get(this),n=i[t+"queue"],s=i[t+"queueHooks"],r=rt.timers,o=n?n.length:0;for(i.finish=!0,rt.queue(this,t,[]),s&&s.stop&&s.stop.call(this,!0),e=r.length;e--;)r[e].elem===this&&r[e].queue===t&&(r[e].anim.stop(!0),r.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish})}}),rt.each(["toggle","show","hide"],function(t,e){var i=rt.fn[e];rt.fn[e]=function(t,n,s){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(M(e,!0),t,n,s)}}),rt.each({slideDown:M("show"),slideUp:M("hide"),slideToggle:M("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){rt.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),rt.timers=[],rt.fx.tick=function(){var t,e=0,i=rt.timers;for(se=rt.now();e<i.length;e++)t=i[e],t()||i[e]!==t||i.splice(e--,1);i.length||rt.fx.stop(),se=void 0},rt.fx.timer=function(t){
rt.timers.push(t),t()?rt.fx.start():rt.timers.pop()},rt.fx.interval=13,rt.fx.start=function(){re||(re=t.setInterval(rt.fx.tick,rt.fx.interval))},rt.fx.stop=function(){t.clearInterval(re),re=null},rt.fx.speeds={slow:600,fast:200,_default:400},rt.fn.delay=function(e,i){return e=rt.fx?rt.fx.speeds[e]||e:e,i=i||"fx",this.queue(i,function(i,n){var s=t.setTimeout(i,e);n.stop=function(){t.clearTimeout(s)}})},function(){var t=$.createElement("input"),e=$.createElement("select"),i=e.appendChild($.createElement("option"));t.type="checkbox",nt.checkOn=""!==t.value,nt.optSelected=i.selected,e.disabled=!0,nt.optDisabled=!i.disabled,t=$.createElement("input"),t.value="t",t.type="radio",nt.radioValue="t"===t.value}();var he,ue=rt.expr.attrHandle;rt.fn.extend({attr:function(t,e){return Ct(this,rt.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){rt.removeAttr(this,t)})}}),rt.extend({attr:function(t,e,i){var n,s,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return"undefined"==typeof t.getAttribute?rt.prop(t,e,i):(1===r&&rt.isXMLDoc(t)||(e=e.toLowerCase(),s=rt.attrHooks[e]||(rt.expr.match.bool.test(e)?he:void 0)),void 0!==i?null===i?void rt.removeAttr(t,e):s&&"set"in s&&void 0!==(n=s.set(t,i,e))?n:(t.setAttribute(e,i+""),i):s&&"get"in s&&null!==(n=s.get(t,e))?n:(n=rt.find.attr(t,e),null==n?void 0:n))},attrHooks:{type:{set:function(t,e){if(!nt.radioValue&&"radio"===e&&rt.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n,s=0,r=e&&e.match(_t);if(r&&1===t.nodeType)for(;i=r[s++];)n=rt.propFix[i]||i,rt.expr.match.bool.test(i)&&(t[n]=!1),t.removeAttribute(i)}}),he={set:function(t,e,i){return e===!1?rt.removeAttr(t,i):t.setAttribute(i,i),i}},rt.each(rt.expr.match.bool.source.match(/\w+/g),function(t,e){var i=ue[e]||rt.find.attr;ue[e]=function(t,e,n){var s,r;return n||(r=ue[e],ue[e]=s,s=null!=i(t,e,n)?e.toLowerCase():null,ue[e]=r),s}});var ce=/^(?:input|select|textarea|button)$/i,le=/^(?:a|area)$/i;rt.fn.extend({prop:function(t,e){return Ct(this,rt.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[rt.propFix[t]||t]})}}),rt.extend({prop:function(t,e,i){var n,s,r=t.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&rt.isXMLDoc(t)||(e=rt.propFix[e]||e,s=rt.propHooks[e]),void 0!==i?s&&"set"in s&&void 0!==(n=s.set(t,i,e))?n:t[e]=i:s&&"get"in s&&null!==(n=s.get(t,e))?n:t[e]},propHooks:{tabIndex:{get:function(t){var e=rt.find.attr(t,"tabindex");return e?parseInt(e,10):ce.test(t.nodeName)||le.test(t.nodeName)&&t.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),nt.optSelected||(rt.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),rt.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){rt.propFix[this.toLowerCase()]=this});var pe=/[\t\r\n\f]/g;rt.fn.extend({addClass:function(t){var e,i,n,s,r,o,a,h=0;if(rt.isFunction(t))return this.each(function(e){rt(this).addClass(t.call(this,e,G(this)))});if("string"==typeof t&&t)for(e=t.match(_t)||[];i=this[h++];)if(s=G(i),n=1===i.nodeType&&(" "+s+" ").replace(pe," ")){for(o=0;r=e[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");a=rt.trim(n),s!==a&&i.setAttribute("class",a)}return this},removeClass:function(t){var e,i,n,s,r,o,a,h=0;if(rt.isFunction(t))return this.each(function(e){rt(this).removeClass(t.call(this,e,G(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof t&&t)for(e=t.match(_t)||[];i=this[h++];)if(s=G(i),n=1===i.nodeType&&(" "+s+" ").replace(pe," ")){for(o=0;r=e[o++];)for(;n.indexOf(" "+r+" ")>-1;)n=n.replace(" "+r+" "," ");a=rt.trim(n),s!==a&&i.setAttribute("class",a)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):rt.isFunction(t)?this.each(function(i){rt(this).toggleClass(t.call(this,i,G(this),e),e)}):this.each(function(){var e,n,s,r;if("string"===i)for(n=0,s=rt(this),r=t.match(_t)||[];e=r[n++];)s.hasClass(e)?s.removeClass(e):s.addClass(e);else void 0!==t&&"boolean"!==i||(e=G(this),e&&Et.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||t===!1?"":Et.get(this,"__className__")||""))})},hasClass:function(t){var e,i,n=0;for(e=" "+t+" ";i=this[n++];)if(1===i.nodeType&&(" "+G(i)+" ").replace(pe," ").indexOf(e)>-1)return!0;return!1}});var de=/\r/g,fe=/[\x20\t\r\n\f]+/g;rt.fn.extend({val:function(t){var e,i,n,s=this[0];{if(arguments.length)return n=rt.isFunction(t),this.each(function(i){var s;1===this.nodeType&&(s=n?t.call(this,i,rt(this).val()):t,null==s?s="":"number"==typeof s?s+="":rt.isArray(s)&&(s=rt.map(s,function(t){return null==t?"":t+""})),e=rt.valHooks[this.type]||rt.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,s,"value")||(this.value=s))});if(s)return e=rt.valHooks[s.type]||rt.valHooks[s.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(i=e.get(s,"value"))?i:(i=s.value,"string"==typeof i?i.replace(de,""):null==i?"":i)}}}),rt.extend({valHooks:{option:{get:function(t){var e=rt.find.attr(t,"value");return null!=e?e:rt.trim(rt.text(t)).replace(fe," ")}},select:{get:function(t){for(var e,i,n=t.options,s=t.selectedIndex,r="select-one"===t.type||s<0,o=r?null:[],a=r?s+1:n.length,h=s<0?a:r?s:0;h<a;h++)if(i=n[h],(i.selected||h===s)&&(nt.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!rt.nodeName(i.parentNode,"optgroup"))){if(e=rt(i).val(),r)return e;o.push(e)}return o},set:function(t,e){for(var i,n,s=t.options,r=rt.makeArray(e),o=s.length;o--;)n=s[o],(n.selected=rt.inArray(rt.valHooks.option.get(n),r)>-1)&&(i=!0);return i||(t.selectedIndex=-1),r}}}}),rt.each(["radio","checkbox"],function(){rt.valHooks[this]={set:function(t,e){if(rt.isArray(e))return t.checked=rt.inArray(rt(t).val(),e)>-1}},nt.checkOn||(rt.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})});var me=/^(?:focusinfocus|focusoutblur)$/;rt.extend(rt.event,{trigger:function(e,i,n,s){var r,o,a,h,u,c,l,p=[n||$],d=it.call(e,"type")?e.type:e,f=it.call(e,"namespace")?e.namespace.split("."):[];if(o=a=n=n||$,3!==n.nodeType&&8!==n.nodeType&&!me.test(d+rt.event.triggered)&&(d.indexOf(".")>-1&&(f=d.split("."),d=f.shift(),f.sort()),u=d.indexOf(":")<0&&"on"+d,e=e[rt.expando]?e:new rt.Event(d,"object"==typeof e&&e),e.isTrigger=s?2:3,e.namespace=f.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),i=null==i?[e]:rt.makeArray(i,[e]),l=rt.event.special[d]||{},s||!l.trigger||l.trigger.apply(n,i)!==!1)){if(!s&&!l.noBubble&&!rt.isWindow(n)){for(h=l.delegateType||d,me.test(h+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||$)&&p.push(a.defaultView||a.parentWindow||t)}for(r=0;(o=p[r++])&&!e.isPropagationStopped();)e.type=r>1?h:l.bindType||d,c=(Et.get(o,"events")||{})[e.type]&&Et.get(o,"handle"),c&&c.apply(o,i),c=u&&o[u],c&&c.apply&&Tt(o)&&(e.result=c.apply(o,i),e.result===!1&&e.preventDefault());return e.type=d,s||e.isDefaultPrevented()||l._default&&l._default.apply(p.pop(),i)!==!1||!Tt(n)||u&&rt.isFunction(n[d])&&!rt.isWindow(n)&&(a=n[u],a&&(n[u]=null),rt.event.triggered=d,n[d](),rt.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(t,e,i){var n=rt.extend(new rt.Event,i,{type:t,isSimulated:!0});rt.event.trigger(n,null,e)}}),rt.fn.extend({trigger:function(t,e){return this.each(function(){rt.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];if(i)return rt.event.trigger(t,e,i,!0)}}),rt.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){rt.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),rt.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),nt.focusin="onfocusin"in t,nt.focusin||rt.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){rt.event.simulate(e,t.target,rt.event.fix(t))};rt.event.special[e]={setup:function(){var n=this.ownerDocument||this,s=Et.access(n,e);s||n.addEventListener(t,i,!0),Et.access(n,e,(s||0)+1)},teardown:function(){var n=this.ownerDocument||this,s=Et.access(n,e)-1;s?Et.access(n,e,s):(n.removeEventListener(t,i,!0),Et.remove(n,e))}}});var ge=t.location,ve=rt.now(),ye=/\?/;rt.parseJSON=function(t){return JSON.parse(t+"")},rt.parseXML=function(e){var i;if(!e||"string"!=typeof e)return null;try{i=(new t.DOMParser).parseFromString(e,"text/xml")}catch(n){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||rt.error("Invalid XML: "+e),i};var be=/#.*$/,Se=/([?&])_=[^&]*/,_e=/^(.*?):[ \t]*([^\r\n]*)$/gm,Re=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ce=/^(?:GET|HEAD)$/,Te=/^\/\//,Ee={},we={},Ae="*/".concat("*"),De=$.createElement("a");De.href=ge.href,rt.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ge.href,type:"GET",isLocal:Re.test(ge.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ae,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":rt.parseJSON,"text xml":rt.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?H(H(t,rt.ajaxSettings),e):H(rt.ajaxSettings,t)},ajaxPrefilter:V(Ee),ajaxTransport:V(we),ajax:function(e,i){function n(e,i,n,a){var u,l,y,b,_,C=i;2!==S&&(S=2,h&&t.clearTimeout(h),s=void 0,o=a||"",R.readyState=e>0?4:0,u=e>=200&&e<300||304===e,n&&(b=U(p,R,n)),b=X(p,b,R,u),u?(p.ifModified&&(_=R.getResponseHeader("Last-Modified"),_&&(rt.lastModified[r]=_),_=R.getResponseHeader("etag"),_&&(rt.etag[r]=_)),204===e||"HEAD"===p.type?C="nocontent":304===e?C="notmodified":(C=b.state,l=b.data,y=b.error,u=!y)):(y=C,!e&&C||(C="error",e<0&&(e=0))),R.status=e,R.statusText=(i||C)+"",u?m.resolveWith(d,[l,C,R]):m.rejectWith(d,[R,C,y]),R.statusCode(v),v=void 0,c&&f.trigger(u?"ajaxSuccess":"ajaxError",[R,p,u?l:y]),g.fireWith(d,[R,C]),c&&(f.trigger("ajaxComplete",[R,p]),--rt.active||rt.event.trigger("ajaxStop")))}"object"==typeof e&&(i=e,e=void 0),i=i||{};var s,r,o,a,h,u,c,l,p=rt.ajaxSetup({},i),d=p.context||p,f=p.context&&(d.nodeType||d.jquery)?rt(d):rt.event,m=rt.Deferred(),g=rt.Callbacks("once memory"),v=p.statusCode||{},y={},b={},S=0,_="canceled",R={readyState:0,getResponseHeader:function(t){var e;if(2===S){if(!a)for(a={};e=_e.exec(o);)a[e[1].toLowerCase()]=e[2];e=a[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===S?o:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return S||(t=b[i]=b[i]||t,y[t]=e),this},overrideMimeType:function(t){return S||(p.mimeType=t),this},statusCode:function(t){var e;if(t)if(S<2)for(e in t)v[e]=[v[e],t[e]];else R.always(t[R.status]);return this},abort:function(t){var e=t||_;return s&&s.abort(e),n(0,e),this}};if(m.promise(R).complete=g.add,R.success=R.done,R.error=R.fail,p.url=((e||p.url||ge.href)+"").replace(be,"").replace(Te,ge.protocol+"//"),p.type=i.method||i.type||p.method||p.type,p.dataTypes=rt.trim(p.dataType||"*").toLowerCase().match(_t)||[""],null==p.crossDomain){u=$.createElement("a");try{u.href=p.url,u.href=u.href,p.crossDomain=De.protocol+"//"+De.host!=u.protocol+"//"+u.host}catch(C){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=rt.param(p.data,p.traditional)),j(Ee,p,i,R),2===S)return R;c=rt.event&&p.global,c&&0===rt.active++&&rt.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Ce.test(p.type),r=p.url,p.hasContent||(p.data&&(r=p.url+=(ye.test(r)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=Se.test(r)?r.replace(Se,"$1_="+ve++):r+(ye.test(r)?"&":"?")+"_="+ve++)),p.ifModified&&(rt.lastModified[r]&&R.setRequestHeader("If-Modified-Since",rt.lastModified[r]),rt.etag[r]&&R.setRequestHeader("If-None-Match",rt.etag[r])),(p.data&&p.hasContent&&p.contentType!==!1||i.contentType)&&R.setRequestHeader("Content-Type",p.contentType),R.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Ae+"; q=0.01":""):p.accepts["*"]);for(l in p.headers)R.setRequestHeader(l,p.headers[l]);if(p.beforeSend&&(p.beforeSend.call(d,R,p)===!1||2===S))return R.abort();_="abort";for(l in{success:1,error:1,complete:1})R[l](p[l]);if(s=j(we,p,i,R)){if(R.readyState=1,c&&f.trigger("ajaxSend",[R,p]),2===S)return R;p.async&&p.timeout>0&&(h=t.setTimeout(function(){R.abort("timeout")},p.timeout));try{S=1,s.send(y,n)}catch(C){if(!(S<2))throw C;n(-1,C)}}else n(-1,"No Transport");return R},getJSON:function(t,e,i){return rt.get(t,e,i,"json")},getScript:function(t,e){return rt.get(t,void 0,e,"script")}}),rt.each(["get","post"],function(t,e){rt[e]=function(t,i,n,s){return rt.isFunction(i)&&(s=s||n,n=i,i=void 0),rt.ajax(rt.extend({url:t,type:e,dataType:s,data:i,success:n},rt.isPlainObject(t)&&t))}}),rt._evalUrl=function(t){return rt.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},rt.fn.extend({wrapAll:function(t){var e;return rt.isFunction(t)?this.each(function(e){rt(this).wrapAll(t.call(this,e))}):(this[0]&&(e=rt(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this)},wrapInner:function(t){return rt.isFunction(t)?this.each(function(e){rt(this).wrapInner(t.call(this,e))}):this.each(function(){var e=rt(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=rt.isFunction(t);return this.each(function(i){rt(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(){return this.parent().each(function(){rt.nodeName(this,"body")||rt(this).replaceWith(this.childNodes)}).end()}}),rt.expr.filters.hidden=function(t){return!rt.expr.filters.visible(t)},rt.expr.filters.visible=function(t){return t.offsetWidth>0||t.offsetHeight>0||t.getClientRects().length>0};var xe=/%20/g,Ne=/\[\]$/,Ie=/\r?\n/g,ke=/^(?:submit|button|image|reset|file)$/i,Pe=/^(?:input|select|textarea|keygen)/i;rt.param=function(t,e){var i,n=[],s=function(t,e){e=rt.isFunction(e)?e():null==e?"":e,n[n.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(void 0===e&&(e=rt.ajaxSettings&&rt.ajaxSettings.traditional),rt.isArray(t)||t.jquery&&!rt.isPlainObject(t))rt.each(t,function(){s(this.name,this.value)});else for(i in t)Y(i,t[i],e,s);return n.join("&").replace(xe,"+")},rt.fn.extend({serialize:function(){return rt.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=rt.prop(this,"elements");return t?rt.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!rt(this).is(":disabled")&&Pe.test(this.nodeName)&&!ke.test(t)&&(this.checked||!Pt.test(t))}).map(function(t,e){var i=rt(this).val();return null==i?null:rt.isArray(i)?rt.map(i,function(t){return{name:e.name,value:t.replace(Ie,"\r\n")}}):{name:e.name,value:i.replace(Ie,"\r\n")}}).get()}}),rt.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(e){}};var Oe={0:200,1223:204},Me=rt.ajaxSettings.xhr();nt.cors=!!Me&&"withCredentials"in Me,nt.ajax=Me=!!Me,rt.ajaxTransport(function(e){var i,n;if(nt.cors||Me&&!e.crossDomain)return{send:function(s,r){var o,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)a[o]=e.xhrFields[o];e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||s["X-Requested-With"]||(s["X-Requested-With"]="XMLHttpRequest");for(o in s)a.setRequestHeader(o,s[o]);i=function(t){return function(){i&&(i=n=a.onload=a.onerror=a.onabort=a.onreadystatechange=null,"abort"===t?a.abort():"error"===t?"number"!=typeof a.status?r(0,"error"):r(a.status,a.statusText):r(Oe[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=i(),n=a.onerror=i("error"),void 0!==a.onabort?a.onabort=n:a.onreadystatechange=function(){4===a.readyState&&t.setTimeout(function(){i&&n()})},i=i("abort");try{a.send(e.hasContent&&e.data||null)}catch(h){if(i)throw h}},abort:function(){i&&i()}}}),rt.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return rt.globalEval(t),t}}}),rt.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),rt.ajaxTransport("script",function(t){if(t.crossDomain){var e,i;return{send:function(n,s){e=rt("<script>").prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&s("error"===t.type?404:200,t.type)}),$.head.appendChild(e[0])},abort:function(){i&&i()}}}});var Le=[],Fe=/(=)\?(?=&|$)|\?\?/;rt.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Le.pop()||rt.expando+"_"+ve++;return this[t]=!0,t}}),rt.ajaxPrefilter("json jsonp",function(e,i,n){var s,r,o,a=e.jsonp!==!1&&(Fe.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Fe.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return s=e.jsonpCallback=rt.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Fe,"$1"+s):e.jsonp!==!1&&(e.url+=(ye.test(e.url)?"&":"?")+e.jsonp+"="+s),e.converters["script json"]=function(){return o||rt.error(s+" was not called"),o[0]},e.dataTypes[0]="json",r=t[s],t[s]=function(){o=arguments},n.always(function(){void 0===r?rt(t).removeProp(s):t[s]=r,e[s]&&(e.jsonpCallback=i.jsonpCallback,Le.push(s)),o&&rt.isFunction(r)&&r(o[0]),o=r=void 0}),"script"}),rt.parseHTML=function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||$;var n=ft.exec(t),s=!i&&[];return n?[e.createElement(n[1])]:(n=p([t],e,s),s&&s.length&&rt(s).remove(),rt.merge([],n.childNodes))};var qe=rt.fn.load;rt.fn.load=function(t,e,i){if("string"!=typeof t&&qe)return qe.apply(this,arguments);var n,s,r,o=this,a=t.indexOf(" ");return a>-1&&(n=rt.trim(t.slice(a)),t=t.slice(0,a)),rt.isFunction(e)?(i=e,e=void 0):e&&"object"==typeof e&&(s="POST"),o.length>0&&rt.ajax({url:t,type:s||"GET",dataType:"html",data:e}).done(function(t){r=arguments,o.html(n?rt("<div>").append(rt.parseHTML(t)).find(n):t)}).always(i&&function(t,e){o.each(function(){i.apply(this,r||[t.responseText,e,t])})}),this},rt.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){rt.fn[e]=function(t){return this.on(e,t)}}),rt.expr.filters.animated=function(t){return rt.grep(rt.timers,function(e){return t===e.elem}).length},rt.offset={setOffset:function(t,e,i){var n,s,r,o,a,h,u,c=rt.css(t,"position"),l=rt(t),p={};"static"===c&&(t.style.position="relative"),a=l.offset(),r=rt.css(t,"top"),h=rt.css(t,"left"),u=("absolute"===c||"fixed"===c)&&(r+h).indexOf("auto")>-1,u?(n=l.position(),o=n.top,s=n.left):(o=parseFloat(r)||0,s=parseFloat(h)||0),rt.isFunction(e)&&(e=e.call(t,i,rt.extend({},a))),null!=e.top&&(p.top=e.top-a.top+o),null!=e.left&&(p.left=e.left-a.left+s),"using"in e?e.using.call(t,p):l.css(p)}},rt.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){rt.offset.setOffset(this,t,e)});var e,i,n=this[0],s={top:0,left:0},r=n&&n.ownerDocument;if(r)return e=r.documentElement,rt.contains(e,n)?(s=n.getBoundingClientRect(),i=W(r),{top:s.top+i.pageYOffset-e.clientTop,left:s.left+i.pageXOffset-e.clientLeft}):s},position:function(){if(this[0]){var t,e,i=this[0],n={top:0,left:0};return"fixed"===rt.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),rt.nodeName(t[0],"html")||(n=t.offset()),n.top+=rt.css(t[0],"borderTopWidth",!0),n.left+=rt.css(t[0],"borderLeftWidth",!0)),{top:e.top-n.top-rt.css(i,"marginTop",!0),left:e.left-n.left-rt.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent;t&&"static"===rt.css(t,"position");)t=t.offsetParent;return t||zt})}}),rt.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,e){var i="pageYOffset"===e;rt.fn[t]=function(n){return Ct(this,function(t,n,s){var r=W(t);return void 0===s?r?r[e]:t[n]:void(r?r.scrollTo(i?r.pageXOffset:s,i?s:r.pageYOffset):t[n]=s)},t,n,arguments.length)}}),rt.each(["top","left"],function(t,e){rt.cssHooks[e]=A(nt.pixelPosition,function(t,i){if(i)return i=w(t,e),$t.test(i)?rt(t).position()[e]+"px":i})}),rt.each({Height:"height",Width:"width"},function(t,e){rt.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,n){rt.fn[n]=function(n,s){var r=arguments.length&&(i||"boolean"!=typeof n),o=i||(n===!0||s===!0?"margin":"border");return Ct(this,function(e,i,n){var s;return rt.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(s=e.documentElement,Math.max(e.body["scroll"+t],s["scroll"+t],e.body["offset"+t],s["offset"+t],s["client"+t])):void 0===n?rt.css(e,i,o):rt.style(e,i,n,o)},e,r?n:void 0,r,null)}})}),rt.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},size:function(){return this.length}}),rt.fn.andSelf=rt.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return rt});var Be=t.jQuery,Ge=t.$;return rt.noConflict=function(e){return t.$===rt&&(t.$=Ge),e&&t.jQuery===rt&&(t.jQuery=Be),rt},e||(t.jQuery=t.$=rt),rt}),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.adapter=t()}}(function(){return function t(e,i,n){function s(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){var i=e[o][1][t];return s(i?i:t)},c,c.exports,t,e,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,e,i){"use strict";var n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(t){return t.trim().split("\n").map(function(t){return t.trim()})},n.splitSections=function(t){var e=t.split("\nm=");return e.map(function(t,e){return(e>0?"m="+t:t).trim()+"\r\n"})},n.matchPrefix=function(t,e){return n.splitLines(t).filter(function(t){return 0===t.indexOf(e)})},n.parseCandidate=function(t){var e;e=0===t.indexOf("a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" ");for(var i={foundation:e[0],component:e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],port:parseInt(e[5],10),type:e[7]},n=8;n<e.length;n+=2)switch(e[n]){case"raddr":i.relatedAddress=e[n+1];break;case"rport":i.relatedPort=parseInt(e[n+1],10);break;case"tcptype":i.tcpType=e[n+1]}return i},n.writeCandidate=function(t){var e=[];e.push(t.foundation),e.push(t.component),e.push(t.protocol.toUpperCase()),e.push(t.priority),e.push(t.ip),e.push(t.port);var i=t.type;return e.push("typ"),e.push(i),"host"!==i&&t.relatedAddress&&t.relatedPort&&(e.push("raddr"),e.push(t.relatedAddress),e.push("rport"),e.push(t.relatedPort)),t.tcpType&&"tcp"===t.protocol.toLowerCase()&&(e.push("tcptype"),e.push(t.tcpType)),"candidate:"+e.join(" ")},n.parseRtpMap=function(t){var e=t.substr(9).split(" "),i={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),i.name=e[0],i.clockRate=parseInt(e[1],10),i.numChannels=3===e.length?parseInt(e[2],10):1,i},n.writeRtpMap=function(t){var e=t.payloadType;return void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType),"a=rtpmap:"+e+" "+t.name+"/"+t.clockRate+(1!==t.numChannels?"/"+t.numChannels:"")+"\r\n"},n.parseExtmap=function(t){var e=t.substr(9).split(" ");return{id:parseInt(e[0],10),uri:e[1]}},n.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+" "+t.uri+"\r\n"},n.parseFmtp=function(t){for(var e,i={},n=t.substr(t.indexOf(" ")+1).split(";"),s=0;s<n.length;s++)e=n[s].trim().split("="),i[e[0].trim()]=e[1];return i},n.writeFmtp=function(t){var e="",i=t.payloadType;if(void 0!==t.preferredPayloadType&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var n=[];Object.keys(t.parameters).forEach(function(e){n.push(e+"="+t.parameters[e])}),e+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return e},n.parseRtcpFb=function(t){var e=t.substr(t.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},n.writeRtcpFb=function(t){var e="",i=t.payloadType;return void 0!==t.preferredPayloadType&&(i=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(t){e+="a=rtcp-fb:"+i+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+"\r\n"}),e},n.parseSsrcMedia=function(t){var e=t.indexOf(" "),i={ssrc:parseInt(t.substr(7,e-7),10)},n=t.indexOf(":",e);return n>-1?(i.attribute=t.substr(e+1,n-e-1),i.value=t.substr(n+1)):i.attribute=t.substr(e+1),i},n.getDtlsParameters=function(t,e){var i=n.splitLines(t);i=i.concat(n.splitLines(e));var s=i.filter(function(t){return 0===t.indexOf("a=fingerprint:")})[0].substr(14),r={role:"auto",fingerprints:[{algorithm:s.split(" ")[0],value:s.split(" ")[1]}]};return r},n.writeDtlsParameters=function(t,e){var i="a=setup:"+e+"\r\n";return t.fingerprints.forEach(function(t){i+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"}),i},n.getIceParameters=function(t,e){var i=n.splitLines(t);i=i.concat(n.splitLines(e));var s={usernameFragment:i.filter(function(t){return 0===t.indexOf("a=ice-ufrag:")})[0].substr(12),password:i.filter(function(t){return 0===t.indexOf("a=ice-pwd:")})[0].substr(10)};return s},n.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+"\r\na=ice-pwd:"+t.password+"\r\n"},n.parseRtpParameters=function(t){for(var e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=n.splitLines(t),s=i[0].split(" "),r=3;r<s.length;r++){var o=s[r],a=n.matchPrefix(t,"a=rtpmap:"+o+" ")[0];if(a){var h=n.parseRtpMap(a),u=n.matchPrefix(t,"a=fmtp:"+o+" ");switch(h.parameters=u.length?n.parseFmtp(u[0]):{},h.rtcpFeedback=n.matchPrefix(t,"a=rtcp-fb:"+o+" ").map(n.parseRtcpFb),e.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(h.name.toUpperCase())}}}return n.matchPrefix(t,"a=extmap:").forEach(function(t){e.headerExtensions.push(n.parseExtmap(t))}),e},n.writeRtpDescription=function(t,e){var i="";return i+="m="+t+" ",i+=e.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=e.codecs.map(function(t){return void 0!==t.preferredPayloadType?t.preferredPayloadType:t.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",e.codecs.forEach(function(t){i+=n.writeRtpMap(t),i+=n.writeFmtp(t),i+=n.writeRtcpFb(t)}),i+="a=rtcp-mux\r\n"},n.parseRtpEncodingParameters=function(t){var e,i=[],s=n.parseRtpParameters(t),r=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,a=n.matchPrefix(t,"a=ssrc:").map(function(t){return n.parseSsrcMedia(t)}).filter(function(t){return"cname"===t.attribute}),h=a.length>0&&a[0].ssrc,u=n.matchPrefix(t,"a=ssrc-group:FID").map(function(t){var e=t.split(" ");return e.shift(),e.map(function(t){return parseInt(t,10)})});u.length>0&&u[0].length>1&&u[0][0]===h&&(e=u[0][1]),s.codecs.forEach(function(t){if("RTX"===t.name.toUpperCase()&&t.parameters.apt){var n={ssrc:h,codecPayloadType:parseInt(t.parameters.apt,10),rtx:{payloadType:t.payloadType,ssrc:e}};i.push(n),r&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:e,mechanism:o?"red+ulpfec":"red"},i.push(n))}}),0===i.length&&h&&i.push({ssrc:h});var c=n.matchPrefix(t,"b=");return c.length&&(0===c[0].indexOf("b=TIAS:")?c=parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")&&(c=parseInt(c[0].substr(5),10)),i.forEach(function(t){t.maxBitrate=c})),i},n.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(t,e,i,s){var r=n.writeRtpDescription(t.kind,e);if(r+=n.writeIceParameters(t.iceGatherer.getLocalParameters()),r+=n.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),r+="a=mid:"+t.mid+"\r\n",r+=t.rtpSender&&t.rtpReceiver?"a=sendrecv\r\n":t.rtpSender?"a=sendonly\r\n":t.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",t.rtpSender){var o="msid:"+s.id+" "+t.rtpSender.track.id+"\r\n";r+="a="+o,r+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+o}return r+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n"},n.getDirection=function(t,e){for(var i=n.splitLines(t),s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substr(2)}return e?n.getDirection(e):"sendrecv"},e.exports=n},{}],2:[function(t,e,i){"use strict";!function(){var i=t("./utils").log,n=t("./utils").browserDetails;e.exports.browserDetails=n,e.exports.extractVersion=t("./utils").extractVersion,e.exports.disableLog=t("./utils").disableLog;var s=t("./chrome/chrome_shim")||null,r=t("./edge/edge_shim")||null,o=t("./firefox/firefox_shim")||null,a=t("./safari/safari_shim")||null;switch(n.browser){case"opera":case"chrome":if(!s||!s.shimPeerConnection)return void i("Chrome shim is not included in this adapter release.");i("adapter.js shimming chrome."),e.exports.browserShim=s,s.shimGetUserMedia(),s.shimMediaStream(),s.shimSourceObject(),s.shimPeerConnection(),s.shimOnTrack();break;case"firefox":if(!o||!o.shimPeerConnection)return void i("Firefox shim is not included in this adapter release.");i("adapter.js shimming firefox."),e.exports.browserShim=o,o.shimGetUserMedia(),o.shimSourceObject(),o.shimPeerConnection(),o.shimOnTrack();break;case"edge":if(!r||!r.shimPeerConnection)return void i("MS edge shim is not included in this adapter release.");i("adapter.js shimming edge."),e.exports.browserShim=r,r.shimGetUserMedia(),r.shimPeerConnection();break;case"safari":if(!a)return void i("Safari shim is not included in this adapter release.");i("adapter.js shimming safari."),e.exports.browserShim=a,a.shimGetUserMedia();break;default:i("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":7,"./safari/safari_shim":9,"./utils":10}],3:[function(t,e,i){"use strict";var n=t("../utils.js").log,s=t("../utils.js").browserDetails,r={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){var e=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=t),this.addEventListener("addstream",this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(i){var n=new Event("track");n.track=i.track,n.receiver={track:i.track},n.streams=[t.stream],e.dispatchEvent(n)}),t.stream.getTracks().forEach(function(e){var i=new Event("track");i.track=e,i.receiver={track:e},i.streams=[t.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{
get:function(){return this._srcObject},set:function(t){var e=this;return this._srcObject=t,this.src&&URL.revokeObjectURL(this.src),t?(this.src=URL.createObjectURL(t),t.addEventListener("addtrack",function(){e.src&&URL.revokeObjectURL(e.src),e.src=URL.createObjectURL(t)}),void t.addEventListener("removetrack",function(){e.src&&URL.revokeObjectURL(e.src),e.src=URL.createObjectURL(t)})):void(this.src="")}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(t,e){n("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy);var i=new webkitRTCPeerConnection(t,e),s=i.getStats.bind(i);return i.getStats=function(t,e,i){var n=this,r=arguments;if(arguments.length>0&&"function"==typeof t)return s(t,e);var o=function(t){var e={},i=t.result();return i.forEach(function(t){var i={id:t.id,timestamp:t.timestamp,type:t.type};t.names().forEach(function(e){i[e]=t.stat(e)}),e[i.id]=i}),e},a=function(t,e){var i=new Map(Object.keys(t).map(function(e){return[e,t[e]]}));return e=e||t,Object.keys(e).forEach(function(t){i[t]=e[t]}),i};if(arguments.length>=2){var h=function(t){r[1](a(o(t)))};return s.apply(this,[h,arguments[0]])}return new Promise(function(e,i){1===r.length&&"object"==typeof t?s.apply(n,[function(t){e(a(o(t)))},i]):s.apply(n,[function(t){e(a(o(t),t.result()))},i])}).then(e,i)},i},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(t){var e=webkitRTCPeerConnection.prototype[t];webkitRTCPeerConnection.prototype[t]=function(){var t=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var i=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,s){e.apply(t,[n,s,i])})}return e.apply(this,arguments)}}),s.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=webkitRTCPeerConnection.prototype[t];webkitRTCPeerConnection.prototype[t]=function(){var t=arguments,i=this,n=new Promise(function(n,s){e.apply(i,[t[0],n,s])});return t.length<2?n:n.then(function(){t[1].apply(null,[])},function(e){t.length>=3&&t[2].apply(null,[e])})}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=webkitRTCPeerConnection.prototype[t];webkitRTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?RTCIceCandidate:RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}});var t=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():t.apply(this,arguments)}}};e.exports={shimMediaStream:r.shimMediaStream,shimOnTrack:r.shimOnTrack,shimSourceObject:r.shimSourceObject,shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:t("./getusermedia")}},{"../utils.js":10,"./getusermedia":4}],4:[function(t,e,i){"use strict";var n=t("../utils.js").log;e.exports=function(){var t=function(t){if("object"!=typeof t||t.mandatory||t.optional)return t;var e={};return Object.keys(t).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var n="object"==typeof t[i]?t[i]:{ideal:t[i]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var s=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e};if(void 0!==n.ideal){e.optional=e.optional||[];var r={};"number"==typeof n.ideal?(r[s("min",i)]=n.ideal,e.optional.push(r),r={},r[s("max",i)]=n.ideal,e.optional.push(r)):(r[s("",i)]=n.ideal,e.optional.push(r))}void 0!==n.exact&&"number"!=typeof n.exact?(e.mandatory=e.mandatory||{},e.mandatory[s("",i)]=n.exact):["min","max"].forEach(function(t){void 0!==n[t]&&(e.mandatory=e.mandatory||{},e.mandatory[s(t,i)]=n[t])})}}),t.advanced&&(e.optional=(e.optional||[]).concat(t.advanced)),e},e=function(e,i){if(e=JSON.parse(JSON.stringify(e)),e&&e.audio&&(e.audio=t(e.audio)),e&&"object"==typeof e.video){var s=e.video.facingMode;if(s=s&&("object"==typeof s?s:{ideal:s}),s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal))return navigator.mediaDevices.enumerateDevices().then(function(r){r=r.filter(function(t){return"videoinput"===t.kind});var o=r.find(function(t){return t.label.toLowerCase().indexOf("back")!==-1})||r.length&&r[r.length-1];return o&&(e.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=t(e.video),n("chrome: "+JSON.stringify(e)),i(e)});e.video=t(e.video)}return n("chrome: "+JSON.stringify(e)),i(e)},i=function(t){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[t.name]||t.name,message:t.message,constraint:t.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(t,n,s){e(t,function(t){navigator.webkitGetUserMedia(t,n,function(t){s(i(t))})})};navigator.getUserMedia=s;var r=function(t){return new Promise(function(e,i){navigator.getUserMedia(t,e,i)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:r,enumerateDevices:function(){return new Promise(function(t){var e={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(i){t(i.map(function(t){return{label:t.label,kind:e[t.kind],deviceId:t.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return e(t,function(t){return o(t)["catch"](function(t){return Promise.reject(i(t))})})}}else navigator.mediaDevices.getUserMedia=function(t){return r(t)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){n("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){n("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":10}],5:[function(t,e,i){"use strict";var n=t("sdp"),s=t("../utils").browserDetails,r={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(t){return t}),window.RTCSessionDescription||(window.RTCSessionDescription=function(t){return t})),window.RTCPeerConnection=function(t){var e=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(t){e[t]=i[t].bind(i)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return e.localStreams},this.getRemoteStreams=function(){return e.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},t&&t.iceTransportPolicy)switch(t.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=t.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=t&&"max-bundle"===t.bundlePolicy,t&&t.iceServers){var n=JSON.parse(JSON.stringify(t.iceServers));this.iceOptions.iceServers=n.filter(function(t){if(t&&t.urls){var e=t.urls;return"string"==typeof e&&(e=[e]),e=e.filter(function(t){return 0===t.indexOf("turn:")&&t.indexOf("transport=udp")!==-1&&t.indexOf("turn:[")===-1||0===t.indexOf("stun:")&&s.version>=14393})[0],!!e}return!1})}this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var t=this,e=n.splitSections(t.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(i){var n=!i.candidate||0===Object.keys(i.candidate).length;if(n)for(var s=1;s<e.length;s++)e[s].indexOf("\r\na=end-of-candidates\r\n")===-1&&(e[s]+="a=end-of-candidates\r\n");else i.candidate.candidate.indexOf("typ endOfCandidates")===-1&&(e[i.candidate.sdpMLineIndex+1]+="a="+i.candidate.candidate+"\r\n");if(t.localDescription.sdp=e.join(""),t.dispatchEvent(i),null!==t.onicecandidate&&t.onicecandidate(i),!i.candidate&&"complete"!==t.iceGatheringState){var r=t.transceivers.every(function(t){return t.iceGatherer&&"completed"===t.iceGatherer.state});r&&(t.iceGatheringState="complete")}}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(t){this.localStreams.push(t.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(t){var e=this.localStreams.indexOf(t);e>-1&&(this.localStreams.splice(e,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(t){return!!t.rtpSender}).map(function(t){return t.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(t){return!!t.rtpReceiver}).map(function(t){return t.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(t,e){var i={codecs:[],headerExtensions:[],fecMechanisms:[]};return t.codecs.forEach(function(t){for(var n=0;n<e.codecs.length;n++){var s=e.codecs[n];if(t.name.toLowerCase()===s.name.toLowerCase()&&t.clockRate===s.clockRate&&t.numChannels===s.numChannels){i.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var i=0;i<t.rtcpFeedback.length;i++)if(t.rtcpFeedback[i].type===e.type&&t.rtcpFeedback[i].parameter===e.parameter)return!0;return!1});break}}}),t.headerExtensions.forEach(function(t){for(var n=0;n<e.headerExtensions.length;n++){var s=e.headerExtensions[n];if(t.uri===s.uri){i.headerExtensions.push(s);break}}}),i},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(t,e){var i=this,s=new RTCIceGatherer(i.iceOptions),r=new RTCIceTransport(s);s.onlocalcandidate=function(o){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:e};var h=o.candidate,u=!h||0===Object.keys(h).length;u?(void 0===s.state&&(s.state="completed"),a.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(h.component="RTCP"===r.component?2:1,a.candidate.candidate=n.writeCandidate(h));var c=n.splitSections(i.localDescription.sdp);a.candidate.candidate.indexOf("typ endOfCandidates")===-1?c[a.candidate.sdpMLineIndex+1]+="a="+a.candidate.candidate+"\r\n":c[a.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",i.localDescription.sdp=c.join("");var l=i.transceivers.every(function(t){return t.iceGatherer&&"completed"===t.iceGatherer.state});switch(i.iceGatheringState){case"new":i._localIceCandidatesBuffer.push(a),u&&l&&i._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":i._emitBufferedCandidates(),i.dispatchEvent(a),null!==i.onicecandidate&&i.onicecandidate(a),l&&(i.dispatchEvent(new Event("icecandidate")),null!==i.onicecandidate&&i.onicecandidate(new Event("icecandidate")),i.iceGatheringState="complete");break;case"complete":}},r.onicestatechange=function(){i._updateConnectionState()};var o=new RTCDtlsTransport(r);return o.ondtlsstatechange=function(){i._updateConnectionState()},o.onerror=function(){o.state="failed",i._updateConnectionState()},{iceGatherer:s,iceTransport:r,dtlsTransport:o}},window.RTCPeerConnection.prototype._transceive=function(t,e,i){var s=this._getCommonCapabilities(t.localCapabilities,t.remoteCapabilities);e&&t.rtpSender&&(s.encodings=t.sendEncodingParameters,s.rtcp={cname:n.localCName},t.recvEncodingParameters.length&&(s.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(s)),i&&t.rtpReceiver&&(s.encodings=t.recvEncodingParameters,s.rtcp={cname:t.cname},t.sendEncodingParameters.length&&(s.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(s))},window.RTCPeerConnection.prototype.setLocalDescription=function(t){var e,i,s=this;if("offer"===t.type)this._pendingOffer&&(e=n.splitSections(t.sdp),i=e.shift(),e.forEach(function(t,e){var i=n.parseRtpParameters(t);s._pendingOffer[e].localCapabilities=i}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===t.type){e=n.splitSections(s.remoteDescription.sdp),i=e.shift();var r=n.matchPrefix(i,"a=ice-lite").length>0;e.forEach(function(t,e){var o=s.transceivers[e],a=o.iceGatherer,h=o.iceTransport,u=o.dtlsTransport,c=o.localCapabilities,l=o.remoteCapabilities,p="0"===t.split("\n",1)[0].split(" ",2)[1];if(!p){var d=n.getIceParameters(t,i);if(r){var f=n.matchPrefix(t,"a=candidate:").map(function(t){return n.parseCandidate(t)}).filter(function(t){return"1"===t.component});f.length&&h.setRemoteCandidates(f)}var m=n.getDtlsParameters(t,i);r&&(m.role="server"),s.usingBundle&&0!==e||(h.start(a,d,r?"controlling":"controlled"),u.start(m));var g=s._getCommonCapabilities(c,l);s._transceive(o,g.codecs.length>0,!1)}})}switch(this.localDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}var o=arguments.length>1&&"function"==typeof arguments[1];if(o){var a=arguments[1];window.setTimeout(function(){a(),"new"===s.iceGatheringState&&(s.iceGatheringState="gathering"),s._emitBufferedCandidates()},0)}var h=Promise.resolve();return h.then(function(){o||("new"===s.iceGatheringState&&(s.iceGatheringState="gathering"),window.setTimeout(s._emitBufferedCandidates.bind(s),500))}),h},window.RTCPeerConnection.prototype.setRemoteDescription=function(t){var e=this,i=new MediaStream,s=[],r=n.splitSections(t.sdp),o=r.shift(),a=n.matchPrefix(o,"a=ice-lite").length>0;switch(this.usingBundle=n.matchPrefix(o,"a=group:BUNDLE ").length>0,r.forEach(function(r,h){var u,c,l,p,d,f,m,g,v,y,b,S,_=n.splitLines(r),R=_[0].substr(2).split(" "),C=R[0],T="0"===R[1],E=n.getDirection(r,o),w=n.parseRtpParameters(r);T||(b=n.getIceParameters(r,o),S=n.getDtlsParameters(r,o),S.role="client"),g=n.parseRtpEncodingParameters(r);var A=n.matchPrefix(r,"a=mid:");A=A.length?A[0].substr(6):n.generateIdentifier();var D,x=n.matchPrefix(r,"a=ssrc:").map(function(t){return n.parseSsrcMedia(t)}).filter(function(t){return"cname"===t.attribute})[0];x&&(D=x.value);var N=n.matchPrefix(r,"a=end-of-candidates",o).length>0,I=n.matchPrefix(r,"a=candidate:").map(function(t){return n.parseCandidate(t)}).filter(function(t){return"1"===t.component});if("offer"!==t.type||T)"answer"!==t.type||T||(u=e.transceivers[h],c=u.iceGatherer,l=u.iceTransport,p=u.dtlsTransport,d=u.rtpSender,f=u.rtpReceiver,m=u.sendEncodingParameters,v=u.localCapabilities,e.transceivers[h].recvEncodingParameters=g,e.transceivers[h].remoteCapabilities=w,e.transceivers[h].cname=D,(a||N)&&I.length&&l.setRemoteCandidates(I),e.usingBundle&&0!==h||(l.start(c,b,"controlling"),p.start(S)),e._transceive(u,"sendrecv"===E||"recvonly"===E,"sendrecv"===E||"sendonly"===E),!f||"sendrecv"!==E&&"sendonly"!==E?delete u.rtpReceiver:(y=f.track,s.push([y,f]),i.addTrack(y)));else{var k=e.usingBundle&&h>0?{iceGatherer:e.transceivers[0].iceGatherer,iceTransport:e.transceivers[0].iceTransport,dtlsTransport:e.transceivers[0].dtlsTransport}:e._createIceAndDtlsTransports(A,h);if(N&&k.iceTransport.setRemoteCandidates(I),v=RTCRtpReceiver.getCapabilities(C),m=[{ssrc:1001*(2*h+2)}],f=new RTCRtpReceiver(k.dtlsTransport,C),y=f.track,s.push([y,f]),i.addTrack(y),e.localStreams.length>0&&e.localStreams[0].getTracks().length>=h){var P;"audio"===C?P=e.localStreams[0].getAudioTracks()[0]:"video"===C&&(P=e.localStreams[0].getVideoTracks()[0]),P&&(d=new RTCRtpSender(P,k.dtlsTransport))}e.transceivers[h]={iceGatherer:k.iceGatherer,iceTransport:k.iceTransport,dtlsTransport:k.dtlsTransport,localCapabilities:v,remoteCapabilities:w,rtpSender:d,rtpReceiver:f,kind:C,mid:A,cname:D,sendEncodingParameters:m,recvEncodingParameters:g},e._transceive(e.transceivers[h],!1,"sendrecv"===E||"sendonly"===E)}}),this.remoteDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}return i.getTracks().length&&(e.remoteStreams.push(i),window.setTimeout(function(){var t=new Event("addstream");t.stream=i,e.dispatchEvent(t),null!==e.onaddstream&&window.setTimeout(function(){e.onaddstream(t)},0),s.forEach(function(n){var s=n[0],r=n[1],o=new Event("track");o.track=s,o.receiver=r,o.streams=[i],e.dispatchEvent(t),null!==e.ontrack&&window.setTimeout(function(){e.ontrack(o)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(t){t.iceTransport&&t.iceTransport.stop(),t.dtlsTransport&&t.dtlsTransport.stop(),t.rtpSender&&t.rtpSender.stop(),t.rtpReceiver&&t.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(t){this.signalingState=t;var e=new Event("signalingstatechange");this.dispatchEvent(e),null!==this.onsignalingstatechange&&this.onsignalingstatechange(e)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var t=new Event("negotiationneeded");this.dispatchEvent(t),null!==this.onnegotiationneeded&&this.onnegotiationneeded(t)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var t,e=this,i={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(t){i[t.iceTransport.state]++,i[t.dtlsTransport.state]++}),i.connected+=i.completed,t="new",i.failed>0?t="failed":i.connecting>0||i.checking>0?t="connecting":i.disconnected>0?t="disconnected":i["new"]>0?t="new":(i.connected>0||i.completed>0)&&(t="connected"),t!==e.iceConnectionState){e.iceConnectionState=t;var n=new Event("iceconnectionstatechange");this.dispatchEvent(n),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(n)}},window.RTCPeerConnection.prototype.createOffer=function(){var t=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var e;1===arguments.length&&"function"!=typeof arguments[0]?e=arguments[0]:3===arguments.length&&(e=arguments[2]);var i=[],s=0,r=0;if(this.localStreams.length&&(s=this.localStreams[0].getAudioTracks().length,r=this.localStreams[0].getVideoTracks().length),e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(s=e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(r=e.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(t){i.push({kind:t.kind,track:t,wantReceive:"audio"===t.kind?s>0:r>0}),"audio"===t.kind?s--:"video"===t.kind&&r--});s>0||r>0;)s>0&&(i.push({kind:"audio",wantReceive:!0}),s--),r>0&&(i.push({kind:"video",wantReceive:!0}),r--);var o=n.writeSessionBoilerplate(),a=[];i.forEach(function(e,i){var s,r,o=e.track,h=e.kind,u=n.generateIdentifier(),c=t.usingBundle&&i>0?{iceGatherer:a[0].iceGatherer,iceTransport:a[0].iceTransport,dtlsTransport:a[0].dtlsTransport}:t._createIceAndDtlsTransports(u,i),l=RTCRtpSender.getCapabilities(h),p=[{ssrc:1001*(2*i+1)}];o&&(s=new RTCRtpSender(o,c.dtlsTransport)),e.wantReceive&&(r=new RTCRtpReceiver(c.dtlsTransport,h)),a[i]={iceGatherer:c.iceGatherer,iceTransport:c.iceTransport,dtlsTransport:c.dtlsTransport,localCapabilities:l,remoteCapabilities:null,rtpSender:s,rtpReceiver:r,kind:h,mid:u,sendEncodingParameters:p,recvEncodingParameters:null}}),this.usingBundle&&(o+="a=group:BUNDLE "+a.map(function(t){return t.mid}).join(" ")+"\r\n"),i.forEach(function(e,i){var s=a[i];o+=n.writeMediaSection(s,s.localCapabilities,"offer",t.localStreams[0])}),this._pendingOffer=a;var h=new RTCSessionDescription({type:"offer",sdp:o});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,h),Promise.resolve(h)},window.RTCPeerConnection.prototype.createAnswer=function(){var t=this,e=n.writeSessionBoilerplate();this.usingBundle&&(e+="a=group:BUNDLE "+this.transceivers.map(function(t){return t.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(i){var s=t._getCommonCapabilities(i.localCapabilities,i.remoteCapabilities);e+=n.writeMediaSection(i,s,"answer",t.localStreams[0])});var i=new RTCSessionDescription({type:"answer",sdp:e});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,i),Promise.resolve(i)},window.RTCPeerConnection.prototype.addIceCandidate=function(t){if(null===t)this.transceivers.forEach(function(t){t.iceTransport.addRemoteCandidate({})});else{var e=t.sdpMLineIndex;if(t.sdpMid)for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].mid===t.sdpMid){e=i;break}var s=this.transceivers[e];if(s){var r=Object.keys(t.candidate).length>0?n.parseCandidate(t.candidate):{};if("tcp"===r.protocol&&(0===r.port||9===r.port))return;if("1"!==r.component)return;"endOfCandidates"===r.type&&(r={}),s.iceTransport.addRemoteCandidate(r);var o=n.splitSections(this.remoteDescription.sdp);o[e+1]+=(r.type?t.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=o.join("")}}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var t=[];this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(i){e[i]&&t.push(e[i].getStats())})});var e=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(i){var n=new Map;Promise.all(t).then(function(t){t.forEach(function(t){Object.keys(t).forEach(function(e){n.set(e,t[e]),n[e]=t[e]})}),e&&window.setTimeout(e,0,n),i(n)})})}}};e.exports={shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:t("./getusermedia")}},{"../utils":10,"./getusermedia":6,sdp:1}],6:[function(t,e,i){"use strict";e.exports=function(){var t=function(t){return{name:{PermissionDeniedError:"NotAllowedError"}[t.name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}}},e=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(i){return e(i)["catch"](function(e){return Promise.reject(t(e))})}}},{}],7:[function(t,e,i){"use strict";var n=t("../utils").browserDetails,s={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=t),this.addEventListener("addstream",this._ontrackpoly=function(t){t.stream.getTracks().forEach(function(e){var i=new Event("track");i.track=e,i.receiver={track:e},i.streams=[t.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(t){this.mozSrcObject=t}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(t,e){if(n.version<38&&t&&t.iceServers){for(var i=[],s=0;s<t.iceServers.length;s++){var r=t.iceServers[s];if(r.hasOwnProperty("urls"))for(var o=0;o<r.urls.length;o++){var a={url:r.urls[o]};0===r.urls[o].indexOf("turn")&&(a.username=r.username,a.credential=r.credential),i.push(a)}else i.push(t.iceServers[s])}t.iceServers=i}return new mozRTCPeerConnection(t,e)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var e=RTCPeerConnection.prototype[t];RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?RTCIceCandidate:RTCSessionDescription)(arguments[0]),e.apply(this,arguments)}});var t=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():t.apply(this,arguments)};var e=function(t){var e=new Map;return Object.keys(t).forEach(function(i){e.set(i,t[i]),e[i]=t[i]}),e},i=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(t,n,s){return i.apply(this,[t||null]).then(function(t){return e(t)}).then(n,s)}}}};e.exports={shimOnTrack:s.shimOnTrack,shimSourceObject:s.shimSourceObject,shimPeerConnection:s.shimPeerConnection,shimGetUserMedia:t("./getusermedia")}},{"../utils":10,"./getusermedia":8}],8:[function(t,e,i){"use strict";var n=t("../utils").log,s=t("../utils").browserDetails;e.exports=function(){var t=function(t){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[t.name]||t.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[t.message]||t.message,constraint:t.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},e=function(e,i,r){var o=function(t){if("object"!=typeof t||t.require)return t;var e=[];return Object.keys(t).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var n=t[i]="object"==typeof t[i]?t[i]:{ideal:t[i]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||e.push(i),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:t[i]=n.exact,delete n.exact),void 0!==n.ideal){t.advanced=t.advanced||[];var s={};"number"==typeof n.ideal?s[i]={min:n.ideal,max:n.ideal}:s[i]=n.ideal,t.advanced.push(s),delete n.ideal,Object.keys(n).length||delete t[i]}}}),e.length&&(t.require=e),t};return e=JSON.parse(JSON.stringify(e)),s.version<38&&(n("spec: "+JSON.stringify(e)),e.audio&&(e.audio=o(e.audio)),e.video&&(e.video=o(e.video)),n("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,i,function(e){r(t(e))})},i=function(t){return new Promise(function(i,n){e(t,i,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:i,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(t){var e=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];t(e)})},s.version<41){var r=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return r().then(void 0,function(t){if("NotFoundError"===t.name)return[];throw t})}}if(s.version<49){var o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return o(e)["catch"](function(e){return Promise.reject(t(e))})}}navigator.getUserMedia=function(t,i,n){return s.version<44?e(t,i,n):(console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),void navigator.mediaDevices.getUserMedia(t).then(i,n))}}},{"../utils":10}],9:[function(t,e,i){"use strict";var n={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};e.exports={shimGetUserMedia:n.shimGetUserMedia}},{}],10:[function(t,e,i){"use strict";var n=!0,s={disableLog:function(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(n=t,t?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(t,e,i){var n=t.match(e);return n&&n.length>=i&&parseInt(n[i],10)},detectBrowser:function(){var t={};if(t.browser=null,t.version=null,"undefined"==typeof window||!window.navigator)return t.browser="Not a browser.",t;if(navigator.mozGetUserMedia)t.browser="firefox",t.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)t.browser="chrome",t.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return t.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",t;t.browser="safari",t.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return t.browser="Not a supported browser.",t;t.browser="edge",t.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return t}};e.exports={log:s.log,disableLog:s.disableLog,browserDetails:s.detectBrowser(),extractVersion:s.extractVersion}},{}]},{},[2])(2)}),function(){"use strict";var t=function(t,e){this.channels={},this.channelsPromises={},this.callbacks=e||{};var i=this;t.ondatachannel=function(t){i._addChannel(t.channel)}};t.prototype={_addChannel:function(t){var e=this.channels[t.label];if(e){if(this.isInitiator)return e;this.closeChannel(t.label)}this.channels[t.label]=t;var i=$.Deferred(),n=i.promise();this.channelsPromises[t.label]=n;var s=this.callbacks,r=this;return t.onmessage=function(e){!s.onMessage||s.onMessage(t.label,!e||!e.data||JSON.parse(e.data))},t.onopen=function(e){!s.onOpen||s.onOpen(t.label,e),i.resolve(t)},t.onclose=function(e){!s.onClose||s.onClose(t.label,e),r._removeChannel(t)},n},_removeChannel:function(t){t.onmessage=null,t.onopen=null,t.onclose=null,delete this.channels[t.label]},_free:function(){this.callbacks={};for(var t in this.channels)this.channels.hasOwnProperty(t)&&this._removeChannel(this.channels[t]);for(var e in this.channelsPromises)this.channelsPromises.hasOwnProperty(e)&&(this.channelsPromises[e].reject(),delete this.channelsPromises[e])},getChannel:function(t,e){return this.channelsPromises[e]||this._addChannel(t.createDataChannel(e))},closeChannel:function(t){var e=this.channels[t];this._removeChannel(e),e.close()}};var e=function(e){var i=this.pc=new RTCPeerConnection;this.channels=new t(i,e);var n=$.Deferred();this.pcReady=n.promise(),i.oniceconnectionstatechange=function(){switch(i.iceConnectionState){case"checking":!e||!e.connected||e.onConnectionReady(),n.resolve();break;case"closed":!e||!e.connected||e.onConnectionClosed()}},i.onicecandidate=function(t){!t||!t.candidate||!e||!e.onICe||e.onICe(t.candidate)}};e.prototype={getOffer:function(t){this.channels.isInitiator=!0;var e=this.pc,i=$.Deferred();return this.channels._addChannel(e.createDataChannel("")),e.createOffer().then(function(t){e.setLocalDescription(t),i.resolve(t)},function(){console.error("WebRtc: offer creation fail")}),i.promise()},getAnswer:function(t){this.channels.isInitiator=!1;var e=this.pc,i=$.Deferred();return this.channels._addChannel(e.createDataChannel("")),e.setRemoteDescription(new RTCSessionDescription(t)),e.createAnswer(function(t){e.setLocalDescription(t),i.resolve(t)},function(){console.error("WebRtc: answer creation fail")}),i.promise();
},setAnswer:function(t){this.pc.setRemoteDescription(new RTCSessionDescription(t))},addICe:function(t){!t||this.pc.addIceCandidate(new RTCIceCandidate(t))},_free:function(){this.pc.oniceconnectionstatechange=null,this.pc.onicecandidate=null,this.channels._free(),delete this.channels,delete this.pc},close:function(){this.pc.close(),this._free()},isOpened:function(){return"completed"===this.pc.iceConnectionState},sendMessage:function(t,e){var i=this;this.pcReady.then(function(){i.channels.getChannel(i.pc,t).then(function(t){t.send(JSON.stringify(e))})})}};var i=window.webRtcMaster=function(){var t=this,e=(this.connections={},new window.webRtcSignalChannel);e.init({onOffer:function(i,n){var s=t._getConnection(i,e);s.getAnswer(n).then(function(e){t._getRelated(i).onOffer.resolve(e)}),t._getRelated(i).onBoth.then(function(t,i){e.sendOffer(t,i)})},onICe:function(i,n){t._getConnection(i,e).addICe(n)}}),this.subscribers=[],this.key=e.roomId,this.related={}};i.prototype={_getRelated:function(t){var e=this.related[t];return e||(e=this.related[t]={onIce:$.Deferred(),onOffer:$.Deferred()},e.onBoth=$.when(e.onOffer,e.onIce)),e},_getConnection:function(t){var i=this,n=this.connections[t];return n||(n=this.connections[t]=new e({onMessage:function(e,n){i._onMessage(t,e,n)},onOpen:function(e){i._onOpen(t,e)},onClose:function(e){i._onClose(t,e)},onConnectionReady:function(){},onConnectionClosed:function(){n._free(),delete i.connections[t]},onICe:function(e){var n=i._getRelated(t);n?n.onIce.resolve(e):i.sendMessage("",t,e)}})),n},subscribe:function(t,e,i,n,s){var r={key:e,lable:t,onMessage:i,onOpen:n,onClose:s};return this.subscribers.push(r),r},unSubscribe:function(t){var e=this.subscribers.indexOf(t);e<0||this.subscribers.splice(e,1)},sendMessage:function(t,e,i){var n=this.connections[e];!n||n.sendMessage(t,i)},sendBroadcastMessage:function(t,e){var i=[];for(var n in this.connections)this.connections.hasOwnProperty(n)&&i.push(connection.sendMessage(t,e))},_eachSubscriber:function(t,e,i){for(var n=0;n<this.subscribers.length;n++){var s=this.subscribers[n];t!==s.key&&s.key||e!==s.lable&&s.lable||i(s,n)}},_onMessage:function(t,e,i){if(""===e){var n=this.connections[t];return void(n&&n.addICe(i.message))}this._eachSubscriber(t,e,function(n){n.onMessage&&n.onMessage(e,t,i)})},_onOpen:function(t,e){this._eachSubscriber(t,e,function(i){i.onOpen&&i.onOpen(e,t)})},_onClose:function(t,e){this._eachSubscriber(t,e,function(i){i.onClose&&i.onClose(e,t)})}};var n=window.webRtcSlave=function(t){var i,n=this,s=new window.webRtcSignalChannel(t);s.init({onOffer:function(e,n){t===e&&i.setAnswer(n)},onICe:function(e,n){t===e&&i.addICe(n)}});var r=$.Deferred(),o=$.Deferred();i=this.connection=new e({onMessage:function(t,e){n._onMessage(t,e)},onOpen:function(t){n._onOpen(t)},onClose:function(t){n._onClose(t)},onConnectionReady:function(){},onConnectionClosed:function(){i._free()},onICe:function(t){o?o.resolve(t):n.sendMessage("",t)}}),i.getOffer(t).then(function(t){r.resolve(t)}),$.when(r,o).then(function(t,e){o=null,s.sendOffer(t,e)}),this.subscribers=[]};n.prototype={subscribe:function(t,e,i,n){var s={lable:t,onMessage:e,onOpen:i,onClose:n};return this.subscribers.push(s),s},unSubscribe:function(t){var e=this.subscribers.indexOf(t);e<0||this.subscribers.splice(e,1)},sendMessage:function(t,e){return!this.connection||this.connection.sendMessage(t,e)},_eachSubscriber:function(t,e){for(var i=0;i<this.subscribers.length;i++){var n=this.subscribers[i];t!==n.lable&&null!==n.lable||e(n,i)}},_onMessage:function(t,e){return""===t?void(this.connection&&this.connection.addICe(e.message)):void this._eachSubscriber(t,function(i){i.onMessage&&i.onMessage(t,e)})},_onOpen:function(t){this._eachSubscriber(t,function(e){e.onOpen&&e.onOpen(t)})},_onClose:function(t){this._eachSubscriber(t,function(e){e.onClose&&e.onClose(t)})}}}(),function(){"use strict";function t(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var i=$.Deferred();$.getScript("https://cdn.scaledrone.com/scaledrone.min.js",function(t,e,n){var s=new ScaleDrone("zjfWz5D7BUNHZhvX");s.on("open",function(t){t&&console.error(t),i.resolve(s)})});var n=window.webRtcSignalChannel=function(e){this.id=t(),this.room=$.Deferred(),this.roomId=e||this.id};n.prototype={init:function(t){var e=this;i.done(function(i){var n=i.subscribe(e.roomId);n.on("open",function(s){return s?console.error(s):("function"==typeof t.onInit&&t.onInit(e.roomId),void e.room.resolve(n,i))}),n.on("data",function(i){i&&i.id&&i.id!==e.id&&(console.log(i),i.offer&&t.onOffer(i.id,i.offer),i.iceClient&&t.onICe(i.id,i.iceClient))})})},sendOffer:function(t,e){var i=this;this.room.done(function(n,s){s.publish({room:i.roomId,message:{id:i.id,offer:t,iceClient:e}})})},sendIceClient:function(t){var e=this;this.room.done(function(i,n){n.publish({room:e.roomId,message:{id:e.id,iceClient:t}})})},stop:function(){this.room.done(function(t){t.unsubscribe()})}}}(),!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Dropbox=e():t.Dropbox=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){var n=i(13);t.exports=n},function(t,e,i){var n;(function(t,s,r){(function(){"use strict";function o(t){return"function"==typeof t||"object"==typeof t&&null!==t}function a(t){return"function"==typeof t}function h(t){K=t}function u(t){tt=t}function c(){return function(){t.nextTick(m)}}function l(){return function(){$(m)}}function p(){var t=0,e=new nt(m),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function d(){var t=new MessageChannel;return t.port1.onmessage=m,function(){t.port2.postMessage(0)}}function f(){return function(){setTimeout(m,1)}}function m(){for(var t=0;t<Q;t+=2){var e=ot[t],i=ot[t+1];e(i),ot[t]=void 0,ot[t+1]=void 0}Q=0}function g(){try{var t=i(19);return $=t.runOnLoop||t.runOnContext,l()}catch(e){return f()}}function v(t,e){var i=this,n=new this.constructor(b);void 0===n[ut]&&q(n);var s=i._state;if(s){var r=arguments[s-1];tt(function(){M(s,n,r,i._result)})}else I(i,n,t,e);return n}function y(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var i=new e(b);return A(i,t),i}function b(){}function S(){return new TypeError("You cannot resolve a promise with itself")}function _(){return new TypeError("A promises callback cannot return that same promise.")}function R(t){try{return t.then}catch(e){return dt.error=e,dt}}function C(t,e,i,n){try{t.call(e,i,n)}catch(s){return s}}function T(t,e,i){tt(function(t){var n=!1,s=C(i,e,function(i){n||(n=!0,e!==i?A(t,i):x(t,i))},function(e){n||(n=!0,N(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&s&&(n=!0,N(t,s))},t)}function E(t,e){e._state===lt?x(t,e._result):e._state===pt?N(t,e._result):I(e,void 0,function(e){A(t,e)},function(e){N(t,e)})}function w(t,e,i){e.constructor===t.constructor&&i===at&&constructor.resolve===ht?E(t,e):i===dt?N(t,dt.error):void 0===i?x(t,e):a(i)?T(t,e,i):x(t,e)}function A(t,e){t===e?N(t,S()):o(e)?w(t,e,R(e)):x(t,e)}function D(t){t._onerror&&t._onerror(t._result),k(t)}function x(t,e){t._state===ct&&(t._result=e,t._state=lt,0!==t._subscribers.length&&tt(k,t))}function N(t,e){t._state===ct&&(t._state=pt,t._result=e,tt(D,t))}function I(t,e,i,n){var s=t._subscribers,r=s.length;t._onerror=null,s[r]=e,s[r+lt]=i,s[r+pt]=n,0===r&&t._state&&tt(k,t)}function k(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n,s,r=t._result,o=0;o<e.length;o+=3)n=e[o],s=e[o+i],n?M(i,n,s,r):s(r);t._subscribers.length=0}}function P(){this.error=null}function O(t,e){try{return t(e)}catch(i){return ft.error=i,ft}}function M(t,e,i,n){var s,r,o,h,u=a(i);if(u){if(s=O(i,n),s===ft?(h=!0,r=s.error,s=null):o=!0,e===s)return void N(e,_())}else s=n,o=!0;e._state!==ct||(u&&o?A(e,s):h?N(e,r):t===lt?x(e,s):t===pt&&N(e,s))}function L(t,e){try{e(function(e){A(t,e)},function(e){N(t,e)})}catch(i){N(t,i)}}function F(){return mt++}function q(t){t[ut]=mt++,t._state=void 0,t._result=void 0,t._subscribers=[]}function B(t){return new St(this,t).promise}function G(t){var e=this;return new e(z(t)?function(i,n){for(var s=t.length,r=0;r<s;r++)e.resolve(t[r]).then(i,n)}:function(t,e){e(new TypeError("You must pass an array to race."))})}function V(t){var e=this,i=new e(b);return N(i,t),i}function j(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function H(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function U(t){this[ut]=F(),this._result=this._state=void 0,this._subscribers=[],b!==t&&("function"!=typeof t&&j(),this instanceof U?L(this,t):H())}function X(t,e){this._instanceConstructor=t,this.promise=new t(b),this.promise[ut]||q(this.promise),z(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?x(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&x(this.promise,this._result))):N(this.promise,Y())}function Y(){return new Error("Array Methods must be provided an Array")}function W(){var t;if("undefined"!=typeof s)t=s;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var i=t.Promise;i&&"[object Promise]"===Object.prototype.toString.call(i.resolve())&&!i.cast||(t.Promise=bt)}var J;J=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var $,K,Z,z=J,Q=0,tt=function(t,e){ot[Q]=t,ot[Q+1]=e,Q+=2,2===Q&&(K?K(m):Z())},et="undefined"!=typeof window?window:void 0,it=et||{},nt=it.MutationObserver||it.WebKitMutationObserver,st="undefined"==typeof self&&"undefined"!=typeof t&&"[object process]"==={}.toString.call(t),rt="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ot=new Array(1e3);Z=st?c():nt?p():rt?d():void 0===et?g():f();var at=v,ht=y,ut=Math.random().toString(36).substring(16),ct=void 0,lt=1,pt=2,dt=new P,ft=new P,mt=0,gt=B,vt=G,yt=V,bt=U;U.all=gt,U.race=vt,U.resolve=ht,U.reject=yt,U._setScheduler=h,U._setAsap=u,U._asap=tt,U.prototype={constructor:U,then:at,"catch":function(t){return this.then(null,t)}};var St=X;X.prototype._enumerate=function(){for(var t=this.length,e=this._input,i=0;this._state===ct&&i<t;i++)this._eachEntry(e[i],i)},X.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,n=i.resolve;if(n===ht){var s=R(t);if(s===at&&t._state!==ct)this._settledAt(t._state,e,t._result);else if("function"!=typeof s)this._remaining--,this._result[e]=t;else if(i===bt){var r=new i(b);w(r,t,s),this._willSettleAt(r,e)}else this._willSettleAt(new i(function(e){e(t)}),e)}else this._willSettleAt(n(t),e)},X.prototype._settledAt=function(t,e,i){var n=this.promise;n._state===ct&&(this._remaining--,t===pt?N(n,i):this._result[e]=i),0===this._remaining&&x(n,this._result)},X.prototype._willSettleAt=function(t,e){var i=this;I(t,void 0,function(t){i._settledAt(lt,e,t)},function(t){i._settledAt(pt,e,t)})};var _t=W,Rt={Promise:bt,polyfill:_t};i(10).amd?(n=function(){return Rt}.call(e,i,e,r),!(void 0!==n&&(r.exports=n))):"undefined"!=typeof r&&r.exports?r.exports=Rt:"undefined"!=typeof this&&(this.ES6Promise=Rt),_t()}).call(this)}).call(e,i(6),function(){return this}(),i(11)(t))},function(t,e,i){function n(){}function s(t){var e={}.toString.call(t);switch(e){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function r(t){if(!b(t))return t;var e=[];for(var i in t)null!=t[i]&&o(e,i,t[i]);return e.join("&")}function o(t,e,i){return Array.isArray(i)?i.forEach(function(i){o(t,e,i)}):void t.push(encodeURIComponent(e)+"="+encodeURIComponent(i))}function a(t){for(var e,i,n={},s=t.split("&"),r=0,o=s.length;r<o;++r)i=s[r],e=i.split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return n}function h(t){var e,i,n,s,r=t.split(/\r?\n/),o={};r.pop();for(var a=0,h=r.length;a<h;++a)i=r[a],e=i.indexOf(":"),n=i.slice(0,e).toLowerCase(),s=_(i.slice(e+1)),o[n]=s;return o}function u(t){return/[\/+]json\b/.test(t)}function c(t){return t.split(/ *; */).shift()}function l(t){return v(t.split(/ *; */),function(t,e){var i=e.split(/ *= */),n=i.shift(),s=i.shift();return n&&s&&(t[n]=s),t},{})}function p(t,e){e=e||{},this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this.setStatusProperties(this.xhr.status),this.header=this.headers=h(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function d(t,e){var i=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var t=null,e=null;try{e=new p(i)}catch(n){return t=new Error("Parser is unable to parse the response"),t.parse=!0,t.original=n,t.rawResponse=i.xhr&&i.xhr.responseText?i.xhr.responseText:null,t.statusCode=i.xhr&&i.xhr.status?i.xhr.status:null,i.callback(t)}if(i.emit("response",e),t)return i.callback(t,e);if(e.status>=200&&e.status<300)return i.callback(t,e);var s=new Error(e.statusText||"Unsuccessful HTTP response");s.original=t,s.response=e,s.status=e.status,i.callback(s,e)})}function f(t,e){var i=S("DELETE",t);return e&&i.end(e),i}var m,g=i(5),v=i(7),y=i(8),b=i(3);m="undefined"!=typeof window?window:"undefined"!=typeof self?self:this;var S=t.exports=i(9).bind(null,d);S.getXHR=function(){if(!(!m.XMLHttpRequest||m.location&&"file:"==m.location.protocol&&m.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}return!1};var _="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};S.serializeObject=r,S.parseString=a,S.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},S.serialize={"application/x-www-form-urlencoded":r,"application/json":JSON.stringify},S.parse={"application/x-www-form-urlencoded":a,"application/json":JSON.parse},p.prototype.get=function(t){return this.header[t.toLowerCase()]},p.prototype.setHeaderProperties=function(t){var e=this.header["content-type"]||"";this.type=c(e);var i=l(e);for(var n in i)this[n]=i[n]},p.prototype.parseBody=function(t){var e=S.parse[this.type];return!e&&u(this.type)&&(e=S.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null},p.prototype.setStatusProperties=function(t){1223===t&&(t=204);var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.notFound=404==t,this.forbidden=403==t},p.prototype.toError=function(){var t=this.req,e=t.method,i=t.url,n="cannot "+e+" "+i+" ("+this.status+")",s=new Error(n);return s.status=this.status,s.method=e,s.url=i,s},S.Response=p,g(d.prototype);for(var R in y)d.prototype[R]=y[R];d.prototype.abort=function(){if(!this.aborted)return this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this},d.prototype.type=function(t){return this.set("Content-Type",S.types[t]||t),this},d.prototype.responseType=function(t){return this._responseType=t,this},d.prototype.accept=function(t){return this.set("Accept",S.types[t]||t),this},d.prototype.auth=function(t,e,i){switch(i||(i={type:"basic"}),i.type){case"basic":var n=btoa(t+":"+e);this.set("Authorization","Basic "+n);break;case"auto":this.username=t,this.password=e}return this},d.prototype.query=function(t){return"string"!=typeof t&&(t=r(t)),t&&this._query.push(t),this},d.prototype.attach=function(t,e,i){return this._getFormData().append(t,e,i||e.name),this},d.prototype._getFormData=function(){return this._formData||(this._formData=new m.FormData),this._formData},d.prototype.send=function(t){var e=b(t),i=this._header["content-type"];if(e&&b(this._data))for(var n in t)this._data[n]=t[n];else"string"==typeof t?(i||this.type("form"),i=this._header["content-type"],"application/x-www-form-urlencoded"==i?this._data=this._data?this._data+"&"+t:t:this._data=(this._data||"")+t):this._data=t;return!e||s(t)?this:(i||this.type("json"),this)},p.prototype.parse=function(t){return m.console&&console.warn("Client-side parse() method has been renamed to serialize(). This method is not compatible with superagent v2.0"),this.serialize(t),this},p.prototype.serialize=function(t){return this._parser=t,this},d.prototype.callback=function(t,e){var i=this._callback;this.clearTimeout(),i(t,e)},d.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},d.prototype.timeoutError=function(){var t=this._timeout,e=new Error("timeout of "+t+"ms exceeded");e.timeout=t,this.callback(e)},d.prototype.withCredentials=function(){return this._withCredentials=!0,this},d.prototype.end=function(t){var e=this,i=this.xhr=S.getXHR(),r=this._query.join("&"),o=this._timeout,a=this._formData||this._data;this._callback=t||n,i.onreadystatechange=function(){if(4==i.readyState){var t;try{t=i.status}catch(n){t=0}if(0==t){if(e.timedout)return e.timeoutError();if(e.aborted)return;return e.crossDomainError()}e.emit("end")}};var h=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),t.direction="download",e.emit("progress",t)};this.hasListeners("progress")&&(i.onprogress=h);try{i.upload&&this.hasListeners("progress")&&(i.upload.onprogress=h)}catch(c){}if(o&&!this._timer&&(this._timer=setTimeout(function(){e.timedout=!0,e.abort()},o)),r&&(r=S.serializeObject(r),this.url+=~this.url.indexOf("?")?"&"+r:"?"+r),this.username&&this.password?i.open(this.method,this.url,!0,this.username,this.password):i.open(this.method,this.url,!0),this._withCredentials&&(i.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof a&&!s(a)){var l=this._header["content-type"],p=this._parser||S.serialize[l?l.split(";")[0]:""];!p&&u(l)&&(p=S.serialize["application/json"]),p&&(a=p(a))}for(var d in this.header)null!=this.header[d]&&i.setRequestHeader(d,this.header[d]);return this._responseType&&(i.responseType=this._responseType),this.emit("request",this),i.send("undefined"!=typeof a?a:null),this},S.Request=d,S.get=function(t,e,i){var n=S("GET",t);return"function"==typeof e&&(i=e,e=null),e&&n.query(e),i&&n.end(i),n},S.head=function(t,e,i){var n=S("HEAD",t);return"function"==typeof e&&(i=e,e=null),e&&n.send(e),i&&n.end(i),n},S.del=f,S["delete"]=f,S.patch=function(t,e,i){var n=S("PATCH",t);return"function"==typeof e&&(i=e,e=null),e&&n.send(e),i&&n.end(i),n},S.post=function(t,e,i){var n=S("POST",t);return"function"==typeof e&&(i=e,e=null),e&&n.send(e),i&&n.end(i),n},S.put=function(t,e,i){var n=S("PUT",t);return"function"==typeof e&&(i=e,e=null),e&&n.send(e),i&&n.end(i),n}},function(t,e){function i(t){return null!=t&&"object"==typeof t}t.exports=i},function(t,e,i){var n,s=i(12),r=i(17),o=i(18),a=i(15);i(14),n=function(t){t=t||{},this.accessToken=t.accessToken,this.clientId=t.clientId,this.selectUser=t.selectUser},n.prototype.setAccessToken=function(t){this.accessToken=t},n.prototype.getAccessToken=function(){return this.accessToken},n.prototype.setClientId=function(t){this.clientId=t},n.prototype.getClientId=function(){return this.clientId},n.prototype.getAuthenticationUrl=function(t,e){var i,n="https://www.dropbox.com/oauth2/authorize",s=this.getClientId();if(!s)throw new Error("A client id is required. You can set the client id using .setClientId().");if(!t)throw new Error("A redirect uri is required.");return i=n+"?response_type=token&client_id="+s,t&&(i=i+"&redirect_uri="+t),e&&(i=i+"&state="+e),i},n.prototype.request=function(t,e,i,n){if(n===a.RPC)return this.rpcRequest(t,e,this.getAccessToken(),this.selectUser);if(n===a.DOWNLOAD)return this.downloadRequest(t,e,this.getAccessToken(),this.selectUser);if(n===a.UPLOAD)return this.uploadRequest(t,e,this.getAccessToken(),this.selectUser);throw new Error("Invalid request type")},n.prototype.rpcRequest=r,n.prototype.setRpcRequest=function(t){n.prototype.rpcRequest=t},n.prototype.getRpcRequest=function(){return n.prototype.rpcRequest},n.prototype.downloadRequest=s,n.prototype.setDownloadRequest=function(t){n.prototype.downloadRequest=t},n.prototype.getDownloadRequest=function(){return n.prototype.downloadRequest},n.prototype.uploadRequest=o,n.prototype.setUploadRequest=function(t){n.prototype.uploadRequest=t},n.prototype.getUploadRequest=function(){return n.prototype.uploadRequest},t.exports=n},function(t,e,i){function n(t){if(t)return s(t)}function s(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},n.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n,s=0;s<i.length;s++)if(n=i[s],n===e||n.fn===e){i.splice(s,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),i=this._callbacks["$"+t];if(i){i=i.slice(0);for(var n=0,s=i.length;n<s;++n)i[n].apply(this,e)}return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e){function i(){l&&u&&(l=!1,u.length?c=u.concat(c):p=-1,c.length&&n())}function n(){if(!l){var t=o(i);l=!0;for(var e=c.length;e;){for(u=c,c=[];++p<e;)u&&u[p].run();p=-1,e=c.length}u=null,l=!1,a(t)}}function s(t,e){this.fun=t,this.array=e}function r(){}var o,a,h=t.exports={};!function(){try{o=setTimeout}catch(t){o=function(){throw new Error("setTimeout is not defined")}}try{a=clearTimeout}catch(t){a=function(){throw new Error("clearTimeout is not defined")}}}();var u,c=[],l=!1,p=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new s(t,e)),1!==c.length||l||o(n,0)},s.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=r,h.addListener=r,h.once=r,h.off=r,h.removeListener=r,h.removeAllListeners=r,h.emit=r,h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,e){t.exports=function(t,e,i){for(var n=0,s=t.length,r=3==arguments.length?i:t[n++];n<s;)r=e.call(null,r,t[n],++n,t);return r}},function(t,e,i){var n=i(3);e.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},e.parse=function(t){return this._parser=t,this},e.timeout=function(t){return this._timeout=t,this},e.then=function(t,e){return this.end(function(i,n){i?e(i):t(n)})},e.use=function(t){return t(this),this},e.get=function(t){return this._header[t.toLowerCase()]},e.getHeader=e.get,e.set=function(t,e){if(n(t)){for(var i in t)this.set(i,t[i]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},e.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},e.field=function(t,e){return this._getFormData().append(t,e),this}},function(t,e){function i(t,e,i){return"function"==typeof i?new t("GET",e).end(i):2==arguments.length?new t("GET",e):new t(e,i)}t.exports=i},function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e,i){var n,s,r,o=i(2),a=i(1).Promise,h="https://content.dropboxapi.com/2/";o.parse["application/octect-stream"]=function(t){return t},n=function(t,e){return{status:t.status,error:e.text,response:e}},r=function(t,e){t.text="",t.setEncoding("binary"),t.on("data",function(e){t.text+=e}),t.on("end",function(){e()})},s=function(t,e,i,s){var u=function(a,u){function c(t){a&&a(t)}function l(t){u&&u(t)}function p(t,e){var i;t?l(n(t,e)):(i=JSON.parse(e.headers["dropbox-api-result"]),e.xhr?i.fileBlob=e.xhr.response:i.fileBinary=e.res.text,c(i))}var d;d=o.post(h+t).set("Authorization","Bearer "+i).set("Dropbox-API-Arg",JSON.stringify(e)).on("request",function(){this.xhr&&(this.xhr.responseType="blob")}),s&&(d=d.set("Dropbox-API-Select-User",s)),"undefined"==typeof window?d.buffer(!0).parse(r).end(p):d.end(p)};return new a(u)},t.exports=s},function(t,e,i){var n,s=i(4),r=i(16);n=function(t){s.call(this,t)},n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.prototype=Object.assign(n.prototype,r),n.prototype.filesGetSharedLinkFile=function(t){return this.request("sharing/get_shared_link_file",t,"api","download")},t.exports=n},function(t,e){"function"!=typeof Object.assign&&!function(){Object.assign=function(t){"use strict";var e,i,n,s;if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(e=Object(t),i=1;i<arguments.length;i++)if(n=arguments[i],void 0!==n&&null!==n)for(s in n)n.hasOwnProperty(s)&&(e[s]=n[s]);return e}}()},function(t,e){var i={RPC:"rpc",DOWNLOAD:"download",UPLOAD:"upload"};t.exports=i},function(t,e){var i={};i.authTokenRevoke=function(t){return this.request("auth/token/revoke",t,"api","rpc")},i.filesAlphaGetMetadata=function(t){return this.request("files/alpha/get_metadata",t,"api","rpc")},i.filesAlphaUpload=function(t){return this.request("files/alpha/upload",t,"content","upload")},i.filesCopy=function(t){return this.request("files/copy",t,"api","rpc")},i.filesCopyReferenceGet=function(t){return this.request("files/copy_reference/get",t,"api","rpc")},i.filesCopyReferenceSave=function(t){return this.request("files/copy_reference/save",t,"api","rpc")},i.filesCreateFolder=function(t){return this.request("files/create_folder",t,"api","rpc")},i.filesDelete=function(t){return this.request("files/delete",t,"api","rpc")},i.filesDownload=function(t){return this.request("files/download",t,"content","download")},i.filesGetMetadata=function(t){return this.request("files/get_metadata",t,"api","rpc")},i.filesGetPreview=function(t){return this.request("files/get_preview",t,"content","download")},i.filesGetTemporaryLink=function(t){return this.request("files/get_temporary_link",t,"api","rpc")},i.filesGetThumbnail=function(t){return this.request("files/get_thumbnail",t,"content","download")},i.filesListFolder=function(t){return this.request("files/list_folder",t,"api","rpc")},i.filesListFolderContinue=function(t){return this.request("files/list_folder/continue",t,"api","rpc")},i.filesListFolderGetLatestCursor=function(t){return this.request("files/list_folder/get_latest_cursor",t,"api","rpc")},i.filesListFolderLongpoll=function(t){return this.request("files/list_folder/longpoll",t,"notify","rpc")},i.filesListRevisions=function(t){return this.request("files/list_revisions",t,"api","rpc")},i.filesMove=function(t){return this.request("files/move",t,"api","rpc")},i.filesPermanentlyDelete=function(t){return this.request("files/permanently_delete",t,"api","rpc")},i.filesPropertiesAdd=function(t){return this.request("files/properties/add",t,"api","rpc")},i.filesPropertiesOverwrite=function(t){return this.request("files/properties/overwrite",t,"api","rpc")},i.filesPropertiesRemove=function(t){return this.request("files/properties/remove",t,"api","rpc")},i.filesPropertiesTemplateGet=function(t){return this.request("files/properties/template/get",t,"api","rpc")},i.filesPropertiesTemplateList=function(t){return this.request("files/properties/template/list",t,"api","rpc")},i.filesPropertiesUpdate=function(t){return this.request("files/properties/update",t,"api","rpc")},i.filesRestore=function(t){return this.request("files/restore",t,"api","rpc")},i.filesSaveUrl=function(t){return this.request("files/save_url",t,"api","rpc")},i.filesSaveUrlCheckJobStatus=function(t){return this.request("files/save_url/check_job_status",t,"api","rpc")},i.filesSearch=function(t){return this.request("files/search",t,"api","rpc")},i.filesUpload=function(t){return this.request("files/upload",t,"content","upload")},i.filesUploadSessionAppend=function(t){return this.request("files/upload_session/append",t,"content","upload")},i.filesUploadSessionAppendV2=function(t){return this.request("files/upload_session/append_v2",t,"content","upload")},i.filesUploadSessionFinish=function(t){return this.request("files/upload_session/finish",t,"content","upload")},i.filesUploadSessionStart=function(t){return this.request("files/upload_session/start",t,"content","upload")},i.sharingAddFileMember=function(t){return this.request("sharing/add_file_member",t,"api","rpc")},i.sharingAddFolderMember=function(t){return this.request("sharing/add_folder_member",t,"api","rpc")},i.sharingCheckJobStatus=function(t){return this.request("sharing/check_job_status",t,"api","rpc")},i.sharingCheckRemoveMemberJobStatus=function(t){return this.request("sharing/check_remove_member_job_status",t,"api","rpc")},i.sharingCheckShareJobStatus=function(t){return this.request("sharing/check_share_job_status",t,"api","rpc")},i.sharingCreateSharedLink=function(t){return this.request("sharing/create_shared_link",t,"api","rpc")},i.sharingCreateSharedLinkWithSettings=function(t){return this.request("sharing/create_shared_link_with_settings",t,"api","rpc")},i.sharingGetFileMetadata=function(t){return this.request("sharing/get_file_metadata",t,"api","rpc")},i.sharingGetFileMetadataBatch=function(t){return this.request("sharing/get_file_metadata/batch",t,"api","rpc")},i.sharingGetFolderMetadata=function(t){return this.request("sharing/get_folder_metadata",t,"api","rpc")},i.sharingGetSharedLinkFile=function(t){return this.request("sharing/get_shared_link_file",t,"content","download")},i.sharingGetSharedLinkMetadata=function(t){return this.request("sharing/get_shared_link_metadata",t,"api","rpc")},i.sharingGetSharedLinks=function(t){return this.request("sharing/get_shared_links",t,"api","rpc")},i.sharingListFileMembers=function(t){return this.request("sharing/list_file_members",t,"api","rpc")},i.sharingListFileMembersBatch=function(t){return this.request("sharing/list_file_members/batch",t,"api","rpc")},i.sharingListFileMembersContinue=function(t){return this.request("sharing/list_file_members/continue",t,"api","rpc")},i.sharingListFolderMembers=function(t){return this.request("sharing/list_folder_members",t,"api","rpc")},i.sharingListFolderMembersContinue=function(t){return this.request("sharing/list_folder_members/continue",t,"api","rpc");
},i.sharingListFolders=function(t){return this.request("sharing/list_folders",t,"api","rpc")},i.sharingListFoldersContinue=function(t){return this.request("sharing/list_folders/continue",t,"api","rpc")},i.sharingListMountableFolders=function(t){return this.request("sharing/list_mountable_folders",t,"api","rpc")},i.sharingListMountableFoldersContinue=function(t){return this.request("sharing/list_mountable_folders/continue",t,"api","rpc")},i.sharingListReceivedFiles=function(t){return this.request("sharing/list_received_files",t,"api","rpc")},i.sharingListReceivedFilesContinue=function(t){return this.request("sharing/list_received_files/continue",t,"api","rpc")},i.sharingListSharedLinks=function(t){return this.request("sharing/list_shared_links",t,"api","rpc")},i.sharingModifySharedLinkSettings=function(t){return this.request("sharing/modify_shared_link_settings",t,"api","rpc")},i.sharingMountFolder=function(t){return this.request("sharing/mount_folder",t,"api","rpc")},i.sharingRelinquishFileMembership=function(t){return this.request("sharing/relinquish_file_membership",t,"api","rpc")},i.sharingRelinquishFolderMembership=function(t){return this.request("sharing/relinquish_folder_membership",t,"api","rpc")},i.sharingRemoveFileMember=function(t){return this.request("sharing/remove_file_member",t,"api","rpc")},i.sharingRemoveFileMember2=function(t){return this.request("sharing/remove_file_member_2",t,"api","rpc")},i.sharingRemoveFolderMember=function(t){return this.request("sharing/remove_folder_member",t,"api","rpc")},i.sharingRevokeSharedLink=function(t){return this.request("sharing/revoke_shared_link",t,"api","rpc")},i.sharingShareFolder=function(t){return this.request("sharing/share_folder",t,"api","rpc")},i.sharingTransferFolder=function(t){return this.request("sharing/transfer_folder",t,"api","rpc")},i.sharingUnmountFolder=function(t){return this.request("sharing/unmount_folder",t,"api","rpc")},i.sharingUnshareFile=function(t){return this.request("sharing/unshare_file",t,"api","rpc")},i.sharingUnshareFolder=function(t){return this.request("sharing/unshare_folder",t,"api","rpc")},i.sharingUpdateFolderMember=function(t){return this.request("sharing/update_folder_member",t,"api","rpc")},i.sharingUpdateFolderPolicy=function(t){return this.request("sharing/update_folder_policy",t,"api","rpc")},i.usersGetAccount=function(t){return this.request("users/get_account",t,"api","rpc")},i.usersGetAccountBatch=function(t){return this.request("users/get_account_batch",t,"api","rpc")},i.usersGetCurrentAccount=function(t){return this.request("users/get_current_account",t,"api","rpc")},i.usersGetSpaceUsage=function(t){return this.request("users/get_space_usage",t,"api","rpc")},t.exports=i},function(t,e,i){var n=i(2),s=i(1).Promise,r="https://api.dropboxapi.com/2/",o=function(t,e){return{status:t.status,error:e.text,response:e}},a=function(t,e,i,a){var h=function(s,h){function u(t){s&&s(t)}function c(t){h&&h(t)}function l(t,e){t?c(o(t,e)):u(e.body)}var p;e||(e=null),p=n.post(r+t).type("application/json").set("Authorization","Bearer "+i),a&&(p=p.set("Dropbox-API-Select-User",a)),p.send(e).end(l)};return new s(h)};t.exports=a},function(t,e,i){var n=i(2),s=i(1).Promise,r="https://content.dropboxapi.com/2/",o=function(t,e){return{status:t.status,error:e.text,response:e}},a=function(t,e,i,a){var h=function(s,h){function u(t){s&&s(t)}function c(t){h&&h(t)}function l(t,e){t?c(o(t,e)):u(e.body)}var p,d=e.contents;delete e.contents,p=n.post(r+t).type("application/octet-stream").set("Authorization","Bearer "+i).set("Dropbox-API-Arg",JSON.stringify(e)),a&&(p=p.set("Dropbox-API-Select-User",a)),p.send(d).end(l)};return new s(h)};t.exports=a},function(t,e){}])});var JSNES=function(t){if(this.opts={ui:JSNES.DummyUI,preferredFrameRate:60,fpsInterval:500,showDisplay:!0,emulateSound:!1,CPU_FREQ_NTSC:1789772.5,CPU_FREQ_PAL:1773447.4},"undefined"!=typeof t){var e;for(e in this.opts)"undefined"!=typeof t[e]&&(this.opts[e]=t[e])}this.frameTime=1e3/this.opts.preferredFrameRate,this.ui=new this.opts.ui(this),this.cpu=new JSNES.CPU(this),this.ppu=new JSNES.PPU(this),this.papu=new JSNES.PAPU(this),this.mmap=null,this.keyboard=new JSNES.Keyboard,this.ui.updateStatus("Ready to load a ROM.")};JSNES.VERSION="<%= version %>",JSNES.prototype={isRunning:!1,fpsFrameCount:0,romData:null,enableSound:function(t){this.opts.emulateSound=t,this.isRunning&&this.papu.enableSound(t)},reset:function(){null!==this.mmap&&this.mmap.reset(),this.cpu.reset(),this.ppu.reset(),this.papu.reset(),this.papu.enableSound(this.opts.emulateSound)},start:function(){var t=this;this.rom&&this.rom.valid?this.isRunning||(this.isRunning=!0,this.frameInterval=setInterval(function(){t.frame()},this.frameTime),this.resetFps(),this.printFps(),this.fpsInterval=setInterval(function(){t.printFps()},this.opts.fpsInterval),this.papu.enableSound(this.opts.emulateSound)):this.ui.updateStatus("There is no ROM loaded, or it is invalid.")},frame:function(){this.ppu.startFrame();var t=0,e=this.opts.emulateSound,i=this.cpu,n=this.ppu,s=this.papu;t:for(;;)for(0===i.cyclesToHalt?(t=i.emulate(),e&&s.clockFrameCounter(t),t*=3):i.cyclesToHalt>8?(t=24,e&&s.clockFrameCounter(8),i.cyclesToHalt-=8):(t=3*i.cyclesToHalt,e&&s.clockFrameCounter(i.cyclesToHalt),i.cyclesToHalt=0);t>0;t--){if(n.curX===n.spr0HitX&&1===n.f_spVisibility&&n.scanline-21===n.spr0HitY&&n.setStatusFlag(n.STATUS_SPRITE0HIT,!0),n.requestEndFrame&&(n.nmiCounter--,0===n.nmiCounter)){n.requestEndFrame=!1,n.startVBlank();break t}n.curX++,341===n.curX&&(n.curX=0,n.endScanline())}this.fpsFrameCount++},printFps:function(){var t=+new Date,e="Running";this.lastFpsTime&&(e+=": "+(this.fpsFrameCount/((t-this.lastFpsTime)/1e3)).toFixed(2)+" FPS"),this.ui.updateStatus(e),this.fpsFrameCount=0,this.lastFpsTime=t},stop:function(){clearInterval(this.frameInterval),clearInterval(this.fpsInterval),this.papu.enableSound(!1),this.isRunning=!1},reloadRom:function(){null!==this.romData&&this.loadRom(this.romData)},loadRom:function(t){if(this.isRunning&&this.stop(),this.ui.updateStatus("Loading ROM..."),this.rom=new JSNES.ROM(this),this.rom.load(t),this.rom.valid){if(this.reset(),this.mmap=this.rom.createMapper(),!this.mmap)return;this.mmap.loadROM(),this.ppu.setMirroring(this.rom.getMirroringType()),this.romData=t,this.ui.updateStatus("Successfully loaded. Ready to be started.")}else this.ui.updateStatus("Invalid ROM!");return this.rom.valid},resetFps:function(){this.lastFpsTime=null,this.fpsFrameCount=0},setFramerate:function(t){this.opts.preferredFrameRate=t,this.frameTime=1e3/t},toJSON:function(){return{romData:this.romData,cpu:this.cpu.toJSON(),mmap:this.mmap.toJSON(),ppu:this.ppu.toJSON()}},fromJSON:function(t){this.loadRom(t.romData),this.cpu.fromJSON(t.cpu),this.mmap.fromJSON(t.mmap),this.ppu.fromJSON(t.ppu)}},JSNES.Utils={copyArrayElements:function(t,e,i,n,s){for(var r=0;r<s;++r)i[n+r]=t[e+r]},copyArray:function(t){for(var e=new Array(t.length),i=0;i<t.length;i++)e[i]=t[i];return e},fromJSON:function(t,e){for(var i=0;i<t.JSON_PROPERTIES.length;i++)t[t.JSON_PROPERTIES[i]]=e[t.JSON_PROPERTIES[i]]},toJSON:function(t){for(var e={},i=0;i<t.JSON_PROPERTIES.length;i++)e[t.JSON_PROPERTIES[i]]=t[t.JSON_PROPERTIES[i]];return e},isIE:function(){return/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)}},JSNES.CPU=function(t){this.nes=t,this.mem=null,this.REG_ACC=null,this.REG_X=null,this.REG_Y=null,this.REG_SP=null,this.REG_PC=null,this.REG_PC_NEW=null,this.REG_STATUS=null,this.F_CARRY=null,this.F_DECIMAL=null,this.F_INTERRUPT=null,this.F_INTERRUPT_NEW=null,this.F_OVERFLOW=null,this.F_SIGN=null,this.F_ZERO=null,this.F_NOTUSED=null,this.F_NOTUSED_NEW=null,this.F_BRK=null,this.F_BRK_NEW=null,this.opdata=null,this.cyclesToHalt=null,this.crash=null,this.irqRequested=null,this.irqType=null,this.reset()},JSNES.CPU.prototype={IRQ_NORMAL:0,IRQ_NMI:1,IRQ_RESET:2,reset:function(){this.mem=new Array(65536);for(var t=0;t<8192;t++)this.mem[t]=255;for(var e=0;e<4;e++){var t=2048*e;this.mem[t+8]=247,this.mem[t+9]=239,this.mem[t+10]=223,this.mem[t+15]=191}for(var t=8193;t<this.mem.length;t++)this.mem[t]=0;this.REG_ACC=0,this.REG_X=0,this.REG_Y=0,this.REG_SP=511,this.REG_PC=32767,this.REG_PC_NEW=32767,this.REG_STATUS=40,this.setStatus(40),this.F_CARRY=0,this.F_DECIMAL=0,this.F_INTERRUPT=1,this.F_INTERRUPT_NEW=1,this.F_OVERFLOW=0,this.F_SIGN=0,this.F_ZERO=1,this.F_NOTUSED=1,this.F_NOTUSED_NEW=1,this.F_BRK=1,this.F_BRK_NEW=1,this.opdata=(new JSNES.CPU.OpData).opdata,this.cyclesToHalt=0,this.crash=!1,this.irqRequested=!1,this.irqType=null},emulate:function(){var t,e;if(this.irqRequested){switch(t=this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7,this.REG_PC_NEW=this.REG_PC,this.F_INTERRUPT_NEW=this.F_INTERRUPT,this.irqType){case 0:if(0!=this.F_INTERRUPT)break;this.doIrq(t);break;case 1:this.doNonMaskableInterrupt(t);break;case 2:this.doResetInterrupt()}this.REG_PC=this.REG_PC_NEW,this.F_INTERRUPT=this.F_INTERRUPT_NEW,this.F_BRK=this.F_BRK_NEW,this.irqRequested=!1}var i=this.opdata[this.nes.mmap.load(this.REG_PC+1)],n=i>>24,s=0,r=i>>8&255,o=this.REG_PC;this.REG_PC+=i>>16&255;var a=0;switch(r){case 0:a=this.load(o+2);break;case 1:a=this.load(o+2),a+=a<128?this.REG_PC:this.REG_PC-256;break;case 2:break;case 3:a=this.load16bit(o+2);break;case 4:a=this.REG_ACC;break;case 5:a=this.REG_PC;break;case 6:a=this.load(o+2)+this.REG_X&255;break;case 7:a=this.load(o+2)+this.REG_Y&255;break;case 8:a=this.load16bit(o+2),(65280&a)!=(a+this.REG_X&65280)&&(s=1),a+=this.REG_X;break;case 9:a=this.load16bit(o+2),(65280&a)!=(a+this.REG_Y&65280)&&(s=1),a+=this.REG_Y;break;case 10:a=this.load(o+2),(65280&a)!=(a+this.REG_X&65280)&&(s=1),a+=this.REG_X,a&=255,a=this.load16bit(a);break;case 11:a=this.load16bit(this.load(o+2)),(65280&a)!=(a+this.REG_Y&65280)&&(s=1),a+=this.REG_Y;break;case 12:a=this.load16bit(o+2),a=a<8191?this.mem[a]+(this.mem[65280&a|(255&a)+1&255]<<8):this.nes.mmap.load(a)+(this.nes.mmap.load(65280&a|(255&a)+1&255)<<8)}switch(a&=65535,255&i){case 0:t=this.REG_ACC+this.load(a)+this.F_CARRY,this.F_OVERFLOW=0==(128&(this.REG_ACC^this.load(a)))&&0!=(128&(this.REG_ACC^t))?1:0,this.F_CARRY=t>255?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t,this.REG_ACC=255&t,n+=s;break;case 1:this.REG_ACC=this.REG_ACC&this.load(a),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!=r&&(n+=s);break;case 2:4==r?(this.F_CARRY=this.REG_ACC>>7&1,this.REG_ACC=this.REG_ACC<<1&255,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC):(t=this.load(a),this.F_CARRY=t>>7&1,t=t<<1&255,this.F_SIGN=t>>7&1,this.F_ZERO=t,this.write(a,t));break;case 3:0==this.F_CARRY&&(n+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 4:1==this.F_CARRY&&(n+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 5:0==this.F_ZERO&&(n+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 6:t=this.load(a),this.F_SIGN=t>>7&1,this.F_OVERFLOW=t>>6&1,t&=this.REG_ACC,this.F_ZERO=t;break;case 7:1==this.F_SIGN&&(n++,this.REG_PC=a);break;case 8:0!=this.F_ZERO&&(n+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 9:0==this.F_SIGN&&(n+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 10:this.REG_PC+=2,this.push(this.REG_PC>>8&255),this.push(255&this.REG_PC),this.F_BRK=1,this.push(this.F_CARRY|(0==this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7),this.F_INTERRUPT=1,this.REG_PC=this.load16bit(65534),this.REG_PC--;break;case 11:0==this.F_OVERFLOW&&(n+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 12:1==this.F_OVERFLOW&&(n+=(65280&o)!=(65280&a)?2:1,this.REG_PC=a);break;case 13:this.F_CARRY=0;break;case 14:this.F_DECIMAL=0;break;case 15:this.F_INTERRUPT=0;break;case 16:this.F_OVERFLOW=0;break;case 17:t=this.REG_ACC-this.load(a),this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t,n+=s;break;case 18:t=this.REG_X-this.load(a),this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t;break;case 19:t=this.REG_Y-this.load(a),this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t;break;case 20:t=this.load(a)-1&255,this.F_SIGN=t>>7&1,this.F_ZERO=t,this.write(a,t);break;case 21:this.REG_X=this.REG_X-1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 22:this.REG_Y=this.REG_Y-1&255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 23:this.REG_ACC=255&(this.load(a)^this.REG_ACC),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,n+=s;break;case 24:t=this.load(a)+1&255,this.F_SIGN=t>>7&1,this.F_ZERO=t,this.write(a,255&t);break;case 25:this.REG_X=this.REG_X+1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 26:this.REG_Y++,this.REG_Y&=255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 27:this.REG_PC=a-1;break;case 28:this.push(this.REG_PC>>8&255),this.push(255&this.REG_PC),this.REG_PC=a-1;break;case 29:this.REG_ACC=this.load(a),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,n+=s;break;case 30:this.REG_X=this.load(a),this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X,n+=s;break;case 31:this.REG_Y=this.load(a),this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y,n+=s;break;case 32:4==r?(t=255&this.REG_ACC,this.F_CARRY=1&t,t>>=1,this.REG_ACC=t):(t=255&this.load(a),this.F_CARRY=1&t,t>>=1,this.write(a,t)),this.F_SIGN=0,this.F_ZERO=t;break;case 33:break;case 34:t=255&(this.load(a)|this.REG_ACC),this.F_SIGN=t>>7&1,this.F_ZERO=t,this.REG_ACC=t,11!=r&&(n+=s);break;case 35:this.push(this.REG_ACC);break;case 36:this.F_BRK=1,this.push(this.F_CARRY|(0==this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7);break;case 37:this.REG_ACC=this.pull(),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 38:t=this.pull(),this.F_CARRY=1&t,this.F_ZERO=1==(t>>1&1)?0:1,this.F_INTERRUPT=t>>2&1,this.F_DECIMAL=t>>3&1,this.F_BRK=t>>4&1,this.F_NOTUSED=t>>5&1,this.F_OVERFLOW=t>>6&1,this.F_SIGN=t>>7&1,this.F_NOTUSED=1;break;case 39:4==r?(t=this.REG_ACC,e=this.F_CARRY,this.F_CARRY=t>>7&1,t=(t<<1&255)+e,this.REG_ACC=t):(t=this.load(a),e=this.F_CARRY,this.F_CARRY=t>>7&1,t=(t<<1&255)+e,this.write(a,t)),this.F_SIGN=t>>7&1,this.F_ZERO=t;break;case 40:4==r?(e=this.F_CARRY<<7,this.F_CARRY=1&this.REG_ACC,t=(this.REG_ACC>>1)+e,this.REG_ACC=t):(t=this.load(a),e=this.F_CARRY<<7,this.F_CARRY=1&t,t=(t>>1)+e,this.write(a,t)),this.F_SIGN=t>>7&1,this.F_ZERO=t;break;case 41:if(t=this.pull(),this.F_CARRY=1&t,this.F_ZERO=0==(t>>1&1)?1:0,this.F_INTERRUPT=t>>2&1,this.F_DECIMAL=t>>3&1,this.F_BRK=t>>4&1,this.F_NOTUSED=t>>5&1,this.F_OVERFLOW=t>>6&1,this.F_SIGN=t>>7&1,this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,65535==this.REG_PC)return;this.REG_PC--,this.F_NOTUSED=1;break;case 42:if(this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,65535==this.REG_PC)return;break;case 43:t=this.REG_ACC-this.load(a)-(1-this.F_CARRY),this.F_SIGN=t>>7&1,this.F_ZERO=255&t,this.F_OVERFLOW=0!=(128&(this.REG_ACC^t))&&0!=(128&(this.REG_ACC^this.load(a)))?1:0,this.F_CARRY=t<0?0:1,this.REG_ACC=255&t,11!=r&&(n+=s);break;case 44:this.F_CARRY=1;break;case 45:this.F_DECIMAL=1;break;case 46:this.F_INTERRUPT=1;break;case 47:this.write(a,this.REG_ACC);break;case 48:this.write(a,this.REG_X);break;case 49:this.write(a,this.REG_Y);break;case 50:this.REG_X=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 51:this.REG_Y=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 52:this.REG_X=this.REG_SP-256,this.F_SIGN=this.REG_SP>>7&1,this.F_ZERO=this.REG_X;break;case 53:this.REG_ACC=this.REG_X,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 54:this.REG_SP=this.REG_X+256,this.stackWrap();break;case 55:this.REG_ACC=this.REG_Y,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;default:this.nes.stop(),this.nes.crashMessage="Game crashed, invalid opcode at address $"+o.toString(16)}return n},load:function(t){return t<8192?this.mem[2047&t]:this.nes.mmap.load(t)},load16bit:function(t){return t<8191?this.mem[2047&t]|this.mem[t+1&2047]<<8:this.nes.mmap.load(t)|this.nes.mmap.load(t+1)<<8},write:function(t,e){t<8192?this.mem[2047&t]=e:this.nes.mmap.write(t,e)},requestIrq:function(t){this.irqRequested&&t==this.IRQ_NORMAL||(this.irqRequested=!0,this.irqType=t)},push:function(t){this.nes.mmap.write(this.REG_SP,t),this.REG_SP--,this.REG_SP=256|255&this.REG_SP},stackWrap:function(){this.REG_SP=256|255&this.REG_SP},pull:function(){return this.REG_SP++,this.REG_SP=256|255&this.REG_SP,this.nes.mmap.load(this.REG_SP)},pageCrossed:function(t,e){return(65280&t)!=(65280&e)},haltCycles:function(t){this.cyclesToHalt+=t},doNonMaskableInterrupt:function(t){0!=(128&this.nes.mmap.load(8192))&&(this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(255&this.REG_PC_NEW),this.push(t),this.REG_PC_NEW=this.nes.mmap.load(65530)|this.nes.mmap.load(65531)<<8,this.REG_PC_NEW--)},doResetInterrupt:function(){this.REG_PC_NEW=this.nes.mmap.load(65532)|this.nes.mmap.load(65533)<<8,this.REG_PC_NEW--},doIrq:function(t){this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(255&this.REG_PC_NEW),this.push(t),this.F_INTERRUPT_NEW=1,this.F_BRK_NEW=0,this.REG_PC_NEW=this.nes.mmap.load(65534)|this.nes.mmap.load(65535)<<8,this.REG_PC_NEW--},getStatus:function(){return this.F_CARRY|this.F_ZERO<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7},setStatus:function(t){this.F_CARRY=1&t,this.F_ZERO=t>>1&1,this.F_INTERRUPT=t>>2&1,this.F_DECIMAL=t>>3&1,this.F_BRK=t>>4&1,this.F_NOTUSED=t>>5&1,this.F_OVERFLOW=t>>6&1,this.F_SIGN=t>>7&1},JSON_PROPERTIES:["mem","cyclesToHalt","irqRequested","irqType","REG_ACC","REG_X","REG_Y","REG_SP","REG_PC","REG_PC_NEW","REG_STATUS","F_CARRY","F_DECIMAL","F_INTERRUPT","F_INTERRUPT_NEW","F_OVERFLOW","F_SIGN","F_ZERO","F_NOTUSED","F_NOTUSED_NEW","F_BRK","F_BRK_NEW"],toJSON:function(){return JSNES.Utils.toJSON(this)},fromJSON:function(t){JSNES.Utils.fromJSON(this,t)}},JSNES.CPU.OpData=function(){this.opdata=new Array(256);for(var t=0;t<256;t++)this.opdata[t]=255;this.setOp(this.INS_ADC,105,this.ADDR_IMM,2,2),this.setOp(this.INS_ADC,101,this.ADDR_ZP,2,3),this.setOp(this.INS_ADC,117,this.ADDR_ZPX,2,4),this.setOp(this.INS_ADC,109,this.ADDR_ABS,3,4),this.setOp(this.INS_ADC,125,this.ADDR_ABSX,3,4),this.setOp(this.INS_ADC,121,this.ADDR_ABSY,3,4),this.setOp(this.INS_ADC,97,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ADC,113,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_AND,41,this.ADDR_IMM,2,2),this.setOp(this.INS_AND,37,this.ADDR_ZP,2,3),this.setOp(this.INS_AND,53,this.ADDR_ZPX,2,4),this.setOp(this.INS_AND,45,this.ADDR_ABS,3,4),this.setOp(this.INS_AND,61,this.ADDR_ABSX,3,4),this.setOp(this.INS_AND,57,this.ADDR_ABSY,3,4),this.setOp(this.INS_AND,33,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_AND,49,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_ASL,10,this.ADDR_ACC,1,2),this.setOp(this.INS_ASL,6,this.ADDR_ZP,2,5),this.setOp(this.INS_ASL,22,this.ADDR_ZPX,2,6),this.setOp(this.INS_ASL,14,this.ADDR_ABS,3,6),this.setOp(this.INS_ASL,30,this.ADDR_ABSX,3,7),this.setOp(this.INS_BCC,144,this.ADDR_REL,2,2),this.setOp(this.INS_BCS,176,this.ADDR_REL,2,2),this.setOp(this.INS_BEQ,240,this.ADDR_REL,2,2),this.setOp(this.INS_BIT,36,this.ADDR_ZP,2,3),this.setOp(this.INS_BIT,44,this.ADDR_ABS,3,4),this.setOp(this.INS_BMI,48,this.ADDR_REL,2,2),this.setOp(this.INS_BNE,208,this.ADDR_REL,2,2),this.setOp(this.INS_BPL,16,this.ADDR_REL,2,2),this.setOp(this.INS_BRK,0,this.ADDR_IMP,1,7),this.setOp(this.INS_BVC,80,this.ADDR_REL,2,2),this.setOp(this.INS_BVS,112,this.ADDR_REL,2,2),this.setOp(this.INS_CLC,24,this.ADDR_IMP,1,2),this.setOp(this.INS_CLD,216,this.ADDR_IMP,1,2),this.setOp(this.INS_CLI,88,this.ADDR_IMP,1,2),this.setOp(this.INS_CLV,184,this.ADDR_IMP,1,2),this.setOp(this.INS_CMP,201,this.ADDR_IMM,2,2),this.setOp(this.INS_CMP,197,this.ADDR_ZP,2,3),this.setOp(this.INS_CMP,213,this.ADDR_ZPX,2,4),this.setOp(this.INS_CMP,205,this.ADDR_ABS,3,4),this.setOp(this.INS_CMP,221,this.ADDR_ABSX,3,4),this.setOp(this.INS_CMP,217,this.ADDR_ABSY,3,4),this.setOp(this.INS_CMP,193,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_CMP,209,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_CPX,224,this.ADDR_IMM,2,2),this.setOp(this.INS_CPX,228,this.ADDR_ZP,2,3),this.setOp(this.INS_CPX,236,this.ADDR_ABS,3,4),this.setOp(this.INS_CPY,192,this.ADDR_IMM,2,2),this.setOp(this.INS_CPY,196,this.ADDR_ZP,2,3),this.setOp(this.INS_CPY,204,this.ADDR_ABS,3,4),this.setOp(this.INS_DEC,198,this.ADDR_ZP,2,5),this.setOp(this.INS_DEC,214,this.ADDR_ZPX,2,6),this.setOp(this.INS_DEC,206,this.ADDR_ABS,3,6),this.setOp(this.INS_DEC,222,this.ADDR_ABSX,3,7),this.setOp(this.INS_DEX,202,this.ADDR_IMP,1,2),this.setOp(this.INS_DEY,136,this.ADDR_IMP,1,2),this.setOp(this.INS_EOR,73,this.ADDR_IMM,2,2),this.setOp(this.INS_EOR,69,this.ADDR_ZP,2,3),this.setOp(this.INS_EOR,85,this.ADDR_ZPX,2,4),this.setOp(this.INS_EOR,77,this.ADDR_ABS,3,4),this.setOp(this.INS_EOR,93,this.ADDR_ABSX,3,4),this.setOp(this.INS_EOR,89,this.ADDR_ABSY,3,4),this.setOp(this.INS_EOR,65,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_EOR,81,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_INC,230,this.ADDR_ZP,2,5),this.setOp(this.INS_INC,246,this.ADDR_ZPX,2,6),this.setOp(this.INS_INC,238,this.ADDR_ABS,3,6),this.setOp(this.INS_INC,254,this.ADDR_ABSX,3,7),this.setOp(this.INS_INX,232,this.ADDR_IMP,1,2),this.setOp(this.INS_INY,200,this.ADDR_IMP,1,2),this.setOp(this.INS_JMP,76,this.ADDR_ABS,3,3),this.setOp(this.INS_JMP,108,this.ADDR_INDABS,3,5),this.setOp(this.INS_JSR,32,this.ADDR_ABS,3,6),this.setOp(this.INS_LDA,169,this.ADDR_IMM,2,2),this.setOp(this.INS_LDA,165,this.ADDR_ZP,2,3),this.setOp(this.INS_LDA,181,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDA,173,this.ADDR_ABS,3,4),this.setOp(this.INS_LDA,189,this.ADDR_ABSX,3,4),this.setOp(this.INS_LDA,185,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDA,161,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_LDA,177,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_LDX,162,this.ADDR_IMM,2,2),this.setOp(this.INS_LDX,166,this.ADDR_ZP,2,3),this.setOp(this.INS_LDX,182,this.ADDR_ZPY,2,4),this.setOp(this.INS_LDX,174,this.ADDR_ABS,3,4),this.setOp(this.INS_LDX,190,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDY,160,this.ADDR_IMM,2,2),this.setOp(this.INS_LDY,164,this.ADDR_ZP,2,3),this.setOp(this.INS_LDY,180,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDY,172,this.ADDR_ABS,3,4),this.setOp(this.INS_LDY,188,this.ADDR_ABSX,3,4),this.setOp(this.INS_LSR,74,this.ADDR_ACC,1,2),this.setOp(this.INS_LSR,70,this.ADDR_ZP,2,5),this.setOp(this.INS_LSR,86,this.ADDR_ZPX,2,6),this.setOp(this.INS_LSR,78,this.ADDR_ABS,3,6),this.setOp(this.INS_LSR,94,this.ADDR_ABSX,3,7),this.setOp(this.INS_NOP,234,this.ADDR_IMP,1,2),this.setOp(this.INS_ORA,9,this.ADDR_IMM,2,2),this.setOp(this.INS_ORA,5,this.ADDR_ZP,2,3),this.setOp(this.INS_ORA,21,this.ADDR_ZPX,2,4),this.setOp(this.INS_ORA,13,this.ADDR_ABS,3,4),this.setOp(this.INS_ORA,29,this.ADDR_ABSX,3,4),this.setOp(this.INS_ORA,25,this.ADDR_ABSY,3,4),this.setOp(this.INS_ORA,1,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ORA,17,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_PHA,72,this.ADDR_IMP,1,3),this.setOp(this.INS_PHP,8,this.ADDR_IMP,1,3),this.setOp(this.INS_PLA,104,this.ADDR_IMP,1,4),this.setOp(this.INS_PLP,40,this.ADDR_IMP,1,4),this.setOp(this.INS_ROL,42,this.ADDR_ACC,1,2),this.setOp(this.INS_ROL,38,this.ADDR_ZP,2,5),this.setOp(this.INS_ROL,54,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROL,46,this.ADDR_ABS,3,6),this.setOp(this.INS_ROL,62,this.ADDR_ABSX,3,7),this.setOp(this.INS_ROR,106,this.ADDR_ACC,1,2),this.setOp(this.INS_ROR,102,this.ADDR_ZP,2,5),this.setOp(this.INS_ROR,118,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROR,110,this.ADDR_ABS,3,6),this.setOp(this.INS_ROR,126,this.ADDR_ABSX,3,7),this.setOp(this.INS_RTI,64,this.ADDR_IMP,1,6),this.setOp(this.INS_RTS,96,this.ADDR_IMP,1,6),this.setOp(this.INS_SBC,233,this.ADDR_IMM,2,2),this.setOp(this.INS_SBC,229,this.ADDR_ZP,2,3),this.setOp(this.INS_SBC,245,this.ADDR_ZPX,2,4),this.setOp(this.INS_SBC,237,this.ADDR_ABS,3,4),this.setOp(this.INS_SBC,253,this.ADDR_ABSX,3,4),this.setOp(this.INS_SBC,249,this.ADDR_ABSY,3,4),this.setOp(this.INS_SBC,225,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_SBC,241,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_SEC,56,this.ADDR_IMP,1,2),this.setOp(this.INS_SED,248,this.ADDR_IMP,1,2),this.setOp(this.INS_SEI,120,this.ADDR_IMP,1,2),this.setOp(this.INS_STA,133,this.ADDR_ZP,2,3),this.setOp(this.INS_STA,149,this.ADDR_ZPX,2,4),this.setOp(this.INS_STA,141,this.ADDR_ABS,3,4),this.setOp(this.INS_STA,157,this.ADDR_ABSX,3,5),this.setOp(this.INS_STA,153,this.ADDR_ABSY,3,5),this.setOp(this.INS_STA,129,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_STA,145,this.ADDR_POSTIDXIND,2,6),this.setOp(this.INS_STX,134,this.ADDR_ZP,2,3),this.setOp(this.INS_STX,150,this.ADDR_ZPY,2,4),this.setOp(this.INS_STX,142,this.ADDR_ABS,3,4),this.setOp(this.INS_STY,132,this.ADDR_ZP,2,3),this.setOp(this.INS_STY,148,this.ADDR_ZPX,2,4),this.setOp(this.INS_STY,140,this.ADDR_ABS,3,4),this.setOp(this.INS_TAX,170,this.ADDR_IMP,1,2),this.setOp(this.INS_TAY,168,this.ADDR_IMP,1,2),this.setOp(this.INS_TSX,186,this.ADDR_IMP,1,2),this.setOp(this.INS_TXA,138,this.ADDR_IMP,1,2),this.setOp(this.INS_TXS,154,this.ADDR_IMP,1,2),this.setOp(this.INS_TYA,152,this.ADDR_IMP,1,2),this.cycTable=new Array(7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,3,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7),this.instname=new Array(56),this.instname[0]="ADC",this.instname[1]="AND",this.instname[2]="ASL",this.instname[3]="BCC",this.instname[4]="BCS",this.instname[5]="BEQ",this.instname[6]="BIT",this.instname[7]="BMI",this.instname[8]="BNE",this.instname[9]="BPL",this.instname[10]="BRK",this.instname[11]="BVC",this.instname[12]="BVS",this.instname[13]="CLC",this.instname[14]="CLD",this.instname[15]="CLI",this.instname[16]="CLV",this.instname[17]="CMP",this.instname[18]="CPX",this.instname[19]="CPY",this.instname[20]="DEC",this.instname[21]="DEX",this.instname[22]="DEY",this.instname[23]="EOR",this.instname[24]="INC",this.instname[25]="INX",this.instname[26]="INY",this.instname[27]="JMP",this.instname[28]="JSR",this.instname[29]="LDA",this.instname[30]="LDX",this.instname[31]="LDY",this.instname[32]="LSR",this.instname[33]="NOP",this.instname[34]="ORA",this.instname[35]="PHA",this.instname[36]="PHP",this.instname[37]="PLA",this.instname[38]="PLP",this.instname[39]="ROL",this.instname[40]="ROR",this.instname[41]="RTI",this.instname[42]="RTS",this.instname[43]="SBC",this.instname[44]="SEC",this.instname[45]="SED",this.instname[46]="SEI",this.instname[47]="STA",this.instname[48]="STX",this.instname[49]="STY",this.instname[50]="TAX",this.instname[51]="TAY",this.instname[52]="TSX",this.instname[53]="TXA",this.instname[54]="TXS",this.instname[55]="TYA",this.addrDesc=new Array("Zero Page           ","Relative            ","Implied             ","Absolute            ","Accumulator         ","Immediate           ","Zero Page,X         ","Zero Page,Y         ","Absolute,X          ","Absolute,Y          ","Preindexed Indirect ","Postindexed Indirect","Indirect Absolute   ")},JSNES.CPU.OpData.prototype={INS_ADC:0,INS_AND:1,INS_ASL:2,INS_BCC:3,INS_BCS:4,INS_BEQ:5,INS_BIT:6,INS_BMI:7,INS_BNE:8,INS_BPL:9,INS_BRK:10,INS_BVC:11,INS_BVS:12,INS_CLC:13,INS_CLD:14,INS_CLI:15,INS_CLV:16,INS_CMP:17,INS_CPX:18,INS_CPY:19,INS_DEC:20,INS_DEX:21,INS_DEY:22,INS_EOR:23,INS_INC:24,INS_INX:25,INS_INY:26,INS_JMP:27,INS_JSR:28,INS_LDA:29,INS_LDX:30,INS_LDY:31,INS_LSR:32,INS_NOP:33,INS_ORA:34,INS_PHA:35,INS_PHP:36,INS_PLA:37,INS_PLP:38,INS_ROL:39,INS_ROR:40,INS_RTI:41,INS_RTS:42,INS_SBC:43,INS_SEC:44,INS_SED:45,INS_SEI:46,INS_STA:47,INS_STX:48,INS_STY:49,INS_TAX:50,INS_TAY:51,INS_TSX:52,INS_TXA:53,INS_TXS:54,INS_TYA:55,INS_DUMMY:56,ADDR_ZP:0,ADDR_REL:1,ADDR_IMP:2,ADDR_ABS:3,ADDR_ACC:4,ADDR_IMM:5,ADDR_ZPX:6,ADDR_ZPY:7,ADDR_ABSX:8,ADDR_ABSY:9,ADDR_PREIDXIND:10,ADDR_POSTIDXIND:11,ADDR_INDABS:12,setOp:function(t,e,i,n,s){this.opdata[e]=255&t|(255&i)<<8|(255&n)<<16|(255&s)<<24}},JSNES.Keyboard=function(){var t;for(this.keys={KEY_A:0,KEY_B:1,KEY_SELECT:2,KEY_START:3,KEY_UP:4,KEY_DOWN:5,KEY_LEFT:6,KEY_RIGHT:7},this.keyState={KEY_DOWN:65,KEY_UP:64},this.state1=new Array(8),t=0;t<this.state1.length;t++)this.state1[t]=64;for(this.state2=new Array(8),t=0;t<this.state2.length;t++)this.state2[t]=64},JSNES.Keyboard.prototype={setKey:function(t,e){switch(t){case 88:this.state1[this.keys.KEY_A]=e;break;case 89:this.state1[this.keys.KEY_B]=e;break;case 90:this.state1[this.keys.KEY_B]=e;break;case 17:this.state1[this.keys.KEY_SELECT]=e;break;case 13:this.state1[this.keys.KEY_START]=e;break;case 38:this.state1[this.keys.KEY_UP]=e;break;case 40:this.state1[this.keys.KEY_DOWN]=e;break;case 37:this.state1[this.keys.KEY_LEFT]=e;break;case 39:this.state1[this.keys.KEY_RIGHT]=e;break;case 103:this.state2[this.keys.KEY_A]=e;break;case 105:this.state2[this.keys.KEY_B]=e;break;case 99:this.state2[this.keys.KEY_SELECT]=e;break;case 97:this.state2[this.keys.KEY_START]=e;break;case 104:this.state2[this.keys.KEY_UP]=e;break;case 98:this.state2[this.keys.KEY_DOWN]=e;break;case 100:this.state2[this.keys.KEY_LEFT]=e;break;case 102:this.state2[this.keys.KEY_RIGHT]=e;break;default:return!0}return!1},keyDown:function(t){!this.setKey(t.keyCode,65)&&t.preventDefault&&t.preventDefault()},keyUp:function(t){!this.setKey(t.keyCode,64)&&t.preventDefault&&t.preventDefault()},keyPress:function(t){t.preventDefault()},setKeyState:function(t,e,i){var n=this.state1;t>0&&(n=this.state2),n[e]=i}},JSNES.Mappers={},JSNES.Mappers[0]=function(t){this.nes=t},JSNES.Mappers[0].prototype={reset:function(){this.joy1StrobeState=0,this.joy2StrobeState=0,this.joypadLastWrite=0,this.mousePressed=!1,this.mouseX=null,this.mouseY=null},write:function(t,e){t<8192?this.nes.cpu.mem[2047&t]=e:t>16407?this.nes.cpu.mem[t]=e:t>8199&&t<16384?this.regWrite(8192+(7&t),e):this.regWrite(t,e)},writelow:function(t,e){t<8192?this.nes.cpu.mem[2047&t]=e:t>16407?this.nes.cpu.mem[t]=e:t>8199&&t<16384?this.regWrite(8192+(7&t),e):this.regWrite(t,e)},load:function(t){return t&=65535,t>16407?this.nes.cpu.mem[t]:t>=8192?this.regLoad(t):this.nes.cpu.mem[2047&t]},regLoad:function(t){switch(t>>12){case 0:break;case 1:break;case 2:case 3:switch(7&t){case 0:return this.nes.cpu.mem[8192];case 1:return this.nes.cpu.mem[8193];case 2:return this.nes.ppu.readStatusRegister();case 3:return 0;case 4:return this.nes.ppu.sramLoad();case 5:return 0;case 6:return 0;case 7:return this.nes.ppu.vramLoad()}break;case 4:switch(t-16405){case 0:return this.nes.papu.readReg(t);case 1:return this.joy1Read();case 2:if(this.mousePressed){for(var e=Math.max(0,this.mouseX-4),i=Math.min(256,this.mouseX+4),n=Math.max(0,this.mouseY-4),s=Math.min(240,this.mouseY+4),r=0,o=n;o<s;o++)for(var a=e;a<i;a++)if(16777215==this.nes.ppu.buffer[(o<<8)+a]){r|=8,console.debug("Clicked on white!");break}return r|=this.mousePressed?16:0,65535&(this.joy2Read()|r)}return this.joy2Read()}}return 0},regWrite:function(t,e){switch(t){case 8192:this.nes.cpu.mem[t]=e,this.nes.ppu.updateControlReg1(e);break;case 8193:this.nes.cpu.mem[t]=e,this.nes.ppu.updateControlReg2(e);break;case 8195:this.nes.ppu.writeSRAMAddress(e);break;case 8196:this.nes.ppu.sramWrite(e);break;case 8197:this.nes.ppu.scrollWrite(e);break;case 8198:this.nes.ppu.writeVRAMAddress(e);break;case 8199:this.nes.ppu.vramWrite(e);break;case 16404:this.nes.ppu.sramDMA(e);break;case 16405:this.nes.papu.writeReg(t,e);break;case 16406:0===(1&e)&&1===(1&this.joypadLastWrite)&&(this.joy1StrobeState=0,this.joy2StrobeState=0),this.joypadLastWrite=e;break;case 16407:this.nes.papu.writeReg(t,e);break;default:t>=16384&&t<=16407&&this.nes.papu.writeReg(t,e)}},joy1Read:function(){var t;switch(this.joy1StrobeState){case 0:case 1:
case 2:case 3:case 4:case 5:case 6:case 7:t=this.nes.keyboard.state1[this.joy1StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:t=0;break;case 19:t=1;break;default:t=0}return this.joy1StrobeState++,24==this.joy1StrobeState&&(this.joy1StrobeState=0),t},joy2Read:function(){var t;switch(this.joy2StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t=this.nes.keyboard.state2[this.joy2StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:t=0;break;case 19:t=1;break;default:t=0}return this.joy2StrobeState++,24==this.joy2StrobeState&&(this.joy2StrobeState=0),t},loadROM:function(){return!this.nes.rom.valid||this.nes.rom.romCount<1?void alert("NoMapper: Invalid ROM! Unable to load."):(this.loadPRGROM(),this.loadCHRROM(),this.loadBatteryRam(),void this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET))},loadPRGROM:function(){this.nes.rom.romCount>1?(this.loadRomBank(0,32768),this.loadRomBank(1,49152)):(this.loadRomBank(0,32768),this.loadRomBank(0,49152))},loadCHRROM:function(){this.nes.rom.vromCount>0&&(1==this.nes.rom.vromCount?(this.loadVromBank(0,0),this.loadVromBank(0,4096)):(this.loadVromBank(0,0),this.loadVromBank(1,4096)))},loadBatteryRam:function(){if(this.nes.rom.batteryRam){var t=this.nes.rom.batteryRam;null!==t&&8192==t.length&&JSNES.Utils.copyArrayElements(t,0,this.nes.cpu.mem,24576,8192)}},loadRomBank:function(t,e){t%=this.nes.rom.romCount,JSNES.Utils.copyArrayElements(this.nes.rom.rom[t],0,this.nes.cpu.mem,e,16384)},loadVromBank:function(t,e){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering(),JSNES.Utils.copyArrayElements(this.nes.rom.vrom[t%this.nes.rom.vromCount],0,this.nes.ppu.vramMem,e,4096);var i=this.nes.rom.vromTile[t%this.nes.rom.vromCount];JSNES.Utils.copyArrayElements(i,0,this.nes.ppu.ptTile,e>>4,256)}},load32kRomBank:function(t,e){this.loadRomBank(2*t%this.nes.rom.romCount,e),this.loadRomBank((2*t+1)%this.nes.rom.romCount,e+16384)},load8kVromBank:function(t,e){0!==this.nes.rom.vromCount&&(this.nes.ppu.triggerRendering(),this.loadVromBank(t%this.nes.rom.vromCount,e),this.loadVromBank((t+1)%this.nes.rom.vromCount,e+4096))},load1kVromBank:function(t,e){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering();var i=Math.floor(t/4)%this.nes.rom.vromCount,n=t%4*1024;JSNES.Utils.copyArrayElements(this.nes.rom.vrom[i],0,this.nes.ppu.vramMem,n,1024);for(var s=this.nes.rom.vromTile[i],r=e>>4,o=0;o<64;o++)this.nes.ppu.ptTile[r+o]=s[(t%4<<6)+o]}},load2kVromBank:function(t,e){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering();var i=Math.floor(t/2)%this.nes.rom.vromCount,n=t%2*2048;JSNES.Utils.copyArrayElements(this.nes.rom.vrom[i],n,this.nes.ppu.vramMem,e,2048);for(var s=this.nes.rom.vromTile[i],r=e>>4,o=0;o<128;o++)this.nes.ppu.ptTile[r+o]=s[(t%2<<7)+o]}},load8kRomBank:function(t,e){var i=Math.floor(t/2)%this.nes.rom.romCount,n=t%2*8192;JSNES.Utils.copyArrayElements(this.nes.rom.rom[i],n,this.nes.cpu.mem,e,8192)},clockIrqCounter:function(){},latchAccess:function(t){},toJSON:function(){return{joy1StrobeState:this.joy1StrobeState,joy2StrobeState:this.joy2StrobeState,joypadLastWrite:this.joypadLastWrite}},fromJSON:function(t){this.joy1StrobeState=t.joy1StrobeState,this.joy2StrobeState=t.joy2StrobeState,this.joypadLastWrite=t.joypadLastWrite}},JSNES.Mappers[1]=function(t){this.nes=t},JSNES.Mappers[1].prototype=new JSNES.Mappers[0],JSNES.Mappers[1].prototype.reset=function(){JSNES.Mappers[0].prototype.reset.apply(this),this.regBuffer=0,this.regBufferCounter=0,this.mirroring=0,this.oneScreenMirroring=0,this.prgSwitchingArea=1,this.prgSwitchingSize=1,this.vromSwitchingSize=0,this.romSelectionReg0=0,this.romSelectionReg1=0,this.romBankSelect=0},JSNES.Mappers[1].prototype.write=function(t,e){return t<32768?void JSNES.Mappers[0].prototype.write.apply(this,arguments):void(0!==(128&e)?(this.regBufferCounter=0,this.regBuffer=0,0===this.getRegNumber(t)&&(this.prgSwitchingArea=1,this.prgSwitchingSize=1)):(this.regBuffer=this.regBuffer&255-(1<<this.regBufferCounter)|(1&e)<<this.regBufferCounter,this.regBufferCounter++,5==this.regBufferCounter&&(this.setReg(this.getRegNumber(t),this.regBuffer),this.regBuffer=0,this.regBufferCounter=0)))},JSNES.Mappers[1].prototype.setReg=function(t,e){var i;switch(t){case 0:i=3&e,i!==this.mirroring&&(this.mirroring=i,0===(2&this.mirroring)?this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING):0!==(1&this.mirroring)?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING)),this.prgSwitchingArea=e>>2&1,this.prgSwitchingSize=e>>3&1,this.vromSwitchingSize=e>>4&1;break;case 1:this.romSelectionReg0=e>>4&1,this.nes.rom.vromCount>0&&(0===this.vromSwitchingSize?0===this.romSelectionReg0?this.load8kVromBank(15&e,0):this.load8kVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&e),0):0===this.romSelectionReg0?this.loadVromBank(15&e,0):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&e),0));break;case 2:this.romSelectionReg1=e>>4&1,this.nes.rom.vromCount>0&&1===this.vromSwitchingSize&&(0===this.romSelectionReg1?this.loadVromBank(15&e,4096):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&e),4096));break;default:i=15&e;var n,s=0;this.nes.rom.romCount>=32?0===this.vromSwitchingSize?1===this.romSelectionReg0&&(s=16):s=(this.romSelectionReg0|this.romSelectionReg1<<1)<<3:this.nes.rom.romCount>=16&&1===this.romSelectionReg0&&(s=8),0===this.prgSwitchingSize?(n=s+(15&e),this.load32kRomBank(n,32768)):(n=2*s+(15&e),0===this.prgSwitchingArea?this.loadRomBank(n,49152):this.loadRomBank(n,32768))}},JSNES.Mappers[1].prototype.getRegNumber=function(t){return t>=32768&&t<=40959?0:t>=40960&&t<=49151?1:t>=49152&&t<=57343?2:3},JSNES.Mappers[1].prototype.loadROM=function(t){return this.nes.rom.valid?(this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.loadBatteryRam(),void this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)):void alert("MMC1: Invalid ROM! Unable to load.")},JSNES.Mappers[1].prototype.switchLowHighPrgRom=function(t){},JSNES.Mappers[1].prototype.switch16to32=function(){},JSNES.Mappers[1].prototype.switch32to16=function(){},JSNES.Mappers[1].prototype.toJSON=function(){var t=JSNES.Mappers[0].prototype.toJSON.apply(this);return t.mirroring=this.mirroring,t.oneScreenMirroring=this.oneScreenMirroring,t.prgSwitchingArea=this.prgSwitchingArea,t.prgSwitchingSize=this.prgSwitchingSize,t.vromSwitchingSize=this.vromSwitchingSize,t.romSelectionReg0=this.romSelectionReg0,t.romSelectionReg1=this.romSelectionReg1,t.romBankSelect=this.romBankSelect,t.regBuffer=this.regBuffer,t.regBufferCounter=this.regBufferCounter,t},JSNES.Mappers[1].prototype.fromJSON=function(t){JSNES.Mappers[0].prototype.fromJSON.apply(this,t),this.mirroring=t.mirroring,this.oneScreenMirroring=t.oneScreenMirroring,this.prgSwitchingArea=t.prgSwitchingArea,this.prgSwitchingSize=t.prgSwitchingSize,this.vromSwitchingSize=t.vromSwitchingSize,this.romSelectionReg0=t.romSelectionReg0,this.romSelectionReg1=t.romSelectionReg1,this.romBankSelect=t.romBankSelect,this.regBuffer=t.regBuffer,this.regBufferCounter=t.regBufferCounter},JSNES.Mappers[2]=function(t){this.nes=t},JSNES.Mappers[2].prototype=new JSNES.Mappers[0],JSNES.Mappers[2].prototype.write=function(t,e){return t<32768?void JSNES.Mappers[0].prototype.write.apply(this,arguments):void this.loadRomBank(e,32768)},JSNES.Mappers[2].prototype.loadROM=function(t){return this.nes.rom.valid?(this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),void this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)):void alert("UNROM: Invalid ROM! Unable to load.")},JSNES.Mappers[4]=function(t){this.nes=t,this.CMD_SEL_2_1K_VROM_0000=0,this.CMD_SEL_2_1K_VROM_0800=1,this.CMD_SEL_1K_VROM_1000=2,this.CMD_SEL_1K_VROM_1400=3,this.CMD_SEL_1K_VROM_1800=4,this.CMD_SEL_1K_VROM_1C00=5,this.CMD_SEL_ROM_PAGE1=6,this.CMD_SEL_ROM_PAGE2=7,this.command=null,this.prgAddressSelect=null,this.chrAddressSelect=null,this.pageNumber=null,this.irqCounter=null,this.irqLatchValue=null,this.irqEnable=null,this.prgAddressChanged=!1},JSNES.Mappers[4].prototype=new JSNES.Mappers[0],JSNES.Mappers[4].prototype.write=function(t,e){if(t<32768)return void JSNES.Mappers[0].prototype.write.apply(this,arguments);switch(t){case 32768:this.command=7&e;var i=e>>6&1;i!=this.prgAddressSelect&&(this.prgAddressChanged=!0),this.prgAddressSelect=i,this.chrAddressSelect=e>>7&1;break;case 32769:this.executeCommand(this.command,e);break;case 40960:0!==(1&e)?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING);break;case 40961:break;case 49152:this.irqCounter=e;break;case 49153:this.irqLatchValue=e;break;case 57344:this.irqEnable=0;break;case 57345:this.irqEnable=1}},JSNES.Mappers[4].prototype.executeCommand=function(t,e){switch(t){case this.CMD_SEL_2_1K_VROM_0000:0===this.chrAddressSelect?(this.load1kVromBank(e,0),this.load1kVromBank(e+1,1024)):(this.load1kVromBank(e,4096),this.load1kVromBank(e+1,5120));break;case this.CMD_SEL_2_1K_VROM_0800:0===this.chrAddressSelect?(this.load1kVromBank(e,2048),this.load1kVromBank(e+1,3072)):(this.load1kVromBank(e,6144),this.load1kVromBank(e+1,7168));break;case this.CMD_SEL_1K_VROM_1000:0===this.chrAddressSelect?this.load1kVromBank(e,4096):this.load1kVromBank(e,0);break;case this.CMD_SEL_1K_VROM_1400:0===this.chrAddressSelect?this.load1kVromBank(e,5120):this.load1kVromBank(e,1024);break;case this.CMD_SEL_1K_VROM_1800:0===this.chrAddressSelect?this.load1kVromBank(e,6144):this.load1kVromBank(e,2048);break;case this.CMD_SEL_1K_VROM_1C00:0===this.chrAddressSelect?this.load1kVromBank(e,7168):this.load1kVromBank(e,3072);break;case this.CMD_SEL_ROM_PAGE1:this.prgAddressChanged&&(0===this.prgAddressSelect?this.load8kRomBank(2*(this.nes.rom.romCount-1),49152):this.load8kRomBank(2*(this.nes.rom.romCount-1),32768),this.prgAddressChanged=!1),0===this.prgAddressSelect?this.load8kRomBank(e,32768):this.load8kRomBank(e,49152);break;case this.CMD_SEL_ROM_PAGE2:this.load8kRomBank(e,40960),this.prgAddressChanged&&(0===this.prgAddressSelect?this.load8kRomBank(2*(this.nes.rom.romCount-1),49152):this.load8kRomBank(2*(this.nes.rom.romCount-1),32768),this.prgAddressChanged=!1)}},JSNES.Mappers[4].prototype.loadROM=function(t){return this.nes.rom.valid?(this.load8kRomBank(2*(this.nes.rom.romCount-1),49152),this.load8kRomBank(2*(this.nes.rom.romCount-1)+1,57344),this.load8kRomBank(0,32768),this.load8kRomBank(1,40960),this.loadCHRROM(),this.loadBatteryRam(),void this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)):void alert("MMC3: Invalid ROM! Unable to load.")},JSNES.Mappers[4].prototype.clockIrqCounter=function(){1==this.irqEnable&&(this.irqCounter--,this.irqCounter<0&&(this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.irqCounter=this.irqLatchValue))},JSNES.Mappers[4].prototype.toJSON=function(){var t=JSNES.Mappers[0].prototype.toJSON.apply(this);return t.command=this.command,t.prgAddressSelect=this.prgAddressSelect,t.chrAddressSelect=this.chrAddressSelect,t.pageNumber=this.pageNumber,t.irqCounter=this.irqCounter,t.irqLatchValue=this.irqLatchValue,t.irqEnable=this.irqEnable,t.prgAddressChanged=this.prgAddressChanged,t},JSNES.Mappers[4].prototype.fromJSON=function(t){JSNES.Mappers[0].prototype.fromJSON.apply(this,t),this.command=t.command,this.prgAddressSelect=t.prgAddressSelect,this.chrAddressSelect=t.chrAddressSelect,this.pageNumber=t.pageNumber,this.irqCounter=t.irqCounter,this.irqLatchValue=t.irqLatchValue,this.irqEnable=t.irqEnable,this.prgAddressChanged=t.prgAddressChanged},JSNES.PAPU=function(t){this.nes=t,this.square1=new JSNES.PAPU.ChannelSquare(this,(!0)),this.square2=new JSNES.PAPU.ChannelSquare(this,(!1)),this.triangle=new JSNES.PAPU.ChannelTriangle(this),this.noise=new JSNES.PAPU.ChannelNoise(this),this.dmc=new JSNES.PAPU.ChannelDM(this),this.frameIrqCounter=null,this.frameIrqCounterMax=4,this.initCounter=2048,this.channelEnableValue=null,this.audio={audioCtx:new(window.AudioContext||window.webkitAudioContext)},this.audio.sampleRate=this.audio.audioCtx.sampleRate,this.audio.bufferSize=4*this.audio.sampleRate,this.audio.buffer=this.audio.audioCtx.createBuffer(2,this.audio.bufferSize,this.audio.sampleRate),this.audio.sampleBufferL=this.audio.buffer.getChannelData(0),this.audio.sampleBufferR=this.audio.buffer.getChannelData(1),this.audio.source=null,this.audio.bufferIndex=0,this.audio.globalBufferIndex=0,this.audio.soundLastTime=null,this.audio.globalBufferIndexLastTime=null,this.lengthLookup=null,this.dmcFreqLookup=null,this.noiseWavelengthLookup=null,this.square_table=null,this.tnd_table=null,this.frameIrqEnabled=!1,this.frameIrqActive=null,this.frameClockNow=null,this.startedPlaying=!1,this.recordOutput=!1,this.initingHardware=!1,this.masterFrameCounter=null,this.derivedFrameCounter=null,this.countSequence=null,this.sampleTimer=null,this.frameTime=null,this.sampleTimerMax=null,this.sampleCount=null,this.triValue=0,this.smpSquare1=null,this.smpSquare2=null,this.smpTriangle=null,this.smpDmc=null,this.accCount=null,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.dacRange=0,this.dcValue=0,this.masterVolume=256,this.stereoPosLSquare1=null,this.stereoPosLSquare2=null,this.stereoPosLTriangle=null,this.stereoPosLNoise=null,this.stereoPosLDMC=null,this.stereoPosRSquare1=null,this.stereoPosRSquare2=null,this.stereoPosRTriangle=null,this.stereoPosRNoise=null,this.stereoPosRDMC=null,this.extraCycles=null,this.maxSample=null,this.minSample=null,this.panning=[80,170,100,150,128],this.setPanning(this.panning),this.initLengthLookup(),this.initDmcFrequencyLookup(),this.initNoiseWavelengthLookup(),this.initDACtables();for(var e=0;e<20;e++)16===e?this.writeReg(16400,16):this.writeReg(16384+e,0);this.reset()},JSNES.PAPU.prototype={reset:function(){this.sampleTimerMax=Math.floor(1024*this.nes.opts.CPU_FREQ_NTSC*this.nes.opts.preferredFrameRate/(60*this.audio.sampleRate)),this.frameTime=Math.floor(14915*this.nes.opts.preferredFrameRate/60),this.sampleTimer=0,this.updateChannelEnable(0),this.masterFrameCounter=0,this.derivedFrameCounter=0,this.countSequence=0,this.sampleCount=0,this.initCounter=2048,this.frameIrqEnabled=!1,this.initingHardware=!1,this.resetCounter(),this.square1.reset(),this.square2.reset(),this.triangle.reset(),this.noise.reset(),this.dmc.reset(),this.accCount=0,this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0,this.frameIrqEnabled=!1,this.frameIrqCounterMax=4,this.channelEnableValue=255,this.startedPlaying=!1,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.maxSample=-5e5,this.minSample=5e5},readReg:function(t){var e=0;return e|=this.square1.getLengthStatus(),e|=this.square2.getLengthStatus()<<1,e|=this.triangle.getLengthStatus()<<2,e|=this.noise.getLengthStatus()<<3,e|=this.dmc.getLengthStatus()<<4,e|=(this.frameIrqActive&&this.frameIrqEnabled?1:0)<<6,e|=this.dmc.getIrqStatus()<<7,this.frameIrqActive=!1,this.dmc.irqGenerated=!1,65535&e},writeReg:function(t,e){t>=16384&&t<16388?this.square1.writeReg(t,e):t>=16388&&t<16392?this.square2.writeReg(t,e):t>=16392&&t<16396?this.triangle.writeReg(t,e):t>=16396&&t<=16399?this.noise.writeReg(t,e):16400===t?this.dmc.writeReg(t,e):16401===t?this.dmc.writeReg(t,e):16402===t?this.dmc.writeReg(t,e):16403===t?this.dmc.writeReg(t,e):16405===t?(this.updateChannelEnable(e),0!==e&&this.initCounter>0&&(this.initingHardware=!0),this.dmc.writeReg(t,e)):16407===t&&(this.countSequence=e>>7&1,this.masterFrameCounter=0,this.frameIrqActive=!1,0===(e>>6&1)?this.frameIrqEnabled=!0:this.frameIrqEnabled=!1,0===this.countSequence?(this.frameIrqCounterMax=4,this.derivedFrameCounter=4):(this.frameIrqCounterMax=5,this.derivedFrameCounter=0,this.frameCounterTick()))},resetCounter:function(){0===this.countSequence?this.derivedFrameCounter=4:this.derivedFrameCounter=0},updateChannelEnable:function(t){this.channelEnableValue=65535&t,this.square1.setEnabled(0!==(1&t)),this.square2.setEnabled(0!==(2&t)),this.triangle.setEnabled(0!==(4&t)),this.noise.setEnabled(0!==(8&t)),this.dmc.setEnabled(0!==(16&t))},clockFrameCounter:function(t){if(this.initCounter>0&&this.initingHardware)return this.initCounter-=t,void(this.initCounter<=0&&(this.initingHardware=!1));t+=this.extraCycles;var e=this.sampleTimerMax-this.sampleTimer;t<<10>e?(this.extraCycles=(t<<10)-e>>10,t-=this.extraCycles):this.extraCycles=0;var i=this.dmc,n=this.triangle,s=this.square1,r=this.square2,o=this.noise;if(i.isEnabled)for(i.shiftCounter-=t<<3;i.shiftCounter<=0&&i.dmaFrequency>0;)i.shiftCounter+=i.dmaFrequency,i.clockDmc();if(n.progTimerMax>0)for(n.progTimerCount-=t;n.progTimerCount<=0;)n.progTimerCount+=n.progTimerMax+1,n.linearCounter>0&&n.lengthCounter>0&&(n.triangleCounter++,n.triangleCounter&=31,n.isEnabled&&(n.triangleCounter>=16?n.sampleValue=15&n.triangleCounter:n.sampleValue=15-(15&n.triangleCounter),n.sampleValue<<=4));s.progTimerCount-=t,s.progTimerCount<=0&&(s.progTimerCount+=s.progTimerMax+1<<1,s.squareCounter++,s.squareCounter&=7,s.updateSampleValue()),r.progTimerCount-=t,r.progTimerCount<=0&&(r.progTimerCount+=r.progTimerMax+1<<1,r.squareCounter++,r.squareCounter&=7,r.updateSampleValue());var a=t;if(o.progTimerCount-a>0)o.progTimerCount-=a,o.accCount+=a,o.accValue+=a*o.sampleValue;else for(;a-- >0;)--o.progTimerCount<=0&&o.progTimerMax>0&&(o.shiftReg<<=1,o.tmp=32768&(o.shiftReg<<(0===o.randomMode?1:6)^o.shiftReg),0!==o.tmp?(o.shiftReg|=1,o.randomBit=0,o.sampleValue=0):(o.randomBit=1,o.isEnabled&&o.lengthCounter>0?o.sampleValue=o.masterVolume:o.sampleValue=0),o.progTimerCount+=o.progTimerMax),o.accValue+=o.sampleValue,o.accCount++;this.frameIrqEnabled&&this.frameIrqActive&&this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.masterFrameCounter+=t<<1,this.masterFrameCounter>=this.frameTime&&(this.masterFrameCounter-=this.frameTime,this.frameCounterTick()),this.accSample(t),this.sampleTimer+=t<<10,this.sampleTimer>=this.sampleTimerMax&&(this.sample(),this.sampleTimer-=this.sampleTimerMax)},accSample:function(t){this.triangle.sampleCondition&&(this.triValue=Math.floor((this.triangle.progTimerCount<<4)/(this.triangle.progTimerMax+1)),this.triValue>16&&(this.triValue=16),this.triangle.triangleCounter>=16&&(this.triValue=16-this.triValue),this.triValue+=this.triangle.sampleValue),2===t?(this.smpTriangle+=this.triValue<<1,this.smpDmc+=this.dmc.sample<<1,this.smpSquare1+=this.square1.sampleValue<<1,this.smpSquare2+=this.square2.sampleValue<<1,this.accCount+=2):4===t?(this.smpTriangle+=this.triValue<<2,this.smpDmc+=this.dmc.sample<<2,this.smpSquare1+=this.square1.sampleValue<<2,this.smpSquare2+=this.square2.sampleValue<<2,this.accCount+=4):(this.smpTriangle+=t*this.triValue,this.smpDmc+=t*this.dmc.sample,this.smpSquare1+=t*this.square1.sampleValue,this.smpSquare2+=t*this.square2.sampleValue,this.accCount+=t)},frameCounterTick:function(){this.derivedFrameCounter++,this.derivedFrameCounter>=this.frameIrqCounterMax&&(this.derivedFrameCounter=0),1!==this.derivedFrameCounter&&3!==this.derivedFrameCounter||(this.triangle.clockLengthCounter(),this.square1.clockLengthCounter(),this.square2.clockLengthCounter(),this.noise.clockLengthCounter(),this.square1.clockSweep(),this.square2.clockSweep()),this.derivedFrameCounter>=0&&this.derivedFrameCounter<4&&(this.square1.clockEnvDecay(),this.square2.clockEnvDecay(),this.noise.clockEnvDecay(),this.triangle.clockLinearCounter()),3===this.derivedFrameCounter&&0===this.countSequence&&(this.frameIrqActive=!0)},sample:function(){var t,e;this.accCount>0?(this.smpSquare1<<=4,this.smpSquare1=Math.floor(this.smpSquare1/this.accCount),this.smpSquare2<<=4,this.smpSquare2=Math.floor(this.smpSquare2/this.accCount),this.smpTriangle=Math.floor(this.smpTriangle/this.accCount),this.smpDmc<<=4,this.smpDmc=Math.floor(this.smpDmc/this.accCount),this.accCount=0):(this.smpSquare1=this.square1.sampleValue<<4,this.smpSquare2=this.square2.sampleValue<<4,this.smpTriangle=this.triangle.sampleValue,this.smpDmc=this.dmc.sample<<4);var i=Math.floor((this.noise.accValue<<4)/this.noise.accCount);this.noise.accValue=i>>4,this.noise.accCount=1,t=this.smpSquare1*this.stereoPosLSquare1+this.smpSquare2*this.stereoPosLSquare2>>8,e=3*this.smpTriangle*this.stereoPosLTriangle+(i<<1)*this.stereoPosLNoise+this.smpDmc*this.stereoPosLDMC>>8,t>=this.square_table.length&&(t=this.square_table.length-1),e>=this.tnd_table.length&&(e=this.tnd_table.length-1);var n=this.square_table[t]+this.tnd_table[e]-this.dcValue;t=this.smpSquare1*this.stereoPosRSquare1+this.smpSquare2*this.stereoPosRSquare2>>8,e=3*this.smpTriangle*this.stereoPosRTriangle+(i<<1)*this.stereoPosRNoise+this.smpDmc*this.stereoPosRDMC>>8,t>=this.square_table.length&&(t=this.square_table.length-1),e>=this.tnd_table.length&&(e=this.tnd_table.length-1);var s=this.square_table[t]+this.tnd_table[e]-this.dcValue,r=n-this.prevSampleL;this.prevSampleL+=r,this.smpAccumL+=r-(this.smpAccumL>>10),n=this.smpAccumL;var o=s-this.prevSampleR;this.prevSampleR+=o,this.smpAccumR+=o-(this.smpAccumR>>10),s=this.smpAccumR,n>this.maxSample&&(this.maxSample=n),n<this.minSample&&(this.minSample=n),this.audio.sampleBufferL[this.audio.bufferIndex]=2*n/65535-1,this.audio.sampleBufferR[this.audio.bufferIndex]=2*s/65535-1,this.audio.bufferIndex++,this.audio.globalBufferIndex++,this.audio.bufferIndex===this.audio.bufferSize&&(this.audio.bufferIndex=0),this.applySoundRate(),this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0},enableSound:function(t){t?this.startAudioPlay():this.audio.source&&this.stopAudioPlay()},startAudioPlay:function(){this.audio.source&&this.stopAudioPlay(),this.audio.source=this.audio.audioCtx.createBufferSource(),this.audio.source.loop=!0,this.audio.source.loopEnd=this.audio.buffer.duration,this.audio.source.buffer=this.audio.buffer,this.audio.source.connect(this.audio.audioCtx.destination),this.audio.source.start(this.audio.audioCtx.currentTime+.01)},stopAudioPlay:function(){this.audio.source.stop(),this.audio.soundStartTime=null,this.audio.bufferIndex=0,this.audio.globalBufferIndex=0,this.audio.globalBufferIndexLastTime=0,this.audio.soundLastTime=null,this.audio.source=null},applySoundRate:function(){this.audio.soundLastTime||(this.audio.soundLastTime=this.audio.audioCtx.currentTime);var t=this.audio.audioCtx.currentTime,e=t-this.audio.soundLastTime;this.audio.source&&e>.5&&(this.audio.source.playbackRate.value=(this.audio.globalBufferIndex-this.audio.globalBufferIndexLastTime-.01*this.audio.sampleRate)/(e*this.audio.sampleRate),this.audio.soundLastTime=t,this.audio.globalBufferIndexLastTime=this.audio.globalBufferIndex)},getLengthMax:function(t){return this.lengthLookup[t>>3]},getDmcFrequency:function(t){return t>=0&&t<16?this.dmcFreqLookup[t]:0},getNoiseWaveLength:function(t){return t>=0&&t<16?this.noiseWavelengthLookup[t]:0},setPanning:function(t){for(var e=0;e<5;e++)this.panning[e]=t[e];this.updateStereoPos()},setMasterVolume:function(t){t<0&&(t=0),t>256&&(t=256),this.masterVolume=t,this.updateStereoPos()},updateStereoPos:function(){this.stereoPosLSquare1=this.panning[0]*this.masterVolume>>8,this.stereoPosLSquare2=this.panning[1]*this.masterVolume>>8,this.stereoPosLTriangle=this.panning[2]*this.masterVolume>>8,this.stereoPosLNoise=this.panning[3]*this.masterVolume>>8,this.stereoPosLDMC=this.panning[4]*this.masterVolume>>8,this.stereoPosRSquare1=this.masterVolume-this.stereoPosLSquare1,this.stereoPosRSquare2=this.masterVolume-this.stereoPosLSquare2,this.stereoPosRTriangle=this.masterVolume-this.stereoPosLTriangle,this.stereoPosRNoise=this.masterVolume-this.stereoPosLNoise,this.stereoPosRDMC=this.masterVolume-this.stereoPosLDMC},initLengthLookup:function(){this.lengthLookup=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30]},initDmcFrequencyLookup:function(){this.dmcFreqLookup=new Array(16),this.dmcFreqLookup[0]=3424,this.dmcFreqLookup[1]=3040,this.dmcFreqLookup[2]=2720,this.dmcFreqLookup[3]=2560,this.dmcFreqLookup[4]=2288,this.dmcFreqLookup[5]=2032,this.dmcFreqLookup[6]=1808,this.dmcFreqLookup[7]=1712,this.dmcFreqLookup[8]=1520,this.dmcFreqLookup[9]=1280,this.dmcFreqLookup[10]=1136,this.dmcFreqLookup[11]=1024,this.dmcFreqLookup[12]=848,this.dmcFreqLookup[13]=672,this.dmcFreqLookup[14]=576,this.dmcFreqLookup[15]=432},initNoiseWavelengthLookup:function(){this.noiseWavelengthLookup=new Array(16),this.noiseWavelengthLookup[0]=4,this.noiseWavelengthLookup[1]=8,this.noiseWavelengthLookup[2]=16,this.noiseWavelengthLookup[3]=32,this.noiseWavelengthLookup[4]=64,this.noiseWavelengthLookup[5]=96,this.noiseWavelengthLookup[6]=128,this.noiseWavelengthLookup[7]=160,this.noiseWavelengthLookup[8]=202,this.noiseWavelengthLookup[9]=254,this.noiseWavelengthLookup[10]=380,this.noiseWavelengthLookup[11]=508,this.noiseWavelengthLookup[12]=762,this.noiseWavelengthLookup[13]=1016,this.noiseWavelengthLookup[14]=2034,this.noiseWavelengthLookup[15]=4068},initDACtables:function(){var t,e,i,n=0,s=0;for(this.square_table=new Array(512),this.tnd_table=new Array(3264),i=0;i<512;i++)t=95.52/(8128/(i/16)+100),t*=.98411,t*=5e4,e=Math.floor(t),this.square_table[i]=e,e>n&&(n=e);for(i=0;i<3264;i++)t=163.67/(24329/(i/16)+100),t*=.98411,t*=5e4,e=Math.floor(t),this.tnd_table[i]=e,e>s&&(s=e);this.dacRange=n+s,this.dcValue=this.dacRange/2}},JSNES.PAPU.ChannelDM=function(t){this.papu=t,this.MODE_NORMAL=0,this.MODE_LOOP=1,this.MODE_IRQ=2,this.isEnabled=null,this.hasSample=null,this.irqGenerated=!1,this.playMode=null,this.dmaFrequency=null,this.dmaCounter=null,this.deltaCounter=null,this.playStartAddress=null,this.playAddress=null,this.playLength=null,this.playLengthCounter=null,this.shiftCounter=null,this.reg4012=null,this.reg4013=null,this.sample=null,this.dacLsb=null,this.data=null,this.reset()},JSNES.PAPU.ChannelDM.prototype={clockDmc:function(){this.hasSample&&(0===(1&this.data)?this.deltaCounter>0&&this.deltaCounter--:this.deltaCounter<63&&this.deltaCounter++,this.sample=this.isEnabled?(this.deltaCounter<<1)+this.dacLsb:0,this.data>>=1),this.dmaCounter--,this.dmaCounter<=0&&(this.hasSample=!1,this.endOfSample(),this.dmaCounter=8),this.irqGenerated&&this.papu.nes.cpu.requestIrq(this.papu.nes.cpu.IRQ_NORMAL)},endOfSample:function(){0===this.playLengthCounter&&this.playMode===this.MODE_LOOP&&(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.playLengthCounter>0&&(this.nextSample(),0===this.playLengthCounter&&this.playMode===this.MODE_IRQ&&(this.irqGenerated=!0))},nextSample:function(){this.data=this.papu.nes.mmap.load(this.playAddress),this.papu.nes.cpu.haltCycles(4),this.playLengthCounter--,this.playAddress++,this.playAddress>65535&&(this.playAddress=32768),this.hasSample=!0},writeReg:function(t,e){16400===t?(e>>6===0?this.playMode=this.MODE_NORMAL:1===(e>>6&1)?this.playMode=this.MODE_LOOP:e>>6===2&&(this.playMode=this.MODE_IRQ),0===(128&e)&&(this.irqGenerated=!1),this.dmaFrequency=this.papu.getDmcFrequency(15&e)):16401===t?(this.deltaCounter=e>>1&63,this.dacLsb=1&e,this.sample=(this.deltaCounter<<1)+this.dacLsb):16402===t?(this.playStartAddress=e<<6|49152,this.playAddress=this.playStartAddress,this.reg4012=e):16403===t?(this.playLength=(e<<4)+1,this.playLengthCounter=this.playLength,this.reg4013=e):16405===t&&(0===(e>>4&1)?this.playLengthCounter=0:(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.irqGenerated=!1)},setEnabled:function(t){!this.isEnabled&&t&&(this.playLengthCounter=this.playLength),this.isEnabled=t},getLengthStatus:function(){return 0!==this.playLengthCounter&&this.isEnabled?1:0},getIrqStatus:function(){return this.irqGenerated?1:0},reset:function(){this.isEnabled=!1,this.irqGenerated=!1,this.playMode=this.MODE_NORMAL,this.dmaFrequency=0,this.dmaCounter=0,this.deltaCounter=0,this.playStartAddress=0,this.playAddress=0,this.playLength=0,this.playLengthCounter=0,this.sample=0,this.dacLsb=0,this.shiftCounter=0,this.reg4012=0,this.reg4013=0,this.data=0}},JSNES.PAPU.ChannelNoise=function(t){this.papu=t,this.isEnabled=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.lengthCounterEnable=null,this.envReset=null,this.shiftNow=null,this.lengthCounter=null,this.progTimerCount=null,this.progTimerMax=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.shiftReg=16384,this.randomBit=null,this.randomMode=null,this.sampleValue=null,this.accValue=0,this.accCount=1,this.tmp=null,this.reset()},JSNES.PAPU.ChannelNoise.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.isEnabled=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1,this.shiftNow=!1,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.shiftReg=1,this.randomBit=0,this.randomMode=0,this.sampleValue=0,this.tmp=0},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.masterVolume=this.envDecayDisable?this.envDecayRate:this.envVolume,this.updateSampleValue()},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&(this.sampleValue=this.randomBit*this.masterVolume)},writeReg:function(t,e){16396===t?(this.envDecayDisable=0!==(16&e),this.envDecayRate=15&e,this.envDecayLoopEnable=0!==(32&e),this.lengthCounterEnable=0===(32&e),this.masterVolume=this.envDecayDisable?this.envDecayRate:this.envVolume):16398===t?(this.progTimerMax=this.papu.getNoiseWaveLength(15&e),this.randomMode=e>>7):16399===t&&(this.lengthCounter=this.papu.getLengthMax(248&e),this.envReset=!0)},setEnabled:function(t){this.isEnabled=t,t||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0}},JSNES.PAPU.ChannelSquare=function(t,e){this.papu=t,this.dutyLookup=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1],this.impLookup=[1,-1,0,0,0,0,0,0,1,0,-1,0,0,0,0,0,1,0,0,0,-1,0,0,0,-1,0,1,0,0,0,0,0],this.sqr1=e,this.isEnabled=null,this.lengthCounterEnable=null,this.sweepActive=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.envReset=null,this.sweepCarry=null,this.updateSweepPeriod=null,this.progTimerCount=null,this.progTimerMax=null,this.lengthCounter=null,this.squareCounter=null,this.sweepCounter=null,this.sweepCounterMax=null,this.sweepMode=null,this.sweepShiftAmount=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.dutyMode=null,this.sweepResult=null,this.sampleValue=null,this.vol=null,this.reset()},JSNES.PAPU.ChannelSquare.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.lengthCounter=0,this.squareCounter=0,this.sweepCounter=0,this.sweepCounterMax=0,this.sweepMode=0,this.sweepShiftAmount=0,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.dutyMode=0,this.vol=0,this.isEnabled=!1,this.lengthCounterEnable=!1,this.sweepActive=!1,this.sweepCarry=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.masterVolume=this.envDecayDisable?this.envDecayRate:this.envVolume,this.updateSampleValue()},clockSweep:function(){--this.sweepCounter<=0&&(this.sweepCounter=this.sweepCounterMax+1,this.sweepActive&&this.sweepShiftAmount>0&&this.progTimerMax>7&&(this.sweepCarry=!1,0===this.sweepMode?(this.progTimerMax+=this.progTimerMax>>this.sweepShiftAmount,
this.progTimerMax>4095&&(this.progTimerMax=4095,this.sweepCarry=!0)):this.progTimerMax=this.progTimerMax-((this.progTimerMax>>this.sweepShiftAmount)-(this.sqr1?1:0)))),this.updateSweepPeriod&&(this.updateSweepPeriod=!1,this.sweepCounter=this.sweepCounterMax+1)},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&this.progTimerMax>7?0===this.sweepMode&&this.progTimerMax+(this.progTimerMax>>this.sweepShiftAmount)>4095?this.sampleValue=0:this.sampleValue=this.masterVolume*this.dutyLookup[(this.dutyMode<<3)+this.squareCounter]:this.sampleValue=0},writeReg:function(t,e){var i=this.sqr1?0:4;t===16384+i?(this.envDecayDisable=0!==(16&e),this.envDecayRate=15&e,this.envDecayLoopEnable=0!==(32&e),this.dutyMode=e>>6&3,this.lengthCounterEnable=0===(32&e),this.masterVolume=this.envDecayDisable?this.envDecayRate:this.envVolume,this.updateSampleValue()):t===16385+i?(this.sweepActive=0!==(128&e),this.sweepCounterMax=e>>4&7,this.sweepMode=e>>3&1,this.sweepShiftAmount=7&e,this.updateSweepPeriod=!0):t===16386+i?(this.progTimerMax&=1792,this.progTimerMax|=e):t===16387+i&&(this.progTimerMax&=255,this.progTimerMax|=(7&e)<<8,this.isEnabled&&(this.lengthCounter=this.papu.getLengthMax(248&e)),this.envReset=!0)},setEnabled:function(t){this.isEnabled=t,t||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0}},JSNES.PAPU.ChannelTriangle=function(t){this.papu=t,this.isEnabled=null,this.sampleCondition=null,this.lengthCounterEnable=null,this.lcHalt=null,this.lcControl=null,this.progTimerCount=null,this.progTimerMax=null,this.triangleCounter=null,this.lengthCounter=null,this.linearCounter=null,this.lcLoadValue=null,this.sampleValue=null,this.tmp=null,this.reset()},JSNES.PAPU.ChannelTriangle.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.triangleCounter=0,this.isEnabled=!1,this.sampleCondition=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.linearCounter=0,this.lcLoadValue=0,this.lcHalt=!0,this.lcControl=!1,this.tmp=0,this.sampleValue=15},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleCondition())},clockLinearCounter:function(){this.lcHalt?(this.linearCounter=this.lcLoadValue,this.updateSampleCondition()):this.linearCounter>0&&(this.linearCounter--,this.updateSampleCondition()),this.lcControl||(this.lcHalt=!1)},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0},readReg:function(t){return 0},writeReg:function(t,e){16392===t?(this.lcControl=0!==(128&e),this.lcLoadValue=127&e,this.lengthCounterEnable=!this.lcControl):16394===t?(this.progTimerMax&=1792,this.progTimerMax|=e):16395===t&&(this.progTimerMax&=255,this.progTimerMax|=(7&e)<<8,this.lengthCounter=this.papu.getLengthMax(248&e),this.lcHalt=!0),this.updateSampleCondition()},clockProgrammableTimer:function(t){if(this.progTimerMax>0)for(this.progTimerCount+=t;this.progTimerMax>0&&this.progTimerCount>=this.progTimerMax;)this.progTimerCount-=this.progTimerMax,this.isEnabled&&this.lengthCounter>0&&this.linearCounter>0&&this.clockTriangleGenerator()},clockTriangleGenerator:function(){this.triangleCounter++,this.triangleCounter&=31},setEnabled:function(t){this.isEnabled=t,t||(this.lengthCounter=0),this.updateSampleCondition()},updateSampleCondition:function(){this.sampleCondition=this.isEnabled&&this.progTimerMax>7&&this.linearCounter>0&&this.lengthCounter>0}},JSNES.PPU=function(t){this.nes=t,this.vramMem=null,this.spriteMem=null,this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=null,this.firstWrite=null,this.sramAddress=null,this.currentMirroring=null,this.requestEndFrame=null,this.nmiOk=null,this.dummyCycleToggle=null,this.validTileData=null,this.nmiCounter=null,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=null,this.f_spriteSize=null,this.f_bgPatternTable=null,this.f_spPatternTable=null,this.f_addrInc=null,this.f_nTblAddress=null,this.f_color=null,this.f_spVisibility=null,this.f_bgVisibility=null,this.f_spClipping=null,this.f_bgClipping=null,this.f_dispType=null,this.cntFV=null,this.cntV=null,this.cntH=null,this.cntVT=null,this.cntHT=null,this.regFV=null,this.regV=null,this.regH=null,this.regVT=null,this.regHT=null,this.regFH=null,this.regS=null,this.curNt=null,this.attrib=null,this.buffer=null,this.prevBuffer=null,this.bgbuffer=null,this.pixrendered=null,this.validTileData=null,this.scantile=null,this.scanline=null,this.lastRenderedScanline=null,this.curX=null,this.sprX=null,this.sprY=null,this.sprTile=null,this.sprCol=null,this.vertFlip=null,this.horiFlip=null,this.bgPriority=null,this.spr0HitX=null,this.spr0HitY=null,this.hitSpr0=null,this.sprPalette=null,this.imgPalette=null,this.ptTile=null,this.ntable1=null,this.currentMirroring=null,this.nameTable=null,this.vramMirrorTable=null,this.palTable=null,this.showSpr0Hit=!1,this.clipToTvSize=!0,this.reset()},JSNES.PPU.prototype={STATUS_VRAMWRITE:4,STATUS_SLSPRITECOUNT:5,STATUS_SPRITE0HIT:6,STATUS_VBLANK:7,reset:function(){var t;for(this.vramMem=new Array(32768),this.spriteMem=new Array(256),t=0;t<this.vramMem.length;t++)this.vramMem[t]=0;for(t=0;t<this.spriteMem.length;t++)this.spriteMem[t]=0;for(this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=0,this.firstWrite=!0,this.sramAddress=0,this.currentMirroring=-1,this.requestEndFrame=!1,this.nmiOk=!1,this.dummyCycleToggle=!1,this.validTileData=!1,this.nmiCounter=0,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=0,this.f_spriteSize=0,this.f_bgPatternTable=0,this.f_spPatternTable=0,this.f_addrInc=0,this.f_nTblAddress=0,this.f_color=0,this.f_spVisibility=0,this.f_bgVisibility=0,this.f_spClipping=0,this.f_bgClipping=0,this.f_dispType=0,this.cntFV=0,this.cntV=0,this.cntH=0,this.cntVT=0,this.cntHT=0,this.regFV=0,this.regV=0,this.regH=0,this.regVT=0,this.regHT=0,this.regFH=0,this.regS=0,this.curNt=null,this.attrib=new Array(32),this.buffer=new Array(61440),this.prevBuffer=new Array(61440),this.bgbuffer=new Array(61440),this.pixrendered=new Array(61440),this.validTileData=null,this.scantile=new Array(32),this.scanline=0,this.lastRenderedScanline=-1,this.curX=0,this.sprX=new Array(64),this.sprY=new Array(64),this.sprTile=new Array(64),this.sprCol=new Array(64),this.vertFlip=new Array(64),this.horiFlip=new Array(64),this.bgPriority=new Array(64),this.spr0HitX=0,this.spr0HitY=0,this.hitSpr0=!1,this.sprPalette=new Array(16),this.imgPalette=new Array(16),this.ptTile=new Array(512),t=0;t<512;t++)this.ptTile[t]=new JSNES.PPU.Tile;for(this.ntable1=new Array(4),this.currentMirroring=-1,this.nameTable=new Array(4),t=0;t<4;t++)this.nameTable[t]=new JSNES.PPU.NameTable(32,32,"Nt"+t);for(this.vramMirrorTable=new Array(32768),t=0;t<32768;t++)this.vramMirrorTable[t]=t;this.palTable=new JSNES.PPU.PaletteTable,this.palTable.loadNTSCPalette(),this.updateControlReg1(0),this.updateControlReg2(0)},setMirroring:function(t){if(t!=this.currentMirroring){this.currentMirroring=t,this.triggerRendering(),null===this.vramMirrorTable&&(this.vramMirrorTable=new Array(32768));for(var e=0;e<32768;e++)this.vramMirrorTable[e]=e;this.defineMirrorRegion(16160,16128,32),this.defineMirrorRegion(16192,16128,32),this.defineMirrorRegion(16256,16128,32),this.defineMirrorRegion(16320,16128,32),this.defineMirrorRegion(12288,8192,3840),this.defineMirrorRegion(16384,0,16384),t==this.nes.rom.HORIZONTAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(11264,10240,1024)):t==this.nes.rom.VERTICAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=0,this.ntable1[3]=1,this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,9216,1024)):t==this.nes.rom.SINGLESCREEN_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=0,this.ntable1[3]=0,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,8192,1024)):t==this.nes.rom.SINGLESCREEN_MIRRORING2?(this.ntable1[0]=1,this.ntable1[1]=1,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,9216,1024),this.defineMirrorRegion(10240,9216,1024),this.defineMirrorRegion(11264,9216,1024)):(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=2,this.ntable1[3]=3)}},defineMirrorRegion:function(t,e,i){for(var n=0;n<i;n++)this.vramMirrorTable[t+n]=e+n},startVBlank:function(){this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI),this.lastRenderedScanline<239&&this.renderFramePartially(this.lastRenderedScanline+1,240-this.lastRenderedScanline),this.endFrame(),this.lastRenderedScanline=-1},endScanline:function(){switch(this.scanline){case 19:this.dummyCycleToggle&&(this.curX=1,this.dummyCycleToggle=!this.dummyCycleToggle);break;case 20:this.setStatusFlag(this.STATUS_VBLANK,!1),this.setStatusFlag(this.STATUS_SPRITE0HIT,!1),this.hitSpr0=!1,this.spr0HitX=-1,this.spr0HitY=-1,1!=this.f_bgVisibility&&1!=this.f_spVisibility||(this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,1==this.f_bgVisibility&&this.renderBgScanline(!1,0)),1==this.f_bgVisibility&&1==this.f_spVisibility&&this.checkSprite0(0),1!=this.f_bgVisibility&&1!=this.f_spVisibility||this.nes.mmap.clockIrqCounter();break;case 261:this.setStatusFlag(this.STATUS_VBLANK,!0),this.requestEndFrame=!0,this.nmiCounter=9,this.scanline=-1;break;default:this.scanline>=21&&this.scanline<=260&&(1==this.f_bgVisibility&&(this.scanlineAlreadyRendered||(this.cntHT=this.regHT,this.cntH=this.regH,this.renderBgScanline(!0,this.scanline+1-21)),this.scanlineAlreadyRendered=!1,this.hitSpr0||1!=this.f_spVisibility||this.sprX[0]>=-7&&this.sprX[0]<256&&this.sprY[0]+1<=this.scanline-20&&this.sprY[0]+1+(0===this.f_spriteSize?8:16)>=this.scanline-20&&this.checkSprite0(this.scanline-20)&&(this.hitSpr0=!0)),1!=this.f_bgVisibility&&1!=this.f_spVisibility||this.nes.mmap.clockIrqCounter())}this.scanline++,this.regsToAddress(),this.cntsToAddress()},startFrame:function(){var t=0;if(0===this.f_dispType)t=this.imgPalette[0];else switch(this.f_color){case 0:t=0;break;case 1:t=65280;break;case 2:t=16711680;break;case 3:t=0;break;case 4:t=255;break;default:t=0}var e,i=this.buffer;for(e=0;e<61440;e++)i[e]=t;var n=this.pixrendered;for(e=0;e<n.length;e++)n[e]=65},endFrame:function(){var t,e,i,n=this.buffer;if(this.showSpr0Hit){if(this.sprX[0]>=0&&this.sprX[0]<256&&this.sprY[0]>=0&&this.sprY[0]<240){for(t=0;t<256;t++)n[(this.sprY[0]<<8)+t]=16733525;for(t=0;t<240;t++)n[(t<<8)+this.sprX[0]]=16733525}if(this.spr0HitX>=0&&this.spr0HitX<256&&this.spr0HitY>=0&&this.spr0HitY<240){for(t=0;t<256;t++)n[(this.spr0HitY<<8)+t]=5635925;for(t=0;t<240;t++)n[(t<<8)+this.spr0HitX]=5635925}}if(this.clipToTvSize||0===this.f_bgClipping||0===this.f_spClipping)for(i=0;i<240;i++)for(e=0;e<8;e++)n[(i<<8)+e]=0;if(this.clipToTvSize)for(i=0;i<240;i++)for(e=0;e<8;e++)n[(i<<8)+255-e]=0;if(this.clipToTvSize)for(i=0;i<8;i++)for(e=0;e<256;e++)n[(i<<8)+e]=0,n[(239-i<<8)+e]=0;this.nes.opts.showDisplay&&this.nes.ui.writeFrame(n,this.prevBuffer)},updateControlReg1:function(t){this.triggerRendering(),this.f_nmiOnVblank=t>>7&1,this.f_spriteSize=t>>5&1,this.f_bgPatternTable=t>>4&1,this.f_spPatternTable=t>>3&1,this.f_addrInc=t>>2&1,this.f_nTblAddress=3&t,this.regV=t>>1&1,this.regH=1&t,this.regS=t>>4&1},updateControlReg2:function(t){this.triggerRendering(),this.f_color=t>>5&7,this.f_spVisibility=t>>4&1,this.f_bgVisibility=t>>3&1,this.f_spClipping=t>>2&1,this.f_bgClipping=t>>1&1,this.f_dispType=1&t,0===this.f_dispType&&this.palTable.setEmphasis(this.f_color),this.updatePalettes()},setStatusFlag:function(t,e){var i=1<<t;this.nes.cpu.mem[8194]=this.nes.cpu.mem[8194]&255-i|(e?i:0)},readStatusRegister:function(){var t=this.nes.cpu.mem[8194];return this.firstWrite=!0,this.setStatusFlag(this.STATUS_VBLANK,!1),t},writeSRAMAddress:function(t){this.sramAddress=t},sramLoad:function(){return this.spriteMem[this.sramAddress]},sramWrite:function(t){this.spriteMem[this.sramAddress]=t,this.spriteRamWriteUpdate(this.sramAddress,t),this.sramAddress++,this.sramAddress%=256},scrollWrite:function(t){this.triggerRendering(),this.firstWrite?(this.regHT=t>>3&31,this.regFH=7&t):(this.regFV=7&t,this.regVT=t>>3&31),this.firstWrite=!this.firstWrite},writeVRAMAddress:function(t){this.firstWrite?(this.regFV=t>>4&3,this.regV=t>>3&1,this.regH=t>>2&1,this.regVT=7&this.regVT|(3&t)<<3):(this.triggerRendering(),this.regVT=24&this.regVT|t>>5&7,this.regHT=31&t,this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,this.checkSprite0(this.scanline-20)),this.firstWrite=!this.firstWrite,this.cntsToAddress(),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress)},vramLoad:function(){var t;return this.cntsToAddress(),this.regsToAddress(),this.vramAddress<=16127?(t=this.vramBufferedReadValue,this.vramAddress<8192?this.vramBufferedReadValue=this.vramMem[this.vramAddress]:this.vramBufferedReadValue=this.mirroredLoad(this.vramAddress),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress),this.vramAddress+=1==this.f_addrInc?32:1,this.cntsFromAddress(),this.regsFromAddress(),t):(t=this.mirroredLoad(this.vramAddress),this.vramAddress+=1==this.f_addrInc?32:1,this.cntsFromAddress(),this.regsFromAddress(),t)},vramWrite:function(t){this.triggerRendering(),this.cntsToAddress(),this.regsToAddress(),this.vramAddress>=8192?this.mirroredWrite(this.vramAddress,t):(this.writeMem(this.vramAddress,t),this.nes.mmap.latchAccess(this.vramAddress)),this.vramAddress+=1==this.f_addrInc?32:1,this.regsFromAddress(),this.cntsFromAddress()},sramDMA:function(t){for(var e,i=256*t,n=this.sramAddress;n<256;n++)e=this.nes.cpu.mem[i+n],this.spriteMem[n]=e,this.spriteRamWriteUpdate(n,e);this.nes.cpu.haltCycles(513)},regsFromAddress:function(){var t=this.vramTmpAddress>>8&255;this.regFV=t>>4&7,this.regV=t>>3&1,this.regH=t>>2&1,this.regVT=7&this.regVT|(3&t)<<3,t=255&this.vramTmpAddress,this.regVT=24&this.regVT|t>>5&7,this.regHT=31&t},cntsFromAddress:function(){var t=this.vramAddress>>8&255;this.cntFV=t>>4&3,this.cntV=t>>3&1,this.cntH=t>>2&1,this.cntVT=7&this.cntVT|(3&t)<<3,t=255&this.vramAddress,this.cntVT=24&this.cntVT|t>>5&7,this.cntHT=31&t},regsToAddress:function(){var t=(7&this.regFV)<<4;t|=(1&this.regV)<<3,t|=(1&this.regH)<<2,t|=this.regVT>>3&3;var e=(7&this.regVT)<<5;e|=31&this.regHT,this.vramTmpAddress=32767&(t<<8|e)},cntsToAddress:function(){var t=(7&this.cntFV)<<4;t|=(1&this.cntV)<<3,t|=(1&this.cntH)<<2,t|=this.cntVT>>3&3;var e=(7&this.cntVT)<<5;e|=31&this.cntHT,this.vramAddress=32767&(t<<8|e)},incTileCounter:function(t){for(var e=t;0!==e;e--)this.cntHT++,32==this.cntHT&&(this.cntHT=0,this.cntVT++,this.cntVT>=30&&(this.cntH++,2==this.cntH&&(this.cntH=0,this.cntV++,2==this.cntV&&(this.cntV=0,this.cntFV++,this.cntFV&=7))))},mirroredLoad:function(t){return this.vramMem[this.vramMirrorTable[t]]},mirroredWrite:function(t,e){t>=16128&&t<16160?16128==t||16144==t?(this.writeMem(16128,e),this.writeMem(16144,e)):16132==t||16148==t?(this.writeMem(16132,e),this.writeMem(16148,e)):16136==t||16152==t?(this.writeMem(16136,e),this.writeMem(16152,e)):16140==t||16156==t?(this.writeMem(16140,e),this.writeMem(16156,e)):this.writeMem(t,e):t<this.vramMirrorTable.length?this.writeMem(this.vramMirrorTable[t],e):alert("Invalid VRAM address: "+t.toString(16))},triggerRendering:function(){this.scanline>=21&&this.scanline<=260&&(this.renderFramePartially(this.lastRenderedScanline+1,this.scanline-21-this.lastRenderedScanline),this.lastRenderedScanline=this.scanline-21)},renderFramePartially:function(t,e){if(1==this.f_spVisibility&&this.renderSpritesPartially(t,e,!0),1==this.f_bgVisibility){var i=t<<8,n=t+e<<8;n>61440&&(n=61440);for(var s=this.buffer,r=this.bgbuffer,o=this.pixrendered,a=i;a<n;a++)o[a]>255&&(s[a]=r[a])}1==this.f_spVisibility&&this.renderSpritesPartially(t,e,!1),this.validTileData=!1},renderBgScanline:function(t,e){var i=0===this.regS?0:256,n=(e<<8)-this.regFH;if(this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],this.cntHT=this.regHT,this.cntH=this.regH,this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],e<240&&e-this.cntFV>=0){for(var s,r,o,a,h=this.cntFV<<3,u=this.scantile,c=this.attrib,l=this.ptTile,p=this.nameTable,d=this.imgPalette,f=this.pixrendered,m=t?this.bgbuffer:this.buffer,g=0;g<32;g++){if(e>=0){this.validTileData?(s=u[g],r=s.pix,o=c[g]):(s=l[i+p[this.curNt].getTileIndex(this.cntHT,this.cntVT)],r=s.pix,o=p[this.curNt].getAttrib(this.cntHT,this.cntVT),u[g]=s,c[g]=o);var v=0,y=(g<<3)-this.regFH;if(y>-8)if(y<0&&(n-=y,v=-y),s.opaque[this.cntFV])for(;v<8;v++)m[n]=d[r[h+v]+o],f[n]|=256,n++;else for(;v<8;v++)a=r[h+v],0!==a&&(m[n]=d[a+o],f[n]|=256),n++}32==++this.cntHT&&(this.cntHT=0,this.cntH++,this.cntH%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH])}this.validTileData=!0}this.cntFV++,8==this.cntFV&&(this.cntFV=0,this.cntVT++,30==this.cntVT?(this.cntVT=0,this.cntV++,this.cntV%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH]):32==this.cntVT&&(this.cntVT=0),this.validTileData=!1)},renderSpritesPartially:function(t,e,i){if(1===this.f_spVisibility)for(var n=0;n<64;n++)if(this.bgPriority[n]==i&&this.sprX[n]>=0&&this.sprX[n]<256&&this.sprY[n]+8>=t&&this.sprY[n]<t+e)if(0===this.f_spriteSize)this.srcy1=0,this.srcy2=8,this.sprY[n]<t&&(this.srcy1=t-this.sprY[n]-1),this.sprY[n]+8>t+e&&(this.srcy2=t+e-this.sprY[n]+1),0===this.f_spPatternTable?this.ptTile[this.sprTile[n]].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[n],this.sprY[n]+1,this.sprCol[n],this.sprPalette,this.horiFlip[n],this.vertFlip[n],n,this.pixrendered):this.ptTile[this.sprTile[n]+256].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[n],this.sprY[n]+1,this.sprCol[n],this.sprPalette,this.horiFlip[n],this.vertFlip[n],n,this.pixrendered);else{var s=this.sprTile[n];0!==(1&s)&&(s=this.sprTile[n]-1+256);var r=0,o=8;this.sprY[n]<t&&(r=t-this.sprY[n]-1),this.sprY[n]+8>t+e&&(o=t+e-this.sprY[n]),this.ptTile[s+(this.vertFlip[n]?1:0)].render(this.buffer,0,r,8,o,this.sprX[n],this.sprY[n]+1,this.sprCol[n],this.sprPalette,this.horiFlip[n],this.vertFlip[n],n,this.pixrendered),r=0,o=8,this.sprY[n]+8<t&&(r=t-(this.sprY[n]+8+1)),this.sprY[n]+16>t+e&&(o=t+e-(this.sprY[n]+8)),this.ptTile[s+(this.vertFlip[n]?0:1)].render(this.buffer,0,r,8,o,this.sprX[n],this.sprY[n]+1+8,this.sprCol[n],this.sprPalette,this.horiFlip[n],this.vertFlip[n],n,this.pixrendered)}},checkSprite0:function(t){this.spr0HitX=-1,this.spr0HitY=-1;var e,i,n,s,r,o,a,h,u=0===this.f_spPatternTable?0:256;if(i=this.sprX[0],n=this.sprY[0]+1,0===this.f_spriteSize){if(n<=t&&n+8>t&&i>=-7&&i<256)if(s=this.ptTile[this.sprTile[0]+u],a=this.sprCol[0],h=this.bgPriority[0],e=this.vertFlip[0]?7-(t-n):t-n,e*=8,o=256*t+i,this.horiFlip[0])for(r=7;r>=0;r--){if(i>=0&&i<256&&o>=0&&o<61440&&0!==this.pixrendered[o]&&0!==s.pix[e+r])return this.spr0HitX=o%256,this.spr0HitY=t,!0;i++,o++}else for(r=0;r<8;r++){if(i>=0&&i<256&&o>=0&&o<61440&&0!==this.pixrendered[o]&&0!==s.pix[e+r])return this.spr0HitX=o%256,this.spr0HitY=t,!0;i++,o++}}else if(n<=t&&n+16>t&&i>=-7&&i<256)if(e=this.vertFlip[0]?15-(t-n):t-n,e<8?s=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?1:0)+(0!==(1&this.sprTile[0])?255:0)]:(s=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?0:1)+(0!==(1&this.sprTile[0])?255:0)],this.vertFlip[0]?e=15-e:e-=8),e*=8,a=this.sprCol[0],h=this.bgPriority[0],o=256*t+i,this.horiFlip[0])for(r=7;r>=0;r--){if(i>=0&&i<256&&o>=0&&o<61440&&0!==this.pixrendered[o]&&0!==s.pix[e+r])return this.spr0HitX=o%256,this.spr0HitY=t,!0;i++,o++}else for(r=0;r<8;r++){if(i>=0&&i<256&&o>=0&&o<61440&&0!==this.pixrendered[o]&&0!==s.pix[e+r])return this.spr0HitX=o%256,this.spr0HitY=t,!0;i++,o++}return!1},writeMem:function(t,e){this.vramMem[t]=e,t<8192?(this.vramMem[t]=e,this.patternWrite(t,e)):t>=8192&&t<9152?this.nameTableWrite(this.ntable1[0],t-8192,e):t>=9152&&t<9216?this.attribTableWrite(this.ntable1[0],t-9152,e):t>=9216&&t<10176?this.nameTableWrite(this.ntable1[1],t-9216,e):t>=10176&&t<10240?this.attribTableWrite(this.ntable1[1],t-10176,e):t>=10240&&t<11200?this.nameTableWrite(this.ntable1[2],t-10240,e):t>=11200&&t<11264?this.attribTableWrite(this.ntable1[2],t-11200,e):t>=11264&&t<12224?this.nameTableWrite(this.ntable1[3],t-11264,e):t>=12224&&t<12288?this.attribTableWrite(this.ntable1[3],t-12224,e):t>=16128&&t<16160&&this.updatePalettes()},updatePalettes:function(){var t;for(t=0;t<16;t++)0===this.f_dispType?this.imgPalette[t]=this.palTable.getEntry(63&this.vramMem[16128+t]):this.imgPalette[t]=this.palTable.getEntry(32&this.vramMem[16128+t]);for(t=0;t<16;t++)0===this.f_dispType?this.sprPalette[t]=this.palTable.getEntry(63&this.vramMem[16144+t]):this.sprPalette[t]=this.palTable.getEntry(32&this.vramMem[16144+t])},patternWrite:function(t,e){var i=Math.floor(t/16),n=t%16;n<8?this.ptTile[i].setScanline(n,e,this.vramMem[t+8]):this.ptTile[i].setScanline(n-8,this.vramMem[t-8],e)},nameTableWrite:function(t,e,i){this.nameTable[t].tile[e]=i,this.checkSprite0(this.scanline-20)},attribTableWrite:function(t,e,i){this.nameTable[t].writeAttrib(e,i)},spriteRamWriteUpdate:function(t,e){var i=Math.floor(t/4);0===i&&this.checkSprite0(this.scanline-20),t%4===0?this.sprY[i]=e:t%4==1?this.sprTile[i]=e:t%4==2?(this.vertFlip[i]=0!==(128&e),this.horiFlip[i]=0!==(64&e),this.bgPriority[i]=0!==(32&e),this.sprCol[i]=(3&e)<<2):t%4==3&&(this.sprX[i]=e)},doNMI:function(){this.setStatusFlag(this.STATUS_VBLANK,!0),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI)},JSON_PROPERTIES:["vramMem","spriteMem","cntFV","cntV","cntH","cntVT","cntHT","regFV","regV","regH","regVT","regHT","regFH","regS","vramAddress","vramTmpAddress","f_nmiOnVblank","f_spriteSize","f_bgPatternTable","f_spPatternTable","f_addrInc","f_nTblAddress","f_color","f_spVisibility","f_bgVisibility","f_spClipping","f_bgClipping","f_dispType","vramBufferedReadValue","firstWrite","currentMirroring","vramMirrorTable","ntable1","sramAddress","hitSpr0","sprPalette","imgPalette","curX","scanline","lastRenderedScanline","curNt","scantile","attrib","buffer","bgbuffer","pixrendered","requestEndFrame","nmiOk","dummyCycleToggle","nmiCounter","validTileData","scanlineAlreadyRendered"],toJSON:function(){var t,e=JSNES.Utils.toJSON(this);for(e.nameTable=[],t=0;t<this.nameTable.length;t++)e.nameTable[t]=this.nameTable[t].toJSON();for(e.ptTile=[],t=0;t<this.ptTile.length;t++)e.ptTile[t]=this.ptTile[t].toJSON();return e},fromJSON:function(t){var e;for(JSNES.Utils.fromJSON(this,t),e=0;e<this.nameTable.length;e++)this.nameTable[e].fromJSON(t.nameTable[e]);for(e=0;e<this.ptTile.length;e++)this.ptTile[e].fromJSON(t.ptTile[e]);for(e=0;e<this.spriteMem.length;e++)this.spriteRamWriteUpdate(e,this.spriteMem[e])}},JSNES.PPU.NameTable=function(t,e,i){this.width=t,this.height=e,this.name=i,this.tile=new Array(t*e),this.attrib=new Array(t*e)},JSNES.PPU.NameTable.prototype={getTileIndex:function(t,e){return this.tile[e*this.width+t]},getAttrib:function(t,e){return this.attrib[e*this.width+t]},writeAttrib:function(t,e){for(var i,n,s,r,o=t%8*4,a=4*Math.floor(t/8),h=0;h<2;h++)for(var u=0;u<2;u++){i=e>>2*(2*h+u)&3;for(var c=0;c<2;c++)for(var l=0;l<2;l++)n=o+2*u+l,s=a+2*h+c,r=s*this.width+n,this.attrib[s*this.width+n]=i<<2&12}},toJSON:function(){return{tile:this.tile,attrib:this.attrib}},fromJSON:function(t){this.tile=t.tile,this.attrib=t.attrib}},JSNES.PPU.PaletteTable=function(){this.curTable=new Array(64),this.emphTable=new Array(8),this.currentEmph=-1},JSNES.PPU.PaletteTable.prototype={reset:function(){this.setEmphasis(0)},loadNTSCPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},loadPALPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},makeTables:function(){for(var t,e,i,n,s,r,o,a,h=0;h<8;h++)for(r=1,o=1,a=1,0!==(1&h)&&(r=.75,a=.75),0!==(2&h)&&(r=.75,o=.75),0!==(4&h)&&(o=.75,a=.75),this.emphTable[h]=new Array(64),s=0;s<64;s++)n=this.curTable[s],t=Math.floor(this.getRed(n)*r),e=Math.floor(this.getGreen(n)*o),i=Math.floor(this.getBlue(n)*a),this.emphTable[h][s]=this.getRgb(t,e,i)},setEmphasis:function(t){if(t!=this.currentEmph){this.currentEmph=t;for(var e=0;e<64;e++)this.curTable[e]=this.emphTable[t][e]}},getEntry:function(t){return this.curTable[t]},getRed:function(t){return t>>16&255},getGreen:function(t){return t>>8&255},getBlue:function(t){return 255&t},getRgb:function(t,e,i){return t<<16|e<<8|i},loadDefaultPalette:function(){this.curTable[0]=this.getRgb(117,117,117),this.curTable[1]=this.getRgb(39,27,143),this.curTable[2]=this.getRgb(0,0,171),this.curTable[3]=this.getRgb(71,0,159),this.curTable[4]=this.getRgb(143,0,119),this.curTable[5]=this.getRgb(171,0,19),this.curTable[6]=this.getRgb(167,0,0),this.curTable[7]=this.getRgb(127,11,0),this.curTable[8]=this.getRgb(67,47,0),this.curTable[9]=this.getRgb(0,71,0),this.curTable[10]=this.getRgb(0,81,0),this.curTable[11]=this.getRgb(0,63,23),this.curTable[12]=this.getRgb(27,63,95),this.curTable[13]=this.getRgb(0,0,0),this.curTable[14]=this.getRgb(0,0,0),this.curTable[15]=this.getRgb(0,0,0),this.curTable[16]=this.getRgb(188,188,188),this.curTable[17]=this.getRgb(0,115,239),this.curTable[18]=this.getRgb(35,59,239),this.curTable[19]=this.getRgb(131,0,243),this.curTable[20]=this.getRgb(191,0,191),this.curTable[21]=this.getRgb(231,0,91),this.curTable[22]=this.getRgb(219,43,0),this.curTable[23]=this.getRgb(203,79,15),this.curTable[24]=this.getRgb(139,115,0),this.curTable[25]=this.getRgb(0,151,0),this.curTable[26]=this.getRgb(0,171,0),this.curTable[27]=this.getRgb(0,147,59),this.curTable[28]=this.getRgb(0,131,139),this.curTable[29]=this.getRgb(0,0,0),this.curTable[30]=this.getRgb(0,0,0),this.curTable[31]=this.getRgb(0,0,0),this.curTable[32]=this.getRgb(255,255,255),this.curTable[33]=this.getRgb(63,191,255),this.curTable[34]=this.getRgb(95,151,255),this.curTable[35]=this.getRgb(167,139,253),this.curTable[36]=this.getRgb(247,123,255),this.curTable[37]=this.getRgb(255,119,183),this.curTable[38]=this.getRgb(255,119,99),this.curTable[39]=this.getRgb(255,155,59),this.curTable[40]=this.getRgb(243,191,63),this.curTable[41]=this.getRgb(131,211,19),this.curTable[42]=this.getRgb(79,223,75),this.curTable[43]=this.getRgb(88,248,152),this.curTable[44]=this.getRgb(0,235,219),this.curTable[45]=this.getRgb(0,0,0),this.curTable[46]=this.getRgb(0,0,0),this.curTable[47]=this.getRgb(0,0,0),this.curTable[48]=this.getRgb(255,255,255),this.curTable[49]=this.getRgb(171,231,255),this.curTable[50]=this.getRgb(199,215,255),this.curTable[51]=this.getRgb(215,203,255),this.curTable[52]=this.getRgb(255,199,255),this.curTable[53]=this.getRgb(255,199,219),this.curTable[54]=this.getRgb(255,191,179),this.curTable[55]=this.getRgb(255,219,171),this.curTable[56]=this.getRgb(255,231,163),this.curTable[57]=this.getRgb(227,255,163),this.curTable[58]=this.getRgb(171,243,191),this.curTable[59]=this.getRgb(179,255,207),this.curTable[60]=this.getRgb(159,255,243),this.curTable[61]=this.getRgb(0,0,0),this.curTable[62]=this.getRgb(0,0,0),this.curTable[63]=this.getRgb(0,0,0),this.makeTables(),this.setEmphasis(0)}},JSNES.PPU.Tile=function(){this.pix=new Array(64),this.fbIndex=null,this.tIndex=null,this.x=null,this.y=null,this.w=null,this.h=null,this.incX=null,this.incY=null,this.palIndex=null,this.tpri=null,this.c=null,this.initialized=!1,this.opaque=new Array(8)},JSNES.PPU.Tile.prototype={setBuffer:function(t){for(this.y=0;this.y<8;this.y++)this.setScanline(this.y,t[this.y],t[this.y+8])},setScanline:function(t,e,i){for(this.initialized=!0,this.tIndex=t<<3,this.x=0;this.x<8;this.x++)this.pix[this.tIndex+this.x]=(e>>7-this.x&1)+((i>>7-this.x&1)<<1),0===this.pix[this.tIndex+this.x]&&(this.opaque[t]=!1)},render:function(t,e,i,n,s,r,o,a,h,u,c,l,p){if(!(r<-7||r>=256||o<-7||o>=240))if(this.w=n-e,this.h=s-i,r<0&&(e-=r),r+n>=256&&(n=256-r),o<0&&(i-=o),o+s>=240&&(s=240-o),u||c)if(u&&!c)for(this.fbIndex=(o<<8)+r,this.tIndex=7,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<n&&this.y>=i&&this.y<s&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&l<=(255&this.tpri)&&(t[this.fbIndex]=h[this.palIndex+a],this.tpri=3840&this.tpri|l,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256,this.tIndex+=16}else if(c&&!u)for(this.fbIndex=(o<<8)+r,this.tIndex=56,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<n&&this.y>=i&&this.y<s&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&l<=(255&this.tpri)&&(t[this.fbIndex]=h[this.palIndex+a],this.tpri=3840&this.tpri|l,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256,this.tIndex-=16}else for(this.fbIndex=(o<<8)+r,this.tIndex=63,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<n&&this.y>=i&&this.y<s&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&l<=(255&this.tpri)&&(t[this.fbIndex]=h[this.palIndex+a],this.tpri=3840&this.tpri|l,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256}else for(this.fbIndex=(o<<8)+r,this.tIndex=0,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<n&&this.y>=i&&this.y<s&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&l<=(255&this.tpri)&&(t[this.fbIndex]=h[this.palIndex+a],this.tpri=3840&this.tpri|l,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256}},isTransparent:function(t,e){return 0===this.pix[(e<<3)+t]},toJSON:function(){return{opaque:this.opaque,pix:this.pix}},fromJSON:function(t){this.opaque=t.opaque,this.pix=t.pix}},JSNES.ROM=function(t){this.nes=t,this.mapperName=new Array(92);for(var e=0;e<92;e++)this.mapperName[e]="Unknown Mapper";this.mapperName[0]="Direct Access",this.mapperName[1]="Nintendo MMC1",this.mapperName[2]="UNROM",this.mapperName[3]="CNROM",this.mapperName[4]="Nintendo MMC3",this.mapperName[5]="Nintendo MMC5",this.mapperName[6]="FFE F4xxx",this.mapperName[7]="AOROM",this.mapperName[8]="FFE F3xxx",this.mapperName[9]="Nintendo MMC2",this.mapperName[10]="Nintendo MMC4",this.mapperName[11]="Color Dreams Chip",this.mapperName[12]="FFE F6xxx",this.mapperName[15]="100-in-1 switch",this.mapperName[16]="Bandai chip",this.mapperName[17]="FFE F8xxx",this.mapperName[18]="Jaleco SS8806 chip",this.mapperName[19]="Namcot 106 chip",this.mapperName[20]="Famicom Disk System",this.mapperName[21]="Konami VRC4a",this.mapperName[22]="Konami VRC2a",this.mapperName[23]="Konami VRC2a",this.mapperName[24]="Konami VRC6",this.mapperName[25]="Konami VRC4b",this.mapperName[32]="Irem G-101 chip",this.mapperName[33]="Taito TC0190/TC0350",this.mapperName[34]="32kB ROM switch",this.mapperName[64]="Tengen RAMBO-1 chip",this.mapperName[65]="Irem H-3001 chip",this.mapperName[66]="GNROM switch",this.mapperName[67]="SunSoft3 chip",this.mapperName[68]="SunSoft4 chip",this.mapperName[69]="SunSoft5 FME-7 chip",this.mapperName[71]="Camerica chip",this.mapperName[78]="Irem 74HC161/32-based",this.mapperName[91]="Pirate HK-SF3 chip"},JSNES.ROM.prototype={VERTICAL_MIRRORING:0,HORIZONTAL_MIRRORING:1,FOURSCREEN_MIRRORING:2,SINGLESCREEN_MIRRORING:3,SINGLESCREEN_MIRRORING2:4,SINGLESCREEN_MIRRORING3:5,SINGLESCREEN_MIRRORING4:6,
CHRROM_MIRRORING:7,header:null,rom:null,vrom:null,vromTile:null,romCount:null,vromCount:null,mirroring:null,batteryRam:null,trainer:null,fourScreen:null,mapperType:null,valid:!1,load:function(t){var e,i,n;if(t.indexOf("NES")===-1)return void this.nes.ui.updateStatus("Not a valid NES ROM.");for(this.header=new Array(16),e=0;e<16;e++)this.header[e]=255&t.charCodeAt(e);this.romCount=this.header[4],this.vromCount=2*this.header[5],this.mirroring=0!==(1&this.header[6])?1:0,this.batteryRam=0!==(2&this.header[6]),this.trainer=0!==(4&this.header[6]),this.fourScreen=0!==(8&this.header[6]),this.mapperType=this.header[6]>>4|240&this.header[7];var s=!1;for(e=8;e<16;e++)if(0!==this.header[e]){s=!0;break}s&&(this.mapperType&=15),this.rom=new Array(this.romCount);var r=16;for(e=0;e<this.romCount;e++){for(this.rom[e]=new Array(16384),i=0;i<16384&&!(r+i>=t.length);i++)this.rom[e][i]=255&t.charCodeAt(r+i);r+=16384}for(this.vrom=new Array(this.vromCount),e=0;e<this.vromCount;e++){for(this.vrom[e]=new Array(4096),i=0;i<4096&&!(r+i>=t.length);i++)this.vrom[e][i]=255&t.charCodeAt(r+i);r+=4096}for(this.vromTile=new Array(this.vromCount),e=0;e<this.vromCount;e++)for(this.vromTile[e]=new Array(256),i=0;i<256;i++)this.vromTile[e][i]=new JSNES.PPU.Tile;var o,a;for(n=0;n<this.vromCount;n++)for(e=0;e<4096;e++)o=e>>4,a=e%16,a<8?this.vromTile[n][o].setScanline(a,this.vrom[n][e],this.vrom[n][e+8]):this.vromTile[n][o].setScanline(a-8,this.vrom[n][e-8],this.vrom[n][e]);this.valid=!0},getMirroringType:function(){return this.fourScreen?this.FOURSCREEN_MIRRORING:0===this.mirroring?this.HORIZONTAL_MIRRORING:this.VERTICAL_MIRRORING},getMapperName:function(){return this.mapperType>=0&&this.mapperType<this.mapperName.length?this.mapperName[this.mapperType]:"Unknown Mapper, "+this.mapperType},mapperSupported:function(){return"undefined"!=typeof JSNES.Mappers[this.mapperType]},createMapper:function(){return this.mapperSupported()?new JSNES.Mappers[this.mapperType](this.nes):(this.nes.ui.updateStatus("This ROM uses a mapper not supported by JSNES: "+this.getMapperName()+"("+this.mapperType+")"),null)}},JSNES.DummyUI=function(t){this.nes=t,this.enable=function(){},this.updateStatus=function(){},this.writeFrame=function(){}},"undefined"!=typeof jQuery&&!function(t){t.fn.JSNESUI=function(){var e=this,i=function(i){var n=this;return n.nes=i,n.root=t('<div style="width: 100%; height: 100%; position: relative;"></div>'),n.screen=t('<canvas class="nes-screen" width="256" height="240" style="width: 100%; height: 100%; object-fit: contain;"></canvas>').appendTo(n.root),n.screen[0].getContext?(n.root.appendTo(e),n.canvasContext=n.screen[0].getContext("2d"),n.canvasContext.getImageData?(n.canvasImageData=n.canvasContext.getImageData(0,0,256,240),void n.resetCanvas()):void e.html("Your browser doesn't support writing pixels directly to the <code>&lt;canvas&gt;</code> tag. Try the latest versions of Google Chrome, Safari, Opera or Firefox!")):void e.html("Your browser doesn't support the <code>&lt;canvas&gt;</code> tag. Try Google Chrome, Safari, Opera or Firefox!")};return i.prototype={loadROM:function(e){var i=this;i.updateStatus("Downloading..."),t.ajax({url:e,xhr:function(){var e=t.ajaxSettings.xhr();return"undefined"!=typeof e.overrideMimeType&&e.overrideMimeType("text/plain; charset=x-user-defined"),i.xhr=e,e},complete:function(t,e){var n;if(JSNES.Utils.isIE()){var s=JSNESBinaryToArray(t.responseBody).toArray();n=String.fromCharCode.apply(void 0,s)}else n=t.responseText;i.setROM(n)}})},setROM:function(t){this.nes.loadRom(t),this.nes.start()},resetCanvas:function(){this.canvasContext.fillStyle="black",this.canvasContext.fillRect(0,0,256,240);for(var t=3;t<this.canvasImageData.data.length-3;t+=4)this.canvasImageData.data[t]=255},screenshot:function(){var t=this.screen[0].toDataURL("image/png"),e=new Image;return e.src=t,e},updateStatus:function(t){},writeFrame:function(t,e){var i,n,s,r=this.canvasImageData.data;for(n=0;n<61440;n++)i=t[n],i!=e[n]&&(s=4*n,r[s]=255&i,r[s+1]=i>>8&255,r[s+2]=i>>16&255,e[n]=i);this.canvasContext.putImageData(this.canvasImageData,0,0)}},i}}(jQuery);var QRCode;!function(){function t(t){this.mode=u.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,i=this.data.length;e<i;e++){var n=[],s=this.data.charCodeAt(e);s>65536?(n[0]=240|(1835008&s)>>>18,n[1]=128|(258048&s)>>>12,n[2]=128|(4032&s)>>>6,n[3]=128|63&s):s>2048?(n[0]=224|(61440&s)>>>12,n[1]=128|(4032&s)>>>6,n[2]=128|63&s):s>128?(n[0]=192|(1984&s)>>>6,n[1]=128|63&s):n[0]=s,this.parsedData.push(n)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function i(t,e){if(void 0==t.length)throw new Error(t.length+"/"+e);for(var i=0;i<t.length&&0==t[i];)i++;this.num=new Array(t.length-i+e);for(var n=0;n<t.length-i;n++)this.num[n]=t[n+i]}function n(t,e){this.totalCount=t,this.dataCount=e}function s(){this.buffer=[],this.length=0}function r(){return"undefined"!=typeof CanvasRenderingContext2D}function o(){var t=!1,e=navigator.userAgent;if(/android/i.test(e)){t=!0;var i=e.toString().match(/android ([0-9]\.[0-9])/i);i&&i[1]&&(t=parseFloat(i[1]))}return t}function a(t,e){for(var i=1,n=h(t),s=0,r=m.length;s<=r;s++){var o=0;switch(e){case c.L:o=m[s][0];break;case c.M:o=m[s][1];break;case c.Q:o=m[s][2];break;case c.H:o=m[s][3]}if(n<=o)break;i++}if(i>m.length)throw new Error("Too long data");return i}function h(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,i=this.parsedData.length;e<i;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var i=new t(e);this.dataList.push(i),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,i){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var s=0;s<this.moduleCount;s++)this.modules[n][s]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,i),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,i)},setupPositionProbePattern:function(t,e){for(var i=-1;i<=7;i++)if(!(t+i<=-1||this.moduleCount<=t+i))for(var n=-1;n<=7;n++)e+n<=-1||this.moduleCount<=e+n||(0<=i&&i<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==i||6==i)||2<=i&&i<=4&&2<=n&&n<=4?this.modules[t+i][e+n]=!0:this.modules[t+i][e+n]=!1)},getBestMaskPattern:function(){for(var t=0,e=0,i=0;i<8;i++){this.makeImpl(!0,i);var n=p.getLostPoint(this);(0==i||t>n)&&(t=n,e=i)}return e},createMovieClip:function(t,e,i){var n=t.createEmptyMovieClip(e,i),s=1;this.make();for(var r=0;r<this.modules.length;r++)for(var o=r*s,a=0;a<this.modules[r].length;a++){var h=a*s,u=this.modules[r][a];u&&(n.beginFill(0,100),n.moveTo(h,o),n.lineTo(h+s,o),n.lineTo(h+s,o+s),n.lineTo(h,o+s),n.endFill())}return n},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=p.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var i=0;i<t.length;i++){var n=t[e],s=t[i];if(null==this.modules[n][s])for(var r=-2;r<=2;r++)for(var o=-2;o<=2;o++)r==-2||2==r||o==-2||2==o||0==r&&0==o?this.modules[n+r][s+o]=!0:this.modules[n+r][s+o]=!1}},setupTypeNumber:function(t){for(var e=p.getBCHTypeNumber(this.typeNumber),i=0;i<18;i++){var n=!t&&1==(e>>i&1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=n}for(var i=0;i<18;i++){var n=!t&&1==(e>>i&1);this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=n}},setupTypeInfo:function(t,e){for(var i=this.errorCorrectLevel<<3|e,n=p.getBCHTypeInfo(i),s=0;s<15;s++){var r=!t&&1==(n>>s&1);s<6?this.modules[s][8]=r:s<8?this.modules[s+1][8]=r:this.modules[this.moduleCount-15+s][8]=r}for(var s=0;s<15;s++){var r=!t&&1==(n>>s&1);s<8?this.modules[8][this.moduleCount-s-1]=r:s<9?this.modules[8][15-s-1+1]=r:this.modules[8][15-s-1]=r}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var i=-1,n=this.moduleCount-1,s=7,r=0,o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(var a=0;a<2;a++)if(null==this.modules[n][o-a]){var h=!1;r<t.length&&(h=1==(t[r]>>>s&1));var u=p.getMask(e,n,o-a);u&&(h=!h),this.modules[n][o-a]=h,s--,s==-1&&(r++,s=7)}if(n+=i,n<0||this.moduleCount<=n){n-=i,i=-i;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,i,r){for(var o=n.getRSBlocks(t,i),a=new s,h=0;h<r.length;h++){var u=r[h];a.put(u.mode,4),a.put(u.getLength(),p.getLengthInBits(u.mode,t)),u.write(a)}for(var c=0,h=0;h<o.length;h++)c+=o[h].dataCount;if(a.getLengthInBits()>8*c)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*c+")");for(a.getLengthInBits()+4<=8*c&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;;){if(a.getLengthInBits()>=8*c)break;if(a.put(e.PAD0,8),a.getLengthInBits()>=8*c)break;a.put(e.PAD1,8)}return e.createBytes(a,o)},e.createBytes=function(t,e){for(var n=0,s=0,r=0,o=new Array(e.length),a=new Array(e.length),h=0;h<e.length;h++){var u=e[h].dataCount,c=e[h].totalCount-u;s=Math.max(s,u),r=Math.max(r,c),o[h]=new Array(u);for(var l=0;l<o[h].length;l++)o[h][l]=255&t.buffer[l+n];n+=u;var d=p.getErrorCorrectPolynomial(c),f=new i(o[h],d.getLength()-1),m=f.mod(d);a[h]=new Array(d.getLength()-1);for(var l=0;l<a[h].length;l++){var g=l+m.getLength()-a[h].length;a[h][l]=g>=0?m.get(g):0}}for(var v=0,l=0;l<e.length;l++)v+=e[l].totalCount;for(var y=new Array(v),b=0,l=0;l<s;l++)for(var h=0;h<e.length;h++)l<o[h].length&&(y[b++]=o[h][l]);for(var l=0;l<r;l++)for(var h=0;h<e.length;h++)l<a[h].length&&(y[b++]=a[h][l]);return y};for(var u={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},c={L:1,M:0,Q:3,H:2},l={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},p={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;p.getBCHDigit(e)-p.getBCHDigit(p.G15)>=0;)e^=p.G15<<p.getBCHDigit(e)-p.getBCHDigit(p.G15);return(t<<10|e)^p.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;p.getBCHDigit(e)-p.getBCHDigit(p.G18)>=0;)e^=p.G18<<p.getBCHDigit(e)-p.getBCHDigit(p.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return p.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,i){switch(t){case l.PATTERN000:return(e+i)%2==0;case l.PATTERN001:return e%2==0;case l.PATTERN010:return i%3==0;case l.PATTERN011:return(e+i)%3==0;case l.PATTERN100:return(Math.floor(e/2)+Math.floor(i/3))%2==0;case l.PATTERN101:return e*i%2+e*i%3==0;case l.PATTERN110:return(e*i%2+e*i%3)%2==0;case l.PATTERN111:return(e*i%3+(e+i)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new i([1],0),n=0;n<t;n++)e=e.multiply(new i([1,d.gexp(n)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case u.MODE_NUMBER:return 10;case u.MODE_ALPHA_NUM:return 9;case u.MODE_8BIT_BYTE:return 8;case u.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case u.MODE_NUMBER:return 12;case u.MODE_ALPHA_NUM:return 11;case u.MODE_8BIT_BYTE:return 16;case u.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case u.MODE_NUMBER:return 14;case u.MODE_ALPHA_NUM:return 13;case u.MODE_8BIT_BYTE:return 16;case u.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),i=0,n=0;n<e;n++)for(var s=0;s<e;s++){for(var r=0,o=t.isDark(n,s),a=-1;a<=1;a++)if(!(n+a<0||e<=n+a))for(var h=-1;h<=1;h++)s+h<0||e<=s+h||0==a&&0==h||o==t.isDark(n+a,s+h)&&r++;r>5&&(i+=3+r-5)}for(var n=0;n<e-1;n++)for(var s=0;s<e-1;s++){var u=0;t.isDark(n,s)&&u++,t.isDark(n+1,s)&&u++,t.isDark(n,s+1)&&u++,t.isDark(n+1,s+1)&&u++,0!=u&&4!=u||(i+=3)}for(var n=0;n<e;n++)for(var s=0;s<e-6;s++)t.isDark(n,s)&&!t.isDark(n,s+1)&&t.isDark(n,s+2)&&t.isDark(n,s+3)&&t.isDark(n,s+4)&&!t.isDark(n,s+5)&&t.isDark(n,s+6)&&(i+=40);for(var s=0;s<e;s++)for(var n=0;n<e-6;n++)t.isDark(n,s)&&!t.isDark(n+1,s)&&t.isDark(n+2,s)&&t.isDark(n+3,s)&&t.isDark(n+4,s)&&!t.isDark(n+5,s)&&t.isDark(n+6,s)&&(i+=40);for(var c=0,s=0;s<e;s++)for(var n=0;n<e;n++)t.isDark(n,s)&&c++;var l=Math.abs(100*c/e/e-50)/5;return i+=10*l}},d={glog:function(t){if(t<1)throw new Error("glog("+t+")");return d.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return d.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},f=0;f<8;f++)d.EXP_TABLE[f]=1<<f;for(var f=8;f<256;f++)d.EXP_TABLE[f]=d.EXP_TABLE[f-4]^d.EXP_TABLE[f-5]^d.EXP_TABLE[f-6]^d.EXP_TABLE[f-8];for(var f=0;f<255;f++)d.LOG_TABLE[d.EXP_TABLE[f]]=f;i.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),n=0;n<this.getLength();n++)for(var s=0;s<t.getLength();s++)e[n+s]^=d.gexp(d.glog(this.get(n))+d.glog(t.get(s)));return new i(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=d.glog(this.get(0))-d.glog(t.get(0)),n=new Array(this.getLength()),s=0;s<this.getLength();s++)n[s]=this.get(s);for(var s=0;s<t.getLength();s++)n[s]^=d.gexp(d.glog(t.get(s))+e);return new i(n,0).mod(t)}},n.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],n.getRSBlocks=function(t,e){var i=n.getRsBlockTable(t,e);if(void 0==i)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var s=i.length/3,r=[],o=0;o<s;o++)for(var a=i[3*o+0],h=i[3*o+1],u=i[3*o+2],c=0;c<a;c++)r.push(new n(h,u));return r},n.getRsBlockTable=function(t,e){switch(e){case c.L:return n.RS_BLOCK_TABLE[4*(t-1)+0];case c.M:return n.RS_BLOCK_TABLE[4*(t-1)+1];case c.Q:return n.RS_BLOCK_TABLE[4*(t-1)+2];case c.H:return n.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},s.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var i=0;i<e;i++)this.putBit(1==(t>>>e-i-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var m=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],g=function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){function e(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg",t);for(var n in e)e.hasOwnProperty(n)&&i.setAttribute(n,e[n]);return i}var i=this._htOption,n=this._el,s=t.getModuleCount();Math.floor(i.width/s),Math.floor(i.height/s);this.clear();var r=e("svg",{viewBox:"0 0 "+String(s)+" "+String(s),width:"100%",height:"100%",fill:i.colorLight});r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.appendChild(r),r.appendChild(e("rect",{fill:i.colorLight,width:"100%",height:"100%"})),r.appendChild(e("rect",{fill:i.colorDark,width:"1",height:"1",id:"template"}));for(var o=0;o<s;o++)for(var a=0;a<s;a++)if(t.isDark(o,a)){var h=e("use",{x:String(a),y:String(o)});h.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),r.appendChild(h)}},t.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},t}(),v="svg"===document.documentElement.tagName.toLowerCase(),y=v?g:r()?function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function e(t,e){var i=this;if(i._fFail=e,i._fSuccess=t,null===i._bSupportDataURI){var n=document.createElement("img"),s=function(){i._bSupportDataURI=!1,i._fFail&&i._fFail.call(i)},r=function(){i._bSupportDataURI=!0,i._fSuccess&&i._fSuccess.call(i)};return n.onabort=s,n.onerror=s,n.onload=r,void(n.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}i._bSupportDataURI===!0&&i._fSuccess?i._fSuccess.call(i):i._bSupportDataURI===!1&&i._fFail&&i._fFail.call(i)}if(this._android&&this._android<=2.1){var i=1/window.devicePixelRatio,n=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,e,s,r,o,a,h,u,c){if("nodeName"in t&&/img/i.test(t.nodeName))for(var l=arguments.length-1;l>=1;l--)arguments[l]=arguments[l]*i;else"undefined"==typeof u&&(arguments[1]*=i,arguments[2]*=i,arguments[3]*=i,arguments[4]*=i);n.apply(this,arguments)}}var s=function(t,e){this._bIsPainted=!1,this._android=o(),this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return s.prototype.draw=function(t){var e=this._elImage,i=this._oContext,n=this._htOption,s=t.getModuleCount(),r=n.width/s,o=n.height/s,a=Math.round(r),h=Math.round(o);e.style.display="none",this.clear();for(var u=0;u<s;u++)for(var c=0;c<s;c++){var l=t.isDark(u,c),p=c*r,d=u*o;i.strokeStyle=l?n.colorDark:n.colorLight,i.lineWidth=1,i.fillStyle=l?n.colorDark:n.colorLight,i.fillRect(p,d,r,o),i.strokeRect(Math.floor(p)+.5,Math.floor(d)+.5,a,h),i.strokeRect(Math.ceil(p)-.5,Math.ceil(d)-.5,a,h)}this._bIsPainted=!0},s.prototype.makeImage=function(){this._bIsPainted&&e.call(this,t)},s.prototype.isPainted=function(){return this._bIsPainted},s.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},s.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},s}():function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){for(var e=this._htOption,i=this._el,n=t.getModuleCount(),s=Math.floor(e.width/n),r=Math.floor(e.height/n),o=['<table style="border:0;border-collapse:collapse;">'],a=0;a<n;a++){o.push("<tr>");for(var h=0;h<n;h++)o.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+s+"px;height:"+r+"px;background-color:"+(t.isDark(a,h)?e.colorDark:e.colorLight)+';"></td>');o.push("</tr>")}o.push("</table>"),i.innerHTML=o.join("");var u=i.childNodes[0],c=(e.width-u.offsetWidth)/2,l=(e.height-u.offsetHeight)/2;c>0&&l>0&&(u.style.margin=l+"px "+c+"px")},t.prototype.clear=function(){this._el.innerHTML=""},t}();QRCode=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:c.H},"string"==typeof e&&(e={text:e}),e)for(var i in e)this._htOption[i]=e[i];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(y=g),this._android=o(),this._el=t,this._oQRCode=null,this._oDrawing=new y(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(t){this._oQRCode=new e(a(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._el.title=t,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=c}(),function(){"use strict";var t=new window.webRtcMaster,e=!0,i=!0,n=!1;$(function(){function s(){i=!1,d.hide(),S.isRunning||S.start(),e=!1}function r(t){g.hide(),t?(f.show(),m.hide()):(m.show(),f.hide(),a(T)),d.show(),!i&&S.isRunning&&S.stop(),e=!0}function o(){g.show(),f.hide(),m.hide(),d.show(),S.stop()}function a(t){$("<h1>Loading...</h1>").appendTo(t.empty()),R.filesListFolder({path:""}).then(function(e){t.empty(),e.entries.forEach(function(e){$("<span>"+e.name+"</span>").on("click",function(){h(e.path_lower)}).appendTo(t)})})["catch"](function(t){console.log(t)})}function h(t,e){e||o(),R.filesDownload({path:t}).then(function(t){var i=URL.createObjectURL(t.fileBlob);S.ui.loadROM(i),e||s()})}function u(t,e){var i=$(".player-controls.player"+(t+1));e?($(".keyboard-controls",i).show(),$(".qrcode",i).hide(),$(".controller-keyboard",i).addClass("selected-controller"),$(".controller-phone",i).removeClass("selected-controller")):($(".keyboard-controls",i).hide(),$(".qrcode",i).show(),$(".controller-keyboard",i).removeClass("selected-controller"),$(".controller-phone",i).addClass("selected-controller"))}function c(){return document.exitFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen}function c(){return document.exitFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen}function l(){var t=document.documentElement;n=!0,t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():n=!1}function p(){n=!1,document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():n=!0}var d=$(".content.modal"),f=$(".menu.main"),m=$(".menu.rom"),g=$(".menu.loading"),v=$(".emulator"),y=$(".player-controls .qrcode"),b="https://doctogonzo.github.io/playNESEmulatorOnline/controller?id="+encodeURIComponent(t.key)+"&player=";console.log(b),y.each(function(t){new QRCode(y[t],b+t)});var S=new JSNES({ui:v.JSNESUI()}),_={};t.subscribe("controllerState",null,function(t,e,i){if(i&&(_[e]||(_[e]=i.player),i.keys))for(var n in i.keys)i.keys.hasOwnProperty(n)&&S.keyboard.keys.hasOwnProperty(n)&&S.keyboard.setKeyState(i.player,S.keyboard.keys[n],i.keys[n])},function(t,e){},function(t,e){});var R=new Dropbox({accessToken:"ioETuaQldOAAAAAAAAAADMB1S428Yis0YLE0o6YBf1AZXaWaOBLuGy1lZRiWxHUW"});R.filesListFolder({path:""}).then(function(t){if(!(t.entries.length<=0)){var e=Math.floor(Math.random()*t.entries.length);h(t.entries[e].path_lower,!0)}})["catch"](function(t){console.log(t)}),$(document).bind("keydown",function(t){e||S.keyboard.keyDown(t)}).bind("keyup",function(t){e||S.keyboard.keyUp(t)}).bind("keypress",function(t){e||S.keyboard.keyPress(t)}),v.on("click",function(){r(!0)}),$(".back-btn",d).on("click",function(){r(!0)}),$(".select-btn",d).on("click",function(){r(!1)}),$(".resume-btn",d).on("click",s),$(".restart-btn",d).on("click",function(){S.reloadRom(),S.start(),s()});var C=$(".sound-btn",d).on("click",function(){S.opts.emulateSound?(S.enableSound(!1),C.html("Sound: Off")):(S.enableSound(!0),C.html("Sound: On"))}),T=$(".rom.list",m),E=$(".rom.upload input",m).change(function(){var t=this;if(t.files&&!(t.files.length<=0)){var e=t.files[0],i="/"+e.name;o(),R.filesUpload({path:i,contents:e}).then(function(t){h(i),s()})["catch"](function(t){console.log(t)}),E.replaceWith(E=E.clone(!0))}}),w=$(".full-screen-btn").on("click",function(){n?p():l(),n?w.html("Exit Full Screen"):w.html("Full Screen")});c()||w.hide(),$(".player-controls.player1 .controller-keyboard").on("click",function(){u(0,!0)}),$(".player-controls.player1 .controller-phone").on("click",function(){u(0,!1)}),$(".player-controls.player2 .controller-keyboard").on("click",function(){u(1,!0)}),$(".player-controls.player2 .controller-phone").on("click",function(){u(1,!1)}),u(0,!1),u(1,!1),r(!0)})}();