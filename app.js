function DynamicAudio(e){return this instanceof arguments.callee?void("function"==typeof this.init&&this.init.apply(this,e&&e.callee?e:arguments)):new arguments.callee(arguments)}!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function i(e){var t=!!e&&"length"in e&&e.length,i=re.type(e);return"function"!==i&&!re.isWindow(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}function n(e,t,i){if(re.isFunction(t))return re.grep(e,function(e,n){return!!t.call(e,n,e)!==i});if(t.nodeType)return re.grep(e,function(e){return e===t!==i});if("string"==typeof t){if(me.test(t))return re.filter(t,e,i);t=re.filter(t,e)}return re.grep(e,function(e){return Q.call(t,e)>-1!==i})}function s(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function r(e){var t={};return re.each(e.match(Ce)||[],function(e,i){t[i]=!0}),t}function a(){$.removeEventListener("DOMContentLoaded",a),e.removeEventListener("load",a),re.ready()}function o(){this.expando=re.expando+o.uid++}function h(e,t,i){var n;if(void 0===i&&1===e.nodeType)if(n="data-"+t.replace(De,"-$&").toLowerCase(),i=e.getAttribute(n),"string"==typeof i){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:Ae.test(i)?re.parseJSON(i):i)}catch(s){}we.set(e,t,i)}else i=void 0;return i}function l(e,t,i,n){var s,r=1,a=20,o=n?function(){return n.cur()}:function(){return re.css(e,t,"")},h=o(),l=i&&i[3]||(re.cssNumber[t]?"":"px"),c=(re.cssNumber[t]||"px"!==l&&+h)&&Ie.exec(re.css(e,t));if(c&&c[3]!==l){l=l||c[3],i=i||[],c=+h||1;do r=r||".5",c/=r,re.style(e,t,c+l);while(r!==(r=o()/h)&&1!==r&&--a)}return i&&(c=+c||+h||0,s=i[1]?c+(i[1]+1)*i[2]:+i[2],n&&(n.unit=l,n.start=c,n.end=s)),s}function c(e,t){var i="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&re.nodeName(e,t)?re.merge([e],i):i}function u(e,t){for(var i=0,n=e.length;i<n;i++)Ee.set(e[i],"globalEval",!t||Ee.get(t[i],"globalEval"))}function p(e,t,i,n,s){for(var r,a,o,h,l,p,d=t.createDocumentFragment(),f=[],m=0,g=e.length;m<g;m++)if(r=e[m],r||0===r)if("object"===re.type(r))re.merge(f,r.nodeType?[r]:r);else if(Fe.test(r)){for(a=a||d.appendChild(t.createElement("div")),o=(Oe.exec(r)||["",""])[1].toLowerCase(),h=Le[o]||Le._default,a.innerHTML=h[1]+re.htmlPrefilter(r)+h[2],p=h[0];p--;)a=a.lastChild;re.merge(f,a.childNodes),a=d.firstChild,a.textContent=""}else f.push(t.createTextNode(r));for(d.textContent="",m=0;r=f[m++];)if(n&&re.inArray(r,n)>-1)s&&s.push(r);else if(l=re.contains(r.ownerDocument,r),a=c(d.appendChild(r),"script"),l&&u(a),i)for(p=0;r=a[p++];)Me.test(r.type||"")&&i.push(r);return d}function d(){return!0}function f(){return!1}function m(){try{return $.activeElement}catch(e){}}function g(e,t,i,n,s,r){var a,o;if("object"==typeof t){"string"!=typeof i&&(n=n||i,i=void 0);for(o in t)g(e,o,i,n,t[o],r);return e}if(null==n&&null==s?(s=i,n=i=void 0):null==s&&("string"==typeof i?(s=n,n=void 0):(s=n,n=i,i=void 0)),s===!1)s=f;else if(!s)return e;return 1===r&&(a=s,s=function(e){return re().off(e),a.apply(this,arguments)},s.guid=a.guid||(a.guid=re.guid++)),e.each(function(){re.event.add(this,t,s,n,i)})}function v(e,t){return re.nodeName(e,"table")&&re.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function y(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function S(e){var t=Ue.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function b(e,t){var i,n,s,r,a,o,h,l;if(1===t.nodeType){if(Ee.hasData(e)&&(r=Ee.access(e),a=Ee.set(t,r),l=r.events)){delete a.handle,a.events={};for(s in l)for(i=0,n=l[s].length;i<n;i++)re.event.add(t,s,l[s][i])}we.hasData(e)&&(o=we.access(e),h=re.extend({},o),we.set(t,h))}}function C(e,t){var i=t.nodeName.toLowerCase();"input"===i&&Pe.test(e.type)?t.checked=e.checked:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}function R(e,t,i,n){t=Z.apply([],t);var s,r,a,o,h,l,u=0,d=e.length,f=d-1,m=t[0],g=re.isFunction(m);if(g||d>1&&"string"==typeof m&&!ne.checkClone&&He.test(m))return e.each(function(s){var r=e.eq(s);g&&(t[0]=m.call(this,s,r.html())),R(r,t,i,n)});if(d&&(s=p(t,e[0].ownerDocument,!1,e,n),r=s.firstChild,1===s.childNodes.length&&(s=r),r||n)){for(a=re.map(c(s,"script"),y),o=a.length;u<d;u++)h=s,u!==f&&(h=re.clone(h,!0,!0),o&&re.merge(a,c(h,"script"))),i.call(e[u],h,u);if(o)for(l=a[a.length-1].ownerDocument,re.map(a,S),u=0;u<o;u++)h=a[u],Me.test(h.type||"")&&!Ee.access(h,"globalEval")&&re.contains(l,h)&&(h.src?re._evalUrl&&re._evalUrl(h.src):re.globalEval(h.textContent.replace(We,"")))}return e}function _(e,t,i){for(var n,s=t?re.filter(t,e):e,r=0;null!=(n=s[r]);r++)i||1!==n.nodeType||re.cleanData(c(n)),n.parentNode&&(i&&re.contains(n.ownerDocument,n)&&u(c(n,"script")),n.parentNode.removeChild(n));return e}function T(e,t){var i=re(t.createElement(e)).appendTo(t.body),n=re.css(i[0],"display");return i.detach(),n}function E(e){var t=$,i=Ye[e];return i||(i=T(e,t),"none"!==i&&i||(Xe=(Xe||re("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=Xe[0].contentDocument,t.write(),t.close(),i=T(e,t),Xe.detach()),Ye[e]=i),i}function w(e,t,i){var n,s,r,a,o=e.style;return i=i||Ke(e),a=i?i.getPropertyValue(t)||i[t]:void 0,""!==a&&void 0!==a||re.contains(e.ownerDocument,e)||(a=re.style(e,t)),i&&!ne.pixelMarginRight()&&$e.test(a)&&Je.test(t)&&(n=o.width,s=o.minWidth,r=o.maxWidth,o.minWidth=o.maxWidth=o.width=a,a=i.width,o.width=n,o.minWidth=s,o.maxWidth=r),void 0!==a?a+"":a}function A(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function D(e){if(e in nt)return e;for(var t=e[0].toUpperCase()+e.slice(1),i=it.length;i--;)if(e=it[i]+t,e in nt)return e}function N(e,t,i){var n=Ie.exec(t);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):t}function I(e,t,i,n,s){for(var r=i===(n?"border":"content")?4:"width"===t?1:0,a=0;r<4;r+=2)"margin"===i&&(a+=re.css(e,i+xe[r],!0,s)),n?("content"===i&&(a-=re.css(e,"padding"+xe[r],!0,s)),"margin"!==i&&(a-=re.css(e,"border"+xe[r]+"Width",!0,s))):(a+=re.css(e,"padding"+xe[r],!0,s),"padding"!==i&&(a+=re.css(e,"border"+xe[r]+"Width",!0,s)));return a}function x(e,t,i){var n=!0,s="width"===t?e.offsetWidth:e.offsetHeight,r=Ke(e),a="border-box"===re.css(e,"boxSizing",!1,r);if(s<=0||null==s){if(s=w(e,t,r),(s<0||null==s)&&(s=e.style[t]),$e.test(s))return s;n=a&&(ne.boxSizingReliable()||s===e.style[t]),s=parseFloat(s)||0}return s+I(e,t,i||(a?"border":"content"),n,r)+"px"}function k(e,t){for(var i,n,s,r=[],a=0,o=e.length;a<o;a++)n=e[a],n.style&&(r[a]=Ee.get(n,"olddisplay"),i=n.style.display,t?(r[a]||"none"!==i||(n.style.display=""),""===n.style.display&&ke(n)&&(r[a]=Ee.access(n,"olddisplay",E(n.nodeName)))):(s=ke(n),"none"===i&&s||Ee.set(n,"olddisplay",s?i:re.css(n,"display"))));for(a=0;a<o;a++)n=e[a],n.style&&(t&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=t?r[a]||"":"none"));return e}function P(e,t,i,n,s){return new P.prototype.init(e,t,i,n,s)}function O(){return e.setTimeout(function(){st=void 0}),st=re.now()}function M(e,t){var i,n=0,s={height:e};for(t=t?1:0;n<4;n+=2-t)i=xe[n],s["margin"+i]=s["padding"+i]=e;return t&&(s.opacity=s.width=e),s}function L(e,t,i){for(var n,s=(V.tweeners[t]||[]).concat(V.tweeners["*"]),r=0,a=s.length;r<a;r++)if(n=s[r].call(i,t,e))return n}function F(e,t,i){var n,s,r,a,o,h,l,c,u=this,p={},d=e.style,f=e.nodeType&&ke(e),m=Ee.get(e,"fxshow");i.queue||(o=re._queueHooks(e,"fx"),null==o.unqueued&&(o.unqueued=0,h=o.empty.fire,o.empty.fire=function(){o.unqueued||h()}),o.unqueued++,u.always(function(){u.always(function(){o.unqueued--,re.queue(e,"fx").length||o.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(i.overflow=[d.overflow,d.overflowX,d.overflowY],l=re.css(e,"display"),c="none"===l?Ee.get(e,"olddisplay")||E(e.nodeName):l,"inline"===c&&"none"===re.css(e,"float")&&(d.display="inline-block")),i.overflow&&(d.overflow="hidden",u.always(function(){d.overflow=i.overflow[0],d.overflowX=i.overflow[1],d.overflowY=i.overflow[2]}));for(n in t)if(s=t[n],at.exec(s)){if(delete t[n],r=r||"toggle"===s,s===(f?"hide":"show")){if("show"!==s||!m||void 0===m[n])continue;f=!0}p[n]=m&&m[n]||re.style(e,n)}else l=void 0;if(re.isEmptyObject(p))"inline"===("none"===l?E(e.nodeName):l)&&(d.display=l);else{m?"hidden"in m&&(f=m.hidden):m=Ee.access(e,"fxshow",{}),r&&(m.hidden=!f),f?re(e).show():u.done(function(){re(e).hide()}),u.done(function(){var t;Ee.remove(e,"fxshow");for(t in p)re.style(e,t,p[t])});for(n in p)a=L(f?m[n]:0,n,u),n in m||(m[n]=a.start,f&&(a.end=a.start,a.start="width"===n||"height"===n?1:0))}}function B(e,t){var i,n,s,r,a;for(i in e)if(n=re.camelCase(i),s=t[n],r=e[i],re.isArray(r)&&(s=r[1],r=e[i]=r[0]),i!==n&&(e[n]=r,delete e[i]),a=re.cssHooks[n],a&&"expand"in a){r=a.expand(r),delete e[n];for(i in r)i in e||(e[i]=r[i],t[i]=s)}else t[n]=s}function V(e,t,i){var n,s,r=0,a=V.prefilters.length,o=re.Deferred().always(function(){delete h.elem}),h=function(){if(s)return!1;for(var t=st||O(),i=Math.max(0,l.startTime+l.duration-t),n=i/l.duration||0,r=1-n,a=0,h=l.tweens.length;a<h;a++)l.tweens[a].run(r);return o.notifyWith(e,[l,r,i]),r<1&&h?i:(o.resolveWith(e,[l]),!1)},l=o.promise({elem:e,props:re.extend({},t),opts:re.extend(!0,{specialEasing:{},easing:re.easing._default},i),originalProperties:t,originalOptions:i,startTime:st||O(),duration:i.duration,tweens:[],createTween:function(t,i){var n=re.Tween(e,l.opts,t,i,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(n),n},stop:function(t){var i=0,n=t?l.tweens.length:0;if(s)return this;for(s=!0;i<n;i++)l.tweens[i].run(1);return t?(o.notifyWith(e,[l,1,0]),o.resolveWith(e,[l,t])):o.rejectWith(e,[l,t]),this}}),c=l.props;for(B(c,l.opts.specialEasing);r<a;r++)if(n=V.prefilters[r].call(l,e,c,l.opts))return re.isFunction(n.stop)&&(re._queueHooks(l.elem,l.opts.queue).stop=re.proxy(n.stop,n)),n;return re.map(c,L,l),re.isFunction(l.opts.start)&&l.opts.start.call(e,l),re.fx.timer(re.extend(h,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function q(e){return e.getAttribute&&e.getAttribute("class")||""}function G(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,s=0,r=t.toLowerCase().match(Ce)||[];if(re.isFunction(i))for(;n=r[s++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(i)):(e[n]=e[n]||[]).push(i)}}function j(e,t,i,n){function s(o){var h;return r[o]=!0,re.each(e[o]||[],function(e,o){var l=o(t,i,n);return"string"!=typeof l||a||r[l]?a?!(h=l):void 0:(t.dataTypes.unshift(l),s(l),!1)}),h}var r={},a=e===wt;return s(t.dataTypes[0])||!r["*"]&&s("*")}function H(e,t){var i,n,s=re.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((s[i]?e:n||(n={}))[i]=t[i]);return n&&re.extend(!0,e,n),e}function U(e,t,i){for(var n,s,r,a,o=e.contents,h=e.dataTypes;"*"===h[0];)h.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(s in o)if(o[s]&&o[s].test(n)){h.unshift(s);break}if(h[0]in i)r=h[0];else{for(s in i){if(!h[0]||e.converters[s+" "+h[0]]){r=s;break}a||(a=s)}r=r||a}if(r)return r!==h[0]&&h.unshift(r),i[r]}function W(e,t,i,n){var s,r,a,o,h,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];for(r=c.shift();r;)if(e.responseFields[r]&&(i[e.responseFields[r]]=t),!h&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),h=r,r=c.shift())if("*"===r)r=h;else if("*"!==h&&h!==r){if(a=l[h+" "+r]||l["* "+r],!a)for(s in l)if(o=s.split(" "),o[1]===r&&(a=l[h+" "+o[0]]||l["* "+o[0]])){a===!0?a=l[s]:l[s]!==!0&&(r=o[0],c.unshift(o[1]));break}if(a!==!0)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(u){return{state:"parsererror",error:a?u:"No conversion from "+h+" to "+r}}}return{state:"success",data:t}}function X(e,t,i,n){var s;if(re.isArray(t))re.each(t,function(t,s){i||It.test(e)?n(e,s):X(e+"["+("object"==typeof s&&null!=s?t:"")+"]",s,i,n)});else if(i||"object"!==re.type(t))n(e,t);else for(s in t)X(e+"["+s+"]",t[s],i,n)}function Y(e){return re.isWindow(e)?e:9===e.nodeType&&e.defaultView}var J=[],$=e.document,K=J.slice,Z=J.concat,z=J.push,Q=J.indexOf,ee={},te=ee.toString,ie=ee.hasOwnProperty,ne={},se="2.2.4",re=function(e,t){return new re.fn.init(e,t)},ae=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,oe=/^-ms-/,he=/-([\da-z])/gi,le=function(e,t){return t.toUpperCase()};re.fn=re.prototype={jquery:se,constructor:re,selector:"",length:0,toArray:function(){return K.call(this)},get:function(e){return null!=e?e<0?this[e+this.length]:this[e]:K.call(this)},pushStack:function(e){var t=re.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e){return re.each(this,e)},map:function(e){return this.pushStack(re.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(K.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(e<0?t:0);return this.pushStack(i>=0&&i<t?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:z,sort:J.sort,splice:J.splice},re.extend=re.fn.extend=function(){var e,t,i,n,s,r,a=arguments[0]||{},o=1,h=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[o]||{},o++),"object"==typeof a||re.isFunction(a)||(a={}),o===h&&(a=this,o--);o<h;o++)if(null!=(e=arguments[o]))for(t in e)i=a[t],n=e[t],a!==n&&(l&&n&&(re.isPlainObject(n)||(s=re.isArray(n)))?(s?(s=!1,r=i&&re.isArray(i)?i:[]):r=i&&re.isPlainObject(i)?i:{},a[t]=re.extend(l,r,n)):void 0!==n&&(a[t]=n));return a},re.extend({expando:"jQuery"+(se+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===re.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=e&&e.toString();return!re.isArray(e)&&t-parseFloat(t)+1>=0},isPlainObject:function(e){var t;if("object"!==re.type(e)||e.nodeType||re.isWindow(e))return!1;if(e.constructor&&!ie.call(e,"constructor")&&!ie.call(e.constructor.prototype||{},"isPrototypeOf"))return!1;for(t in e);return void 0===t||ie.call(e,t)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?ee[te.call(e)]||"object":typeof e},globalEval:function(e){var t,i=eval;e=re.trim(e),e&&(1===e.indexOf("use strict")?(t=$.createElement("script"),t.text=e,$.head.appendChild(t).parentNode.removeChild(t)):i(e))},camelCase:function(e){return e.replace(oe,"ms-").replace(he,le)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var n,s=0;if(i(e))for(n=e.length;s<n&&t.call(e[s],s,e[s])!==!1;s++);else for(s in e)if(t.call(e[s],s,e[s])===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(ae,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(i(Object(e))?re.merge(n,"string"==typeof e?[e]:e):z.call(n,e)),n},inArray:function(e,t,i){return null==t?-1:Q.call(t,e,i)},merge:function(e,t){for(var i=+t.length,n=0,s=e.length;n<i;n++)e[s++]=t[n];return e.length=s,e},grep:function(e,t,i){for(var n,s=[],r=0,a=e.length,o=!i;r<a;r++)n=!t(e[r],r),n!==o&&s.push(e[r]);return s},map:function(e,t,n){var s,r,a=0,o=[];if(i(e))for(s=e.length;a<s;a++)r=t(e[a],a,n),null!=r&&o.push(r);else for(a in e)r=t(e[a],a,n),null!=r&&o.push(r);return Z.apply([],o)},guid:1,proxy:function(e,t){var i,n,s;if("string"==typeof t&&(i=e[t],t=e,e=i),re.isFunction(e))return n=K.call(arguments,2),s=function(){return e.apply(t||this,n.concat(K.call(arguments)))},s.guid=e.guid=e.guid||re.guid++,s},now:Date.now,support:ne}),"function"==typeof Symbol&&(re.fn[Symbol.iterator]=J[Symbol.iterator]),re.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){ee["[object "+t+"]"]=t.toLowerCase()});var ce=function(e){function t(e,t,i,n){var s,r,a,o,h,l,u,d,f=t&&t.ownerDocument,m=t?t.nodeType:9;if(i=i||[],"string"!=typeof e||!e||1!==m&&9!==m&&11!==m)return i;if(!n&&((t?t.ownerDocument||t:q)!==k&&x(t),t=t||k,O)){if(11!==m&&(l=ve.exec(e)))if(s=l[1]){if(9===m){if(!(a=t.getElementById(s)))return i;if(a.id===s)return i.push(a),i}else if(f&&(a=f.getElementById(s))&&B(t,a)&&a.id===s)return i.push(a),i}else{if(l[2])return z.apply(i,t.getElementsByTagName(e)),i;if((s=l[3])&&C.getElementsByClassName&&t.getElementsByClassName)return z.apply(i,t.getElementsByClassName(s)),i}if(C.qsa&&!W[e+" "]&&(!M||!M.test(e))){if(1!==m)f=t,d=e;else if("object"!==t.nodeName.toLowerCase()){for((o=t.getAttribute("id"))?o=o.replace(Se,"\\$&"):t.setAttribute("id",o=V),u=E(e),r=u.length,h=pe.test(o)?"#"+o:"[id='"+o+"']";r--;)u[r]=h+" "+p(u[r]);d=u.join(","),f=ye.test(e)&&c(t.parentNode)||t}if(d)try{return z.apply(i,f.querySelectorAll(d)),i}catch(g){}finally{o===V&&t.removeAttribute("id")}}}return A(e.replace(oe,"$1"),t,i,n)}function i(){function e(i,n){return t.push(i+" ")>R.cacheLength&&delete e[t.shift()],e[i+" "]=n}var t=[];return e}function n(e){return e[V]=!0,e}function s(e){var t=k.createElement("div");try{return!!e(t)}catch(i){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function r(e,t){for(var i=e.split("|"),n=i.length;n--;)R.attrHandle[i[n]]=t}function a(e,t){var i=t&&e,n=i&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||Y)-(~e.sourceIndex||Y);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function o(e){return function(t){var i=t.nodeName.toLowerCase();return"input"===i&&t.type===e}}function h(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function l(e){return n(function(t){return t=+t,n(function(i,n){for(var s,r=e([],i.length,t),a=r.length;a--;)i[s=r[a]]&&(i[s]=!(n[s]=i[s]))})})}function c(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function u(){}function p(e){for(var t=0,i=e.length,n="";t<i;t++)n+=e[t].value;return n}function d(e,t,i){var n=t.dir,s=i&&"parentNode"===n,r=j++;return t.first?function(t,i,r){for(;t=t[n];)if(1===t.nodeType||s)return e(t,i,r)}:function(t,i,a){var o,h,l,c=[G,r];if(a){for(;t=t[n];)if((1===t.nodeType||s)&&e(t,i,a))return!0}else for(;t=t[n];)if(1===t.nodeType||s){if(l=t[V]||(t[V]={}),h=l[t.uniqueID]||(l[t.uniqueID]={}),(o=h[n])&&o[0]===G&&o[1]===r)return c[2]=o[2];if(h[n]=c,c[2]=e(t,i,a))return!0}}}function f(e){return e.length>1?function(t,i,n){for(var s=e.length;s--;)if(!e[s](t,i,n))return!1;return!0}:e[0]}function m(e,i,n){for(var s=0,r=i.length;s<r;s++)t(e,i[s],n);return n}function g(e,t,i,n,s){for(var r,a=[],o=0,h=e.length,l=null!=t;o<h;o++)(r=e[o])&&(i&&!i(r,n,s)||(a.push(r),l&&t.push(o)));return a}function v(e,t,i,s,r,a){return s&&!s[V]&&(s=v(s)),r&&!r[V]&&(r=v(r,a)),n(function(n,a,o,h){var l,c,u,p=[],d=[],f=a.length,v=n||m(t||"*",o.nodeType?[o]:o,[]),y=!e||!n&&t?v:g(v,p,e,o,h),S=i?r||(n?e:f||s)?[]:a:y;if(i&&i(y,S,o,h),s)for(l=g(S,d),s(l,[],o,h),c=l.length;c--;)(u=l[c])&&(S[d[c]]=!(y[d[c]]=u));if(n){if(r||e){if(r){for(l=[],c=S.length;c--;)(u=S[c])&&l.push(y[c]=u);r(null,S=[],l,h)}for(c=S.length;c--;)(u=S[c])&&(l=r?ee(n,u):p[c])>-1&&(n[l]=!(a[l]=u))}}else S=g(S===a?S.splice(f,S.length):S),r?r(null,a,S,h):z.apply(a,S)})}function y(e){for(var t,i,n,s=e.length,r=R.relative[e[0].type],a=r||R.relative[" "],o=r?1:0,h=d(function(e){return e===t},a,!0),l=d(function(e){return ee(t,e)>-1},a,!0),c=[function(e,i,n){var s=!r&&(n||i!==D)||((t=i).nodeType?h(e,i,n):l(e,i,n));return t=null,s}];o<s;o++)if(i=R.relative[e[o].type])c=[d(f(c),i)];else{if(i=R.filter[e[o].type].apply(null,e[o].matches),i[V]){for(n=++o;n<s&&!R.relative[e[n].type];n++);return v(o>1&&f(c),o>1&&p(e.slice(0,o-1).concat({value:" "===e[o-2].type?"*":""})).replace(oe,"$1"),i,o<n&&y(e.slice(o,n)),n<s&&y(e=e.slice(n)),n<s&&p(e))}c.push(i)}return f(c)}function S(e,i){var s=i.length>0,r=e.length>0,a=function(n,a,o,h,l){var c,u,p,d=0,f="0",m=n&&[],v=[],y=D,S=n||r&&R.find.TAG("*",l),b=G+=null==y?1:Math.random()||.1,C=S.length;for(l&&(D=a===k||a||l);f!==C&&null!=(c=S[f]);f++){if(r&&c){for(u=0,a||c.ownerDocument===k||(x(c),o=!O);p=e[u++];)if(p(c,a||k,o)){h.push(c);break}l&&(G=b)}s&&((c=!p&&c)&&d--,n&&m.push(c))}if(d+=f,s&&f!==d){for(u=0;p=i[u++];)p(m,v,a,o);if(n){if(d>0)for(;f--;)m[f]||v[f]||(v[f]=K.call(h));v=g(v)}z.apply(h,v),l&&!n&&v.length>0&&d+i.length>1&&t.uniqueSort(h)}return l&&(G=b,D=y),m};return s?n(a):a}var b,C,R,_,T,E,w,A,D,N,I,x,k,P,O,M,L,F,B,V="sizzle"+1*new Date,q=e.document,G=0,j=0,H=i(),U=i(),W=i(),X=function(e,t){return e===t&&(I=!0),0},Y=1<<31,J={}.hasOwnProperty,$=[],K=$.pop,Z=$.push,z=$.push,Q=$.slice,ee=function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ie="[\\x20\\t\\r\\n\\f]",ne="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",se="\\["+ie+"*("+ne+")(?:"+ie+"*([*^$|!~]?=)"+ie+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ne+"))|)"+ie+"*\\]",re=":("+ne+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+se+")*)|.*)\\)|)",ae=new RegExp(ie+"+","g"),oe=new RegExp("^"+ie+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ie+"+$","g"),he=new RegExp("^"+ie+"*,"+ie+"*"),le=new RegExp("^"+ie+"*([>+~]|"+ie+")"+ie+"*"),ce=new RegExp("="+ie+"*([^\\]'\"]*?)"+ie+"*\\]","g"),ue=new RegExp(re),pe=new RegExp("^"+ne+"$"),de={ID:new RegExp("^#("+ne+")"),CLASS:new RegExp("^\\.("+ne+")"),TAG:new RegExp("^("+ne+"|[*])"),ATTR:new RegExp("^"+se),PSEUDO:new RegExp("^"+re),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ie+"*(even|odd|(([+-]|)(\\d*)n|)"+ie+"*(?:([+-]|)"+ie+"*(\\d+)|))"+ie+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+ie+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ie+"*((?:-\\d)?\\d*)"+ie+"*\\)|)(?=[^-]|$)","i")},fe=/^(?:input|select|textarea|button)$/i,me=/^h\d$/i,ge=/^[^{]+\{\s*\[native \w/,ve=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,Se=/'|\\/g,be=new RegExp("\\\\([\\da-f]{1,6}"+ie+"?|("+ie+")|.)","ig"),Ce=function(e,t,i){var n="0x"+t-65536;return n!==n||i?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},Re=function(){x()};try{z.apply($=Q.call(q.childNodes),q.childNodes),$[q.childNodes.length].nodeType}catch(_e){z={apply:$.length?function(e,t){Z.apply(e,Q.call(t))}:function(e,t){for(var i=e.length,n=0;e[i++]=t[n++];);e.length=i-1}}}C=t.support={},T=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},x=t.setDocument=function(e){var t,i,n=e?e.ownerDocument||e:q;return n!==k&&9===n.nodeType&&n.documentElement?(k=n,P=k.documentElement,O=!T(k),(i=k.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",Re,!1):i.attachEvent&&i.attachEvent("onunload",Re)),C.attributes=s(function(e){return e.className="i",!e.getAttribute("className")}),C.getElementsByTagName=s(function(e){return e.appendChild(k.createComment("")),!e.getElementsByTagName("*").length}),C.getElementsByClassName=ge.test(k.getElementsByClassName),C.getById=s(function(e){return P.appendChild(e).id=V,!k.getElementsByName||!k.getElementsByName(V).length}),C.getById?(R.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&O){var i=t.getElementById(e);return i?[i]:[]}},R.filter.ID=function(e){var t=e.replace(be,Ce);return function(e){return e.getAttribute("id")===t}}):(delete R.find.ID,R.filter.ID=function(e){var t=e.replace(be,Ce);return function(e){var i="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}}),R.find.TAG=C.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):C.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,n=[],s=0,r=t.getElementsByTagName(e);if("*"===e){for(;i=r[s++];)1===i.nodeType&&n.push(i);return n}return r},R.find.CLASS=C.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&O)return t.getElementsByClassName(e)},L=[],M=[],(C.qsa=ge.test(k.querySelectorAll))&&(s(function(e){P.appendChild(e).innerHTML="<a id='"+V+"'></a><select id='"+V+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&M.push("[*^$]="+ie+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||M.push("\\["+ie+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+V+"-]").length||M.push("~="),e.querySelectorAll(":checked").length||M.push(":checked"),e.querySelectorAll("a#"+V+"+*").length||M.push(".#.+[+~]")}),s(function(e){var t=k.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&M.push("name"+ie+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||M.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),M.push(",.*:")})),(C.matchesSelector=ge.test(F=P.matches||P.webkitMatchesSelector||P.mozMatchesSelector||P.oMatchesSelector||P.msMatchesSelector))&&s(function(e){C.disconnectedMatch=F.call(e,"div"),F.call(e,"[s!='']:x"),L.push("!=",re)}),M=M.length&&new RegExp(M.join("|")),L=L.length&&new RegExp(L.join("|")),t=ge.test(P.compareDocumentPosition),B=t||ge.test(P.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},X=t?function(e,t){if(e===t)return I=!0,0;var i=!e.compareDocumentPosition-!t.compareDocumentPosition;return i?i:(i=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&i||!C.sortDetached&&t.compareDocumentPosition(e)===i?e===k||e.ownerDocument===q&&B(q,e)?-1:t===k||t.ownerDocument===q&&B(q,t)?1:N?ee(N,e)-ee(N,t):0:4&i?-1:1)}:function(e,t){if(e===t)return I=!0,0;var i,n=0,s=e.parentNode,r=t.parentNode,o=[e],h=[t];if(!s||!r)return e===k?-1:t===k?1:s?-1:r?1:N?ee(N,e)-ee(N,t):0;if(s===r)return a(e,t);for(i=e;i=i.parentNode;)o.unshift(i);for(i=t;i=i.parentNode;)h.unshift(i);for(;o[n]===h[n];)n++;return n?a(o[n],h[n]):o[n]===q?-1:h[n]===q?1:0},k):k},t.matches=function(e,i){return t(e,null,null,i)},t.matchesSelector=function(e,i){if((e.ownerDocument||e)!==k&&x(e),i=i.replace(ce,"='$1']"),C.matchesSelector&&O&&!W[i+" "]&&(!L||!L.test(i))&&(!M||!M.test(i)))try{var n=F.call(e,i);if(n||C.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(s){}return t(i,k,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==k&&x(e),B(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==k&&x(e);var i=R.attrHandle[t.toLowerCase()],n=i&&J.call(R.attrHandle,t.toLowerCase())?i(e,t,!O):void 0;return void 0!==n?n:C.attributes||!O?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,i=[],n=0,s=0;if(I=!C.detectDuplicates,N=!C.sortStable&&e.slice(0),e.sort(X),I){for(;t=e[s++];)t===e[s]&&(n=i.push(s));for(;n--;)e.splice(i[n],1)}return N=null,e},_=t.getText=function(e){var t,i="",n=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=_(e)}else if(3===s||4===s)return e.nodeValue}else for(;t=e[n++];)i+=_(t);return i},R=t.selectors={cacheLength:50,createPseudo:n,match:de,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(be,Ce),e[3]=(e[3]||e[4]||e[5]||"").replace(be,Ce),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return de.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&ue.test(i)&&(t=E(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(be,Ce).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=H[e+" "];return t||(t=new RegExp("(^|"+ie+")"+e+"("+ie+"|$)"))&&H(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,i,n){return function(s){var r=t.attr(s,e);return null==r?"!="===i:!i||(r+="","="===i?r===n:"!="===i?r!==n:"^="===i?n&&0===r.indexOf(n):"*="===i?n&&r.indexOf(n)>-1:"$="===i?n&&r.slice(-n.length)===n:"~="===i?(" "+r.replace(ae," ")+" ").indexOf(n)>-1:"|="===i&&(r===n||r.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,i,n,s){var r="nth"!==e.slice(0,3),a="last"!==e.slice(-4),o="of-type"===t;return 1===n&&0===s?function(e){return!!e.parentNode}:function(t,i,h){var l,c,u,p,d,f,m=r!==a?"nextSibling":"previousSibling",g=t.parentNode,v=o&&t.nodeName.toLowerCase(),y=!h&&!o,S=!1;if(g){if(r){for(;m;){for(p=t;p=p[m];)if(o?p.nodeName.toLowerCase()===v:1===p.nodeType)return!1;f=m="only"===e&&!f&&"nextSibling"}return!0}if(f=[a?g.firstChild:g.lastChild],a&&y){for(p=g,u=p[V]||(p[V]={}),c=u[p.uniqueID]||(u[p.uniqueID]={}),l=c[e]||[],d=l[0]===G&&l[1],S=d&&l[2],p=d&&g.childNodes[d];p=++d&&p&&p[m]||(S=d=0)||f.pop();)if(1===p.nodeType&&++S&&p===t){c[e]=[G,d,S];break}}else if(y&&(p=t,u=p[V]||(p[V]={}),c=u[p.uniqueID]||(u[p.uniqueID]={}),l=c[e]||[],d=l[0]===G&&l[1],S=d),S===!1)for(;(p=++d&&p&&p[m]||(S=d=0)||f.pop())&&((o?p.nodeName.toLowerCase()!==v:1!==p.nodeType)||!++S||(y&&(u=p[V]||(p[V]={}),c=u[p.uniqueID]||(u[p.uniqueID]={}),c[e]=[G,S]),p!==t)););return S-=s,S===n||S%n===0&&S/n>=0}}},PSEUDO:function(e,i){var s,r=R.pseudos[e]||R.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return r[V]?r(i):r.length>1?(s=[e,e,"",i],R.setFilters.hasOwnProperty(e.toLowerCase())?n(function(e,t){for(var n,s=r(e,i),a=s.length;a--;)n=ee(e,s[a]),e[n]=!(t[n]=s[a])}):function(e){return r(e,0,s)}):r}},pseudos:{not:n(function(e){var t=[],i=[],s=w(e.replace(oe,"$1"));return s[V]?n(function(e,t,i,n){for(var r,a=s(e,null,n,[]),o=e.length;o--;)(r=a[o])&&(e[o]=!(t[o]=r))}):function(e,n,r){return t[0]=e,s(t,null,r,i),t[0]=null,!i.pop()}}),has:n(function(e){return function(i){return t(e,i).length>0}}),contains:n(function(e){return e=e.replace(be,Ce),function(t){return(t.textContent||t.innerText||_(t)).indexOf(e)>-1}}),lang:n(function(e){return pe.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(be,Ce).toLowerCase(),function(t){var i;do if(i=O?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return i=i.toLowerCase(),i===e||0===i.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===P},focus:function(e){return e===k.activeElement&&(!k.hasFocus||k.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!R.pseudos.empty(e)},header:function(e){return me.test(e.nodeName)},input:function(e){return fe.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:l(function(){
return[0]}),last:l(function(e,t){return[t-1]}),eq:l(function(e,t,i){return[i<0?i+t:i]}),even:l(function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e}),odd:l(function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e}),lt:l(function(e,t,i){for(var n=i<0?i+t:i;--n>=0;)e.push(n);return e}),gt:l(function(e,t,i){for(var n=i<0?i+t:i;++n<t;)e.push(n);return e})}},R.pseudos.nth=R.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})R.pseudos[b]=o(b);for(b in{submit:!0,reset:!0})R.pseudos[b]=h(b);return u.prototype=R.filters=R.pseudos,R.setFilters=new u,E=t.tokenize=function(e,i){var n,s,r,a,o,h,l,c=U[e+" "];if(c)return i?0:c.slice(0);for(o=e,h=[],l=R.preFilter;o;){n&&!(s=he.exec(o))||(s&&(o=o.slice(s[0].length)||o),h.push(r=[])),n=!1,(s=le.exec(o))&&(n=s.shift(),r.push({value:n,type:s[0].replace(oe," ")}),o=o.slice(n.length));for(a in R.filter)!(s=de[a].exec(o))||l[a]&&!(s=l[a](s))||(n=s.shift(),r.push({value:n,type:a,matches:s}),o=o.slice(n.length));if(!n)break}return i?o.length:o?t.error(e):U(e,h).slice(0)},w=t.compile=function(e,t){var i,n=[],s=[],r=W[e+" "];if(!r){for(t||(t=E(e)),i=t.length;i--;)r=y(t[i]),r[V]?n.push(r):s.push(r);r=W(e,S(s,n)),r.selector=e}return r},A=t.select=function(e,t,i,n){var s,r,a,o,h,l="function"==typeof e&&e,u=!n&&E(e=l.selector||e);if(i=i||[],1===u.length){if(r=u[0]=u[0].slice(0),r.length>2&&"ID"===(a=r[0]).type&&C.getById&&9===t.nodeType&&O&&R.relative[r[1].type]){if(t=(R.find.ID(a.matches[0].replace(be,Ce),t)||[])[0],!t)return i;l&&(t=t.parentNode),e=e.slice(r.shift().value.length)}for(s=de.needsContext.test(e)?0:r.length;s--&&(a=r[s],!R.relative[o=a.type]);)if((h=R.find[o])&&(n=h(a.matches[0].replace(be,Ce),ye.test(r[0].type)&&c(t.parentNode)||t))){if(r.splice(s,1),e=n.length&&p(r),!e)return z.apply(i,n),i;break}}return(l||w(e,u))(n,t,!O,i,!t||ye.test(e)&&c(t.parentNode)||t),i},C.sortStable=V.split("").sort(X).join("")===V,C.detectDuplicates=!!I,x(),C.sortDetached=s(function(e){return 1&e.compareDocumentPosition(k.createElement("div"))}),s(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||r("type|href|height|width",function(e,t,i){if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),C.attributes&&s(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||r("value",function(e,t,i){if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),s(function(e){return null==e.getAttribute("disabled")})||r(te,function(e,t,i){var n;if(!i)return e[t]===!0?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null}),t}(e);re.find=ce,re.expr=ce.selectors,re.expr[":"]=re.expr.pseudos,re.uniqueSort=re.unique=ce.uniqueSort,re.text=ce.getText,re.isXMLDoc=ce.isXML,re.contains=ce.contains;var ue=function(e,t,i){for(var n=[],s=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(s&&re(e).is(i))break;n.push(e)}return n},pe=function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},de=re.expr.match.needsContext,fe=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,me=/^.[^:#\[\.,]*$/;re.filter=function(e,t,i){var n=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?re.find.matchesSelector(n,e)?[n]:[]:re.find.matches(e,re.grep(t,function(e){return 1===e.nodeType}))},re.fn.extend({find:function(e){var t,i=this.length,n=[],s=this;if("string"!=typeof e)return this.pushStack(re(e).filter(function(){for(t=0;t<i;t++)if(re.contains(s[t],this))return!0}));for(t=0;t<i;t++)re.find(e,s[t],n);return n=this.pushStack(i>1?re.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(n(this,e||[],!1))},not:function(e){return this.pushStack(n(this,e||[],!0))},is:function(e){return!!n(this,"string"==typeof e&&de.test(e)?re(e):e||[],!1).length}});var ge,ve=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ye=re.fn.init=function(e,t,i){var n,s;if(!e)return this;if(i=i||ge,"string"==typeof e){if(n="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:ve.exec(e),!n||!n[1]&&t)return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof re?t[0]:t,re.merge(this,re.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:$,!0)),fe.test(n[1])&&re.isPlainObject(t))for(n in t)re.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return s=$.getElementById(n[2]),s&&s.parentNode&&(this.length=1,this[0]=s),this.context=$,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):re.isFunction(e)?void 0!==i.ready?i.ready(e):e(re):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),re.makeArray(e,this))};ye.prototype=re.fn,ge=re($);var Se=/^(?:parents|prev(?:Until|All))/,be={children:!0,contents:!0,next:!0,prev:!0};re.fn.extend({has:function(e){var t=re(e,this),i=t.length;return this.filter(function(){for(var e=0;e<i;e++)if(re.contains(this,t[e]))return!0})},closest:function(e,t){for(var i,n=0,s=this.length,r=[],a=de.test(e)||"string"!=typeof e?re(e,t||this.context):0;n<s;n++)for(i=this[n];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(a?a.index(i)>-1:1===i.nodeType&&re.find.matchesSelector(i,e))){r.push(i);break}return this.pushStack(r.length>1?re.uniqueSort(r):r)},index:function(e){return e?"string"==typeof e?Q.call(re(e),this[0]):Q.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(re.uniqueSort(re.merge(this.get(),re(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),re.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return ue(e,"parentNode")},parentsUntil:function(e,t,i){return ue(e,"parentNode",i)},next:function(e){return s(e,"nextSibling")},prev:function(e){return s(e,"previousSibling")},nextAll:function(e){return ue(e,"nextSibling")},prevAll:function(e){return ue(e,"previousSibling")},nextUntil:function(e,t,i){return ue(e,"nextSibling",i)},prevUntil:function(e,t,i){return ue(e,"previousSibling",i)},siblings:function(e){return pe((e.parentNode||{}).firstChild,e)},children:function(e){return pe(e.firstChild)},contents:function(e){return e.contentDocument||re.merge([],e.childNodes)}},function(e,t){re.fn[e]=function(i,n){var s=re.map(this,t,i);return"Until"!==e.slice(-5)&&(n=i),n&&"string"==typeof n&&(s=re.filter(n,s)),this.length>1&&(be[e]||re.uniqueSort(s),Se.test(e)&&s.reverse()),this.pushStack(s)}});var Ce=/\S+/g;re.Callbacks=function(e){e="string"==typeof e?r(e):re.extend({},e);var t,i,n,s,a=[],o=[],h=-1,l=function(){for(s=e.once,n=t=!0;o.length;h=-1)for(i=o.shift();++h<a.length;)a[h].apply(i[0],i[1])===!1&&e.stopOnFalse&&(h=a.length,i=!1);e.memory||(i=!1),t=!1,s&&(a=i?[]:"")},c={add:function(){return a&&(i&&!t&&(h=a.length-1,o.push(i)),function n(t){re.each(t,function(t,i){re.isFunction(i)?e.unique&&c.has(i)||a.push(i):i&&i.length&&"string"!==re.type(i)&&n(i)})}(arguments),i&&!t&&l()),this},remove:function(){return re.each(arguments,function(e,t){for(var i;(i=re.inArray(t,a,i))>-1;)a.splice(i,1),i<=h&&h--}),this},has:function(e){return e?re.inArray(e,a)>-1:a.length>0},empty:function(){return a&&(a=[]),this},disable:function(){return s=o=[],a=i="",this},disabled:function(){return!a},lock:function(){return s=o=[],i||(a=i=""),this},locked:function(){return!!s},fireWith:function(e,i){return s||(i=i||[],i=[e,i.slice?i.slice():i],o.push(i),t||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!n}};return c},re.extend({Deferred:function(e){var t=[["resolve","done",re.Callbacks("once memory"),"resolved"],["reject","fail",re.Callbacks("once memory"),"rejected"],["notify","progress",re.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var e=arguments;return re.Deferred(function(i){re.each(t,function(t,r){var a=re.isFunction(e[t])&&e[t];s[r[1]](function(){var e=a&&a.apply(this,arguments);e&&re.isFunction(e.promise)?e.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[r[0]+"With"](this===n?i.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?re.extend(e,n):n}},s={};return n.pipe=n.then,re.each(t,function(e,r){var a=r[2],o=r[3];n[r[1]]=a.add,o&&a.add(function(){i=o},t[1^e][2].disable,t[2][2].lock),s[r[0]]=function(){return s[r[0]+"With"](this===s?n:this,arguments),this},s[r[0]+"With"]=a.fireWith}),n.promise(s),e&&e.call(s,s),s},when:function(e){var t,i,n,s=0,r=K.call(arguments),a=r.length,o=1!==a||e&&re.isFunction(e.promise)?a:0,h=1===o?e:re.Deferred(),l=function(e,i,n){return function(s){i[e]=this,n[e]=arguments.length>1?K.call(arguments):s,n===t?h.notifyWith(i,n):--o||h.resolveWith(i,n)}};if(a>1)for(t=new Array(a),i=new Array(a),n=new Array(a);s<a;s++)r[s]&&re.isFunction(r[s].promise)?r[s].promise().progress(l(s,i,t)).done(l(s,n,r)).fail(h.reject):--o;return o||h.resolveWith(n,r),h.promise()}});var Re;re.fn.ready=function(e){return re.ready.promise().done(e),this},re.extend({isReady:!1,readyWait:1,holdReady:function(e){e?re.readyWait++:re.ready(!0)},ready:function(e){(e===!0?--re.readyWait:re.isReady)||(re.isReady=!0,e!==!0&&--re.readyWait>0||(Re.resolveWith($,[re]),re.fn.triggerHandler&&(re($).triggerHandler("ready"),re($).off("ready"))))}}),re.ready.promise=function(t){return Re||(Re=re.Deferred(),"complete"===$.readyState||"loading"!==$.readyState&&!$.documentElement.doScroll?e.setTimeout(re.ready):($.addEventListener("DOMContentLoaded",a),e.addEventListener("load",a))),Re.promise(t)},re.ready.promise();var _e=function(e,t,i,n,s,r,a){var o=0,h=e.length,l=null==i;if("object"===re.type(i)){s=!0;for(o in i)_e(e,t,o,i[o],!0,r,a)}else if(void 0!==n&&(s=!0,re.isFunction(n)||(a=!0),l&&(a?(t.call(e,n),t=null):(l=t,t=function(e,t,i){return l.call(re(e),i)})),t))for(;o<h;o++)t(e[o],i,a?n:n.call(e[o],o,t(e[o],i)));return s?e:l?t.call(e):h?t(e[0],i):r},Te=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};o.uid=1,o.prototype={register:function(e,t){var i=t||{};return e.nodeType?e[this.expando]=i:Object.defineProperty(e,this.expando,{value:i,writable:!0,configurable:!0}),e[this.expando]},cache:function(e){if(!Te(e))return{};var t=e[this.expando];return t||(t={},Te(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,i){var n,s=this.cache(e);if("string"==typeof t)s[t]=i;else for(n in t)s[n]=t[n];return s},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][t]},access:function(e,t,i){var n;return void 0===t||t&&"string"==typeof t&&void 0===i?(n=this.get(e,t),void 0!==n?n:this.get(e,re.camelCase(t))):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,n,s,r=e[this.expando];if(void 0!==r){if(void 0===t)this.register(e);else{re.isArray(t)?n=t.concat(t.map(re.camelCase)):(s=re.camelCase(t),t in r?n=[t,s]:(n=s,n=n in r?[n]:n.match(Ce)||[])),i=n.length;for(;i--;)delete r[n[i]]}(void 0===t||re.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!re.isEmptyObject(t)}};var Ee=new o,we=new o,Ae=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,De=/[A-Z]/g;re.extend({hasData:function(e){return we.hasData(e)||Ee.hasData(e)},data:function(e,t,i){return we.access(e,t,i)},removeData:function(e,t){we.remove(e,t)},_data:function(e,t,i){return Ee.access(e,t,i)},_removeData:function(e,t){Ee.remove(e,t)}}),re.fn.extend({data:function(e,t){var i,n,s,r=this[0],a=r&&r.attributes;if(void 0===e){if(this.length&&(s=we.get(r),1===r.nodeType&&!Ee.get(r,"hasDataAttrs"))){for(i=a.length;i--;)a[i]&&(n=a[i].name,0===n.indexOf("data-")&&(n=re.camelCase(n.slice(5)),h(r,n,s[n])));Ee.set(r,"hasDataAttrs",!0)}return s}return"object"==typeof e?this.each(function(){we.set(this,e)}):_e(this,function(t){var i,n;if(r&&void 0===t){if(i=we.get(r,e)||we.get(r,e.replace(De,"-$&").toLowerCase()),void 0!==i)return i;if(n=re.camelCase(e),i=we.get(r,n),void 0!==i)return i;if(i=h(r,n,void 0),void 0!==i)return i}else n=re.camelCase(e),this.each(function(){var i=we.get(this,n);we.set(this,n,t),e.indexOf("-")>-1&&void 0!==i&&we.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){we.remove(this,e)})}}),re.extend({queue:function(e,t,i){var n;if(e)return t=(t||"fx")+"queue",n=Ee.get(e,t),i&&(!n||re.isArray(i)?n=Ee.access(e,t,re.makeArray(i)):n.push(i)),n||[]},dequeue:function(e,t){t=t||"fx";var i=re.queue(e,t),n=i.length,s=i.shift(),r=re._queueHooks(e,t),a=function(){re.dequeue(e,t)};"inprogress"===s&&(s=i.shift(),n--),s&&("fx"===t&&i.unshift("inprogress"),delete r.stop,s.call(e,a,r)),!n&&r&&r.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return Ee.get(e,i)||Ee.access(e,i,{empty:re.Callbacks("once memory").add(function(){Ee.remove(e,[t+"queue",i])})})}}),re.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?re.queue(this[0],e):void 0===t?this:this.each(function(){var i=re.queue(this,e,t);re._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&re.dequeue(this,e)})},dequeue:function(e){return this.each(function(){re.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,n=1,s=re.Deferred(),r=this,a=this.length,o=function(){--n||s.resolveWith(r,[r])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)i=Ee.get(r[a],e+"queueHooks"),i&&i.empty&&(n++,i.empty.add(o));return o(),s.promise(t)}});var Ne=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ie=new RegExp("^(?:([+-])=|)("+Ne+")([a-z%]*)$","i"),xe=["Top","Right","Bottom","Left"],ke=function(e,t){return e=t||e,"none"===re.css(e,"display")||!re.contains(e.ownerDocument,e)},Pe=/^(?:checkbox|radio)$/i,Oe=/<([\w:-]+)/,Me=/^$|\/(?:java|ecma)script/i,Le={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Le.optgroup=Le.option,Le.tbody=Le.tfoot=Le.colgroup=Le.caption=Le.thead,Le.th=Le.td;var Fe=/<|&#?\w+;/;!function(){var e=$.createDocumentFragment(),t=e.appendChild($.createElement("div")),i=$.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),t.appendChild(i),ne.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",ne.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Be=/^key/,Ve=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,qe=/^([^.]*)(?:\.(.+)|)/;re.event={global:{},add:function(e,t,i,n,s){var r,a,o,h,l,c,u,p,d,f,m,g=Ee.get(e);if(g)for(i.handler&&(r=i,i=r.handler,s=r.selector),i.guid||(i.guid=re.guid++),(h=g.events)||(h=g.events={}),(a=g.handle)||(a=g.handle=function(t){return"undefined"!=typeof re&&re.event.triggered!==t.type?re.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(Ce)||[""],l=t.length;l--;)o=qe.exec(t[l])||[],d=m=o[1],f=(o[2]||"").split(".").sort(),d&&(u=re.event.special[d]||{},d=(s?u.delegateType:u.bindType)||d,u=re.event.special[d]||{},c=re.extend({type:d,origType:m,data:n,handler:i,guid:i.guid,selector:s,needsContext:s&&re.expr.match.needsContext.test(s),namespace:f.join(".")},r),(p=h[d])||(p=h[d]=[],p.delegateCount=0,u.setup&&u.setup.call(e,n,f,a)!==!1||e.addEventListener&&e.addEventListener(d,a)),u.add&&(u.add.call(e,c),c.handler.guid||(c.handler.guid=i.guid)),s?p.splice(p.delegateCount++,0,c):p.push(c),re.event.global[d]=!0)},remove:function(e,t,i,n,s){var r,a,o,h,l,c,u,p,d,f,m,g=Ee.hasData(e)&&Ee.get(e);if(g&&(h=g.events)){for(t=(t||"").match(Ce)||[""],l=t.length;l--;)if(o=qe.exec(t[l])||[],d=m=o[1],f=(o[2]||"").split(".").sort(),d){for(u=re.event.special[d]||{},d=(n?u.delegateType:u.bindType)||d,p=h[d]||[],o=o[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=r=p.length;r--;)c=p[r],!s&&m!==c.origType||i&&i.guid!==c.guid||o&&!o.test(c.namespace)||n&&n!==c.selector&&("**"!==n||!c.selector)||(p.splice(r,1),c.selector&&p.delegateCount--,u.remove&&u.remove.call(e,c));a&&!p.length&&(u.teardown&&u.teardown.call(e,f,g.handle)!==!1||re.removeEvent(e,d,g.handle),delete h[d])}else for(d in h)re.event.remove(e,d+t[l],i,n,!0);re.isEmptyObject(h)&&Ee.remove(e,"handle events")}},dispatch:function(e){e=re.event.fix(e);var t,i,n,s,r,a=[],o=K.call(arguments),h=(Ee.get(this,"events")||{})[e.type]||[],l=re.event.special[e.type]||{};if(o[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){for(a=re.event.handlers.call(this,e,h),t=0;(s=a[t++])&&!e.isPropagationStopped();)for(e.currentTarget=s.elem,i=0;(r=s.handlers[i++])&&!e.isImmediatePropagationStopped();)e.rnamespace&&!e.rnamespace.test(r.namespace)||(e.handleObj=r,e.data=r.data,n=((re.event.special[r.origType]||{}).handle||r.handler).apply(s.elem,o),void 0!==n&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var i,n,s,r,a=[],o=t.delegateCount,h=e.target;if(o&&h.nodeType&&("click"!==e.type||isNaN(e.button)||e.button<1))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&(h.disabled!==!0||"click"!==e.type)){for(n=[],i=0;i<o;i++)r=t[i],s=r.selector+" ",void 0===n[s]&&(n[s]=r.needsContext?re(s,this).index(h)>-1:re.find(s,this,null,[h]).length),n[s]&&n.push(r);n.length&&a.push({elem:h,handlers:n})}return o<t.length&&a.push({elem:this,handlers:t.slice(o)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var i,n,s,r=t.button;return null==e.pageX&&null!=t.clientX&&(i=e.target.ownerDocument||$,n=i.documentElement,s=i.body,e.pageX=t.clientX+(n&&n.scrollLeft||s&&s.scrollLeft||0)-(n&&n.clientLeft||s&&s.clientLeft||0),e.pageY=t.clientY+(n&&n.scrollTop||s&&s.scrollTop||0)-(n&&n.clientTop||s&&s.clientTop||0)),e.which||void 0===r||(e.which=1&r?1:2&r?3:4&r?2:0),e}},fix:function(e){if(e[re.expando])return e;var t,i,n,s=e.type,r=e,a=this.fixHooks[s];for(a||(this.fixHooks[s]=a=Ve.test(s)?this.mouseHooks:Be.test(s)?this.keyHooks:{}),n=a.props?this.props.concat(a.props):this.props,e=new re.Event(r),t=n.length;t--;)i=n[t],e[i]=r[i];return e.target||(e.target=$),3===e.target.nodeType&&(e.target=e.target.parentNode),a.filter?a.filter(e,r):e},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==m()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===m()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&re.nodeName(this,"input"))return this.click(),!1},_default:function(e){return re.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},re.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},re.Event=function(e,t){return this instanceof re.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?d:f):this.type=e,t&&re.extend(this,t),this.timeStamp=e&&e.timeStamp||re.now(),void(this[re.expando]=!0)):new re.Event(e,t)},re.Event.prototype={constructor:re.Event,isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=d,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=d,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=d,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},re.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){re.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=this,s=e.relatedTarget,r=e.handleObj;return s&&(s===n||re.contains(n,s))||(e.type=r.origType,i=r.handler.apply(this,arguments),e.type=t),i}}}),re.fn.extend({on:function(e,t,i,n){return g(this,e,t,i,n)},one:function(e,t,i,n){return g(this,e,t,i,n,1)},off:function(e,t,i){var n,s;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,re(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof e){for(s in e)this.off(s,t,e[s]);return this}return t!==!1&&"function"!=typeof t||(i=t,t=void 0),i===!1&&(i=f),this.each(function(){re.event.remove(this,e,i,t)})}});var Ge=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,je=/<script|<style|<link/i,He=/checked\s*(?:[^=]|=\s*.checked.)/i,Ue=/^true\/(.*)/,We=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;re.extend({htmlPrefilter:function(e){return e.replace(Ge,"<$1></$2>")},clone:function(e,t,i){var n,s,r,a,o=e.cloneNode(!0),h=re.contains(e.ownerDocument,e);if(!(ne.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||re.isXMLDoc(e)))for(a=c(o),r=c(e),n=0,s=r.length;n<s;n++)C(r[n],a[n]);if(t)if(i)for(r=r||c(e),a=a||c(o),n=0,s=r.length;n<s;n++)b(r[n],a[n]);else b(e,o);return a=c(o,"script"),a.length>0&&u(a,!h&&c(e,"script")),o},cleanData:function(e){for(var t,i,n,s=re.event.special,r=0;void 0!==(i=e[r]);r++)if(Te(i)){if(t=i[Ee.expando]){if(t.events)for(n in t.events)s[n]?re.event.remove(i,n):re.removeEvent(i,n,t.handle);i[Ee.expando]=void 0}i[we.expando]&&(i[we.expando]=void 0)}}}),re.fn.extend({domManip:R,detach:function(e){return _(this,e,!0)},remove:function(e){return _(this,e)},text:function(e){return _e(this,function(e){return void 0===e?re.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return R(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=v(this,e);t.appendChild(e)}})},prepend:function(){return R(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=v(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return R(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return R(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(re.cleanData(c(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return re.clone(this,e,t)})},html:function(e){return _e(this,function(e){var t=this[0]||{},i=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!je.test(e)&&!Le[(Oe.exec(e)||["",""])[1].toLowerCase()]){e=re.htmlPrefilter(e);try{for(;i<n;i++)t=this[i]||{},1===t.nodeType&&(re.cleanData(c(t,!1)),t.innerHTML=e);t=0}catch(s){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return R(this,arguments,function(t){var i=this.parentNode;re.inArray(this,e)<0&&(re.cleanData(c(this)),i&&i.replaceChild(t,this))},e)}}),re.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){re.fn[e]=function(e){for(var i,n=[],s=re(e),r=s.length-1,a=0;a<=r;a++)i=a===r?this:this.clone(!0),re(s[a])[t](i),z.apply(n,i.get());return this.pushStack(n)}});var Xe,Ye={HTML:"block",BODY:"block"},Je=/^margin/,$e=new RegExp("^("+Ne+")(?!px)[a-z%]+$","i"),Ke=function(t){var i=t.ownerDocument.defaultView;return i&&i.opener||(i=e),i.getComputedStyle(t)},Ze=function(e,t,i,n){var s,r,a={};for(r in t)a[r]=e.style[r],e.style[r]=t[r];s=i.apply(e,n||[]);for(r in t)e.style[r]=a[r];return s},ze=$.documentElement;!function(){function t(){o.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",o.innerHTML="",ze.appendChild(a);var t=e.getComputedStyle(o);i="1%"!==t.top,r="2px"===t.marginLeft,n="4px"===t.width,o.style.marginRight="50%",s="4px"===t.marginRight,ze.removeChild(a)}var i,n,s,r,a=$.createElement("div"),o=$.createElement("div");o.style&&(o.style.backgroundClip="content-box",o.cloneNode(!0).style.backgroundClip="",ne.clearCloneStyle="content-box"===o.style.backgroundClip,a.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",a.appendChild(o),re.extend(ne,{pixelPosition:function(){return t(),i},boxSizingReliable:function(){return null==n&&t(),n},pixelMarginRight:function(){return null==n&&t(),s},reliableMarginLeft:function(){return null==n&&t(),r},reliableMarginRight:function(){var t,i=o.appendChild($.createElement("div"));return i.style.cssText=o.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",o.style.width="1px",ze.appendChild(a),t=!parseFloat(e.getComputedStyle(i).marginRight),ze.removeChild(a),o.removeChild(i),t}}))}();var Qe=/^(none|table(?!-c[ea]).+)/,et={position:"absolute",visibility:"hidden",display:"block"},tt={letterSpacing:"0",fontWeight:"400"},it=["Webkit","O","Moz","ms"],nt=$.createElement("div").style;re.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=w(e,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,i,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,r,a,o=re.camelCase(t),h=e.style;return t=re.cssProps[o]||(re.cssProps[o]=D(o)||o),a=re.cssHooks[t]||re.cssHooks[o],void 0===i?a&&"get"in a&&void 0!==(s=a.get(e,!1,n))?s:h[t]:(r=typeof i,"string"===r&&(s=Ie.exec(i))&&s[1]&&(i=l(e,t,s),r="number"),null!=i&&i===i&&("number"===r&&(i+=s&&s[3]||(re.cssNumber[o]?"":"px")),ne.clearCloneStyle||""!==i||0!==t.indexOf("background")||(h[t]="inherit"),a&&"set"in a&&void 0===(i=a.set(e,i,n))||(h[t]=i)),void 0)}},css:function(e,t,i,n){var s,r,a,o=re.camelCase(t);return t=re.cssProps[o]||(re.cssProps[o]=D(o)||o),a=re.cssHooks[t]||re.cssHooks[o],a&&"get"in a&&(s=a.get(e,!0,i)),void 0===s&&(s=w(e,t,n)),"normal"===s&&t in tt&&(s=tt[t]),""===i||i?(r=parseFloat(s),i===!0||isFinite(r)?r||0:s):s}}),re.each(["height","width"],function(e,t){re.cssHooks[t]={get:function(e,i,n){if(i)return Qe.test(re.css(e,"display"))&&0===e.offsetWidth?Ze(e,et,function(){return x(e,t,n)}):x(e,t,n)},set:function(e,i,n){var s,r=n&&Ke(e),a=n&&I(e,t,n,"border-box"===re.css(e,"boxSizing",!1,r),r);return a&&(s=Ie.exec(i))&&"px"!==(s[3]||"px")&&(e.style[t]=i,i=re.css(e,t)),N(e,i,a)}}}),re.cssHooks.marginLeft=A(ne.reliableMarginLeft,function(e,t){if(t)return(parseFloat(w(e,"marginLeft"))||e.getBoundingClientRect().left-Ze(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),re.cssHooks.marginRight=A(ne.reliableMarginRight,function(e,t){if(t)return Ze(e,{display:"inline-block"},w,[e,"marginRight"])}),re.each({margin:"",padding:"",border:"Width"},function(e,t){re.cssHooks[e+t]={expand:function(i){for(var n=0,s={},r="string"==typeof i?i.split(" "):[i];n<4;n++)s[e+xe[n]+t]=r[n]||r[n-2]||r[0];return s}},Je.test(e)||(re.cssHooks[e+t].set=N)}),re.fn.extend({css:function(e,t){return _e(this,function(e,t,i){var n,s,r={},a=0;if(re.isArray(t)){for(n=Ke(e),s=t.length;a<s;a++)r[t[a]]=re.css(e,t[a],!1,n);return r}return void 0!==i?re.style(e,t,i):re.css(e,t)},e,t,arguments.length>1)},show:function(){return k(this,!0)},hide:function(){return k(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ke(this)?re(this).show():re(this).hide()})}}),re.Tween=P,P.prototype={constructor:P,init:function(e,t,i,n,s,r){this.elem=e,this.prop=i,this.easing=s||re.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=r||(re.cssNumber[i]?"":"px")},cur:function(){var e=P.propHooks[this.prop];return e&&e.get?e.get(this):P.propHooks._default.get(this)},run:function(e){var t,i=P.propHooks[this.prop];return this.options.duration?this.pos=t=re.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):P.propHooks._default.set(this),this}},P.prototype.init.prototype=P.prototype,P.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=re.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){re.fx.step[e.prop]?re.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[re.cssProps[e.prop]]&&!re.cssHooks[e.prop]?e.elem[e.prop]=e.now:re.style(e.elem,e.prop,e.now+e.unit)}}},P.propHooks.scrollTop=P.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},re.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},re.fx=P.prototype.init,re.fx.step={};var st,rt,at=/^(?:toggle|show|hide)$/,ot=/queueHooks$/;re.Animation=re.extend(V,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return l(i.elem,e,Ie.exec(t),i),i}]},tweener:function(e,t){re.isFunction(e)?(t=e,e=["*"]):e=e.match(Ce);for(var i,n=0,s=e.length;n<s;n++)i=e[n],V.tweeners[i]=V.tweeners[i]||[],V.tweeners[i].unshift(t)},prefilters:[F],prefilter:function(e,t){t?V.prefilters.unshift(e):V.prefilters.push(e)}}),re.speed=function(e,t,i){var n=e&&"object"==typeof e?re.extend({},e):{complete:i||!i&&t||re.isFunction(e)&&e,duration:e,easing:i&&t||t&&!re.isFunction(t)&&t};return n.duration=re.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in re.fx.speeds?re.fx.speeds[n.duration]:re.fx.speeds._default,null!=n.queue&&n.queue!==!0||(n.queue="fx"),n.old=n.complete,n.complete=function(){re.isFunction(n.old)&&n.old.call(this),n.queue&&re.dequeue(this,n.queue)},n},re.fn.extend({fadeTo:function(e,t,i,n){return this.filter(ke).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var s=re.isEmptyObject(e),r=re.speed(t,i,n),a=function(){var t=V(this,re.extend({},e),r);(s||Ee.get(this,"finish"))&&t.stop(!0)};return a.finish=a,s||r.queue===!1?this.each(a):this.queue(r.queue,a)},stop:function(e,t,i){var n=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,s=null!=e&&e+"queueHooks",r=re.timers,a=Ee.get(this);if(s)a[s]&&a[s].stop&&n(a[s]);else for(s in a)a[s]&&a[s].stop&&ot.test(s)&&n(a[s]);for(s=r.length;s--;)r[s].elem!==this||null!=e&&r[s].queue!==e||(r[s].anim.stop(i),t=!1,r.splice(s,1));!t&&i||re.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,i=Ee.get(this),n=i[e+"queue"],s=i[e+"queueHooks"],r=re.timers,a=n?n.length:0;for(i.finish=!0,re.queue(this,e,[]),s&&s.stop&&s.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===e&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;t<a;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete i.finish})}}),re.each(["toggle","show","hide"],function(e,t){var i=re.fn[t];re.fn[t]=function(e,n,s){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(M(t,!0),e,n,s)}}),re.each({slideDown:M("show"),slideUp:M("hide"),slideToggle:M("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){re.fn[e]=function(e,i,n){return this.animate(t,e,i,n);
}}),re.timers=[],re.fx.tick=function(){var e,t=0,i=re.timers;for(st=re.now();t<i.length;t++)e=i[t],e()||i[t]!==e||i.splice(t--,1);i.length||re.fx.stop(),st=void 0},re.fx.timer=function(e){re.timers.push(e),e()?re.fx.start():re.timers.pop()},re.fx.interval=13,re.fx.start=function(){rt||(rt=e.setInterval(re.fx.tick,re.fx.interval))},re.fx.stop=function(){e.clearInterval(rt),rt=null},re.fx.speeds={slow:600,fast:200,_default:400},re.fn.delay=function(t,i){return t=re.fx?re.fx.speeds[t]||t:t,i=i||"fx",this.queue(i,function(i,n){var s=e.setTimeout(i,t);n.stop=function(){e.clearTimeout(s)}})},function(){var e=$.createElement("input"),t=$.createElement("select"),i=t.appendChild($.createElement("option"));e.type="checkbox",ne.checkOn=""!==e.value,ne.optSelected=i.selected,t.disabled=!0,ne.optDisabled=!i.disabled,e=$.createElement("input"),e.value="t",e.type="radio",ne.radioValue="t"===e.value}();var ht,lt=re.expr.attrHandle;re.fn.extend({attr:function(e,t){return _e(this,re.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){re.removeAttr(this,e)})}}),re.extend({attr:function(e,t,i){var n,s,r=e.nodeType;if(3!==r&&8!==r&&2!==r)return"undefined"==typeof e.getAttribute?re.prop(e,t,i):(1===r&&re.isXMLDoc(e)||(t=t.toLowerCase(),s=re.attrHooks[t]||(re.expr.match.bool.test(t)?ht:void 0)),void 0!==i?null===i?void re.removeAttr(e,t):s&&"set"in s&&void 0!==(n=s.set(e,i,t))?n:(e.setAttribute(t,i+""),i):s&&"get"in s&&null!==(n=s.get(e,t))?n:(n=re.find.attr(e,t),null==n?void 0:n))},attrHooks:{type:{set:function(e,t){if(!ne.radioValue&&"radio"===t&&re.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr:function(e,t){var i,n,s=0,r=t&&t.match(Ce);if(r&&1===e.nodeType)for(;i=r[s++];)n=re.propFix[i]||i,re.expr.match.bool.test(i)&&(e[n]=!1),e.removeAttribute(i)}}),ht={set:function(e,t,i){return t===!1?re.removeAttr(e,i):e.setAttribute(i,i),i}},re.each(re.expr.match.bool.source.match(/\w+/g),function(e,t){var i=lt[t]||re.find.attr;lt[t]=function(e,t,n){var s,r;return n||(r=lt[t],lt[t]=s,s=null!=i(e,t,n)?t.toLowerCase():null,lt[t]=r),s}});var ct=/^(?:input|select|textarea|button)$/i,ut=/^(?:a|area)$/i;re.fn.extend({prop:function(e,t){return _e(this,re.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[re.propFix[e]||e]})}}),re.extend({prop:function(e,t,i){var n,s,r=e.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&re.isXMLDoc(e)||(t=re.propFix[t]||t,s=re.propHooks[t]),void 0!==i?s&&"set"in s&&void 0!==(n=s.set(e,i,t))?n:e[t]=i:s&&"get"in s&&null!==(n=s.get(e,t))?n:e[t]},propHooks:{tabIndex:{get:function(e){var t=re.find.attr(e,"tabindex");return t?parseInt(t,10):ct.test(e.nodeName)||ut.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),ne.optSelected||(re.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),re.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){re.propFix[this.toLowerCase()]=this});var pt=/[\t\r\n\f]/g;re.fn.extend({addClass:function(e){var t,i,n,s,r,a,o,h=0;if(re.isFunction(e))return this.each(function(t){re(this).addClass(e.call(this,t,q(this)))});if("string"==typeof e&&e)for(t=e.match(Ce)||[];i=this[h++];)if(s=q(i),n=1===i.nodeType&&(" "+s+" ").replace(pt," ")){for(a=0;r=t[a++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");o=re.trim(n),s!==o&&i.setAttribute("class",o)}return this},removeClass:function(e){var t,i,n,s,r,a,o,h=0;if(re.isFunction(e))return this.each(function(t){re(this).removeClass(e.call(this,t,q(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(Ce)||[];i=this[h++];)if(s=q(i),n=1===i.nodeType&&(" "+s+" ").replace(pt," ")){for(a=0;r=t[a++];)for(;n.indexOf(" "+r+" ")>-1;)n=n.replace(" "+r+" "," ");o=re.trim(n),s!==o&&i.setAttribute("class",o)}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):re.isFunction(e)?this.each(function(i){re(this).toggleClass(e.call(this,i,q(this),t),t)}):this.each(function(){var t,n,s,r;if("string"===i)for(n=0,s=re(this),r=e.match(Ce)||[];t=r[n++];)s.hasClass(t)?s.removeClass(t):s.addClass(t);else void 0!==e&&"boolean"!==i||(t=q(this),t&&Ee.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||e===!1?"":Ee.get(this,"__className__")||""))})},hasClass:function(e){var t,i,n=0;for(t=" "+e+" ";i=this[n++];)if(1===i.nodeType&&(" "+q(i)+" ").replace(pt," ").indexOf(t)>-1)return!0;return!1}});var dt=/\r/g,ft=/[\x20\t\r\n\f]+/g;re.fn.extend({val:function(e){var t,i,n,s=this[0];{if(arguments.length)return n=re.isFunction(e),this.each(function(i){var s;1===this.nodeType&&(s=n?e.call(this,i,re(this).val()):e,null==s?s="":"number"==typeof s?s+="":re.isArray(s)&&(s=re.map(s,function(e){return null==e?"":e+""})),t=re.valHooks[this.type]||re.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,s,"value")||(this.value=s))});if(s)return t=re.valHooks[s.type]||re.valHooks[s.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(i=t.get(s,"value"))?i:(i=s.value,"string"==typeof i?i.replace(dt,""):null==i?"":i)}}}),re.extend({valHooks:{option:{get:function(e){var t=re.find.attr(e,"value");return null!=t?t:re.trim(re.text(e)).replace(ft," ")}},select:{get:function(e){for(var t,i,n=e.options,s=e.selectedIndex,r="select-one"===e.type||s<0,a=r?null:[],o=r?s+1:n.length,h=s<0?o:r?s:0;h<o;h++)if(i=n[h],(i.selected||h===s)&&(ne.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!re.nodeName(i.parentNode,"optgroup"))){if(t=re(i).val(),r)return t;a.push(t)}return a},set:function(e,t){for(var i,n,s=e.options,r=re.makeArray(t),a=s.length;a--;)n=s[a],(n.selected=re.inArray(re.valHooks.option.get(n),r)>-1)&&(i=!0);return i||(e.selectedIndex=-1),r}}}}),re.each(["radio","checkbox"],function(){re.valHooks[this]={set:function(e,t){if(re.isArray(t))return e.checked=re.inArray(re(e).val(),t)>-1}},ne.checkOn||(re.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var mt=/^(?:focusinfocus|focusoutblur)$/;re.extend(re.event,{trigger:function(t,i,n,s){var r,a,o,h,l,c,u,p=[n||$],d=ie.call(t,"type")?t.type:t,f=ie.call(t,"namespace")?t.namespace.split("."):[];if(a=o=n=n||$,3!==n.nodeType&&8!==n.nodeType&&!mt.test(d+re.event.triggered)&&(d.indexOf(".")>-1&&(f=d.split("."),d=f.shift(),f.sort()),l=d.indexOf(":")<0&&"on"+d,t=t[re.expando]?t:new re.Event(d,"object"==typeof t&&t),t.isTrigger=s?2:3,t.namespace=f.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),i=null==i?[t]:re.makeArray(i,[t]),u=re.event.special[d]||{},s||!u.trigger||u.trigger.apply(n,i)!==!1)){if(!s&&!u.noBubble&&!re.isWindow(n)){for(h=u.delegateType||d,mt.test(h+d)||(a=a.parentNode);a;a=a.parentNode)p.push(a),o=a;o===(n.ownerDocument||$)&&p.push(o.defaultView||o.parentWindow||e)}for(r=0;(a=p[r++])&&!t.isPropagationStopped();)t.type=r>1?h:u.bindType||d,c=(Ee.get(a,"events")||{})[t.type]&&Ee.get(a,"handle"),c&&c.apply(a,i),c=l&&a[l],c&&c.apply&&Te(a)&&(t.result=c.apply(a,i),t.result===!1&&t.preventDefault());return t.type=d,s||t.isDefaultPrevented()||u._default&&u._default.apply(p.pop(),i)!==!1||!Te(n)||l&&re.isFunction(n[d])&&!re.isWindow(n)&&(o=n[l],o&&(n[l]=null),re.event.triggered=d,n[d](),re.event.triggered=void 0,o&&(n[l]=o)),t.result}},simulate:function(e,t,i){var n=re.extend(new re.Event,i,{type:e,isSimulated:!0});re.event.trigger(n,null,t)}}),re.fn.extend({trigger:function(e,t){return this.each(function(){re.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];if(i)return re.event.trigger(e,t,i,!0)}}),re.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){re.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),re.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),ne.focusin="onfocusin"in e,ne.focusin||re.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){re.event.simulate(t,e.target,re.event.fix(e))};re.event.special[t]={setup:function(){var n=this.ownerDocument||this,s=Ee.access(n,t);s||n.addEventListener(e,i,!0),Ee.access(n,t,(s||0)+1)},teardown:function(){var n=this.ownerDocument||this,s=Ee.access(n,t)-1;s?Ee.access(n,t,s):(n.removeEventListener(e,i,!0),Ee.remove(n,t))}}});var gt=e.location,vt=re.now(),yt=/\?/;re.parseJSON=function(e){return JSON.parse(e+"")},re.parseXML=function(t){var i;if(!t||"string"!=typeof t)return null;try{i=(new e.DOMParser).parseFromString(t,"text/xml")}catch(n){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||re.error("Invalid XML: "+t),i};var St=/#.*$/,bt=/([?&])_=[^&]*/,Ct=/^(.*?):[ \t]*([^\r\n]*)$/gm,Rt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,_t=/^(?:GET|HEAD)$/,Tt=/^\/\//,Et={},wt={},At="*/".concat("*"),Dt=$.createElement("a");Dt.href=gt.href,re.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:gt.href,type:"GET",isLocal:Rt.test(gt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":At,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":re.parseJSON,"text xml":re.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?H(H(e,re.ajaxSettings),t):H(re.ajaxSettings,e)},ajaxPrefilter:G(Et),ajaxTransport:G(wt),ajax:function(t,i){function n(t,i,n,o){var l,u,y,S,C,_=i;2!==b&&(b=2,h&&e.clearTimeout(h),s=void 0,a=o||"",R.readyState=t>0?4:0,l=t>=200&&t<300||304===t,n&&(S=U(p,R,n)),S=W(p,S,R,l),l?(p.ifModified&&(C=R.getResponseHeader("Last-Modified"),C&&(re.lastModified[r]=C),C=R.getResponseHeader("etag"),C&&(re.etag[r]=C)),204===t||"HEAD"===p.type?_="nocontent":304===t?_="notmodified":(_=S.state,u=S.data,y=S.error,l=!y)):(y=_,!t&&_||(_="error",t<0&&(t=0))),R.status=t,R.statusText=(i||_)+"",l?m.resolveWith(d,[u,_,R]):m.rejectWith(d,[R,_,y]),R.statusCode(v),v=void 0,c&&f.trigger(l?"ajaxSuccess":"ajaxError",[R,p,l?u:y]),g.fireWith(d,[R,_]),c&&(f.trigger("ajaxComplete",[R,p]),--re.active||re.event.trigger("ajaxStop")))}"object"==typeof t&&(i=t,t=void 0),i=i||{};var s,r,a,o,h,l,c,u,p=re.ajaxSetup({},i),d=p.context||p,f=p.context&&(d.nodeType||d.jquery)?re(d):re.event,m=re.Deferred(),g=re.Callbacks("once memory"),v=p.statusCode||{},y={},S={},b=0,C="canceled",R={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!o)for(o={};t=Ct.exec(a);)o[t[1].toLowerCase()]=t[2];t=o[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?a:null},setRequestHeader:function(e,t){var i=e.toLowerCase();return b||(e=S[i]=S[i]||e,y[e]=t),this},overrideMimeType:function(e){return b||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(b<2)for(t in e)v[t]=[v[t],e[t]];else R.always(e[R.status]);return this},abort:function(e){var t=e||C;return s&&s.abort(t),n(0,t),this}};if(m.promise(R).complete=g.add,R.success=R.done,R.error=R.fail,p.url=((t||p.url||gt.href)+"").replace(St,"").replace(Tt,gt.protocol+"//"),p.type=i.method||i.type||p.method||p.type,p.dataTypes=re.trim(p.dataType||"*").toLowerCase().match(Ce)||[""],null==p.crossDomain){l=$.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=Dt.protocol+"//"+Dt.host!=l.protocol+"//"+l.host}catch(_){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=re.param(p.data,p.traditional)),j(Et,p,i,R),2===b)return R;c=re.event&&p.global,c&&0===re.active++&&re.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!_t.test(p.type),r=p.url,p.hasContent||(p.data&&(r=p.url+=(yt.test(r)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=bt.test(r)?r.replace(bt,"$1_="+vt++):r+(yt.test(r)?"&":"?")+"_="+vt++)),p.ifModified&&(re.lastModified[r]&&R.setRequestHeader("If-Modified-Since",re.lastModified[r]),re.etag[r]&&R.setRequestHeader("If-None-Match",re.etag[r])),(p.data&&p.hasContent&&p.contentType!==!1||i.contentType)&&R.setRequestHeader("Content-Type",p.contentType),R.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+At+"; q=0.01":""):p.accepts["*"]);for(u in p.headers)R.setRequestHeader(u,p.headers[u]);if(p.beforeSend&&(p.beforeSend.call(d,R,p)===!1||2===b))return R.abort();C="abort";for(u in{success:1,error:1,complete:1})R[u](p[u]);if(s=j(wt,p,i,R)){if(R.readyState=1,c&&f.trigger("ajaxSend",[R,p]),2===b)return R;p.async&&p.timeout>0&&(h=e.setTimeout(function(){R.abort("timeout")},p.timeout));try{b=1,s.send(y,n)}catch(_){if(!(b<2))throw _;n(-1,_)}}else n(-1,"No Transport");return R},getJSON:function(e,t,i){return re.get(e,t,i,"json")},getScript:function(e,t){return re.get(e,void 0,t,"script")}}),re.each(["get","post"],function(e,t){re[t]=function(e,i,n,s){return re.isFunction(i)&&(s=s||n,n=i,i=void 0),re.ajax(re.extend({url:e,type:t,dataType:s,data:i,success:n},re.isPlainObject(e)&&e))}}),re._evalUrl=function(e){return re.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},re.fn.extend({wrapAll:function(e){var t;return re.isFunction(e)?this.each(function(t){re(this).wrapAll(e.call(this,t))}):(this[0]&&(t=re(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return re.isFunction(e)?this.each(function(t){re(this).wrapInner(e.call(this,t))}):this.each(function(){var t=re(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=re.isFunction(e);return this.each(function(i){re(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(){return this.parent().each(function(){re.nodeName(this,"body")||re(this).replaceWith(this.childNodes)}).end()}}),re.expr.filters.hidden=function(e){return!re.expr.filters.visible(e)},re.expr.filters.visible=function(e){return e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0};var Nt=/%20/g,It=/\[\]$/,xt=/\r?\n/g,kt=/^(?:submit|button|image|reset|file)$/i,Pt=/^(?:input|select|textarea|keygen)/i;re.param=function(e,t){var i,n=[],s=function(e,t){t=re.isFunction(t)?t():null==t?"":t,n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=re.ajaxSettings&&re.ajaxSettings.traditional),re.isArray(e)||e.jquery&&!re.isPlainObject(e))re.each(e,function(){s(this.name,this.value)});else for(i in e)X(i,e[i],t,s);return n.join("&").replace(Nt,"+")},re.fn.extend({serialize:function(){return re.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=re.prop(this,"elements");return e?re.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!re(this).is(":disabled")&&Pt.test(this.nodeName)&&!kt.test(e)&&(this.checked||!Pe.test(e))}).map(function(e,t){var i=re(this).val();return null==i?null:re.isArray(i)?re.map(i,function(e){return{name:t.name,value:e.replace(xt,"\r\n")}}):{name:t.name,value:i.replace(xt,"\r\n")}}).get()}}),re.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(t){}};var Ot={0:200,1223:204},Mt=re.ajaxSettings.xhr();ne.cors=!!Mt&&"withCredentials"in Mt,ne.ajax=Mt=!!Mt,re.ajaxTransport(function(t){var i,n;if(ne.cors||Mt&&!t.crossDomain)return{send:function(s,r){var a,o=t.xhr();if(o.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)o[a]=t.xhrFields[a];t.mimeType&&o.overrideMimeType&&o.overrideMimeType(t.mimeType),t.crossDomain||s["X-Requested-With"]||(s["X-Requested-With"]="XMLHttpRequest");for(a in s)o.setRequestHeader(a,s[a]);i=function(e){return function(){i&&(i=n=o.onload=o.onerror=o.onabort=o.onreadystatechange=null,"abort"===e?o.abort():"error"===e?"number"!=typeof o.status?r(0,"error"):r(o.status,o.statusText):r(Ot[o.status]||o.status,o.statusText,"text"!==(o.responseType||"text")||"string"!=typeof o.responseText?{binary:o.response}:{text:o.responseText},o.getAllResponseHeaders()))}},o.onload=i(),n=o.onerror=i("error"),void 0!==o.onabort?o.onabort=n:o.onreadystatechange=function(){4===o.readyState&&e.setTimeout(function(){i&&n()})},i=i("abort");try{o.send(t.hasContent&&t.data||null)}catch(h){if(i)throw h}},abort:function(){i&&i()}}}),re.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return re.globalEval(e),e}}}),re.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),re.ajaxTransport("script",function(e){if(e.crossDomain){var t,i;return{send:function(n,s){t=re("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&s("error"===e.type?404:200,e.type)}),$.head.appendChild(t[0])},abort:function(){i&&i()}}}});var Lt=[],Ft=/(=)\?(?=&|$)|\?\?/;re.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Lt.pop()||re.expando+"_"+vt++;return this[e]=!0,e}}),re.ajaxPrefilter("json jsonp",function(t,i,n){var s,r,a,o=t.jsonp!==!1&&(Ft.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ft.test(t.data)&&"data");if(o||"jsonp"===t.dataTypes[0])return s=t.jsonpCallback=re.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,o?t[o]=t[o].replace(Ft,"$1"+s):t.jsonp!==!1&&(t.url+=(yt.test(t.url)?"&":"?")+t.jsonp+"="+s),t.converters["script json"]=function(){return a||re.error(s+" was not called"),a[0]},t.dataTypes[0]="json",r=e[s],e[s]=function(){a=arguments},n.always(function(){void 0===r?re(e).removeProp(s):e[s]=r,t[s]&&(t.jsonpCallback=i.jsonpCallback,Lt.push(s)),a&&re.isFunction(r)&&r(a[0]),a=r=void 0}),"script"}),re.parseHTML=function(e,t,i){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(i=t,t=!1),t=t||$;var n=fe.exec(e),s=!i&&[];return n?[t.createElement(n[1])]:(n=p([e],t,s),s&&s.length&&re(s).remove(),re.merge([],n.childNodes))};var Bt=re.fn.load;re.fn.load=function(e,t,i){if("string"!=typeof e&&Bt)return Bt.apply(this,arguments);var n,s,r,a=this,o=e.indexOf(" ");return o>-1&&(n=re.trim(e.slice(o)),e=e.slice(0,o)),re.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(s="POST"),a.length>0&&re.ajax({url:e,type:s||"GET",dataType:"html",data:t}).done(function(e){r=arguments,a.html(n?re("<div>").append(re.parseHTML(e)).find(n):e)}).always(i&&function(e,t){a.each(function(){i.apply(this,r||[e.responseText,t,e])})}),this},re.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){re.fn[t]=function(e){return this.on(t,e)}}),re.expr.filters.animated=function(e){return re.grep(re.timers,function(t){return e===t.elem}).length},re.offset={setOffset:function(e,t,i){var n,s,r,a,o,h,l,c=re.css(e,"position"),u=re(e),p={};"static"===c&&(e.style.position="relative"),o=u.offset(),r=re.css(e,"top"),h=re.css(e,"left"),l=("absolute"===c||"fixed"===c)&&(r+h).indexOf("auto")>-1,l?(n=u.position(),a=n.top,s=n.left):(a=parseFloat(r)||0,s=parseFloat(h)||0),re.isFunction(t)&&(t=t.call(e,i,re.extend({},o))),null!=t.top&&(p.top=t.top-o.top+a),null!=t.left&&(p.left=t.left-o.left+s),"using"in t?t.using.call(e,p):u.css(p)}},re.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){re.offset.setOffset(this,e,t)});var t,i,n=this[0],s={top:0,left:0},r=n&&n.ownerDocument;if(r)return t=r.documentElement,re.contains(t,n)?(s=n.getBoundingClientRect(),i=Y(r),{top:s.top+i.pageYOffset-t.clientTop,left:s.left+i.pageXOffset-t.clientLeft}):s},position:function(){if(this[0]){var e,t,i=this[0],n={top:0,left:0};return"fixed"===re.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),re.nodeName(e[0],"html")||(n=e.offset()),n.top+=re.css(e[0],"borderTopWidth",!0),n.left+=re.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-re.css(i,"marginTop",!0),left:t.left-n.left-re.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===re.css(e,"position");)e=e.offsetParent;return e||ze})}}),re.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var i="pageYOffset"===t;re.fn[e]=function(n){return _e(this,function(e,n,s){var r=Y(e);return void 0===s?r?r[t]:e[n]:void(r?r.scrollTo(i?r.pageXOffset:s,i?s:r.pageYOffset):e[n]=s)},e,n,arguments.length)}}),re.each(["top","left"],function(e,t){re.cssHooks[t]=A(ne.pixelPosition,function(e,i){if(i)return i=w(e,t),$e.test(i)?re(e).position()[t]+"px":i})}),re.each({Height:"height",Width:"width"},function(e,t){re.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,n){re.fn[n]=function(n,s){var r=arguments.length&&(i||"boolean"!=typeof n),a=i||(n===!0||s===!0?"margin":"border");return _e(this,function(t,i,n){var s;return re.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,Math.max(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===n?re.css(t,i,a):re.style(t,i,n,a)},t,r?n:void 0,r,null)}})}),re.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)},size:function(){return this.length}}),re.fn.andSelf=re.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return re});var Vt=e.jQuery,qt=e.$;return re.noConflict=function(t){return e.$===re&&(e.$=qt),t&&e.jQuery===re&&(e.jQuery=Vt),re},t||(e.jQuery=e.$=re),re}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.adapter=e()}}(function(){return function e(t,i,n){function s(a,o){if(!i[a]){if(!t[a]){var h="function"==typeof require&&require;if(!o&&h)return h(a,!0);if(r)return r(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[a]={exports:{}};t[a][0].call(c.exports,function(e){var i=t[a][1][e];return s(i?i:e)},c,c.exports,e,t,i,n)}return i[a].exports}for(var r="function"==typeof require&&require,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(e,t,i){"use strict";var n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var i={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":i.relatedAddress=t[n+1];break;case"rport":i.relatedPort=parseInt(t[n+1],10);break;case"tcptype":i.tcpType=t[n+1]}return i},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.numChannels=3===t.length?parseInt(t[2],10):1,i},n.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,i={},n=e.substr(e.indexOf(" ")+1).split(";"),s=0;s<n.length;s++)t=n[s].trim().split("="),i[t[0].trim()]=t[1];return i},n.writeFmtp=function(e){var t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){n.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(i.attribute=e.substr(t+1,n-t-1),i.value=e.substr(n+1)):i.attribute=e.substr(t+1),i},n.getDtlsParameters=function(e,t){var i=n.splitLines(e);i=i.concat(n.splitLines(t));var s=i.filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14),r={role:"auto",fingerprints:[{algorithm:s.split(" ")[0],value:s.split(" ")[1]}]};return r},n.writeDtlsParameters=function(e,t){var i="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),i},n.getIceParameters=function(e,t){var i=n.splitLines(e);i=i.concat(n.splitLines(t));var s={usernameFragment:i.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:i.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return s},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=n.splitLines(e),s=i[0].split(" "),r=3;r<s.length;r++){var a=s[r],o=n.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(o){var h=n.parseRtpMap(o),l=n.matchPrefix(e,"a=fmtp:"+a+" ");switch(h.parameters=l.length?n.parseFmtp(l[0]):{},h.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(n.parseRtcpFb),t.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(h.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var i="";return i+="m="+e+" ",i+=t.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){i+=n.writeRtpMap(e),i+=n.writeFmtp(e),i+=n.writeRtcpFb(e)}),i+="a=rtcp-mux\r\n"},n.parseRtpEncodingParameters=function(e){var t,i=[],s=n.parseRtpParameters(e),r=s.fecMechanisms.indexOf("RED")!==-1,a=s.fecMechanisms.indexOf("ULPFEC")!==-1,o=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),h=o.length>0&&o[0].ssrc,l=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});l.length>0&&l[0].length>1&&l[0][0]===h&&(t=l[0][1]),s.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:h,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{payloadType:e.payloadType,ssrc:t}};i.push(n),r&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},i.push(n))}}),0===i.length&&h&&i.push({ssrc:h});var c=n.matchPrefix(e,"b=");return c.length&&(0===c[0].indexOf("b=TIAS:")?c=parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")&&(c=parseInt(c[0].substr(5),10)),i.forEach(function(e){e.maxBitrate=c})),i},n.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,i,s){var r=n.writeRtpDescription(e.kind,t);if(r+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),r+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),r+="a=mid:"+e.mid+"\r\n",r+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a="msid:"+s.id+" "+e.rtpSender.track.id+"\r\n";r+="a="+a,r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a}return r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n"},n.getDirection=function(e,t){for(var i=n.splitLines(e),s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substr(2)}return t?n.getDirection(t):"sendrecv"},t.exports=n},{}],2:[function(e,t,i){"use strict";!function(){var i=e("./utils").log,n=e("./utils").browserDetails;t.exports.browserDetails=n,t.exports.extractVersion=e("./utils").extractVersion,t.exports.disableLog=e("./utils").disableLog;var s=e("./chrome/chrome_shim")||null,r=e("./edge/edge_shim")||null,a=e("./firefox/firefox_shim")||null,o=e("./safari/safari_shim")||null;switch(n.browser){case"opera":case"chrome":if(!s||!s.shimPeerConnection)return void i("Chrome shim is not included in this adapter release.");i("adapter.js shimming chrome."),t.exports.browserShim=s,s.shimGetUserMedia(),s.shimMediaStream(),s.shimSourceObject(),s.shimPeerConnection(),s.shimOnTrack();break;case"firefox":if(!a||!a.shimPeerConnection)return void i("Firefox shim is not included in this adapter release.");i("adapter.js shimming firefox."),t.exports.browserShim=a,a.shimGetUserMedia(),a.shimSourceObject(),a.shimPeerConnection(),a.shimOnTrack();break;case"edge":if(!r||!r.shimPeerConnection)return void i("MS edge shim is not included in this adapter release.");i("adapter.js shimming edge."),t.exports.browserShim=r,r.shimGetUserMedia(),r.shimPeerConnection();break;case"safari":if(!o)return void i("Safari shim is not included in this adapter release.");i("adapter.js shimming safari."),t.exports.browserShim=o,o.shimGetUserMedia();break;default:i("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":7,"./safari/safari_shim":9,"./utils":10}],3:[function(e,t,i){"use strict";var n=e("../utils.js").log,s=e("../utils.js").browserDetails,r={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(i){var n=new Event("track");n.track=i.track,n.receiver={track:i.track},n.streams=[e.stream],t.dispatchEvent(n)}),e.stream.getTracks().forEach(function(t){var i=new Event("track");i.track=t,
i.receiver={track:t},i.streams=[e.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;return this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),void e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})):void(this.src="")}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(e,t){n("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var i=new webkitRTCPeerConnection(e,t),s=i.getStats.bind(i);return i.getStats=function(e,t,i){var n=this,r=arguments;if(arguments.length>0&&"function"==typeof e)return s(e,t);var a=function(e){var t={},i=e.result();return i.forEach(function(e){var i={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){i[t]=e.stat(t)}),t[i.id]=i}),t},o=function(e,t){var i=new Map(Object.keys(e).map(function(t){return[t,e[t]]}));return t=t||e,Object.keys(t).forEach(function(e){i[e]=t[e]}),i};if(arguments.length>=2){var h=function(e){r[1](o(a(e)))};return s.apply(this,[h,arguments[0]])}return new Promise(function(t,i){1===r.length&&"object"==typeof e?s.apply(n,[function(e){t(o(a(e)))},i]):s.apply(n,[function(e){t(o(a(e),e.result()))},i])}).then(t,i)},i},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var i=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,s){t.apply(e,[n,s,i])})}return t.apply(this,arguments)}}),s.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,i=this,n=new Promise(function(n,s){t.apply(i,[e[0],n,s])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)}}};t.exports={shimMediaStream:r.shimMediaStream,shimOnTrack:r.shimOnTrack,shimSourceObject:r.shimSourceObject,shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":10,"./getusermedia":4}],4:[function(e,t,i){"use strict";var n=e("../utils.js").log;t.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var n="object"==typeof e[i]?e[i]:{ideal:e[i]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var s=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var r={};"number"==typeof n.ideal?(r[s("min",i)]=n.ideal,t.optional.push(r),r={},r[s("max",i)]=n.ideal,t.optional.push(r)):(r[s("",i)]=n.ideal,t.optional.push(r))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[s("",i)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[s(e,i)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},t=function(t,i){if(t=JSON.parse(JSON.stringify(t)),t&&t.audio&&(t.audio=e(t.audio)),t&&"object"==typeof t.video){var s=t.video.facingMode;if(s=s&&("object"==typeof s?s:{ideal:s}),s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete t.video.facingMode,"environment"===s.exact||"environment"===s.ideal))return navigator.mediaDevices.enumerateDevices().then(function(r){r=r.filter(function(e){return"videoinput"===e.kind});var a=r.find(function(e){return e.label.toLowerCase().indexOf("back")!==-1})||r.length&&r[r.length-1];return a&&(t.video.deviceId=s.exact?{exact:a.deviceId}:{ideal:a.deviceId}),t.video=e(t.video),n("chrome: "+JSON.stringify(t)),i(t)});t.video=e(t.video)}return n("chrome: "+JSON.stringify(t)),i(t)},i=function(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,n,s){t(e,function(e){navigator.webkitGetUserMedia(e,n,function(e){s(i(e))})})};navigator.getUserMedia=s;var r=function(e){return new Promise(function(t,i){navigator.getUserMedia(e,t,i)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:r,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(i){e(i.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var a=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e,function(e){return a(e)["catch"](function(e){return Promise.reject(i(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return r(e)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){n("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){n("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":10}],5:[function(e,t,i){"use strict";var n=e("sdp"),s=e("../utils").browserDetails,r={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e})),window.RTCPeerConnection=function(e){var t=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=i[e].bind(i)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers){var n=JSON.parse(JSON.stringify(e.iceServers));this.iceOptions.iceServers=n.filter(function(e){if(e&&e.urls){var t=e.urls;return"string"==typeof t&&(t=[t]),t=t.filter(function(e){return 0===e.indexOf("turn:")&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1||0===e.indexOf("stun:")&&s.version>=14393})[0],!!t}return!1})}this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this,t=n.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(i){var n=!i.candidate||0===Object.keys(i.candidate).length;if(n)for(var s=1;s<t.length;s++)t[s].indexOf("\r\na=end-of-candidates\r\n")===-1&&(t[s]+="a=end-of-candidates\r\n");else i.candidate.candidate.indexOf("typ endOfCandidates")===-1&&(t[i.candidate.sdpMLineIndex+1]+="a="+i.candidate.candidate+"\r\n");if(e.localDescription.sdp=t.join(""),e.dispatchEvent(i),null!==e.onicecandidate&&e.onicecandidate(i),!i.candidate&&"complete"!==e.iceGatheringState){var r=e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});r&&(e.iceGatheringState="complete")}}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(e){this.localStreams.push(e.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var i={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var n=0;n<t.codecs.length;n++){var s=t.codecs[n];if(e.name.toLowerCase()===s.name.toLowerCase()&&e.clockRate===s.clockRate&&e.numChannels===s.numChannels){i.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(t){for(var i=0;i<e.rtcpFeedback.length;i++)if(e.rtcpFeedback[i].type===t.type&&e.rtcpFeedback[i].parameter===t.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var s=t.headerExtensions[n];if(e.uri===s.uri){i.headerExtensions.push(s);break}}}),i},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,t){var i=this,s=new RTCIceGatherer(i.iceOptions),r=new RTCIceTransport(s);s.onlocalcandidate=function(a){var o=new Event("icecandidate");o.candidate={sdpMid:e,sdpMLineIndex:t};var h=a.candidate,l=!h||0===Object.keys(h).length;l?(void 0===s.state&&(s.state="completed"),o.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(h.component="RTCP"===r.component?2:1,o.candidate.candidate=n.writeCandidate(h));var c=n.splitSections(i.localDescription.sdp);o.candidate.candidate.indexOf("typ endOfCandidates")===-1?c[o.candidate.sdpMLineIndex+1]+="a="+o.candidate.candidate+"\r\n":c[o.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",i.localDescription.sdp=c.join("");var u=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(i.iceGatheringState){case"new":i._localIceCandidatesBuffer.push(o),l&&u&&i._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":i._emitBufferedCandidates(),i.dispatchEvent(o),null!==i.onicecandidate&&i.onicecandidate(o),u&&(i.dispatchEvent(new Event("icecandidate")),null!==i.onicecandidate&&i.onicecandidate(new Event("icecandidate")),i.iceGatheringState="complete");break;case"complete":}},r.onicestatechange=function(){i._updateConnectionState()};var a=new RTCDtlsTransport(r);return a.ondtlsstatechange=function(){i._updateConnectionState()},a.onerror=function(){a.state="failed",i._updateConnectionState()},{iceGatherer:s,iceTransport:r,dtlsTransport:a}},window.RTCPeerConnection.prototype._transceive=function(e,t,i){var s=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:n.localCName},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),i&&e.rtpReceiver&&(s.encodings=e.recvEncodingParameters,s.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t,i,s=this;if("offer"===e.type)this._pendingOffer&&(t=n.splitSections(e.sdp),i=t.shift(),t.forEach(function(e,t){var i=n.parseRtpParameters(e);s._pendingOffer[t].localCapabilities=i}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){t=n.splitSections(s.remoteDescription.sdp),i=t.shift();var r=n.matchPrefix(i,"a=ice-lite").length>0;t.forEach(function(e,t){var a=s.transceivers[t],o=a.iceGatherer,h=a.iceTransport,l=a.dtlsTransport,c=a.localCapabilities,u=a.remoteCapabilities,p="0"===e.split("\n",1)[0].split(" ",2)[1];if(!p){var d=n.getIceParameters(e,i);if(r){var f=n.matchPrefix(e,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return"1"===e.component});f.length&&h.setRemoteCandidates(f)}var m=n.getDtlsParameters(e,i);r&&(m.role="server"),s.usingBundle&&0!==t||(h.start(o,d,r?"controlling":"controlled"),l.start(m));var g=s._getCommonCapabilities(c,u);s._transceive(a,g.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var a=arguments.length>1&&"function"==typeof arguments[1];if(a){var o=arguments[1];window.setTimeout(function(){o(),"new"===s.iceGatheringState&&(s.iceGatheringState="gathering"),s._emitBufferedCandidates()},0)}var h=Promise.resolve();return h.then(function(){a||("new"===s.iceGatheringState&&(s.iceGatheringState="gathering"),window.setTimeout(s._emitBufferedCandidates.bind(s),500))}),h},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t=this,i=new MediaStream,s=[],r=n.splitSections(e.sdp),a=r.shift(),o=n.matchPrefix(a,"a=ice-lite").length>0;switch(this.usingBundle=n.matchPrefix(a,"a=group:BUNDLE ").length>0,r.forEach(function(r,h){var l,c,u,p,d,f,m,g,v,y,S,b,C=n.splitLines(r),R=C[0].substr(2).split(" "),_=R[0],T="0"===R[1],E=n.getDirection(r,a),w=n.parseRtpParameters(r);T||(S=n.getIceParameters(r,a),b=n.getDtlsParameters(r,a),b.role="client"),g=n.parseRtpEncodingParameters(r);var A=n.matchPrefix(r,"a=mid:");A=A.length?A[0].substr(6):n.generateIdentifier();var D,N=n.matchPrefix(r,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];N&&(D=N.value);var I=n.matchPrefix(r,"a=end-of-candidates",a).length>0,x=n.matchPrefix(r,"a=candidate:").map(function(e){return n.parseCandidate(e)}).filter(function(e){return"1"===e.component});if("offer"!==e.type||T)"answer"!==e.type||T||(l=t.transceivers[h],c=l.iceGatherer,u=l.iceTransport,p=l.dtlsTransport,d=l.rtpSender,f=l.rtpReceiver,m=l.sendEncodingParameters,v=l.localCapabilities,t.transceivers[h].recvEncodingParameters=g,t.transceivers[h].remoteCapabilities=w,t.transceivers[h].cname=D,(o||I)&&x.length&&u.setRemoteCandidates(x),t.usingBundle&&0!==h||(u.start(c,S,"controlling"),p.start(b)),t._transceive(l,"sendrecv"===E||"recvonly"===E,"sendrecv"===E||"sendonly"===E),!f||"sendrecv"!==E&&"sendonly"!==E?delete l.rtpReceiver:(y=f.track,s.push([y,f]),i.addTrack(y)));else{var k=t.usingBundle&&h>0?{iceGatherer:t.transceivers[0].iceGatherer,iceTransport:t.transceivers[0].iceTransport,dtlsTransport:t.transceivers[0].dtlsTransport}:t._createIceAndDtlsTransports(A,h);if(I&&k.iceTransport.setRemoteCandidates(x),v=RTCRtpReceiver.getCapabilities(_),m=[{ssrc:1001*(2*h+2)}],f=new RTCRtpReceiver(k.dtlsTransport,_),y=f.track,s.push([y,f]),i.addTrack(y),t.localStreams.length>0&&t.localStreams[0].getTracks().length>=h){var P;"audio"===_?P=t.localStreams[0].getAudioTracks()[0]:"video"===_&&(P=t.localStreams[0].getVideoTracks()[0]),P&&(d=new RTCRtpSender(P,k.dtlsTransport))}t.transceivers[h]={iceGatherer:k.iceGatherer,iceTransport:k.iceTransport,dtlsTransport:k.dtlsTransport,localCapabilities:v,remoteCapabilities:w,rtpSender:d,rtpReceiver:f,kind:_,mid:A,cname:D,sendEncodingParameters:m,recvEncodingParameters:g},t._transceive(t.transceivers[h],!1,"sendrecv"===E||"sendonly"===E)}}),this.remoteDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return i.getTracks().length&&(t.remoteStreams.push(i),window.setTimeout(function(){var e=new Event("addstream");e.stream=i,t.dispatchEvent(e),null!==t.onaddstream&&window.setTimeout(function(){t.onaddstream(e)},0),s.forEach(function(n){var s=n[0],r=n[1],a=new Event("track");a.track=s,a.receiver=r,a.streams=[i],t.dispatchEvent(e),null!==t.ontrack&&window.setTimeout(function(){t.ontrack(a)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t=this,i={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){i[e.iceTransport.state]++,i[e.dtlsTransport.state]++}),i.connected+=i.completed,e="new",i.failed>0?e="failed":i.connecting>0||i.checking>0?e="connecting":i.disconnected>0?e="disconnected":i["new"]>0?e="new":(i.connected>0||i.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this.dispatchEvent(n),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(n)}},window.RTCPeerConnection.prototype.createOffer=function(){var e=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var t;1===arguments.length&&"function"!=typeof arguments[0]?t=arguments[0]:3===arguments.length&&(t=arguments[2]);var i=[],s=0,r=0;if(this.localStreams.length&&(s=this.localStreams[0].getAudioTracks().length,r=this.localStreams[0].getVideoTracks().length),t){if(t.mandatory||t.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==t.offerToReceiveAudio&&(s=t.offerToReceiveAudio),void 0!==t.offerToReceiveVideo&&(r=t.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){i.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?s>0:r>0}),"audio"===e.kind?s--:"video"===e.kind&&r--});s>0||r>0;)s>0&&(i.push({kind:"audio",wantReceive:!0}),s--),r>0&&(i.push({kind:"video",wantReceive:!0}),r--);var a=n.writeSessionBoilerplate(),o=[];i.forEach(function(t,i){var s,r,a=t.track,h=t.kind,l=n.generateIdentifier(),c=e.usingBundle&&i>0?{iceGatherer:o[0].iceGatherer,iceTransport:o[0].iceTransport,dtlsTransport:o[0].dtlsTransport}:e._createIceAndDtlsTransports(l,i),u=RTCRtpSender.getCapabilities(h),p=[{ssrc:1001*(2*i+1)}];a&&(s=new RTCRtpSender(a,c.dtlsTransport)),t.wantReceive&&(r=new RTCRtpReceiver(c.dtlsTransport,h)),o[i]={iceGatherer:c.iceGatherer,iceTransport:c.iceTransport,dtlsTransport:c.dtlsTransport,localCapabilities:u,remoteCapabilities:null,rtpSender:s,rtpReceiver:r,kind:h,mid:l,sendEncodingParameters:p,recvEncodingParameters:null}}),this.usingBundle&&(a+="a=group:BUNDLE "+o.map(function(e){return e.mid}).join(" ")+"\r\n"),i.forEach(function(t,i){var s=o[i];a+=n.writeMediaSection(s,s.localCapabilities,"offer",e.localStreams[0])}),this._pendingOffer=o;var h=new RTCSessionDescription({type:"offer",sdp:a});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,h),Promise.resolve(h)},window.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=n.writeSessionBoilerplate();this.usingBundle&&(t+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(i){var s=e._getCommonCapabilities(i.localCapabilities,i.remoteCapabilities);t+=n.writeMediaSection(i,s,"answer",e.localStreams[0])});var i=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,i),Promise.resolve(i)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){if(null===e)this.transceivers.forEach(function(e){e.iceTransport.addRemoteCandidate({})});else{var t=e.sdpMLineIndex;if(e.sdpMid)for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].mid===e.sdpMid){t=i;break}var s=this.transceivers[t];if(s){var r=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===r.protocol&&(0===r.port||9===r.port))return;if("1"!==r.component)return;"endOfCandidates"===r.type&&(r={}),s.iceTransport.addRemoteCandidate(r);var a=n.splitSections(this.remoteDescription.sdp);a[t+1]+=(r.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=a.join("")}}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(i){t[i]&&e.push(t[i].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(i){var n=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){n.set(t,e[t]),n[t]=e[t]})}),t&&window.setTimeout(t,0,n),i(n)})})}}};t.exports={shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":10,"./getusermedia":6,sdp:1}],6:[function(e,t,i){"use strict";t.exports=function(){var e=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(i){return t(i)["catch"](function(t){return Promise.reject(e(t))})}}},{}],7:[function(e,t,i){"use strict";var n=e("../utils").browserDetails,s={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var i=new Event("track");i.track=t,i.receiver={track:t},i.streams=[e.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(n.version<38&&e&&e.iceServers){for(var i=[],s=0;s<e.iceServers.length;s++){var r=e.iceServers[s];if(r.hasOwnProperty("urls"))for(var a=0;a<r.urls.length;a++){var o={url:r.urls[a]};0===r.urls[a].indexOf("turn")&&(o.username=r.username,o.credential=r.credential),i.push(o)}else i.push(e.iceServers[s])}e.iceServers=i}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)};var t=function(e){var t=new Map;return Object.keys(e).forEach(function(i){t.set(i,e[i]),t[i]=e[i]}),t},i=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,n,s){return i.apply(this,[e||null]).then(function(e){return t(e)}).then(n,s)}}}};t.exports={shimOnTrack:s.shimOnTrack,shimSourceObject:s.shimSourceObject,shimPeerConnection:s.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":10,"./getusermedia":8}],8:[function(e,t,i){"use strict";var n=e("../utils").log,s=e("../utils").browserDetails;t.exports=function(){var e=function(e){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},t=function(t,i,r){var a=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var n=e[i]="object"==typeof e[i]?e[i]:{ideal:e[i]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||t.push(i),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[i]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var s={};"number"==typeof n.ideal?s[i]={min:n.ideal,max:n.ideal}:s[i]=n.ideal,e.advanced.push(s),delete n.ideal,Object.keys(n).length||delete e[i]}}}),t.length&&(e.require=t),e};return t=JSON.parse(JSON.stringify(t)),s.version<38&&(n("spec: "+JSON.stringify(t)),t.audio&&(t.audio=a(t.audio)),t.video&&(t.video=a(t.video)),n("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,i,function(t){r(e(t))})},i=function(e){return new Promise(function(i,n){t(e,i,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:i,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},s.version<41){var r=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return r().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(s.version<49){var a=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return a(t)["catch"](function(t){return Promise.reject(e(t))})}}navigator.getUserMedia=function(e,i,n){return s.version<44?t(e,i,n):(console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),void navigator.mediaDevices.getUserMedia(e).then(i,n))}}},{"../utils":10}],9:[function(e,t,i){"use strict";var n={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};t.exports={shimGetUserMedia:n.shimGetUserMedia}},{}],10:[function(e,t,i){"use strict";var n=!0,s={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,t,i){var n=e.match(t);return n&&n.length>=i&&parseInt(n[i],10)},detectBrowser:function(){var e={};if(e.browser=null,e.version=null,"undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return e}};t.exports={log:s.log,disableLog:s.disableLog,browserDetails:s.detectBrowser(),extractVersion:s.extractVersion}},{}]},{},[2])(2)}),function(){"use strict";var e=function(e,t){this.channels={},this.channelsPromises={},this.callbacks=t||{};var i=this;e.ondatachannel=function(e){i._addChannel(e.channel)}};e.prototype={_addChannel:function(e){var t=this.channels[e.label];if(t){if(this.isInitiator)return t;this.closeChannel(e.label)}this.channels[e.label]=e;var i=$.Deferred(),n=i.promise();this.channelsPromises[e.label]=n;var s=this.callbacks,r=this;return e.onmessage=function(t){!s.onMessage||s.onMessage(e.label,!t||!t.data||JSON.parse(t.data))},e.onopen=function(t){!s.onOpen||s.onOpen(e.label,t),i.resolve(e)},e.onclose=function(t){!s.onClose||s.onClose(e.label,t),r._removeChannel(e)},n},_removeChannel:function(e){e.onmessage=null,e.onopen=null,e.onclose=null,delete this.channels[e.label]},_free:function(){this.callbacks={};for(var e in this.channels)this.channels.hasOwnProperty(e)&&this._removeChannel(this.channels[e]);for(var t in this.channelsPromises)this.channelsPromises.hasOwnProperty(t)&&(this.channelsPromises[t].reject(),delete this.channelsPromises[t])},getChannel:function(e,t){return this.channelsPromises[t]||this._addChannel(e.createDataChannel(t))},closeChannel:function(e){var t=this.channels[e];this._removeChannel(t),t.close()}};var t=function(t){var i=this.pc=new RTCPeerConnection;this.channels=new e(i,t);var n=$.Deferred();this.pcReady=n.promise(),i.oniceconnectionstatechange=function(){switch(i.iceConnectionState){case"checking":!t||!t.connected||t.onConnectionReady(),n.resolve();break;case"closed":!t||!t.connected||t.onConnectionClosed()}},i.onicecandidate=function(e){!e||!e.candidate||!t||!t.onICe||t.onICe(e.candidate)}};t.prototype={getOffer:function(e){this.channels.isInitiator=!0;var t=this.pc,i=$.Deferred();return this.channels._addChannel(t.createDataChannel("")),t.createOffer().then(function(e){t.setLocalDescription(e),i.resolve(e)},function(){console.error("WebRtc: offer creation fail")}),i.promise()},getAnswer:function(e){this.channels.isInitiator=!1;
var t=this.pc,i=$.Deferred();return this.channels._addChannel(t.createDataChannel("")),t.setRemoteDescription(new RTCSessionDescription(e)),t.createAnswer(function(e){t.setLocalDescription(e),i.resolve(e)},function(){console.error("WebRtc: answer creation fail")}),i.promise()},setAnswer:function(e){this.pc.setRemoteDescription(new RTCSessionDescription(e))},addICe:function(e){!e||this.pc.addIceCandidate(new RTCIceCandidate(e))},_free:function(){this.pc.oniceconnectionstatechange=null,this.pc.onicecandidate=null,this.channels._free(),delete this.channels,delete this.pc},close:function(){this.pc.close(),this._free()},isOpened:function(){return"completed"===this.pc.iceConnectionState},sendMessage:function(e,t){var i=this;this.pcReady.then(function(){i.channels.getChannel(i.pc,e).then(function(e){e.send(JSON.stringify(t))})})}};var i=window.webRtcMaster=function(){var e=this,t=(this.connections={},new window.webRtcSignalChannel);t.init({onOffer:function(i,n){var s=e._getConnection(i,t);s.getAnswer(n).then(function(t){e._getRelated(i).onOffer.resolve(t)}),e._getRelated(i).onBoth.then(function(e,i){t.sendOffer(e,i)})},onICe:function(i,n){e._getConnection(i,t).addICe(n)}}),this.subscribers=[],this.key=t.roomId,this.related={}};i.prototype={_getRelated:function(e){var t=this.related[e];return t||(t=this.related[e]={onIce:$.Deferred(),onOffer:$.Deferred()},t.onBoth=$.when(t.onOffer,t.onIce)),t},_getConnection:function(e){var i=this,n=this.connections[e];return n||(n=this.connections[e]=new t({onMessage:function(t,n){i._onMessage(e,t,n)},onOpen:function(t){i._onOpen(e,t)},onClose:function(t){i._onClose(e,t)},onConnectionReady:function(){},onConnectionClosed:function(){n._free(),delete i.connections[e]},onICe:function(t){var n=i._getRelated(e);n?n.onIce.resolve(t):i.sendMessage("",e,t)}})),n},subscribe:function(e,t,i,n,s){var r={key:t,lable:e,onMessage:i,onOpen:n,onClose:s};return this.subscribers.push(r),r},unSubscribe:function(e){var t=this.subscribers.indexOf(e);t<0||this.subscribers.splice(t,1)},sendMessage:function(e,t,i){var n=this.connections[t];!n||n.sendMessage(e,i)},sendBroadcastMessage:function(e,t){var i=[];for(var n in this.connections)this.connections.hasOwnProperty(n)&&i.push(connection.sendMessage(e,t))},_eachSubscriber:function(e,t,i){for(var n=0;n<this.subscribers.length;n++){var s=this.subscribers[n];e!==s.key&&s.key||t!==s.lable&&s.lable||i(s,n)}},_onMessage:function(e,t,i){if(""===t){var n=this.connections[e];return void(n&&n.addICe(i.message))}this._eachSubscriber(e,t,function(n){n.onMessage&&n.onMessage(t,e,i)})},_onOpen:function(e,t){this._eachSubscriber(e,t,function(i){i.onOpen&&i.onOpen(t,e)})},_onClose:function(e,t){this._eachSubscriber(e,t,function(i){i.onClose&&i.onClose(t,e)})}};var n=window.webRtcSlave=function(e){var i,n=this,s=new window.webRtcSignalChannel(e);s.init({onOffer:function(t,n){e===t&&i.setAnswer(n)},onICe:function(t,n){e===t&&i.addICe(n)}});var r=$.Deferred(),a=$.Deferred();i=this.connection=new t({onMessage:function(e,t){n._onMessage(e,t)},onOpen:function(e){n._onOpen(e)},onClose:function(e){n._onClose(e)},onConnectionReady:function(){},onConnectionClosed:function(){i._free()},onICe:function(e){a?a.resolve(e):n.sendMessage("",e)}}),i.getOffer(e).then(function(e){r.resolve(e)}),$.when(r,a).then(function(e,t){a=null,s.sendOffer(e,t)}),this.subscribers=[]};n.prototype={subscribe:function(e,t,i,n){var s={lable:e,onMessage:t,onOpen:i,onClose:n};return this.subscribers.push(s),s},unSubscribe:function(e){var t=this.subscribers.indexOf(e);t<0||this.subscribers.splice(t,1)},sendMessage:function(e,t){return!this.connection||this.connection.sendMessage(e,t)},_eachSubscriber:function(e,t){for(var i=0;i<this.subscribers.length;i++){var n=this.subscribers[i];e!==n.lable&&null!==n.lable||t(n,i)}},_onMessage:function(e,t){return""===e?void(this.connection&&this.connection.addICe(t.message)):void this._eachSubscriber(e,function(i){i.onMessage&&i.onMessage(e,t)})},_onOpen:function(e){this._eachSubscriber(e,function(t){t.onOpen&&t.onOpen(e)})},_onClose:function(e){this._eachSubscriber(e,function(t){t.onClose&&t.onClose(e)})}}}(),function(){"use strict";function e(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var i=$.Deferred();$.getScript("https://cdn.scaledrone.com/scaledrone.min.js",function(e,t,n){var s=new ScaleDrone("zjfWz5D7BUNHZhvX");s.on("open",function(e){e&&console.error(e),i.resolve(s)})});var n=window.webRtcSignalChannel=function(t){this.id=e(),this.room=$.Deferred(),this.roomId=t||this.id};n.prototype={init:function(e){var t=this;i.done(function(i){var n=i.subscribe(t.roomId);n.on("open",function(s){return s?console.error(s):("function"==typeof e.onInit&&e.onInit(t.roomId),void t.room.resolve(n,i))}),n.on("data",function(i){i&&i.id&&i.id!==t.id&&(console.log(i),i.offer&&e.onOffer(i.id,i.offer),i.iceClient&&e.onICe(i.id,i.iceClient))})})},sendOffer:function(e,t){var i=this;this.room.done(function(n,s){s.publish({room:i.roomId,message:{id:i.id,offer:e,iceClient:t}})})},sendIceClient:function(e){var t=this;this.room.done(function(i,n){n.publish({room:t.roomId,message:{id:t.id,iceClient:e}})})},stop:function(){this.room.done(function(e){e.unsubscribe()})}}}();var swfobject=function(){function e(){if(!H){try{var e=L.getElementsByTagName("body")[0].appendChild(g("span"));e.parentNode.removeChild(e)}catch(t){return}H=!0;for(var i=V.length,n=0;n<i;n++)V[n]()}}function t(e){H?e():V[V.length]=e}function i(e){if(typeof M.addEventListener!=D)M.addEventListener("load",e,!1);else if(typeof L.addEventListener!=D)L.addEventListener("load",e,!1);else if(typeof M.attachEvent!=D)v(M,"onload",e);else if("function"==typeof M.onload){var t=M.onload;M.onload=function(){t(),e()}}else M.onload=e}function n(){B?s():r()}function s(){var e=L.getElementsByTagName("body")[0],t=g(N);t.setAttribute("type",k);var i=e.appendChild(t);if(i){var n=0;!function(){if(typeof i.GetVariable!=D){var s=i.GetVariable("$version");s&&(s=s.split(" ")[1].split(","),X.pv=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)])}else if(n<10)return n++,void setTimeout(arguments.callee,10);e.removeChild(t),i=null,r()}()}else r()}function r(){var e=q.length;if(e>0)for(var t=0;t<e;t++){var i=q[t].id,n=q[t].callbackFn,s={success:!1,id:i};if(X.pv[0]>0){var r=m(i);if(r)if(!y(q[t].swfVersion)||X.wk&&X.wk<312)if(q[t].expressInstall&&o()){var c={};c.data=q[t].expressInstall,c.width=r.getAttribute("width")||"0",c.height=r.getAttribute("height")||"0",r.getAttribute("class")&&(c.styleclass=r.getAttribute("class")),r.getAttribute("align")&&(c.align=r.getAttribute("align"));for(var u={},p=r.getElementsByTagName("param"),d=p.length,f=0;f<d;f++)"movie"!=p[f].getAttribute("name").toLowerCase()&&(u[p[f].getAttribute("name")]=p[f].getAttribute("value"));h(c,u,i,n)}else l(r),n&&n(s);else b(i,!0),n&&(s.success=!0,s.ref=a(i),n(s))}else if(b(i,!0),n){var g=a(i);g&&typeof g.SetVariable!=D&&(s.success=!0,s.ref=g),n(s)}}}function a(e){var t=null,i=m(e);if(i&&"OBJECT"==i.nodeName)if(typeof i.SetVariable!=D)t=i;else{var n=i.getElementsByTagName(N)[0];n&&(t=n)}return t}function o(){return!U&&y("6.0.65")&&(X.win||X.mac)&&!(X.wk&&X.wk<312)}function h(e,t,i,n){U=!0,T=n||null,E={success:!1,id:i};var s=m(i);if(s){"OBJECT"==s.nodeName?(R=c(s),_=null):(R=s,_=i),e.id=P,(typeof e.width==D||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==D||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),L.title=L.title.slice(0,47)+" - Flash Player Installation";var r=X.ie&&X.win?"ActiveX":"PlugIn",a="MMredirectURL="+M.location.toString().replace(/&/g,"%26")+"&MMplayerType="+r+"&MMdoctitle="+L.title;if(typeof t.flashvars!=D?t.flashvars+="&"+a:t.flashvars=a,X.ie&&X.win&&4!=s.readyState){var o=g("div");i+="SWFObjectNew",o.setAttribute("id",i),s.parentNode.insertBefore(o,s),s.style.display="none",function(){4==s.readyState?s.parentNode.removeChild(s):setTimeout(arguments.callee,10)}()}u(e,t,i)}}function l(e){if(X.ie&&X.win&&4!=e.readyState){var t=g("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(c(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(c(e),e)}function c(e){var t=g("div");if(X.win&&X.ie)t.innerHTML=e.innerHTML;else{var i=e.getElementsByTagName(N)[0];if(i){var n=i.childNodes;if(n)for(var s=n.length,r=0;r<s;r++)1==n[r].nodeType&&"PARAM"==n[r].nodeName||8==n[r].nodeType||t.appendChild(n[r].cloneNode(!0))}}return t}function u(e,t,i){var n,s=m(i);if(X.wk&&X.wk<312)return n;if(s)if(typeof e.id==D&&(e.id=i),X.ie&&X.win){var r="";for(var a in e)e[a]!=Object.prototype[a]&&("data"==a.toLowerCase()?t.movie=e[a]:"styleclass"==a.toLowerCase()?r+=' class="'+e[a]+'"':"classid"!=a.toLowerCase()&&(r+=" "+a+'="'+e[a]+'"'));var o="";for(var h in t)t[h]!=Object.prototype[h]&&(o+='<param name="'+h+'" value="'+t[h]+'" />');s.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+r+">"+o+"</object>",G[G.length]=e.id,n=m(e.id)}else{var l=g(N);l.setAttribute("type",k);for(var c in e)e[c]!=Object.prototype[c]&&("styleclass"==c.toLowerCase()?l.setAttribute("class",e[c]):"classid"!=c.toLowerCase()&&l.setAttribute(c,e[c]));for(var u in t)t[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&p(l,u,t[u]);s.parentNode.replaceChild(l,s),n=l}return n}function p(e,t,i){var n=g("param");n.setAttribute("name",t),n.setAttribute("value",i),e.appendChild(n)}function d(e){var t=m(e);t&&"OBJECT"==t.nodeName&&(X.ie&&X.win?(t.style.display="none",function(){4==t.readyState?f(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function f(e){var t=m(e);if(t){for(var i in t)"function"==typeof t[i]&&(t[i]=null);t.parentNode.removeChild(t)}}function m(e){var t=null;try{t=L.getElementById(e)}catch(i){}return t}function g(e){return L.createElement(e)}function v(e,t,i){e.attachEvent(t,i),j[j.length]=[e,t,i]}function y(e){var t=X.pv,i=e.split(".");return i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10)||0,i[2]=parseInt(i[2],10)||0,t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]}function S(e,t,i,n){if(!X.ie||!X.mac){var s=L.getElementsByTagName("head")[0];if(s){var r=i&&"string"==typeof i?i:"screen";if(n&&(w=null,A=null),!w||A!=r){var a=g("style");a.setAttribute("type","text/css"),a.setAttribute("media",r),w=s.appendChild(a),X.ie&&X.win&&typeof L.styleSheets!=D&&L.styleSheets.length>0&&(w=L.styleSheets[L.styleSheets.length-1]),A=r}X.ie&&X.win?w&&typeof w.addRule==N&&w.addRule(e,t):w&&typeof L.createTextNode!=D&&w.appendChild(L.createTextNode(e+" {"+t+"}"))}}}function b(e,t){if(W){var i=t?"visible":"hidden";H&&m(e)?m(e).style.visibility=i:S("#"+e,"visibility:"+i)}}function C(e){var t=/[\\\"<>\.;]/,i=null!=t.exec(e);return i&&typeof encodeURIComponent!=D?encodeURIComponent(e):e}var R,_,T,E,w,A,D="undefined",N="object",I="Shockwave Flash",x="ShockwaveFlash.ShockwaveFlash",k="application/x-shockwave-flash",P="SWFObjectExprInst",O="onreadystatechange",M=window,L=document,F=navigator,B=!1,V=[n],q=[],G=[],j=[],H=!1,U=!1,W=!0,X=function(){var e=typeof L.getElementById!=D&&typeof L.getElementsByTagName!=D&&typeof L.createElement!=D,t=F.userAgent.toLowerCase(),i=F.platform.toLowerCase(),n=i?/win/.test(i):/win/.test(t),s=i?/mac/.test(i):/mac/.test(t),r=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),a=!1,o=[0,0,0],h=null;if(typeof F.plugins!=D&&typeof F.plugins[I]==N)h=F.plugins[I].description,!h||typeof F.mimeTypes!=D&&F.mimeTypes[k]&&!F.mimeTypes[k].enabledPlugin||(B=!0,a=!1,h=h.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),o[0]=parseInt(h.replace(/^(.*)\..*$/,"$1"),10),o[1]=parseInt(h.replace(/^.*\.(.*)\s.*$/,"$1"),10),o[2]=/[a-zA-Z]/.test(h)?parseInt(h.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof M.ActiveXObject!=D)try{var l=new ActiveXObject(x);l&&(h=l.GetVariable("$version"),h&&(a=!0,h=h.split(" ")[1].split(","),o=[parseInt(h[0],10),parseInt(h[1],10),parseInt(h[2],10)]))}catch(c){}return{w3:e,pv:o,wk:r,ie:a,win:n,mac:s}}();(function(){X.w3&&((typeof L.readyState!=D&&"complete"==L.readyState||typeof L.readyState==D&&(L.getElementsByTagName("body")[0]||L.body))&&e(),H||(typeof L.addEventListener!=D&&L.addEventListener("DOMContentLoaded",e,!1),X.ie&&X.win&&(L.attachEvent(O,function(){"complete"==L.readyState&&(L.detachEvent(O,arguments.callee),e())}),M==top&&!function(){if(!H){try{L.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),X.wk&&!function(){if(!H)return/loaded|complete/.test(L.readyState)?void e():void setTimeout(arguments.callee,0)}(),i(e)))})(),function(){X.ie&&X.win&&window.attachEvent("onunload",function(){for(var e=j.length,t=0;t<e;t++)j[t][0].detachEvent(j[t][1],j[t][2]);for(var i=G.length,n=0;n<i;n++)d(G[n]);for(var s in X)X[s]=null;X=null;for(var r in swfobject)swfobject[r]=null;swfobject=null})}();return{registerObject:function(e,t,i,n){if(X.w3&&e&&t){var s={};s.id=e,s.swfVersion=t,s.expressInstall=i,s.callbackFn=n,q[q.length]=s,b(e,!1)}else n&&n({success:!1,id:e})},getObjectById:function(e){if(X.w3)return a(e)},embedSWF:function(e,i,n,s,r,a,l,c,p,d){var f={success:!1,id:i};X.w3&&!(X.wk&&X.wk<312)&&e&&i&&n&&s&&r?(b(i,!1),t(function(){n+="",s+="";var t={};if(p&&typeof p===N)for(var m in p)t[m]=p[m];t.data=e,t.width=n,t.height=s;var g={};if(c&&typeof c===N)for(var v in c)g[v]=c[v];if(l&&typeof l===N)for(var S in l)typeof g.flashvars!=D?g.flashvars+="&"+S+"="+l[S]:g.flashvars=S+"="+l[S];if(y(r)){var C=u(t,g,i);t.id==i&&b(i,!0),f.success=!0,f.ref=C}else{if(a&&o())return t.data=a,void h(t,g,i,d);b(i,!0)}d&&d(f)})):d&&d(f)},switchOffAutoHideShow:function(){W=!1},ua:X,getFlashPlayerVersion:function(){return{major:X.pv[0],minor:X.pv[1],release:X.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(e,t,i){return X.w3?u(e,t,i):void 0},showExpressInstall:function(e,t,i,n){X.w3&&o()&&h(e,t,i,n)},removeSWF:function(e){X.w3&&d(e)},createCSS:function(e,t,i,n){X.w3&&S(e,t,i,n)},addDomLoadEvent:t,addLoadEvent:i,getQueryParamValue:function(e){var t=L.location.search||L.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return C(t);for(var i=t.split("&"),n=0;n<i.length;n++)if(i[n].substring(0,i[n].indexOf("="))==e)return C(i[n].substring(i[n].indexOf("=")+1))}return""},expressInstallCallback:function(){if(U){var e=m(P);e&&R&&(e.parentNode.replaceChild(R,e),_&&(b(_,!0),X.ie&&X.win&&(R.style.display="block")),T&&T(E)),U=!1}}}}();DynamicAudio.nextId=1,DynamicAudio.prototype={nextId:null,swf:"dynamicaudio.swf",audioElement:null,flashWrapper:null,flashElement:null,init:function(e){var t=this;if(t.id=DynamicAudio.nextId++,e&&"undefined"!=typeof e.swf&&(t.swf=e.swf),"undefined"!=typeof Audio&&(t.audioElement=new Audio,t.audioElement.mozSetup))return void t.audioElement.mozSetup(2,44100,1);t.audioElement=null,t.flashWrapper=document.createElement("div"),t.flashWrapper.id="dynamicaudio-flashwrapper-"+t.id;var i=t.flashWrapper.style;i.position="fixed",i.width=i.height="8px",i.bottom=i.left="0px",i.overflow="hidden",t.flashElement=document.createElement("div"),t.flashElement.id="dynamicaudio-flashelement-"+t.id,t.flashWrapper.appendChild(t.flashElement),document.body.appendChild(t.flashWrapper),swfobject.embedSWF(t.swf,t.flashElement.id,"8","8","9.0.0",null,null,{allowScriptAccess:"always"},null,function(e){t.flashElement=e.ref})},write:function(e){if(null!=this.audioElement)this.audioElement.mozWriteAudio(e.length,e);else if(null!=this.flashElement){for(var t=new Array(e.length),i=e.length-1;0!=i;i--)t[i]=Math.floor(32768*e[i]);this.flashElement.write(t.join(" "))}},writeInt:function(e){if(null!=this.audioElement){for(var t=new Array(e.length),i=e.length-1;0!=i;i--)t[i]=Math.floor(e[i]/32768);this.audioElement.mozWriteAudio(t.length,t)}else null!=this.flashElement&&this.flashElement.write(e.join(" "))}};var JSNES=function(e){if(this.opts={ui:JSNES.DummyUI,swfPath:"lib/",preferredFrameRate:60,fpsInterval:500,showDisplay:!0,emulateSound:!1,sampleRate:44100,CPU_FREQ_NTSC:1789772.5,CPU_FREQ_PAL:1773447.4},"undefined"!=typeof e){var t;for(t in this.opts)"undefined"!=typeof e[t]&&(this.opts[t]=e[t])}this.frameTime=1e3/this.opts.preferredFrameRate,this.ui=new this.opts.ui(this),this.cpu=new JSNES.CPU(this),this.ppu=new JSNES.PPU(this),this.papu=new JSNES.PAPU(this),this.mmap=null,this.keyboard=new JSNES.Keyboard,this.ui.updateStatus("Ready to load a ROM.")};JSNES.VERSION="<%= version %>",JSNES.prototype={isRunning:!1,fpsFrameCount:0,romData:null,reset:function(){null!==this.mmap&&this.mmap.reset(),this.cpu.reset(),this.ppu.reset(),this.papu.reset()},start:function(){var e=this;null!==this.rom&&this.rom.valid?this.isRunning||(this.isRunning=!0,this.frameInterval=setInterval(function(){e.frame()},this.frameTime),this.resetFps(),this.printFps(),this.fpsInterval=setInterval(function(){e.printFps()},this.opts.fpsInterval)):this.ui.updateStatus("There is no ROM loaded, or it is invalid.")},frame:function(){this.ppu.startFrame();var e=0,t=this.opts.emulateSound,i=this.cpu,n=this.ppu,s=this.papu;e:for(;;)for(0===i.cyclesToHalt?(e=i.emulate(),t&&s.clockFrameCounter(e),e*=3):i.cyclesToHalt>8?(e=24,t&&s.clockFrameCounter(8),i.cyclesToHalt-=8):(e=3*i.cyclesToHalt,t&&s.clockFrameCounter(i.cyclesToHalt),i.cyclesToHalt=0);e>0;e--){if(n.curX===n.spr0HitX&&1===n.f_spVisibility&&n.scanline-21===n.spr0HitY&&n.setStatusFlag(n.STATUS_SPRITE0HIT,!0),n.requestEndFrame&&(n.nmiCounter--,0===n.nmiCounter)){n.requestEndFrame=!1,n.startVBlank();break e}n.curX++,341===n.curX&&(n.curX=0,n.endScanline())}this.fpsFrameCount++},printFps:function(){var e=+new Date,t="Running";this.lastFpsTime&&(t+=": "+(this.fpsFrameCount/((e-this.lastFpsTime)/1e3)).toFixed(2)+" FPS"),this.ui.updateStatus(t),this.fpsFrameCount=0,this.lastFpsTime=e},stop:function(){clearInterval(this.frameInterval),clearInterval(this.fpsInterval),this.isRunning=!1},reloadRom:function(){null!==this.romData&&this.loadRom(this.romData)},loadRom:function(e){if(this.isRunning&&this.stop(),this.ui.updateStatus("Loading ROM..."),this.rom=new JSNES.ROM(this),this.rom.load(e),this.rom.valid){if(this.reset(),this.mmap=this.rom.createMapper(),!this.mmap)return;this.mmap.loadROM(),this.ppu.setMirroring(this.rom.getMirroringType()),this.romData=e,this.ui.updateStatus("Successfully loaded. Ready to be started.")}else this.ui.updateStatus("Invalid ROM!");return this.rom.valid},resetFps:function(){this.lastFpsTime=null,this.fpsFrameCount=0},setFramerate:function(e){this.opts.preferredFrameRate=e,this.frameTime=1e3/e,this.papu.setSampleRate(this.opts.sampleRate,!1)},toJSON:function(){return{romData:this.romData,cpu:this.cpu.toJSON(),mmap:this.mmap.toJSON(),ppu:this.ppu.toJSON()}},fromJSON:function(e){this.loadRom(e.romData),this.cpu.fromJSON(e.cpu),this.mmap.fromJSON(e.mmap),this.ppu.fromJSON(e.ppu)}},JSNES.Utils={copyArrayElements:function(e,t,i,n,s){for(var r=0;r<s;++r)i[n+r]=e[t+r]},copyArray:function(e){for(var t=new Array(e.length),i=0;i<e.length;i++)t[i]=e[i];return t},fromJSON:function(e,t){for(var i=0;i<e.JSON_PROPERTIES.length;i++)e[e.JSON_PROPERTIES[i]]=t[e.JSON_PROPERTIES[i]]},toJSON:function(e){for(var t={},i=0;i<e.JSON_PROPERTIES.length;i++)t[e.JSON_PROPERTIES[i]]=e[e.JSON_PROPERTIES[i]];return t},isIE:function(){return/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)}},JSNES.CPU=function(e){this.nes=e,this.mem=null,this.REG_ACC=null,this.REG_X=null,this.REG_Y=null,this.REG_SP=null,this.REG_PC=null,this.REG_PC_NEW=null,this.REG_STATUS=null,this.F_CARRY=null,this.F_DECIMAL=null,this.F_INTERRUPT=null,this.F_INTERRUPT_NEW=null,this.F_OVERFLOW=null,this.F_SIGN=null,this.F_ZERO=null,this.F_NOTUSED=null,this.F_NOTUSED_NEW=null,this.F_BRK=null,this.F_BRK_NEW=null,this.opdata=null,this.cyclesToHalt=null,this.crash=null,this.irqRequested=null,this.irqType=null,this.reset()},JSNES.CPU.prototype={IRQ_NORMAL:0,IRQ_NMI:1,IRQ_RESET:2,reset:function(){this.mem=new Array(65536);for(var e=0;e<8192;e++)this.mem[e]=255;for(var t=0;t<4;t++){var e=2048*t;this.mem[e+8]=247,this.mem[e+9]=239,this.mem[e+10]=223,this.mem[e+15]=191}for(var e=8193;e<this.mem.length;e++)this.mem[e]=0;this.REG_ACC=0,this.REG_X=0,this.REG_Y=0,this.REG_SP=511,this.REG_PC=32767,this.REG_PC_NEW=32767,this.REG_STATUS=40,this.setStatus(40),this.F_CARRY=0,this.F_DECIMAL=0,this.F_INTERRUPT=1,this.F_INTERRUPT_NEW=1,this.F_OVERFLOW=0,this.F_SIGN=0,this.F_ZERO=1,this.F_NOTUSED=1,this.F_NOTUSED_NEW=1,this.F_BRK=1,this.F_BRK_NEW=1,this.opdata=(new JSNES.CPU.OpData).opdata,this.cyclesToHalt=0,this.crash=!1,this.irqRequested=!1,this.irqType=null},emulate:function(){var e,t;if(this.irqRequested){switch(e=this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7,this.REG_PC_NEW=this.REG_PC,this.F_INTERRUPT_NEW=this.F_INTERRUPT,this.irqType){case 0:if(0!=this.F_INTERRUPT)break;this.doIrq(e);break;case 1:this.doNonMaskableInterrupt(e);break;case 2:this.doResetInterrupt()}this.REG_PC=this.REG_PC_NEW,this.F_INTERRUPT=this.F_INTERRUPT_NEW,this.F_BRK=this.F_BRK_NEW,this.irqRequested=!1}var i=this.opdata[this.nes.mmap.load(this.REG_PC+1)],n=i>>24,s=0,r=i>>8&255,a=this.REG_PC;this.REG_PC+=i>>16&255;var o=0;switch(r){case 0:o=this.load(a+2);break;case 1:o=this.load(a+2),o+=o<128?this.REG_PC:this.REG_PC-256;break;case 2:break;case 3:o=this.load16bit(a+2);break;case 4:o=this.REG_ACC;break;case 5:o=this.REG_PC;break;case 6:o=this.load(a+2)+this.REG_X&255;break;case 7:o=this.load(a+2)+this.REG_Y&255;break;case 8:o=this.load16bit(a+2),(65280&o)!=(o+this.REG_X&65280)&&(s=1),o+=this.REG_X;break;case 9:o=this.load16bit(a+2),(65280&o)!=(o+this.REG_Y&65280)&&(s=1),o+=this.REG_Y;break;case 10:o=this.load(a+2),(65280&o)!=(o+this.REG_X&65280)&&(s=1),o+=this.REG_X,o&=255,o=this.load16bit(o);break;case 11:o=this.load16bit(this.load(a+2)),(65280&o)!=(o+this.REG_Y&65280)&&(s=1),o+=this.REG_Y;break;case 12:o=this.load16bit(a+2),o=o<8191?this.mem[o]+(this.mem[65280&o|(255&o)+1&255]<<8):this.nes.mmap.load(o)+(this.nes.mmap.load(65280&o|(255&o)+1&255)<<8)}switch(o&=65535,255&i){case 0:e=this.REG_ACC+this.load(o)+this.F_CARRY,this.F_OVERFLOW=0==(128&(this.REG_ACC^this.load(o)))&&0!=(128&(this.REG_ACC^e))?1:0,this.F_CARRY=e>255?1:0,this.F_SIGN=e>>7&1,this.F_ZERO=255&e,this.REG_ACC=255&e,n+=s;break;case 1:this.REG_ACC=this.REG_ACC&this.load(o),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!=r&&(n+=s);break;case 2:4==r?(this.F_CARRY=this.REG_ACC>>7&1,this.REG_ACC=this.REG_ACC<<1&255,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC):(e=this.load(o),this.F_CARRY=e>>7&1,e=e<<1&255,this.F_SIGN=e>>7&1,this.F_ZERO=e,this.write(o,e));break;case 3:0==this.F_CARRY&&(n+=(65280&a)!=(65280&o)?2:1,this.REG_PC=o);break;case 4:1==this.F_CARRY&&(n+=(65280&a)!=(65280&o)?2:1,this.REG_PC=o);break;case 5:0==this.F_ZERO&&(n+=(65280&a)!=(65280&o)?2:1,this.REG_PC=o);break;case 6:e=this.load(o),this.F_SIGN=e>>7&1,this.F_OVERFLOW=e>>6&1,e&=this.REG_ACC,this.F_ZERO=e;break;case 7:1==this.F_SIGN&&(n++,this.REG_PC=o);break;case 8:0!=this.F_ZERO&&(n+=(65280&a)!=(65280&o)?2:1,this.REG_PC=o);break;case 9:0==this.F_SIGN&&(n+=(65280&a)!=(65280&o)?2:1,this.REG_PC=o);break;case 10:this.REG_PC+=2,this.push(this.REG_PC>>8&255),this.push(255&this.REG_PC),this.F_BRK=1,this.push(this.F_CARRY|(0==this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7),this.F_INTERRUPT=1,this.REG_PC=this.load16bit(65534),this.REG_PC--;break;case 11:0==this.F_OVERFLOW&&(n+=(65280&a)!=(65280&o)?2:1,this.REG_PC=o);break;case 12:1==this.F_OVERFLOW&&(n+=(65280&a)!=(65280&o)?2:1,this.REG_PC=o);break;case 13:this.F_CARRY=0;break;case 14:this.F_DECIMAL=0;break;case 15:this.F_INTERRUPT=0;break;case 16:this.F_OVERFLOW=0;break;case 17:e=this.REG_ACC-this.load(o),this.F_CARRY=e>=0?1:0,this.F_SIGN=e>>7&1,this.F_ZERO=255&e,n+=s;break;case 18:e=this.REG_X-this.load(o),this.F_CARRY=e>=0?1:0,this.F_SIGN=e>>7&1,this.F_ZERO=255&e;break;case 19:e=this.REG_Y-this.load(o),this.F_CARRY=e>=0?1:0,this.F_SIGN=e>>7&1,this.F_ZERO=255&e;break;case 20:e=this.load(o)-1&255,this.F_SIGN=e>>7&1,this.F_ZERO=e,this.write(o,e);break;case 21:this.REG_X=this.REG_X-1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 22:this.REG_Y=this.REG_Y-1&255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 23:this.REG_ACC=255&(this.load(o)^this.REG_ACC),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,n+=s;break;case 24:e=this.load(o)+1&255,this.F_SIGN=e>>7&1,this.F_ZERO=e,this.write(o,255&e);break;case 25:this.REG_X=this.REG_X+1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 26:this.REG_Y++,this.REG_Y&=255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 27:this.REG_PC=o-1;break;case 28:this.push(this.REG_PC>>8&255),this.push(255&this.REG_PC),this.REG_PC=o-1;break;case 29:this.REG_ACC=this.load(o),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,n+=s;break;case 30:this.REG_X=this.load(o),this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X,n+=s;break;case 31:this.REG_Y=this.load(o),this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y,n+=s;break;case 32:4==r?(e=255&this.REG_ACC,this.F_CARRY=1&e,e>>=1,this.REG_ACC=e):(e=255&this.load(o),this.F_CARRY=1&e,e>>=1,this.write(o,e)),this.F_SIGN=0,this.F_ZERO=e;break;case 33:break;case 34:e=255&(this.load(o)|this.REG_ACC),this.F_SIGN=e>>7&1,this.F_ZERO=e,this.REG_ACC=e,11!=r&&(n+=s);break;case 35:this.push(this.REG_ACC);break;case 36:this.F_BRK=1,this.push(this.F_CARRY|(0==this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7);break;case 37:this.REG_ACC=this.pull(),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 38:e=this.pull(),this.F_CARRY=1&e,this.F_ZERO=1==(e>>1&1)?0:1,this.F_INTERRUPT=e>>2&1,this.F_DECIMAL=e>>3&1,this.F_BRK=e>>4&1,this.F_NOTUSED=e>>5&1,this.F_OVERFLOW=e>>6&1,this.F_SIGN=e>>7&1,this.F_NOTUSED=1;break;case 39:4==r?(e=this.REG_ACC,t=this.F_CARRY,this.F_CARRY=e>>7&1,e=(e<<1&255)+t,this.REG_ACC=e):(e=this.load(o),t=this.F_CARRY,this.F_CARRY=e>>7&1,e=(e<<1&255)+t,this.write(o,e)),this.F_SIGN=e>>7&1,this.F_ZERO=e;break;case 40:4==r?(t=this.F_CARRY<<7,this.F_CARRY=1&this.REG_ACC,e=(this.REG_ACC>>1)+t,this.REG_ACC=e):(e=this.load(o),t=this.F_CARRY<<7,this.F_CARRY=1&e,e=(e>>1)+t,this.write(o,e)),this.F_SIGN=e>>7&1,this.F_ZERO=e;break;case 41:if(e=this.pull(),this.F_CARRY=1&e,this.F_ZERO=0==(e>>1&1)?1:0,this.F_INTERRUPT=e>>2&1,this.F_DECIMAL=e>>3&1,this.F_BRK=e>>4&1,this.F_NOTUSED=e>>5&1,this.F_OVERFLOW=e>>6&1,this.F_SIGN=e>>7&1,this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,65535==this.REG_PC)return;this.REG_PC--,this.F_NOTUSED=1;break;case 42:if(this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,65535==this.REG_PC)return;break;case 43:e=this.REG_ACC-this.load(o)-(1-this.F_CARRY),this.F_SIGN=e>>7&1,this.F_ZERO=255&e,this.F_OVERFLOW=0!=(128&(this.REG_ACC^e))&&0!=(128&(this.REG_ACC^this.load(o)))?1:0,this.F_CARRY=e<0?0:1,this.REG_ACC=255&e,11!=r&&(n+=s);break;case 44:this.F_CARRY=1;break;case 45:this.F_DECIMAL=1;break;case 46:this.F_INTERRUPT=1;break;case 47:this.write(o,this.REG_ACC);break;case 48:this.write(o,this.REG_X);break;case 49:this.write(o,this.REG_Y);break;case 50:this.REG_X=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 51:this.REG_Y=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 52:this.REG_X=this.REG_SP-256,this.F_SIGN=this.REG_SP>>7&1,this.F_ZERO=this.REG_X;break;case 53:this.REG_ACC=this.REG_X,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 54:this.REG_SP=this.REG_X+256,this.stackWrap();break;case 55:this.REG_ACC=this.REG_Y,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;default:this.nes.stop(),this.nes.crashMessage="Game crashed, invalid opcode at address $"+a.toString(16)}return n},load:function(e){return e<8192?this.mem[2047&e]:this.nes.mmap.load(e)},load16bit:function(e){return e<8191?this.mem[2047&e]|this.mem[e+1&2047]<<8:this.nes.mmap.load(e)|this.nes.mmap.load(e+1)<<8},write:function(e,t){e<8192?this.mem[2047&e]=t:this.nes.mmap.write(e,t)},requestIrq:function(e){this.irqRequested&&e==this.IRQ_NORMAL||(this.irqRequested=!0,this.irqType=e)},push:function(e){this.nes.mmap.write(this.REG_SP,e),this.REG_SP--,this.REG_SP=256|255&this.REG_SP},stackWrap:function(){this.REG_SP=256|255&this.REG_SP},pull:function(){return this.REG_SP++,this.REG_SP=256|255&this.REG_SP,this.nes.mmap.load(this.REG_SP)},pageCrossed:function(e,t){return(65280&e)!=(65280&t)},haltCycles:function(e){this.cyclesToHalt+=e},doNonMaskableInterrupt:function(e){0!=(128&this.nes.mmap.load(8192))&&(this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(255&this.REG_PC_NEW),this.push(e),this.REG_PC_NEW=this.nes.mmap.load(65530)|this.nes.mmap.load(65531)<<8,this.REG_PC_NEW--)},doResetInterrupt:function(){this.REG_PC_NEW=this.nes.mmap.load(65532)|this.nes.mmap.load(65533)<<8,this.REG_PC_NEW--},doIrq:function(e){this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(255&this.REG_PC_NEW),this.push(e),this.F_INTERRUPT_NEW=1,this.F_BRK_NEW=0,this.REG_PC_NEW=this.nes.mmap.load(65534)|this.nes.mmap.load(65535)<<8,this.REG_PC_NEW--},getStatus:function(){return this.F_CARRY|this.F_ZERO<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7},setStatus:function(e){this.F_CARRY=1&e,this.F_ZERO=e>>1&1,this.F_INTERRUPT=e>>2&1,this.F_DECIMAL=e>>3&1,this.F_BRK=e>>4&1,this.F_NOTUSED=e>>5&1,this.F_OVERFLOW=e>>6&1,this.F_SIGN=e>>7&1},JSON_PROPERTIES:["mem","cyclesToHalt","irqRequested","irqType","REG_ACC","REG_X","REG_Y","REG_SP","REG_PC","REG_PC_NEW","REG_STATUS","F_CARRY","F_DECIMAL","F_INTERRUPT","F_INTERRUPT_NEW","F_OVERFLOW","F_SIGN","F_ZERO","F_NOTUSED","F_NOTUSED_NEW","F_BRK","F_BRK_NEW"],toJSON:function(){return JSNES.Utils.toJSON(this)},fromJSON:function(e){JSNES.Utils.fromJSON(this,e)}},JSNES.CPU.OpData=function(){this.opdata=new Array(256);for(var e=0;e<256;e++)this.opdata[e]=255;this.setOp(this.INS_ADC,105,this.ADDR_IMM,2,2),this.setOp(this.INS_ADC,101,this.ADDR_ZP,2,3),this.setOp(this.INS_ADC,117,this.ADDR_ZPX,2,4),this.setOp(this.INS_ADC,109,this.ADDR_ABS,3,4),this.setOp(this.INS_ADC,125,this.ADDR_ABSX,3,4),this.setOp(this.INS_ADC,121,this.ADDR_ABSY,3,4),this.setOp(this.INS_ADC,97,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ADC,113,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_AND,41,this.ADDR_IMM,2,2),this.setOp(this.INS_AND,37,this.ADDR_ZP,2,3),this.setOp(this.INS_AND,53,this.ADDR_ZPX,2,4),this.setOp(this.INS_AND,45,this.ADDR_ABS,3,4),this.setOp(this.INS_AND,61,this.ADDR_ABSX,3,4),this.setOp(this.INS_AND,57,this.ADDR_ABSY,3,4),this.setOp(this.INS_AND,33,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_AND,49,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_ASL,10,this.ADDR_ACC,1,2),this.setOp(this.INS_ASL,6,this.ADDR_ZP,2,5),this.setOp(this.INS_ASL,22,this.ADDR_ZPX,2,6),this.setOp(this.INS_ASL,14,this.ADDR_ABS,3,6),this.setOp(this.INS_ASL,30,this.ADDR_ABSX,3,7),this.setOp(this.INS_BCC,144,this.ADDR_REL,2,2),this.setOp(this.INS_BCS,176,this.ADDR_REL,2,2),this.setOp(this.INS_BEQ,240,this.ADDR_REL,2,2),this.setOp(this.INS_BIT,36,this.ADDR_ZP,2,3),this.setOp(this.INS_BIT,44,this.ADDR_ABS,3,4),this.setOp(this.INS_BMI,48,this.ADDR_REL,2,2),this.setOp(this.INS_BNE,208,this.ADDR_REL,2,2),this.setOp(this.INS_BPL,16,this.ADDR_REL,2,2),this.setOp(this.INS_BRK,0,this.ADDR_IMP,1,7),this.setOp(this.INS_BVC,80,this.ADDR_REL,2,2),this.setOp(this.INS_BVS,112,this.ADDR_REL,2,2),this.setOp(this.INS_CLC,24,this.ADDR_IMP,1,2),this.setOp(this.INS_CLD,216,this.ADDR_IMP,1,2),this.setOp(this.INS_CLI,88,this.ADDR_IMP,1,2),this.setOp(this.INS_CLV,184,this.ADDR_IMP,1,2),this.setOp(this.INS_CMP,201,this.ADDR_IMM,2,2),this.setOp(this.INS_CMP,197,this.ADDR_ZP,2,3),this.setOp(this.INS_CMP,213,this.ADDR_ZPX,2,4),this.setOp(this.INS_CMP,205,this.ADDR_ABS,3,4),this.setOp(this.INS_CMP,221,this.ADDR_ABSX,3,4),this.setOp(this.INS_CMP,217,this.ADDR_ABSY,3,4),
this.setOp(this.INS_CMP,193,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_CMP,209,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_CPX,224,this.ADDR_IMM,2,2),this.setOp(this.INS_CPX,228,this.ADDR_ZP,2,3),this.setOp(this.INS_CPX,236,this.ADDR_ABS,3,4),this.setOp(this.INS_CPY,192,this.ADDR_IMM,2,2),this.setOp(this.INS_CPY,196,this.ADDR_ZP,2,3),this.setOp(this.INS_CPY,204,this.ADDR_ABS,3,4),this.setOp(this.INS_DEC,198,this.ADDR_ZP,2,5),this.setOp(this.INS_DEC,214,this.ADDR_ZPX,2,6),this.setOp(this.INS_DEC,206,this.ADDR_ABS,3,6),this.setOp(this.INS_DEC,222,this.ADDR_ABSX,3,7),this.setOp(this.INS_DEX,202,this.ADDR_IMP,1,2),this.setOp(this.INS_DEY,136,this.ADDR_IMP,1,2),this.setOp(this.INS_EOR,73,this.ADDR_IMM,2,2),this.setOp(this.INS_EOR,69,this.ADDR_ZP,2,3),this.setOp(this.INS_EOR,85,this.ADDR_ZPX,2,4),this.setOp(this.INS_EOR,77,this.ADDR_ABS,3,4),this.setOp(this.INS_EOR,93,this.ADDR_ABSX,3,4),this.setOp(this.INS_EOR,89,this.ADDR_ABSY,3,4),this.setOp(this.INS_EOR,65,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_EOR,81,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_INC,230,this.ADDR_ZP,2,5),this.setOp(this.INS_INC,246,this.ADDR_ZPX,2,6),this.setOp(this.INS_INC,238,this.ADDR_ABS,3,6),this.setOp(this.INS_INC,254,this.ADDR_ABSX,3,7),this.setOp(this.INS_INX,232,this.ADDR_IMP,1,2),this.setOp(this.INS_INY,200,this.ADDR_IMP,1,2),this.setOp(this.INS_JMP,76,this.ADDR_ABS,3,3),this.setOp(this.INS_JMP,108,this.ADDR_INDABS,3,5),this.setOp(this.INS_JSR,32,this.ADDR_ABS,3,6),this.setOp(this.INS_LDA,169,this.ADDR_IMM,2,2),this.setOp(this.INS_LDA,165,this.ADDR_ZP,2,3),this.setOp(this.INS_LDA,181,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDA,173,this.ADDR_ABS,3,4),this.setOp(this.INS_LDA,189,this.ADDR_ABSX,3,4),this.setOp(this.INS_LDA,185,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDA,161,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_LDA,177,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_LDX,162,this.ADDR_IMM,2,2),this.setOp(this.INS_LDX,166,this.ADDR_ZP,2,3),this.setOp(this.INS_LDX,182,this.ADDR_ZPY,2,4),this.setOp(this.INS_LDX,174,this.ADDR_ABS,3,4),this.setOp(this.INS_LDX,190,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDY,160,this.ADDR_IMM,2,2),this.setOp(this.INS_LDY,164,this.ADDR_ZP,2,3),this.setOp(this.INS_LDY,180,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDY,172,this.ADDR_ABS,3,4),this.setOp(this.INS_LDY,188,this.ADDR_ABSX,3,4),this.setOp(this.INS_LSR,74,this.ADDR_ACC,1,2),this.setOp(this.INS_LSR,70,this.ADDR_ZP,2,5),this.setOp(this.INS_LSR,86,this.ADDR_ZPX,2,6),this.setOp(this.INS_LSR,78,this.ADDR_ABS,3,6),this.setOp(this.INS_LSR,94,this.ADDR_ABSX,3,7),this.setOp(this.INS_NOP,234,this.ADDR_IMP,1,2),this.setOp(this.INS_ORA,9,this.ADDR_IMM,2,2),this.setOp(this.INS_ORA,5,this.ADDR_ZP,2,3),this.setOp(this.INS_ORA,21,this.ADDR_ZPX,2,4),this.setOp(this.INS_ORA,13,this.ADDR_ABS,3,4),this.setOp(this.INS_ORA,29,this.ADDR_ABSX,3,4),this.setOp(this.INS_ORA,25,this.ADDR_ABSY,3,4),this.setOp(this.INS_ORA,1,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ORA,17,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_PHA,72,this.ADDR_IMP,1,3),this.setOp(this.INS_PHP,8,this.ADDR_IMP,1,3),this.setOp(this.INS_PLA,104,this.ADDR_IMP,1,4),this.setOp(this.INS_PLP,40,this.ADDR_IMP,1,4),this.setOp(this.INS_ROL,42,this.ADDR_ACC,1,2),this.setOp(this.INS_ROL,38,this.ADDR_ZP,2,5),this.setOp(this.INS_ROL,54,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROL,46,this.ADDR_ABS,3,6),this.setOp(this.INS_ROL,62,this.ADDR_ABSX,3,7),this.setOp(this.INS_ROR,106,this.ADDR_ACC,1,2),this.setOp(this.INS_ROR,102,this.ADDR_ZP,2,5),this.setOp(this.INS_ROR,118,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROR,110,this.ADDR_ABS,3,6),this.setOp(this.INS_ROR,126,this.ADDR_ABSX,3,7),this.setOp(this.INS_RTI,64,this.ADDR_IMP,1,6),this.setOp(this.INS_RTS,96,this.ADDR_IMP,1,6),this.setOp(this.INS_SBC,233,this.ADDR_IMM,2,2),this.setOp(this.INS_SBC,229,this.ADDR_ZP,2,3),this.setOp(this.INS_SBC,245,this.ADDR_ZPX,2,4),this.setOp(this.INS_SBC,237,this.ADDR_ABS,3,4),this.setOp(this.INS_SBC,253,this.ADDR_ABSX,3,4),this.setOp(this.INS_SBC,249,this.ADDR_ABSY,3,4),this.setOp(this.INS_SBC,225,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_SBC,241,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_SEC,56,this.ADDR_IMP,1,2),this.setOp(this.INS_SED,248,this.ADDR_IMP,1,2),this.setOp(this.INS_SEI,120,this.ADDR_IMP,1,2),this.setOp(this.INS_STA,133,this.ADDR_ZP,2,3),this.setOp(this.INS_STA,149,this.ADDR_ZPX,2,4),this.setOp(this.INS_STA,141,this.ADDR_ABS,3,4),this.setOp(this.INS_STA,157,this.ADDR_ABSX,3,5),this.setOp(this.INS_STA,153,this.ADDR_ABSY,3,5),this.setOp(this.INS_STA,129,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_STA,145,this.ADDR_POSTIDXIND,2,6),this.setOp(this.INS_STX,134,this.ADDR_ZP,2,3),this.setOp(this.INS_STX,150,this.ADDR_ZPY,2,4),this.setOp(this.INS_STX,142,this.ADDR_ABS,3,4),this.setOp(this.INS_STY,132,this.ADDR_ZP,2,3),this.setOp(this.INS_STY,148,this.ADDR_ZPX,2,4),this.setOp(this.INS_STY,140,this.ADDR_ABS,3,4),this.setOp(this.INS_TAX,170,this.ADDR_IMP,1,2),this.setOp(this.INS_TAY,168,this.ADDR_IMP,1,2),this.setOp(this.INS_TSX,186,this.ADDR_IMP,1,2),this.setOp(this.INS_TXA,138,this.ADDR_IMP,1,2),this.setOp(this.INS_TXS,154,this.ADDR_IMP,1,2),this.setOp(this.INS_TYA,152,this.ADDR_IMP,1,2),this.cycTable=new Array(7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,3,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7),this.instname=new Array(56),this.instname[0]="ADC",this.instname[1]="AND",this.instname[2]="ASL",this.instname[3]="BCC",this.instname[4]="BCS",this.instname[5]="BEQ",this.instname[6]="BIT",this.instname[7]="BMI",this.instname[8]="BNE",this.instname[9]="BPL",this.instname[10]="BRK",this.instname[11]="BVC",this.instname[12]="BVS",this.instname[13]="CLC",this.instname[14]="CLD",this.instname[15]="CLI",this.instname[16]="CLV",this.instname[17]="CMP",this.instname[18]="CPX",this.instname[19]="CPY",this.instname[20]="DEC",this.instname[21]="DEX",this.instname[22]="DEY",this.instname[23]="EOR",this.instname[24]="INC",this.instname[25]="INX",this.instname[26]="INY",this.instname[27]="JMP",this.instname[28]="JSR",this.instname[29]="LDA",this.instname[30]="LDX",this.instname[31]="LDY",this.instname[32]="LSR",this.instname[33]="NOP",this.instname[34]="ORA",this.instname[35]="PHA",this.instname[36]="PHP",this.instname[37]="PLA",this.instname[38]="PLP",this.instname[39]="ROL",this.instname[40]="ROR",this.instname[41]="RTI",this.instname[42]="RTS",this.instname[43]="SBC",this.instname[44]="SEC",this.instname[45]="SED",this.instname[46]="SEI",this.instname[47]="STA",this.instname[48]="STX",this.instname[49]="STY",this.instname[50]="TAX",this.instname[51]="TAY",this.instname[52]="TSX",this.instname[53]="TXA",this.instname[54]="TXS",this.instname[55]="TYA",this.addrDesc=new Array("Zero Page           ","Relative            ","Implied             ","Absolute            ","Accumulator         ","Immediate           ","Zero Page,X         ","Zero Page,Y         ","Absolute,X          ","Absolute,Y          ","Preindexed Indirect ","Postindexed Indirect","Indirect Absolute   ")},JSNES.CPU.OpData.prototype={INS_ADC:0,INS_AND:1,INS_ASL:2,INS_BCC:3,INS_BCS:4,INS_BEQ:5,INS_BIT:6,INS_BMI:7,INS_BNE:8,INS_BPL:9,INS_BRK:10,INS_BVC:11,INS_BVS:12,INS_CLC:13,INS_CLD:14,INS_CLI:15,INS_CLV:16,INS_CMP:17,INS_CPX:18,INS_CPY:19,INS_DEC:20,INS_DEX:21,INS_DEY:22,INS_EOR:23,INS_INC:24,INS_INX:25,INS_INY:26,INS_JMP:27,INS_JSR:28,INS_LDA:29,INS_LDX:30,INS_LDY:31,INS_LSR:32,INS_NOP:33,INS_ORA:34,INS_PHA:35,INS_PHP:36,INS_PLA:37,INS_PLP:38,INS_ROL:39,INS_ROR:40,INS_RTI:41,INS_RTS:42,INS_SBC:43,INS_SEC:44,INS_SED:45,INS_SEI:46,INS_STA:47,INS_STX:48,INS_STY:49,INS_TAX:50,INS_TAY:51,INS_TSX:52,INS_TXA:53,INS_TXS:54,INS_TYA:55,INS_DUMMY:56,ADDR_ZP:0,ADDR_REL:1,ADDR_IMP:2,ADDR_ABS:3,ADDR_ACC:4,ADDR_IMM:5,ADDR_ZPX:6,ADDR_ZPY:7,ADDR_ABSX:8,ADDR_ABSY:9,ADDR_PREIDXIND:10,ADDR_POSTIDXIND:11,ADDR_INDABS:12,setOp:function(e,t,i,n,s){this.opdata[t]=255&e|(255&i)<<8|(255&n)<<16|(255&s)<<24}},JSNES.Keyboard=function(){var e;for(this.keys={KEY_A:0,KEY_B:1,KEY_SELECT:2,KEY_START:3,KEY_UP:4,KEY_DOWN:5,KEY_LEFT:6,KEY_RIGHT:7},this.keyState={KEY_DOWN:65,KEY_UP:64},this.state1=new Array(8),e=0;e<this.state1.length;e++)this.state1[e]=64;for(this.state2=new Array(8),e=0;e<this.state2.length;e++)this.state2[e]=64},JSNES.Keyboard.prototype={setKey:function(e,t){switch(e){case 88:this.state1[this.keys.KEY_A]=t;break;case 89:this.state1[this.keys.KEY_B]=t;break;case 90:this.state1[this.keys.KEY_B]=t;break;case 17:this.state1[this.keys.KEY_SELECT]=t;break;case 13:this.state1[this.keys.KEY_START]=t;break;case 38:this.state1[this.keys.KEY_UP]=t;break;case 40:this.state1[this.keys.KEY_DOWN]=t;break;case 37:this.state1[this.keys.KEY_LEFT]=t;break;case 39:this.state1[this.keys.KEY_RIGHT]=t;break;case 103:this.state2[this.keys.KEY_A]=t;break;case 105:this.state2[this.keys.KEY_B]=t;break;case 99:this.state2[this.keys.KEY_SELECT]=t;break;case 97:this.state2[this.keys.KEY_START]=t;break;case 104:this.state2[this.keys.KEY_UP]=t;break;case 98:this.state2[this.keys.KEY_DOWN]=t;break;case 100:this.state2[this.keys.KEY_LEFT]=t;break;case 102:this.state2[this.keys.KEY_RIGHT]=t;break;default:return!0}return!1},keyDown:function(e){!this.setKey(e.keyCode,65)&&e.preventDefault&&e.preventDefault()},keyUp:function(e){!this.setKey(e.keyCode,64)&&e.preventDefault&&e.preventDefault()},keyPress:function(e){e.preventDefault()},setKeyState:function(e,t,i){var n=this.state1;e>0&&(n=this.state2),n[t]=i}},JSNES.Mappers={},JSNES.Mappers[0]=function(e){this.nes=e},JSNES.Mappers[0].prototype={reset:function(){this.joy1StrobeState=0,this.joy2StrobeState=0,this.joypadLastWrite=0,this.mousePressed=!1,this.mouseX=null,this.mouseY=null},write:function(e,t){e<8192?this.nes.cpu.mem[2047&e]=t:e>16407?this.nes.cpu.mem[e]=t:e>8199&&e<16384?this.regWrite(8192+(7&e),t):this.regWrite(e,t)},writelow:function(e,t){e<8192?this.nes.cpu.mem[2047&e]=t:e>16407?this.nes.cpu.mem[e]=t:e>8199&&e<16384?this.regWrite(8192+(7&e),t):this.regWrite(e,t)},load:function(e){return e&=65535,e>16407?this.nes.cpu.mem[e]:e>=8192?this.regLoad(e):this.nes.cpu.mem[2047&e]},regLoad:function(e){switch(e>>12){case 0:break;case 1:break;case 2:case 3:switch(7&e){case 0:return this.nes.cpu.mem[8192];case 1:return this.nes.cpu.mem[8193];case 2:return this.nes.ppu.readStatusRegister();case 3:return 0;case 4:return this.nes.ppu.sramLoad();case 5:return 0;case 6:return 0;case 7:return this.nes.ppu.vramLoad()}break;case 4:switch(e-16405){case 0:return this.nes.papu.readReg(e);case 1:return this.joy1Read();case 2:if(this.mousePressed){for(var t=Math.max(0,this.mouseX-4),i=Math.min(256,this.mouseX+4),n=Math.max(0,this.mouseY-4),s=Math.min(240,this.mouseY+4),r=0,a=n;a<s;a++)for(var o=t;o<i;o++)if(16777215==this.nes.ppu.buffer[(a<<8)+o]){r|=8,console.debug("Clicked on white!");break}return r|=this.mousePressed?16:0,65535&(this.joy2Read()|r)}return this.joy2Read()}}return 0},regWrite:function(e,t){switch(e){case 8192:this.nes.cpu.mem[e]=t,this.nes.ppu.updateControlReg1(t);break;case 8193:this.nes.cpu.mem[e]=t,this.nes.ppu.updateControlReg2(t);break;case 8195:this.nes.ppu.writeSRAMAddress(t);break;case 8196:this.nes.ppu.sramWrite(t);break;case 8197:this.nes.ppu.scrollWrite(t);break;case 8198:this.nes.ppu.writeVRAMAddress(t);break;case 8199:this.nes.ppu.vramWrite(t);break;case 16404:this.nes.ppu.sramDMA(t);break;case 16405:this.nes.papu.writeReg(e,t);break;case 16406:0===(1&t)&&1===(1&this.joypadLastWrite)&&(this.joy1StrobeState=0,this.joy2StrobeState=0),this.joypadLastWrite=t;break;case 16407:this.nes.papu.writeReg(e,t);break;default:e>=16384&&e<=16407&&this.nes.papu.writeReg(e,t)}},joy1Read:function(){var e;switch(this.joy1StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e=this.nes.keyboard.state1[this.joy1StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:e=0;break;case 19:e=1;break;default:e=0}return this.joy1StrobeState++,24==this.joy1StrobeState&&(this.joy1StrobeState=0),e},joy2Read:function(){var e;switch(this.joy2StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e=this.nes.keyboard.state2[this.joy2StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:e=0;break;case 19:e=1;break;default:e=0}return this.joy2StrobeState++,24==this.joy2StrobeState&&(this.joy2StrobeState=0),e},loadROM:function(){return!this.nes.rom.valid||this.nes.rom.romCount<1?void alert("NoMapper: Invalid ROM! Unable to load."):(this.loadPRGROM(),this.loadCHRROM(),this.loadBatteryRam(),void this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET))},loadPRGROM:function(){this.nes.rom.romCount>1?(this.loadRomBank(0,32768),this.loadRomBank(1,49152)):(this.loadRomBank(0,32768),this.loadRomBank(0,49152))},loadCHRROM:function(){this.nes.rom.vromCount>0&&(1==this.nes.rom.vromCount?(this.loadVromBank(0,0),this.loadVromBank(0,4096)):(this.loadVromBank(0,0),this.loadVromBank(1,4096)))},loadBatteryRam:function(){if(this.nes.rom.batteryRam){var e=this.nes.rom.batteryRam;null!==e&&8192==e.length&&JSNES.Utils.copyArrayElements(e,0,this.nes.cpu.mem,24576,8192)}},loadRomBank:function(e,t){e%=this.nes.rom.romCount,JSNES.Utils.copyArrayElements(this.nes.rom.rom[e],0,this.nes.cpu.mem,t,16384)},loadVromBank:function(e,t){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering(),JSNES.Utils.copyArrayElements(this.nes.rom.vrom[e%this.nes.rom.vromCount],0,this.nes.ppu.vramMem,t,4096);var i=this.nes.rom.vromTile[e%this.nes.rom.vromCount];JSNES.Utils.copyArrayElements(i,0,this.nes.ppu.ptTile,t>>4,256)}},load32kRomBank:function(e,t){this.loadRomBank(2*e%this.nes.rom.romCount,t),this.loadRomBank((2*e+1)%this.nes.rom.romCount,t+16384)},load8kVromBank:function(e,t){0!==this.nes.rom.vromCount&&(this.nes.ppu.triggerRendering(),this.loadVromBank(e%this.nes.rom.vromCount,t),this.loadVromBank((e+1)%this.nes.rom.vromCount,t+4096))},load1kVromBank:function(e,t){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering();var i=Math.floor(e/4)%this.nes.rom.vromCount,n=e%4*1024;JSNES.Utils.copyArrayElements(this.nes.rom.vrom[i],0,this.nes.ppu.vramMem,n,1024);for(var s=this.nes.rom.vromTile[i],r=t>>4,a=0;a<64;a++)this.nes.ppu.ptTile[r+a]=s[(e%4<<6)+a]}},load2kVromBank:function(e,t){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering();var i=Math.floor(e/2)%this.nes.rom.vromCount,n=e%2*2048;JSNES.Utils.copyArrayElements(this.nes.rom.vrom[i],n,this.nes.ppu.vramMem,t,2048);for(var s=this.nes.rom.vromTile[i],r=t>>4,a=0;a<128;a++)this.nes.ppu.ptTile[r+a]=s[(e%2<<7)+a]}},load8kRomBank:function(e,t){var i=Math.floor(e/2)%this.nes.rom.romCount,n=e%2*8192;JSNES.Utils.copyArrayElements(this.nes.rom.rom[i],n,this.nes.cpu.mem,t,8192)},clockIrqCounter:function(){},latchAccess:function(e){},toJSON:function(){return{joy1StrobeState:this.joy1StrobeState,joy2StrobeState:this.joy2StrobeState,joypadLastWrite:this.joypadLastWrite}},fromJSON:function(e){this.joy1StrobeState=e.joy1StrobeState,this.joy2StrobeState=e.joy2StrobeState,this.joypadLastWrite=e.joypadLastWrite}},JSNES.Mappers[1]=function(e){this.nes=e},JSNES.Mappers[1].prototype=new JSNES.Mappers[0],JSNES.Mappers[1].prototype.reset=function(){JSNES.Mappers[0].prototype.reset.apply(this),this.regBuffer=0,this.regBufferCounter=0,this.mirroring=0,this.oneScreenMirroring=0,this.prgSwitchingArea=1,this.prgSwitchingSize=1,this.vromSwitchingSize=0,this.romSelectionReg0=0,this.romSelectionReg1=0,this.romBankSelect=0},JSNES.Mappers[1].prototype.write=function(e,t){return e<32768?void JSNES.Mappers[0].prototype.write.apply(this,arguments):void(0!==(128&t)?(this.regBufferCounter=0,this.regBuffer=0,0===this.getRegNumber(e)&&(this.prgSwitchingArea=1,this.prgSwitchingSize=1)):(this.regBuffer=this.regBuffer&255-(1<<this.regBufferCounter)|(1&t)<<this.regBufferCounter,this.regBufferCounter++,5==this.regBufferCounter&&(this.setReg(this.getRegNumber(e),this.regBuffer),this.regBuffer=0,this.regBufferCounter=0)))},JSNES.Mappers[1].prototype.setReg=function(e,t){var i;switch(e){case 0:i=3&t,i!==this.mirroring&&(this.mirroring=i,0===(2&this.mirroring)?this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING):0!==(1&this.mirroring)?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING)),this.prgSwitchingArea=t>>2&1,this.prgSwitchingSize=t>>3&1,this.vromSwitchingSize=t>>4&1;break;case 1:this.romSelectionReg0=t>>4&1,this.nes.rom.vromCount>0&&(0===this.vromSwitchingSize?0===this.romSelectionReg0?this.load8kVromBank(15&t,0):this.load8kVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&t),0):0===this.romSelectionReg0?this.loadVromBank(15&t,0):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&t),0));break;case 2:this.romSelectionReg1=t>>4&1,this.nes.rom.vromCount>0&&1===this.vromSwitchingSize&&(0===this.romSelectionReg1?this.loadVromBank(15&t,4096):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&t),4096));break;default:i=15&t;var n,s=0;this.nes.rom.romCount>=32?0===this.vromSwitchingSize?1===this.romSelectionReg0&&(s=16):s=(this.romSelectionReg0|this.romSelectionReg1<<1)<<3:this.nes.rom.romCount>=16&&1===this.romSelectionReg0&&(s=8),0===this.prgSwitchingSize?(n=s+(15&t),this.load32kRomBank(n,32768)):(n=2*s+(15&t),0===this.prgSwitchingArea?this.loadRomBank(n,49152):this.loadRomBank(n,32768))}},JSNES.Mappers[1].prototype.getRegNumber=function(e){return e>=32768&&e<=40959?0:e>=40960&&e<=49151?1:e>=49152&&e<=57343?2:3},JSNES.Mappers[1].prototype.loadROM=function(e){return this.nes.rom.valid?(this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.loadBatteryRam(),void this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)):void alert("MMC1: Invalid ROM! Unable to load.")},JSNES.Mappers[1].prototype.switchLowHighPrgRom=function(e){},JSNES.Mappers[1].prototype.switch16to32=function(){},JSNES.Mappers[1].prototype.switch32to16=function(){},JSNES.Mappers[1].prototype.toJSON=function(){var e=JSNES.Mappers[0].prototype.toJSON.apply(this);return e.mirroring=this.mirroring,e.oneScreenMirroring=this.oneScreenMirroring,e.prgSwitchingArea=this.prgSwitchingArea,e.prgSwitchingSize=this.prgSwitchingSize,e.vromSwitchingSize=this.vromSwitchingSize,e.romSelectionReg0=this.romSelectionReg0,e.romSelectionReg1=this.romSelectionReg1,e.romBankSelect=this.romBankSelect,e.regBuffer=this.regBuffer,e.regBufferCounter=this.regBufferCounter,e},JSNES.Mappers[1].prototype.fromJSON=function(e){JSNES.Mappers[0].prototype.fromJSON.apply(this,e),this.mirroring=e.mirroring,this.oneScreenMirroring=e.oneScreenMirroring,this.prgSwitchingArea=e.prgSwitchingArea,this.prgSwitchingSize=e.prgSwitchingSize,this.vromSwitchingSize=e.vromSwitchingSize,this.romSelectionReg0=e.romSelectionReg0,this.romSelectionReg1=e.romSelectionReg1,this.romBankSelect=e.romBankSelect,this.regBuffer=e.regBuffer,this.regBufferCounter=e.regBufferCounter},JSNES.Mappers[2]=function(e){this.nes=e},JSNES.Mappers[2].prototype=new JSNES.Mappers[0],JSNES.Mappers[2].prototype.write=function(e,t){return e<32768?void JSNES.Mappers[0].prototype.write.apply(this,arguments):void this.loadRomBank(t,32768)},JSNES.Mappers[2].prototype.loadROM=function(e){return this.nes.rom.valid?(this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),void this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)):void alert("UNROM: Invalid ROM! Unable to load.")},JSNES.Mappers[4]=function(e){this.nes=e,this.CMD_SEL_2_1K_VROM_0000=0,this.CMD_SEL_2_1K_VROM_0800=1,this.CMD_SEL_1K_VROM_1000=2,this.CMD_SEL_1K_VROM_1400=3,this.CMD_SEL_1K_VROM_1800=4,this.CMD_SEL_1K_VROM_1C00=5,this.CMD_SEL_ROM_PAGE1=6,this.CMD_SEL_ROM_PAGE2=7,this.command=null,this.prgAddressSelect=null,this.chrAddressSelect=null,this.pageNumber=null,this.irqCounter=null,this.irqLatchValue=null,this.irqEnable=null,this.prgAddressChanged=!1},JSNES.Mappers[4].prototype=new JSNES.Mappers[0],JSNES.Mappers[4].prototype.write=function(e,t){if(e<32768)return void JSNES.Mappers[0].prototype.write.apply(this,arguments);switch(e){case 32768:this.command=7&t;var i=t>>6&1;i!=this.prgAddressSelect&&(this.prgAddressChanged=!0),this.prgAddressSelect=i,this.chrAddressSelect=t>>7&1;break;case 32769:this.executeCommand(this.command,t);break;case 40960:0!==(1&t)?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING);break;case 40961:break;case 49152:this.irqCounter=t;break;case 49153:this.irqLatchValue=t;break;case 57344:this.irqEnable=0;break;case 57345:this.irqEnable=1}},JSNES.Mappers[4].prototype.executeCommand=function(e,t){switch(e){case this.CMD_SEL_2_1K_VROM_0000:0===this.chrAddressSelect?(this.load1kVromBank(t,0),this.load1kVromBank(t+1,1024)):(this.load1kVromBank(t,4096),this.load1kVromBank(t+1,5120));break;case this.CMD_SEL_2_1K_VROM_0800:0===this.chrAddressSelect?(this.load1kVromBank(t,2048),this.load1kVromBank(t+1,3072)):(this.load1kVromBank(t,6144),this.load1kVromBank(t+1,7168));break;case this.CMD_SEL_1K_VROM_1000:0===this.chrAddressSelect?this.load1kVromBank(t,4096):this.load1kVromBank(t,0);break;case this.CMD_SEL_1K_VROM_1400:0===this.chrAddressSelect?this.load1kVromBank(t,5120):this.load1kVromBank(t,1024);break;case this.CMD_SEL_1K_VROM_1800:0===this.chrAddressSelect?this.load1kVromBank(t,6144):this.load1kVromBank(t,2048);break;case this.CMD_SEL_1K_VROM_1C00:0===this.chrAddressSelect?this.load1kVromBank(t,7168):this.load1kVromBank(t,3072);break;case this.CMD_SEL_ROM_PAGE1:this.prgAddressChanged&&(0===this.prgAddressSelect?this.load8kRomBank(2*(this.nes.rom.romCount-1),49152):this.load8kRomBank(2*(this.nes.rom.romCount-1),32768),this.prgAddressChanged=!1),0===this.prgAddressSelect?this.load8kRomBank(t,32768):this.load8kRomBank(t,49152);break;case this.CMD_SEL_ROM_PAGE2:this.load8kRomBank(t,40960),this.prgAddressChanged&&(0===this.prgAddressSelect?this.load8kRomBank(2*(this.nes.rom.romCount-1),49152):this.load8kRomBank(2*(this.nes.rom.romCount-1),32768),this.prgAddressChanged=!1)}},JSNES.Mappers[4].prototype.loadROM=function(e){return this.nes.rom.valid?(this.load8kRomBank(2*(this.nes.rom.romCount-1),49152),this.load8kRomBank(2*(this.nes.rom.romCount-1)+1,57344),this.load8kRomBank(0,32768),this.load8kRomBank(1,40960),this.loadCHRROM(),this.loadBatteryRam(),void this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)):void alert("MMC3: Invalid ROM! Unable to load.")},JSNES.Mappers[4].prototype.clockIrqCounter=function(){1==this.irqEnable&&(this.irqCounter--,this.irqCounter<0&&(this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.irqCounter=this.irqLatchValue))},JSNES.Mappers[4].prototype.toJSON=function(){var e=JSNES.Mappers[0].prototype.toJSON.apply(this);return e.command=this.command,e.prgAddressSelect=this.prgAddressSelect,e.chrAddressSelect=this.chrAddressSelect,e.pageNumber=this.pageNumber,e.irqCounter=this.irqCounter,e.irqLatchValue=this.irqLatchValue,e.irqEnable=this.irqEnable,e.prgAddressChanged=this.prgAddressChanged,e},JSNES.Mappers[4].prototype.fromJSON=function(e){JSNES.Mappers[0].prototype.fromJSON.apply(this,e),this.command=e.command,this.prgAddressSelect=e.prgAddressSelect,this.chrAddressSelect=e.chrAddressSelect,this.pageNumber=e.pageNumber,this.irqCounter=e.irqCounter,this.irqLatchValue=e.irqLatchValue,this.irqEnable=e.irqEnable,this.prgAddressChanged=e.prgAddressChanged},JSNES.PAPU=function(e){this.nes=e,this.square1=new JSNES.PAPU.ChannelSquare(this,(!0)),this.square2=new JSNES.PAPU.ChannelSquare(this,(!1)),this.triangle=new JSNES.PAPU.ChannelTriangle(this),this.noise=new JSNES.PAPU.ChannelNoise(this),this.dmc=new JSNES.PAPU.ChannelDM(this),this.frameIrqCounter=null,this.frameIrqCounterMax=4,this.initCounter=2048,this.channelEnableValue=null,this.bufferSize=8192,this.bufferIndex=0,this.sampleRate=44100,this.lengthLookup=null,this.dmcFreqLookup=null,this.noiseWavelengthLookup=null,this.square_table=null,this.tnd_table=null,this.sampleBuffer=new Array(2*this.bufferSize),this.frameIrqEnabled=!1,this.frameIrqActive=null,this.frameClockNow=null,this.startedPlaying=!1,this.recordOutput=!1,this.initingHardware=!1,this.masterFrameCounter=null,this.derivedFrameCounter=null,this.countSequence=null,this.sampleTimer=null,this.frameTime=null,this.sampleTimerMax=null,this.sampleCount=null,this.triValue=0,this.smpSquare1=null,this.smpSquare2=null,this.smpTriangle=null,this.smpDmc=null,this.accCount=null,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.dacRange=0,this.dcValue=0,this.masterVolume=256,this.stereoPosLSquare1=null,this.stereoPosLSquare2=null,this.stereoPosLTriangle=null,this.stereoPosLNoise=null,this.stereoPosLDMC=null,this.stereoPosRSquare1=null,this.stereoPosRSquare2=null,this.stereoPosRTriangle=null,this.stereoPosRNoise=null,this.stereoPosRDMC=null,this.extraCycles=null,this.maxSample=null,this.minSample=null,this.panning=[80,170,100,150,128],this.setPanning(this.panning),this.initLengthLookup(),this.initDmcFrequencyLookup(),this.initNoiseWavelengthLookup(),this.initDACtables();for(var t=0;t<20;t++)16===t?this.writeReg(16400,16):this.writeReg(16384+t,0);this.reset()},JSNES.PAPU.prototype={reset:function(){this.sampleRate=this.nes.opts.sampleRate,this.sampleTimerMax=Math.floor(1024*this.nes.opts.CPU_FREQ_NTSC*this.nes.opts.preferredFrameRate/(60*this.sampleRate)),this.frameTime=Math.floor(14915*this.nes.opts.preferredFrameRate/60),this.sampleTimer=0,this.bufferIndex=0,this.updateChannelEnable(0),this.masterFrameCounter=0,this.derivedFrameCounter=0,this.countSequence=0,this.sampleCount=0,this.initCounter=2048,this.frameIrqEnabled=!1,this.initingHardware=!1,this.resetCounter(),this.square1.reset(),this.square2.reset(),this.triangle.reset(),this.noise.reset(),this.dmc.reset(),this.bufferIndex=0,this.accCount=0,this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0,this.frameIrqEnabled=!1,this.frameIrqCounterMax=4,this.channelEnableValue=255,this.startedPlaying=!1,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.maxSample=-5e5,this.minSample=5e5},readReg:function(e){var t=0;return t|=this.square1.getLengthStatus(),t|=this.square2.getLengthStatus()<<1,t|=this.triangle.getLengthStatus()<<2,t|=this.noise.getLengthStatus()<<3,t|=this.dmc.getLengthStatus()<<4,t|=(this.frameIrqActive&&this.frameIrqEnabled?1:0)<<6,t|=this.dmc.getIrqStatus()<<7,this.frameIrqActive=!1,this.dmc.irqGenerated=!1,65535&t},writeReg:function(e,t){e>=16384&&e<16388?this.square1.writeReg(e,t):e>=16388&&e<16392?this.square2.writeReg(e,t):e>=16392&&e<16396?this.triangle.writeReg(e,t):e>=16396&&e<=16399?this.noise.writeReg(e,t):16400===e?this.dmc.writeReg(e,t):16401===e?this.dmc.writeReg(e,t):16402===e?this.dmc.writeReg(e,t):16403===e?this.dmc.writeReg(e,t):16405===e?(this.updateChannelEnable(t),0!==t&&this.initCounter>0&&(this.initingHardware=!0),this.dmc.writeReg(e,t)):16407===e&&(this.countSequence=t>>7&1,this.masterFrameCounter=0,this.frameIrqActive=!1,0===(t>>6&1)?this.frameIrqEnabled=!0:this.frameIrqEnabled=!1,0===this.countSequence?(this.frameIrqCounterMax=4,this.derivedFrameCounter=4):(this.frameIrqCounterMax=5,this.derivedFrameCounter=0,this.frameCounterTick()))},resetCounter:function(){0===this.countSequence?this.derivedFrameCounter=4:this.derivedFrameCounter=0},updateChannelEnable:function(e){this.channelEnableValue=65535&e,this.square1.setEnabled(0!==(1&e)),this.square2.setEnabled(0!==(2&e)),this.triangle.setEnabled(0!==(4&e)),this.noise.setEnabled(0!==(8&e)),this.dmc.setEnabled(0!==(16&e))},clockFrameCounter:function(e){if(this.initCounter>0&&this.initingHardware)return this.initCounter-=e,void(this.initCounter<=0&&(this.initingHardware=!1));e+=this.extraCycles;var t=this.sampleTimerMax-this.sampleTimer;e<<10>t?(this.extraCycles=(e<<10)-t>>10,e-=this.extraCycles):this.extraCycles=0;var i=this.dmc,n=this.triangle,s=this.square1,r=this.square2,a=this.noise;if(i.isEnabled)for(i.shiftCounter-=e<<3;i.shiftCounter<=0&&i.dmaFrequency>0;)i.shiftCounter+=i.dmaFrequency,i.clockDmc();if(n.progTimerMax>0)for(n.progTimerCount-=e;n.progTimerCount<=0;)n.progTimerCount+=n.progTimerMax+1,n.linearCounter>0&&n.lengthCounter>0&&(n.triangleCounter++,n.triangleCounter&=31,n.isEnabled&&(n.triangleCounter>=16?n.sampleValue=15&n.triangleCounter:n.sampleValue=15-(15&n.triangleCounter),n.sampleValue<<=4));s.progTimerCount-=e,s.progTimerCount<=0&&(s.progTimerCount+=s.progTimerMax+1<<1,s.squareCounter++,s.squareCounter&=7,s.updateSampleValue()),r.progTimerCount-=e,r.progTimerCount<=0&&(r.progTimerCount+=r.progTimerMax+1<<1,r.squareCounter++,r.squareCounter&=7,r.updateSampleValue());var o=e;if(a.progTimerCount-o>0)a.progTimerCount-=o,a.accCount+=o,a.accValue+=o*a.sampleValue;else for(;o-- >0;)--a.progTimerCount<=0&&a.progTimerMax>0&&(a.shiftReg<<=1,a.tmp=32768&(a.shiftReg<<(0===a.randomMode?1:6)^a.shiftReg),0!==a.tmp?(a.shiftReg|=1,a.randomBit=0,a.sampleValue=0):(a.randomBit=1,a.isEnabled&&a.lengthCounter>0?a.sampleValue=a.masterVolume:a.sampleValue=0),a.progTimerCount+=a.progTimerMax),a.accValue+=a.sampleValue,a.accCount++;this.frameIrqEnabled&&this.frameIrqActive&&this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.masterFrameCounter+=e<<1,this.masterFrameCounter>=this.frameTime&&(this.masterFrameCounter-=this.frameTime,this.frameCounterTick()),this.accSample(e),this.sampleTimer+=e<<10,this.sampleTimer>=this.sampleTimerMax&&(this.sample(),this.sampleTimer-=this.sampleTimerMax)},accSample:function(e){this.triangle.sampleCondition&&(this.triValue=Math.floor((this.triangle.progTimerCount<<4)/(this.triangle.progTimerMax+1)),this.triValue>16&&(this.triValue=16),this.triangle.triangleCounter>=16&&(this.triValue=16-this.triValue),this.triValue+=this.triangle.sampleValue),2===e?(this.smpTriangle+=this.triValue<<1,this.smpDmc+=this.dmc.sample<<1,this.smpSquare1+=this.square1.sampleValue<<1,this.smpSquare2+=this.square2.sampleValue<<1,this.accCount+=2):4===e?(this.smpTriangle+=this.triValue<<2,this.smpDmc+=this.dmc.sample<<2,this.smpSquare1+=this.square1.sampleValue<<2,this.smpSquare2+=this.square2.sampleValue<<2,this.accCount+=4):(this.smpTriangle+=e*this.triValue,this.smpDmc+=e*this.dmc.sample,this.smpSquare1+=e*this.square1.sampleValue,this.smpSquare2+=e*this.square2.sampleValue,this.accCount+=e)},frameCounterTick:function(){this.derivedFrameCounter++,this.derivedFrameCounter>=this.frameIrqCounterMax&&(this.derivedFrameCounter=0),1!==this.derivedFrameCounter&&3!==this.derivedFrameCounter||(this.triangle.clockLengthCounter(),this.square1.clockLengthCounter(),this.square2.clockLengthCounter(),this.noise.clockLengthCounter(),this.square1.clockSweep(),this.square2.clockSweep()),this.derivedFrameCounter>=0&&this.derivedFrameCounter<4&&(this.square1.clockEnvDecay(),this.square2.clockEnvDecay(),this.noise.clockEnvDecay(),this.triangle.clockLinearCounter()),3===this.derivedFrameCounter&&0===this.countSequence&&(this.frameIrqActive=!0)},sample:function(){var e,t;this.accCount>0?(this.smpSquare1<<=4,this.smpSquare1=Math.floor(this.smpSquare1/this.accCount),this.smpSquare2<<=4,this.smpSquare2=Math.floor(this.smpSquare2/this.accCount),this.smpTriangle=Math.floor(this.smpTriangle/this.accCount),this.smpDmc<<=4,this.smpDmc=Math.floor(this.smpDmc/this.accCount),this.accCount=0):(this.smpSquare1=this.square1.sampleValue<<4,this.smpSquare2=this.square2.sampleValue<<4,this.smpTriangle=this.triangle.sampleValue,this.smpDmc=this.dmc.sample<<4);var i=Math.floor((this.noise.accValue<<4)/this.noise.accCount);this.noise.accValue=i>>4,this.noise.accCount=1,e=this.smpSquare1*this.stereoPosLSquare1+this.smpSquare2*this.stereoPosLSquare2>>8,t=3*this.smpTriangle*this.stereoPosLTriangle+(i<<1)*this.stereoPosLNoise+this.smpDmc*this.stereoPosLDMC>>8,e>=this.square_table.length&&(e=this.square_table.length-1),
t>=this.tnd_table.length&&(t=this.tnd_table.length-1);var n=this.square_table[e]+this.tnd_table[t]-this.dcValue;e=this.smpSquare1*this.stereoPosRSquare1+this.smpSquare2*this.stereoPosRSquare2>>8,t=3*this.smpTriangle*this.stereoPosRTriangle+(i<<1)*this.stereoPosRNoise+this.smpDmc*this.stereoPosRDMC>>8,e>=this.square_table.length&&(e=this.square_table.length-1),t>=this.tnd_table.length&&(t=this.tnd_table.length-1);var s=this.square_table[e]+this.tnd_table[t]-this.dcValue,r=n-this.prevSampleL;this.prevSampleL+=r,this.smpAccumL+=r-(this.smpAccumL>>10),n=this.smpAccumL;var a=s-this.prevSampleR;this.prevSampleR+=a,this.smpAccumR+=a-(this.smpAccumR>>10),s=this.smpAccumR,n>this.maxSample&&(this.maxSample=n),n<this.minSample&&(this.minSample=n),this.sampleBuffer[this.bufferIndex++]=n,this.sampleBuffer[this.bufferIndex++]=s,this.bufferIndex===this.sampleBuffer.length&&(this.nes.ui.writeAudio(this.sampleBuffer),this.sampleBuffer=new Array(2*this.bufferSize),this.bufferIndex=0),this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0},getLengthMax:function(e){return this.lengthLookup[e>>3]},getDmcFrequency:function(e){return e>=0&&e<16?this.dmcFreqLookup[e]:0},getNoiseWaveLength:function(e){return e>=0&&e<16?this.noiseWavelengthLookup[e]:0},setPanning:function(e){for(var t=0;t<5;t++)this.panning[t]=e[t];this.updateStereoPos()},setMasterVolume:function(e){e<0&&(e=0),e>256&&(e=256),this.masterVolume=e,this.updateStereoPos()},updateStereoPos:function(){this.stereoPosLSquare1=this.panning[0]*this.masterVolume>>8,this.stereoPosLSquare2=this.panning[1]*this.masterVolume>>8,this.stereoPosLTriangle=this.panning[2]*this.masterVolume>>8,this.stereoPosLNoise=this.panning[3]*this.masterVolume>>8,this.stereoPosLDMC=this.panning[4]*this.masterVolume>>8,this.stereoPosRSquare1=this.masterVolume-this.stereoPosLSquare1,this.stereoPosRSquare2=this.masterVolume-this.stereoPosLSquare2,this.stereoPosRTriangle=this.masterVolume-this.stereoPosLTriangle,this.stereoPosRNoise=this.masterVolume-this.stereoPosLNoise,this.stereoPosRDMC=this.masterVolume-this.stereoPosLDMC},initLengthLookup:function(){this.lengthLookup=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30]},initDmcFrequencyLookup:function(){this.dmcFreqLookup=new Array(16),this.dmcFreqLookup[0]=3424,this.dmcFreqLookup[1]=3040,this.dmcFreqLookup[2]=2720,this.dmcFreqLookup[3]=2560,this.dmcFreqLookup[4]=2288,this.dmcFreqLookup[5]=2032,this.dmcFreqLookup[6]=1808,this.dmcFreqLookup[7]=1712,this.dmcFreqLookup[8]=1520,this.dmcFreqLookup[9]=1280,this.dmcFreqLookup[10]=1136,this.dmcFreqLookup[11]=1024,this.dmcFreqLookup[12]=848,this.dmcFreqLookup[13]=672,this.dmcFreqLookup[14]=576,this.dmcFreqLookup[15]=432},initNoiseWavelengthLookup:function(){this.noiseWavelengthLookup=new Array(16),this.noiseWavelengthLookup[0]=4,this.noiseWavelengthLookup[1]=8,this.noiseWavelengthLookup[2]=16,this.noiseWavelengthLookup[3]=32,this.noiseWavelengthLookup[4]=64,this.noiseWavelengthLookup[5]=96,this.noiseWavelengthLookup[6]=128,this.noiseWavelengthLookup[7]=160,this.noiseWavelengthLookup[8]=202,this.noiseWavelengthLookup[9]=254,this.noiseWavelengthLookup[10]=380,this.noiseWavelengthLookup[11]=508,this.noiseWavelengthLookup[12]=762,this.noiseWavelengthLookup[13]=1016,this.noiseWavelengthLookup[14]=2034,this.noiseWavelengthLookup[15]=4068},initDACtables:function(){var e,t,i,n=0,s=0;for(this.square_table=new Array(512),this.tnd_table=new Array(3264),i=0;i<512;i++)e=95.52/(8128/(i/16)+100),e*=.98411,e*=5e4,t=Math.floor(e),this.square_table[i]=t,t>n&&(n=t);for(i=0;i<3264;i++)e=163.67/(24329/(i/16)+100),e*=.98411,e*=5e4,t=Math.floor(e),this.tnd_table[i]=t,t>s&&(s=t);this.dacRange=n+s,this.dcValue=this.dacRange/2}},JSNES.PAPU.ChannelDM=function(e){this.papu=e,this.MODE_NORMAL=0,this.MODE_LOOP=1,this.MODE_IRQ=2,this.isEnabled=null,this.hasSample=null,this.irqGenerated=!1,this.playMode=null,this.dmaFrequency=null,this.dmaCounter=null,this.deltaCounter=null,this.playStartAddress=null,this.playAddress=null,this.playLength=null,this.playLengthCounter=null,this.shiftCounter=null,this.reg4012=null,this.reg4013=null,this.sample=null,this.dacLsb=null,this.data=null,this.reset()},JSNES.PAPU.ChannelDM.prototype={clockDmc:function(){this.hasSample&&(0===(1&this.data)?this.deltaCounter>0&&this.deltaCounter--:this.deltaCounter<63&&this.deltaCounter++,this.sample=this.isEnabled?(this.deltaCounter<<1)+this.dacLsb:0,this.data>>=1),this.dmaCounter--,this.dmaCounter<=0&&(this.hasSample=!1,this.endOfSample(),this.dmaCounter=8),this.irqGenerated&&this.papu.nes.cpu.requestIrq(this.papu.nes.cpu.IRQ_NORMAL)},endOfSample:function(){0===this.playLengthCounter&&this.playMode===this.MODE_LOOP&&(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.playLengthCounter>0&&(this.nextSample(),0===this.playLengthCounter&&this.playMode===this.MODE_IRQ&&(this.irqGenerated=!0))},nextSample:function(){this.data=this.papu.nes.mmap.load(this.playAddress),this.papu.nes.cpu.haltCycles(4),this.playLengthCounter--,this.playAddress++,this.playAddress>65535&&(this.playAddress=32768),this.hasSample=!0},writeReg:function(e,t){16400===e?(t>>6===0?this.playMode=this.MODE_NORMAL:1===(t>>6&1)?this.playMode=this.MODE_LOOP:t>>6===2&&(this.playMode=this.MODE_IRQ),0===(128&t)&&(this.irqGenerated=!1),this.dmaFrequency=this.papu.getDmcFrequency(15&t)):16401===e?(this.deltaCounter=t>>1&63,this.dacLsb=1&t,this.sample=(this.deltaCounter<<1)+this.dacLsb):16402===e?(this.playStartAddress=t<<6|49152,this.playAddress=this.playStartAddress,this.reg4012=t):16403===e?(this.playLength=(t<<4)+1,this.playLengthCounter=this.playLength,this.reg4013=t):16405===e&&(0===(t>>4&1)?this.playLengthCounter=0:(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.irqGenerated=!1)},setEnabled:function(e){!this.isEnabled&&e&&(this.playLengthCounter=this.playLength),this.isEnabled=e},getLengthStatus:function(){return 0!==this.playLengthCounter&&this.isEnabled?1:0},getIrqStatus:function(){return this.irqGenerated?1:0},reset:function(){this.isEnabled=!1,this.irqGenerated=!1,this.playMode=this.MODE_NORMAL,this.dmaFrequency=0,this.dmaCounter=0,this.deltaCounter=0,this.playStartAddress=0,this.playAddress=0,this.playLength=0,this.playLengthCounter=0,this.sample=0,this.dacLsb=0,this.shiftCounter=0,this.reg4012=0,this.reg4013=0,this.data=0}},JSNES.PAPU.ChannelNoise=function(e){this.papu=e,this.isEnabled=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.lengthCounterEnable=null,this.envReset=null,this.shiftNow=null,this.lengthCounter=null,this.progTimerCount=null,this.progTimerMax=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.shiftReg=16384,this.randomBit=null,this.randomMode=null,this.sampleValue=null,this.accValue=0,this.accCount=1,this.tmp=null,this.reset()},JSNES.PAPU.ChannelNoise.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.isEnabled=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1,this.shiftNow=!1,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.shiftReg=1,this.randomBit=0,this.randomMode=0,this.sampleValue=0,this.tmp=0},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.masterVolume=this.envDecayDisable?this.envDecayRate:this.envVolume,this.updateSampleValue()},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&(this.sampleValue=this.randomBit*this.masterVolume)},writeReg:function(e,t){16396===e?(this.envDecayDisable=0!==(16&t),this.envDecayRate=15&t,this.envDecayLoopEnable=0!==(32&t),this.lengthCounterEnable=0===(32&t),this.masterVolume=this.envDecayDisable?this.envDecayRate:this.envVolume):16398===e?(this.progTimerMax=this.papu.getNoiseWaveLength(15&t),this.randomMode=t>>7):16399===e&&(this.lengthCounter=this.papu.getLengthMax(248&t),this.envReset=!0)},setEnabled:function(e){this.isEnabled=e,e||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0}},JSNES.PAPU.ChannelSquare=function(e,t){this.papu=e,this.dutyLookup=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1],this.impLookup=[1,-1,0,0,0,0,0,0,1,0,-1,0,0,0,0,0,1,0,0,0,-1,0,0,0,-1,0,1,0,0,0,0,0],this.sqr1=t,this.isEnabled=null,this.lengthCounterEnable=null,this.sweepActive=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.envReset=null,this.sweepCarry=null,this.updateSweepPeriod=null,this.progTimerCount=null,this.progTimerMax=null,this.lengthCounter=null,this.squareCounter=null,this.sweepCounter=null,this.sweepCounterMax=null,this.sweepMode=null,this.sweepShiftAmount=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.dutyMode=null,this.sweepResult=null,this.sampleValue=null,this.vol=null,this.reset()},JSNES.PAPU.ChannelSquare.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.lengthCounter=0,this.squareCounter=0,this.sweepCounter=0,this.sweepCounterMax=0,this.sweepMode=0,this.sweepShiftAmount=0,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.dutyMode=0,this.vol=0,this.isEnabled=!1,this.lengthCounterEnable=!1,this.sweepActive=!1,this.sweepCarry=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.masterVolume=this.envDecayDisable?this.envDecayRate:this.envVolume,this.updateSampleValue()},clockSweep:function(){--this.sweepCounter<=0&&(this.sweepCounter=this.sweepCounterMax+1,this.sweepActive&&this.sweepShiftAmount>0&&this.progTimerMax>7&&(this.sweepCarry=!1,0===this.sweepMode?(this.progTimerMax+=this.progTimerMax>>this.sweepShiftAmount,this.progTimerMax>4095&&(this.progTimerMax=4095,this.sweepCarry=!0)):this.progTimerMax=this.progTimerMax-((this.progTimerMax>>this.sweepShiftAmount)-(this.sqr1?1:0)))),this.updateSweepPeriod&&(this.updateSweepPeriod=!1,this.sweepCounter=this.sweepCounterMax+1)},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&this.progTimerMax>7?0===this.sweepMode&&this.progTimerMax+(this.progTimerMax>>this.sweepShiftAmount)>4095?this.sampleValue=0:this.sampleValue=this.masterVolume*this.dutyLookup[(this.dutyMode<<3)+this.squareCounter]:this.sampleValue=0},writeReg:function(e,t){var i=this.sqr1?0:4;e===16384+i?(this.envDecayDisable=0!==(16&t),this.envDecayRate=15&t,this.envDecayLoopEnable=0!==(32&t),this.dutyMode=t>>6&3,this.lengthCounterEnable=0===(32&t),this.masterVolume=this.envDecayDisable?this.envDecayRate:this.envVolume,this.updateSampleValue()):e===16385+i?(this.sweepActive=0!==(128&t),this.sweepCounterMax=t>>4&7,this.sweepMode=t>>3&1,this.sweepShiftAmount=7&t,this.updateSweepPeriod=!0):e===16386+i?(this.progTimerMax&=1792,this.progTimerMax|=t):e===16387+i&&(this.progTimerMax&=255,this.progTimerMax|=(7&t)<<8,this.isEnabled&&(this.lengthCounter=this.papu.getLengthMax(248&t)),this.envReset=!0)},setEnabled:function(e){this.isEnabled=e,e||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0}},JSNES.PAPU.ChannelTriangle=function(e){this.papu=e,this.isEnabled=null,this.sampleCondition=null,this.lengthCounterEnable=null,this.lcHalt=null,this.lcControl=null,this.progTimerCount=null,this.progTimerMax=null,this.triangleCounter=null,this.lengthCounter=null,this.linearCounter=null,this.lcLoadValue=null,this.sampleValue=null,this.tmp=null,this.reset()},JSNES.PAPU.ChannelTriangle.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.triangleCounter=0,this.isEnabled=!1,this.sampleCondition=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.linearCounter=0,this.lcLoadValue=0,this.lcHalt=!0,this.lcControl=!1,this.tmp=0,this.sampleValue=15},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleCondition())},clockLinearCounter:function(){this.lcHalt?(this.linearCounter=this.lcLoadValue,this.updateSampleCondition()):this.linearCounter>0&&(this.linearCounter--,this.updateSampleCondition()),this.lcControl||(this.lcHalt=!1)},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0},readReg:function(e){return 0},writeReg:function(e,t){16392===e?(this.lcControl=0!==(128&t),this.lcLoadValue=127&t,this.lengthCounterEnable=!this.lcControl):16394===e?(this.progTimerMax&=1792,this.progTimerMax|=t):16395===e&&(this.progTimerMax&=255,this.progTimerMax|=(7&t)<<8,this.lengthCounter=this.papu.getLengthMax(248&t),this.lcHalt=!0),this.updateSampleCondition()},clockProgrammableTimer:function(e){if(this.progTimerMax>0)for(this.progTimerCount+=e;this.progTimerMax>0&&this.progTimerCount>=this.progTimerMax;)this.progTimerCount-=this.progTimerMax,this.isEnabled&&this.lengthCounter>0&&this.linearCounter>0&&this.clockTriangleGenerator()},clockTriangleGenerator:function(){this.triangleCounter++,this.triangleCounter&=31},setEnabled:function(e){this.isEnabled=e,e||(this.lengthCounter=0),this.updateSampleCondition()},updateSampleCondition:function(){this.sampleCondition=this.isEnabled&&this.progTimerMax>7&&this.linearCounter>0&&this.lengthCounter>0}},JSNES.PPU=function(e){this.nes=e,this.vramMem=null,this.spriteMem=null,this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=null,this.firstWrite=null,this.sramAddress=null,this.currentMirroring=null,this.requestEndFrame=null,this.nmiOk=null,this.dummyCycleToggle=null,this.validTileData=null,this.nmiCounter=null,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=null,this.f_spriteSize=null,this.f_bgPatternTable=null,this.f_spPatternTable=null,this.f_addrInc=null,this.f_nTblAddress=null,this.f_color=null,this.f_spVisibility=null,this.f_bgVisibility=null,this.f_spClipping=null,this.f_bgClipping=null,this.f_dispType=null,this.cntFV=null,this.cntV=null,this.cntH=null,this.cntVT=null,this.cntHT=null,this.regFV=null,this.regV=null,this.regH=null,this.regVT=null,this.regHT=null,this.regFH=null,this.regS=null,this.curNt=null,this.attrib=null,this.buffer=null,this.prevBuffer=null,this.bgbuffer=null,this.pixrendered=null,this.validTileData=null,this.scantile=null,this.scanline=null,this.lastRenderedScanline=null,this.curX=null,this.sprX=null,this.sprY=null,this.sprTile=null,this.sprCol=null,this.vertFlip=null,this.horiFlip=null,this.bgPriority=null,this.spr0HitX=null,this.spr0HitY=null,this.hitSpr0=null,this.sprPalette=null,this.imgPalette=null,this.ptTile=null,this.ntable1=null,this.currentMirroring=null,this.nameTable=null,this.vramMirrorTable=null,this.palTable=null,this.showSpr0Hit=!1,this.clipToTvSize=!0,this.reset()},JSNES.PPU.prototype={STATUS_VRAMWRITE:4,STATUS_SLSPRITECOUNT:5,STATUS_SPRITE0HIT:6,STATUS_VBLANK:7,reset:function(){var e;for(this.vramMem=new Array(32768),this.spriteMem=new Array(256),e=0;e<this.vramMem.length;e++)this.vramMem[e]=0;for(e=0;e<this.spriteMem.length;e++)this.spriteMem[e]=0;for(this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=0,this.firstWrite=!0,this.sramAddress=0,this.currentMirroring=-1,this.requestEndFrame=!1,this.nmiOk=!1,this.dummyCycleToggle=!1,this.validTileData=!1,this.nmiCounter=0,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=0,this.f_spriteSize=0,this.f_bgPatternTable=0,this.f_spPatternTable=0,this.f_addrInc=0,this.f_nTblAddress=0,this.f_color=0,this.f_spVisibility=0,this.f_bgVisibility=0,this.f_spClipping=0,this.f_bgClipping=0,this.f_dispType=0,this.cntFV=0,this.cntV=0,this.cntH=0,this.cntVT=0,this.cntHT=0,this.regFV=0,this.regV=0,this.regH=0,this.regVT=0,this.regHT=0,this.regFH=0,this.regS=0,this.curNt=null,this.attrib=new Array(32),this.buffer=new Array(61440),this.prevBuffer=new Array(61440),this.bgbuffer=new Array(61440),this.pixrendered=new Array(61440),this.validTileData=null,this.scantile=new Array(32),this.scanline=0,this.lastRenderedScanline=-1,this.curX=0,this.sprX=new Array(64),this.sprY=new Array(64),this.sprTile=new Array(64),this.sprCol=new Array(64),this.vertFlip=new Array(64),this.horiFlip=new Array(64),this.bgPriority=new Array(64),this.spr0HitX=0,this.spr0HitY=0,this.hitSpr0=!1,this.sprPalette=new Array(16),this.imgPalette=new Array(16),this.ptTile=new Array(512),e=0;e<512;e++)this.ptTile[e]=new JSNES.PPU.Tile;for(this.ntable1=new Array(4),this.currentMirroring=-1,this.nameTable=new Array(4),e=0;e<4;e++)this.nameTable[e]=new JSNES.PPU.NameTable(32,32,"Nt"+e);for(this.vramMirrorTable=new Array(32768),e=0;e<32768;e++)this.vramMirrorTable[e]=e;this.palTable=new JSNES.PPU.PaletteTable,this.palTable.loadNTSCPalette(),this.updateControlReg1(0),this.updateControlReg2(0)},setMirroring:function(e){if(e!=this.currentMirroring){this.currentMirroring=e,this.triggerRendering(),null===this.vramMirrorTable&&(this.vramMirrorTable=new Array(32768));for(var t=0;t<32768;t++)this.vramMirrorTable[t]=t;this.defineMirrorRegion(16160,16128,32),this.defineMirrorRegion(16192,16128,32),this.defineMirrorRegion(16256,16128,32),this.defineMirrorRegion(16320,16128,32),this.defineMirrorRegion(12288,8192,3840),this.defineMirrorRegion(16384,0,16384),e==this.nes.rom.HORIZONTAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(11264,10240,1024)):e==this.nes.rom.VERTICAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=0,this.ntable1[3]=1,this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,9216,1024)):e==this.nes.rom.SINGLESCREEN_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=0,this.ntable1[3]=0,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,8192,1024)):e==this.nes.rom.SINGLESCREEN_MIRRORING2?(this.ntable1[0]=1,this.ntable1[1]=1,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,9216,1024),this.defineMirrorRegion(10240,9216,1024),this.defineMirrorRegion(11264,9216,1024)):(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=2,this.ntable1[3]=3)}},defineMirrorRegion:function(e,t,i){for(var n=0;n<i;n++)this.vramMirrorTable[e+n]=t+n},startVBlank:function(){this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI),this.lastRenderedScanline<239&&this.renderFramePartially(this.lastRenderedScanline+1,240-this.lastRenderedScanline),this.endFrame(),this.lastRenderedScanline=-1},endScanline:function(){switch(this.scanline){case 19:this.dummyCycleToggle&&(this.curX=1,this.dummyCycleToggle=!this.dummyCycleToggle);break;case 20:this.setStatusFlag(this.STATUS_VBLANK,!1),this.setStatusFlag(this.STATUS_SPRITE0HIT,!1),this.hitSpr0=!1,this.spr0HitX=-1,this.spr0HitY=-1,1!=this.f_bgVisibility&&1!=this.f_spVisibility||(this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,1==this.f_bgVisibility&&this.renderBgScanline(!1,0)),1==this.f_bgVisibility&&1==this.f_spVisibility&&this.checkSprite0(0),1!=this.f_bgVisibility&&1!=this.f_spVisibility||this.nes.mmap.clockIrqCounter();break;case 261:this.setStatusFlag(this.STATUS_VBLANK,!0),this.requestEndFrame=!0,this.nmiCounter=9,this.scanline=-1;break;default:this.scanline>=21&&this.scanline<=260&&(1==this.f_bgVisibility&&(this.scanlineAlreadyRendered||(this.cntHT=this.regHT,this.cntH=this.regH,this.renderBgScanline(!0,this.scanline+1-21)),this.scanlineAlreadyRendered=!1,this.hitSpr0||1!=this.f_spVisibility||this.sprX[0]>=-7&&this.sprX[0]<256&&this.sprY[0]+1<=this.scanline-20&&this.sprY[0]+1+(0===this.f_spriteSize?8:16)>=this.scanline-20&&this.checkSprite0(this.scanline-20)&&(this.hitSpr0=!0)),1!=this.f_bgVisibility&&1!=this.f_spVisibility||this.nes.mmap.clockIrqCounter())}this.scanline++,this.regsToAddress(),this.cntsToAddress()},startFrame:function(){var e=0;if(0===this.f_dispType)e=this.imgPalette[0];else switch(this.f_color){case 0:e=0;break;case 1:e=65280;break;case 2:e=16711680;break;case 3:e=0;break;case 4:e=255;break;default:e=0}var t,i=this.buffer;for(t=0;t<61440;t++)i[t]=e;var n=this.pixrendered;for(t=0;t<n.length;t++)n[t]=65},endFrame:function(){var e,t,i,n=this.buffer;if(this.showSpr0Hit){if(this.sprX[0]>=0&&this.sprX[0]<256&&this.sprY[0]>=0&&this.sprY[0]<240){for(e=0;e<256;e++)n[(this.sprY[0]<<8)+e]=16733525;for(e=0;e<240;e++)n[(e<<8)+this.sprX[0]]=16733525}if(this.spr0HitX>=0&&this.spr0HitX<256&&this.spr0HitY>=0&&this.spr0HitY<240){for(e=0;e<256;e++)n[(this.spr0HitY<<8)+e]=5635925;for(e=0;e<240;e++)n[(e<<8)+this.spr0HitX]=5635925}}if(this.clipToTvSize||0===this.f_bgClipping||0===this.f_spClipping)for(i=0;i<240;i++)for(t=0;t<8;t++)n[(i<<8)+t]=0;if(this.clipToTvSize)for(i=0;i<240;i++)for(t=0;t<8;t++)n[(i<<8)+255-t]=0;if(this.clipToTvSize)for(i=0;i<8;i++)for(t=0;t<256;t++)n[(i<<8)+t]=0,n[(239-i<<8)+t]=0;this.nes.opts.showDisplay&&this.nes.ui.writeFrame(n,this.prevBuffer)},updateControlReg1:function(e){this.triggerRendering(),this.f_nmiOnVblank=e>>7&1,this.f_spriteSize=e>>5&1,this.f_bgPatternTable=e>>4&1,this.f_spPatternTable=e>>3&1,this.f_addrInc=e>>2&1,this.f_nTblAddress=3&e,this.regV=e>>1&1,this.regH=1&e,this.regS=e>>4&1},updateControlReg2:function(e){this.triggerRendering(),this.f_color=e>>5&7,this.f_spVisibility=e>>4&1,this.f_bgVisibility=e>>3&1,this.f_spClipping=e>>2&1,this.f_bgClipping=e>>1&1,this.f_dispType=1&e,0===this.f_dispType&&this.palTable.setEmphasis(this.f_color),this.updatePalettes()},setStatusFlag:function(e,t){var i=1<<e;this.nes.cpu.mem[8194]=this.nes.cpu.mem[8194]&255-i|(t?i:0)},readStatusRegister:function(){var e=this.nes.cpu.mem[8194];return this.firstWrite=!0,this.setStatusFlag(this.STATUS_VBLANK,!1),e},writeSRAMAddress:function(e){this.sramAddress=e},sramLoad:function(){return this.spriteMem[this.sramAddress]},sramWrite:function(e){this.spriteMem[this.sramAddress]=e,this.spriteRamWriteUpdate(this.sramAddress,e),this.sramAddress++,this.sramAddress%=256},scrollWrite:function(e){this.triggerRendering(),this.firstWrite?(this.regHT=e>>3&31,this.regFH=7&e):(this.regFV=7&e,this.regVT=e>>3&31),this.firstWrite=!this.firstWrite},writeVRAMAddress:function(e){this.firstWrite?(this.regFV=e>>4&3,this.regV=e>>3&1,this.regH=e>>2&1,this.regVT=7&this.regVT|(3&e)<<3):(this.triggerRendering(),this.regVT=24&this.regVT|e>>5&7,this.regHT=31&e,this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,this.checkSprite0(this.scanline-20)),this.firstWrite=!this.firstWrite,this.cntsToAddress(),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress)},vramLoad:function(){var e;return this.cntsToAddress(),this.regsToAddress(),this.vramAddress<=16127?(e=this.vramBufferedReadValue,this.vramAddress<8192?this.vramBufferedReadValue=this.vramMem[this.vramAddress]:this.vramBufferedReadValue=this.mirroredLoad(this.vramAddress),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress),this.vramAddress+=1==this.f_addrInc?32:1,this.cntsFromAddress(),this.regsFromAddress(),e):(e=this.mirroredLoad(this.vramAddress),this.vramAddress+=1==this.f_addrInc?32:1,this.cntsFromAddress(),this.regsFromAddress(),e)},vramWrite:function(e){this.triggerRendering(),this.cntsToAddress(),this.regsToAddress(),this.vramAddress>=8192?this.mirroredWrite(this.vramAddress,e):(this.writeMem(this.vramAddress,e),this.nes.mmap.latchAccess(this.vramAddress)),this.vramAddress+=1==this.f_addrInc?32:1,this.regsFromAddress(),this.cntsFromAddress()},sramDMA:function(e){for(var t,i=256*e,n=this.sramAddress;n<256;n++)t=this.nes.cpu.mem[i+n],this.spriteMem[n]=t,this.spriteRamWriteUpdate(n,t);this.nes.cpu.haltCycles(513)},regsFromAddress:function(){var e=this.vramTmpAddress>>8&255;this.regFV=e>>4&7,this.regV=e>>3&1,this.regH=e>>2&1,this.regVT=7&this.regVT|(3&e)<<3,e=255&this.vramTmpAddress,this.regVT=24&this.regVT|e>>5&7,this.regHT=31&e},cntsFromAddress:function(){var e=this.vramAddress>>8&255;this.cntFV=e>>4&3,this.cntV=e>>3&1,this.cntH=e>>2&1,this.cntVT=7&this.cntVT|(3&e)<<3,e=255&this.vramAddress,this.cntVT=24&this.cntVT|e>>5&7,this.cntHT=31&e},regsToAddress:function(){var e=(7&this.regFV)<<4;e|=(1&this.regV)<<3,e|=(1&this.regH)<<2,e|=this.regVT>>3&3;var t=(7&this.regVT)<<5;t|=31&this.regHT,this.vramTmpAddress=32767&(e<<8|t)},cntsToAddress:function(){var e=(7&this.cntFV)<<4;e|=(1&this.cntV)<<3,e|=(1&this.cntH)<<2,e|=this.cntVT>>3&3;var t=(7&this.cntVT)<<5;t|=31&this.cntHT,this.vramAddress=32767&(e<<8|t)},incTileCounter:function(e){for(var t=e;0!==t;t--)this.cntHT++,32==this.cntHT&&(this.cntHT=0,this.cntVT++,this.cntVT>=30&&(this.cntH++,2==this.cntH&&(this.cntH=0,this.cntV++,2==this.cntV&&(this.cntV=0,this.cntFV++,this.cntFV&=7))))},mirroredLoad:function(e){return this.vramMem[this.vramMirrorTable[e]]},mirroredWrite:function(e,t){e>=16128&&e<16160?16128==e||16144==e?(this.writeMem(16128,t),this.writeMem(16144,t)):16132==e||16148==e?(this.writeMem(16132,t),this.writeMem(16148,t)):16136==e||16152==e?(this.writeMem(16136,t),this.writeMem(16152,t)):16140==e||16156==e?(this.writeMem(16140,t),this.writeMem(16156,t)):this.writeMem(e,t):e<this.vramMirrorTable.length?this.writeMem(this.vramMirrorTable[e],t):alert("Invalid VRAM address: "+e.toString(16))},triggerRendering:function(){this.scanline>=21&&this.scanline<=260&&(this.renderFramePartially(this.lastRenderedScanline+1,this.scanline-21-this.lastRenderedScanline),this.lastRenderedScanline=this.scanline-21)},renderFramePartially:function(e,t){if(1==this.f_spVisibility&&this.renderSpritesPartially(e,t,!0),1==this.f_bgVisibility){var i=e<<8,n=e+t<<8;n>61440&&(n=61440);for(var s=this.buffer,r=this.bgbuffer,a=this.pixrendered,o=i;o<n;o++)a[o]>255&&(s[o]=r[o])}1==this.f_spVisibility&&this.renderSpritesPartially(e,t,!1),this.validTileData=!1},renderBgScanline:function(e,t){var i=0===this.regS?0:256,n=(t<<8)-this.regFH;if(this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],this.cntHT=this.regHT,this.cntH=this.regH,this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],t<240&&t-this.cntFV>=0){for(var s,r,a,o,h=this.cntFV<<3,l=this.scantile,c=this.attrib,u=this.ptTile,p=this.nameTable,d=this.imgPalette,f=this.pixrendered,m=e?this.bgbuffer:this.buffer,g=0;g<32;g++){if(t>=0){this.validTileData?(s=l[g],r=s.pix,a=c[g]):(s=u[i+p[this.curNt].getTileIndex(this.cntHT,this.cntVT)],r=s.pix,a=p[this.curNt].getAttrib(this.cntHT,this.cntVT),l[g]=s,c[g]=a);var v=0,y=(g<<3)-this.regFH;if(y>-8)if(y<0&&(n-=y,v=-y),s.opaque[this.cntFV])for(;v<8;v++)m[n]=d[r[h+v]+a],f[n]|=256,n++;else for(;v<8;v++)o=r[h+v],0!==o&&(m[n]=d[o+a],f[n]|=256),n++}32==++this.cntHT&&(this.cntHT=0,this.cntH++,this.cntH%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH])}this.validTileData=!0}this.cntFV++,8==this.cntFV&&(this.cntFV=0,this.cntVT++,30==this.cntVT?(this.cntVT=0,this.cntV++,this.cntV%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH]):32==this.cntVT&&(this.cntVT=0),this.validTileData=!1)},renderSpritesPartially:function(e,t,i){if(1===this.f_spVisibility)for(var n=0;n<64;n++)if(this.bgPriority[n]==i&&this.sprX[n]>=0&&this.sprX[n]<256&&this.sprY[n]+8>=e&&this.sprY[n]<e+t)if(0===this.f_spriteSize)this.srcy1=0,this.srcy2=8,this.sprY[n]<e&&(this.srcy1=e-this.sprY[n]-1),this.sprY[n]+8>e+t&&(this.srcy2=e+t-this.sprY[n]+1),0===this.f_spPatternTable?this.ptTile[this.sprTile[n]].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[n],this.sprY[n]+1,this.sprCol[n],this.sprPalette,this.horiFlip[n],this.vertFlip[n],n,this.pixrendered):this.ptTile[this.sprTile[n]+256].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[n],this.sprY[n]+1,this.sprCol[n],this.sprPalette,this.horiFlip[n],this.vertFlip[n],n,this.pixrendered);else{var s=this.sprTile[n];0!==(1&s)&&(s=this.sprTile[n]-1+256);var r=0,a=8;this.sprY[n]<e&&(r=e-this.sprY[n]-1),this.sprY[n]+8>e+t&&(a=e+t-this.sprY[n]),this.ptTile[s+(this.vertFlip[n]?1:0)].render(this.buffer,0,r,8,a,this.sprX[n],this.sprY[n]+1,this.sprCol[n],this.sprPalette,this.horiFlip[n],this.vertFlip[n],n,this.pixrendered),r=0,a=8,this.sprY[n]+8<e&&(r=e-(this.sprY[n]+8+1)),this.sprY[n]+16>e+t&&(a=e+t-(this.sprY[n]+8)),this.ptTile[s+(this.vertFlip[n]?0:1)].render(this.buffer,0,r,8,a,this.sprX[n],this.sprY[n]+1+8,this.sprCol[n],this.sprPalette,this.horiFlip[n],this.vertFlip[n],n,this.pixrendered)}},checkSprite0:function(e){this.spr0HitX=-1,this.spr0HitY=-1;var t,i,n,s,r,a,o,h,l=0===this.f_spPatternTable?0:256;if(i=this.sprX[0],n=this.sprY[0]+1,0===this.f_spriteSize){if(n<=e&&n+8>e&&i>=-7&&i<256)if(s=this.ptTile[this.sprTile[0]+l],o=this.sprCol[0],h=this.bgPriority[0],t=this.vertFlip[0]?7-(e-n):e-n,t*=8,a=256*e+i,this.horiFlip[0])for(r=7;r>=0;r--){if(i>=0&&i<256&&a>=0&&a<61440&&0!==this.pixrendered[a]&&0!==s.pix[t+r])return this.spr0HitX=a%256,this.spr0HitY=e,!0;i++,a++}else for(r=0;r<8;r++){if(i>=0&&i<256&&a>=0&&a<61440&&0!==this.pixrendered[a]&&0!==s.pix[t+r])return this.spr0HitX=a%256,this.spr0HitY=e,!0;i++,a++}}else if(n<=e&&n+16>e&&i>=-7&&i<256)if(t=this.vertFlip[0]?15-(e-n):e-n,t<8?s=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?1:0)+(0!==(1&this.sprTile[0])?255:0)]:(s=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?0:1)+(0!==(1&this.sprTile[0])?255:0)],this.vertFlip[0]?t=15-t:t-=8),t*=8,o=this.sprCol[0],h=this.bgPriority[0],a=256*e+i,this.horiFlip[0])for(r=7;r>=0;r--){if(i>=0&&i<256&&a>=0&&a<61440&&0!==this.pixrendered[a]&&0!==s.pix[t+r])return this.spr0HitX=a%256,this.spr0HitY=e,!0;i++,a++}else for(r=0;r<8;r++){if(i>=0&&i<256&&a>=0&&a<61440&&0!==this.pixrendered[a]&&0!==s.pix[t+r])return this.spr0HitX=a%256,this.spr0HitY=e,!0;i++,a++}return!1},writeMem:function(e,t){this.vramMem[e]=t,e<8192?(this.vramMem[e]=t,this.patternWrite(e,t)):e>=8192&&e<9152?this.nameTableWrite(this.ntable1[0],e-8192,t):e>=9152&&e<9216?this.attribTableWrite(this.ntable1[0],e-9152,t):e>=9216&&e<10176?this.nameTableWrite(this.ntable1[1],e-9216,t):e>=10176&&e<10240?this.attribTableWrite(this.ntable1[1],e-10176,t):e>=10240&&e<11200?this.nameTableWrite(this.ntable1[2],e-10240,t):e>=11200&&e<11264?this.attribTableWrite(this.ntable1[2],e-11200,t):e>=11264&&e<12224?this.nameTableWrite(this.ntable1[3],e-11264,t):e>=12224&&e<12288?this.attribTableWrite(this.ntable1[3],e-12224,t):e>=16128&&e<16160&&this.updatePalettes()},updatePalettes:function(){var e;for(e=0;e<16;e++)0===this.f_dispType?this.imgPalette[e]=this.palTable.getEntry(63&this.vramMem[16128+e]):this.imgPalette[e]=this.palTable.getEntry(32&this.vramMem[16128+e]);for(e=0;e<16;e++)0===this.f_dispType?this.sprPalette[e]=this.palTable.getEntry(63&this.vramMem[16144+e]):this.sprPalette[e]=this.palTable.getEntry(32&this.vramMem[16144+e])},patternWrite:function(e,t){var i=Math.floor(e/16),n=e%16;n<8?this.ptTile[i].setScanline(n,t,this.vramMem[e+8]):this.ptTile[i].setScanline(n-8,this.vramMem[e-8],t)},nameTableWrite:function(e,t,i){this.nameTable[e].tile[t]=i,this.checkSprite0(this.scanline-20)},attribTableWrite:function(e,t,i){this.nameTable[e].writeAttrib(t,i)},spriteRamWriteUpdate:function(e,t){var i=Math.floor(e/4);0===i&&this.checkSprite0(this.scanline-20),e%4===0?this.sprY[i]=t:e%4==1?this.sprTile[i]=t:e%4==2?(this.vertFlip[i]=0!==(128&t),this.horiFlip[i]=0!==(64&t),this.bgPriority[i]=0!==(32&t),this.sprCol[i]=(3&t)<<2):e%4==3&&(this.sprX[i]=t)},doNMI:function(){this.setStatusFlag(this.STATUS_VBLANK,!0),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI)},JSON_PROPERTIES:["vramMem","spriteMem","cntFV","cntV","cntH","cntVT","cntHT","regFV","regV","regH","regVT","regHT","regFH","regS","vramAddress","vramTmpAddress","f_nmiOnVblank","f_spriteSize","f_bgPatternTable","f_spPatternTable","f_addrInc","f_nTblAddress","f_color","f_spVisibility","f_bgVisibility","f_spClipping","f_bgClipping","f_dispType","vramBufferedReadValue","firstWrite","currentMirroring","vramMirrorTable","ntable1","sramAddress","hitSpr0","sprPalette","imgPalette","curX","scanline","lastRenderedScanline","curNt","scantile","attrib","buffer","bgbuffer","pixrendered","requestEndFrame","nmiOk","dummyCycleToggle","nmiCounter","validTileData","scanlineAlreadyRendered"],
toJSON:function(){var e,t=JSNES.Utils.toJSON(this);for(t.nameTable=[],e=0;e<this.nameTable.length;e++)t.nameTable[e]=this.nameTable[e].toJSON();for(t.ptTile=[],e=0;e<this.ptTile.length;e++)t.ptTile[e]=this.ptTile[e].toJSON();return t},fromJSON:function(e){var t;for(JSNES.Utils.fromJSON(this,e),t=0;t<this.nameTable.length;t++)this.nameTable[t].fromJSON(e.nameTable[t]);for(t=0;t<this.ptTile.length;t++)this.ptTile[t].fromJSON(e.ptTile[t]);for(t=0;t<this.spriteMem.length;t++)this.spriteRamWriteUpdate(t,this.spriteMem[t])}},JSNES.PPU.NameTable=function(e,t,i){this.width=e,this.height=t,this.name=i,this.tile=new Array(e*t),this.attrib=new Array(e*t)},JSNES.PPU.NameTable.prototype={getTileIndex:function(e,t){return this.tile[t*this.width+e]},getAttrib:function(e,t){return this.attrib[t*this.width+e]},writeAttrib:function(e,t){for(var i,n,s,r,a=e%8*4,o=4*Math.floor(e/8),h=0;h<2;h++)for(var l=0;l<2;l++){i=t>>2*(2*h+l)&3;for(var c=0;c<2;c++)for(var u=0;u<2;u++)n=a+2*l+u,s=o+2*h+c,r=s*this.width+n,this.attrib[s*this.width+n]=i<<2&12}},toJSON:function(){return{tile:this.tile,attrib:this.attrib}},fromJSON:function(e){this.tile=e.tile,this.attrib=e.attrib}},JSNES.PPU.PaletteTable=function(){this.curTable=new Array(64),this.emphTable=new Array(8),this.currentEmph=-1},JSNES.PPU.PaletteTable.prototype={reset:function(){this.setEmphasis(0)},loadNTSCPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},loadPALPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},makeTables:function(){for(var e,t,i,n,s,r,a,o,h=0;h<8;h++)for(r=1,a=1,o=1,0!==(1&h)&&(r=.75,o=.75),0!==(2&h)&&(r=.75,a=.75),0!==(4&h)&&(a=.75,o=.75),this.emphTable[h]=new Array(64),s=0;s<64;s++)n=this.curTable[s],e=Math.floor(this.getRed(n)*r),t=Math.floor(this.getGreen(n)*a),i=Math.floor(this.getBlue(n)*o),this.emphTable[h][s]=this.getRgb(e,t,i)},setEmphasis:function(e){if(e!=this.currentEmph){this.currentEmph=e;for(var t=0;t<64;t++)this.curTable[t]=this.emphTable[e][t]}},getEntry:function(e){return this.curTable[e]},getRed:function(e){return e>>16&255},getGreen:function(e){return e>>8&255},getBlue:function(e){return 255&e},getRgb:function(e,t,i){return e<<16|t<<8|i},loadDefaultPalette:function(){this.curTable[0]=this.getRgb(117,117,117),this.curTable[1]=this.getRgb(39,27,143),this.curTable[2]=this.getRgb(0,0,171),this.curTable[3]=this.getRgb(71,0,159),this.curTable[4]=this.getRgb(143,0,119),this.curTable[5]=this.getRgb(171,0,19),this.curTable[6]=this.getRgb(167,0,0),this.curTable[7]=this.getRgb(127,11,0),this.curTable[8]=this.getRgb(67,47,0),this.curTable[9]=this.getRgb(0,71,0),this.curTable[10]=this.getRgb(0,81,0),this.curTable[11]=this.getRgb(0,63,23),this.curTable[12]=this.getRgb(27,63,95),this.curTable[13]=this.getRgb(0,0,0),this.curTable[14]=this.getRgb(0,0,0),this.curTable[15]=this.getRgb(0,0,0),this.curTable[16]=this.getRgb(188,188,188),this.curTable[17]=this.getRgb(0,115,239),this.curTable[18]=this.getRgb(35,59,239),this.curTable[19]=this.getRgb(131,0,243),this.curTable[20]=this.getRgb(191,0,191),this.curTable[21]=this.getRgb(231,0,91),this.curTable[22]=this.getRgb(219,43,0),this.curTable[23]=this.getRgb(203,79,15),this.curTable[24]=this.getRgb(139,115,0),this.curTable[25]=this.getRgb(0,151,0),this.curTable[26]=this.getRgb(0,171,0),this.curTable[27]=this.getRgb(0,147,59),this.curTable[28]=this.getRgb(0,131,139),this.curTable[29]=this.getRgb(0,0,0),this.curTable[30]=this.getRgb(0,0,0),this.curTable[31]=this.getRgb(0,0,0),this.curTable[32]=this.getRgb(255,255,255),this.curTable[33]=this.getRgb(63,191,255),this.curTable[34]=this.getRgb(95,151,255),this.curTable[35]=this.getRgb(167,139,253),this.curTable[36]=this.getRgb(247,123,255),this.curTable[37]=this.getRgb(255,119,183),this.curTable[38]=this.getRgb(255,119,99),this.curTable[39]=this.getRgb(255,155,59),this.curTable[40]=this.getRgb(243,191,63),this.curTable[41]=this.getRgb(131,211,19),this.curTable[42]=this.getRgb(79,223,75),this.curTable[43]=this.getRgb(88,248,152),this.curTable[44]=this.getRgb(0,235,219),this.curTable[45]=this.getRgb(0,0,0),this.curTable[46]=this.getRgb(0,0,0),this.curTable[47]=this.getRgb(0,0,0),this.curTable[48]=this.getRgb(255,255,255),this.curTable[49]=this.getRgb(171,231,255),this.curTable[50]=this.getRgb(199,215,255),this.curTable[51]=this.getRgb(215,203,255),this.curTable[52]=this.getRgb(255,199,255),this.curTable[53]=this.getRgb(255,199,219),this.curTable[54]=this.getRgb(255,191,179),this.curTable[55]=this.getRgb(255,219,171),this.curTable[56]=this.getRgb(255,231,163),this.curTable[57]=this.getRgb(227,255,163),this.curTable[58]=this.getRgb(171,243,191),this.curTable[59]=this.getRgb(179,255,207),this.curTable[60]=this.getRgb(159,255,243),this.curTable[61]=this.getRgb(0,0,0),this.curTable[62]=this.getRgb(0,0,0),this.curTable[63]=this.getRgb(0,0,0),this.makeTables(),this.setEmphasis(0)}},JSNES.PPU.Tile=function(){this.pix=new Array(64),this.fbIndex=null,this.tIndex=null,this.x=null,this.y=null,this.w=null,this.h=null,this.incX=null,this.incY=null,this.palIndex=null,this.tpri=null,this.c=null,this.initialized=!1,this.opaque=new Array(8)},JSNES.PPU.Tile.prototype={setBuffer:function(e){for(this.y=0;this.y<8;this.y++)this.setScanline(this.y,e[this.y],e[this.y+8])},setScanline:function(e,t,i){for(this.initialized=!0,this.tIndex=e<<3,this.x=0;this.x<8;this.x++)this.pix[this.tIndex+this.x]=(t>>7-this.x&1)+((i>>7-this.x&1)<<1),0===this.pix[this.tIndex+this.x]&&(this.opaque[e]=!1)},render:function(e,t,i,n,s,r,a,o,h,l,c,u,p){if(!(r<-7||r>=256||a<-7||a>=240))if(this.w=n-t,this.h=s-i,r<0&&(t-=r),r+n>=256&&(n=256-r),a<0&&(i-=a),a+s>=240&&(s=240-a),l||c)if(l&&!c)for(this.fbIndex=(a<<8)+r,this.tIndex=7,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=t&&this.x<n&&this.y>=i&&this.y<s&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&u<=(255&this.tpri)&&(e[this.fbIndex]=h[this.palIndex+o],this.tpri=3840&this.tpri|u,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256,this.tIndex+=16}else if(c&&!l)for(this.fbIndex=(a<<8)+r,this.tIndex=56,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=t&&this.x<n&&this.y>=i&&this.y<s&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&u<=(255&this.tpri)&&(e[this.fbIndex]=h[this.palIndex+o],this.tpri=3840&this.tpri|u,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256,this.tIndex-=16}else for(this.fbIndex=(a<<8)+r,this.tIndex=63,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=t&&this.x<n&&this.y>=i&&this.y<s&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&u<=(255&this.tpri)&&(e[this.fbIndex]=h[this.palIndex+o],this.tpri=3840&this.tpri|u,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256}else for(this.fbIndex=(a<<8)+r,this.tIndex=0,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=t&&this.x<n&&this.y>=i&&this.y<s&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&u<=(255&this.tpri)&&(e[this.fbIndex]=h[this.palIndex+o],this.tpri=3840&this.tpri|u,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256}},isTransparent:function(e,t){return 0===this.pix[(t<<3)+e]},toJSON:function(){return{opaque:this.opaque,pix:this.pix}},fromJSON:function(e){this.opaque=e.opaque,this.pix=e.pix}},JSNES.ROM=function(e){this.nes=e,this.mapperName=new Array(92);for(var t=0;t<92;t++)this.mapperName[t]="Unknown Mapper";this.mapperName[0]="Direct Access",this.mapperName[1]="Nintendo MMC1",this.mapperName[2]="UNROM",this.mapperName[3]="CNROM",this.mapperName[4]="Nintendo MMC3",this.mapperName[5]="Nintendo MMC5",this.mapperName[6]="FFE F4xxx",this.mapperName[7]="AOROM",this.mapperName[8]="FFE F3xxx",this.mapperName[9]="Nintendo MMC2",this.mapperName[10]="Nintendo MMC4",this.mapperName[11]="Color Dreams Chip",this.mapperName[12]="FFE F6xxx",this.mapperName[15]="100-in-1 switch",this.mapperName[16]="Bandai chip",this.mapperName[17]="FFE F8xxx",this.mapperName[18]="Jaleco SS8806 chip",this.mapperName[19]="Namcot 106 chip",this.mapperName[20]="Famicom Disk System",this.mapperName[21]="Konami VRC4a",this.mapperName[22]="Konami VRC2a",this.mapperName[23]="Konami VRC2a",this.mapperName[24]="Konami VRC6",this.mapperName[25]="Konami VRC4b",this.mapperName[32]="Irem G-101 chip",this.mapperName[33]="Taito TC0190/TC0350",this.mapperName[34]="32kB ROM switch",this.mapperName[64]="Tengen RAMBO-1 chip",this.mapperName[65]="Irem H-3001 chip",this.mapperName[66]="GNROM switch",this.mapperName[67]="SunSoft3 chip",this.mapperName[68]="SunSoft4 chip",this.mapperName[69]="SunSoft5 FME-7 chip",this.mapperName[71]="Camerica chip",this.mapperName[78]="Irem 74HC161/32-based",this.mapperName[91]="Pirate HK-SF3 chip"},JSNES.ROM.prototype={VERTICAL_MIRRORING:0,HORIZONTAL_MIRRORING:1,FOURSCREEN_MIRRORING:2,SINGLESCREEN_MIRRORING:3,SINGLESCREEN_MIRRORING2:4,SINGLESCREEN_MIRRORING3:5,SINGLESCREEN_MIRRORING4:6,CHRROM_MIRRORING:7,header:null,rom:null,vrom:null,vromTile:null,romCount:null,vromCount:null,mirroring:null,batteryRam:null,trainer:null,fourScreen:null,mapperType:null,valid:!1,load:function(e){var t,i,n;if(e.indexOf("NES")===-1)return void this.nes.ui.updateStatus("Not a valid NES ROM.");for(this.header=new Array(16),t=0;t<16;t++)this.header[t]=255&e.charCodeAt(t);this.romCount=this.header[4],this.vromCount=2*this.header[5],this.mirroring=0!==(1&this.header[6])?1:0,this.batteryRam=0!==(2&this.header[6]),this.trainer=0!==(4&this.header[6]),this.fourScreen=0!==(8&this.header[6]),this.mapperType=this.header[6]>>4|240&this.header[7];var s=!1;for(t=8;t<16;t++)if(0!==this.header[t]){s=!0;break}s&&(this.mapperType&=15),this.rom=new Array(this.romCount);var r=16;for(t=0;t<this.romCount;t++){for(this.rom[t]=new Array(16384),i=0;i<16384&&!(r+i>=e.length);i++)this.rom[t][i]=255&e.charCodeAt(r+i);r+=16384}for(this.vrom=new Array(this.vromCount),t=0;t<this.vromCount;t++){for(this.vrom[t]=new Array(4096),i=0;i<4096&&!(r+i>=e.length);i++)this.vrom[t][i]=255&e.charCodeAt(r+i);r+=4096}for(this.vromTile=new Array(this.vromCount),t=0;t<this.vromCount;t++)for(this.vromTile[t]=new Array(256),i=0;i<256;i++)this.vromTile[t][i]=new JSNES.PPU.Tile;var a,o;for(n=0;n<this.vromCount;n++)for(t=0;t<4096;t++)a=t>>4,o=t%16,o<8?this.vromTile[n][a].setScanline(o,this.vrom[n][t],this.vrom[n][t+8]):this.vromTile[n][a].setScanline(o-8,this.vrom[n][t-8],this.vrom[n][t]);this.valid=!0},getMirroringType:function(){return this.fourScreen?this.FOURSCREEN_MIRRORING:0===this.mirroring?this.HORIZONTAL_MIRRORING:this.VERTICAL_MIRRORING},getMapperName:function(){return this.mapperType>=0&&this.mapperType<this.mapperName.length?this.mapperName[this.mapperType]:"Unknown Mapper, "+this.mapperType},mapperSupported:function(){return"undefined"!=typeof JSNES.Mappers[this.mapperType]},createMapper:function(){return this.mapperSupported()?new JSNES.Mappers[this.mapperType](this.nes):(this.nes.ui.updateStatus("This ROM uses a mapper not supported by JSNES: "+this.getMapperName()+"("+this.mapperType+")"),null)}},JSNES.DummyUI=function(e){this.nes=e,this.enable=function(){},this.updateStatus=function(){},this.writeAudio=function(){},this.writeFrame=function(){}},"undefined"!=typeof jQuery&&!function(e){e.fn.JSNESUI=function(){var t=this,i=function(i){var n=this;return n.nes=i,n.root=e('<div style="width: 100%; height: 100%; position: relative;"></div>'),n.screen=e('<canvas class="nes-screen" width="256" height="240" style="width: 100%; height: 100%; object-fit: contain;"></canvas>').appendTo(n.root),n.screen[0].getContext?(n.root.appendTo(t),n.canvasContext=n.screen[0].getContext("2d"),n.canvasContext.getImageData?(n.canvasImageData=n.canvasContext.getImageData(0,0,256,240),n.resetCanvas(),void(n.dynamicaudio=new DynamicAudio({swf:i.opts.swfPath+"dynamicaudio.swf"}))):void t.html("Your browser doesn't support writing pixels directly to the <code>&lt;canvas&gt;</code> tag. Try the latest versions of Google Chrome, Safari, Opera or Firefox!")):void t.html("Your browser doesn't support the <code>&lt;canvas&gt;</code> tag. Try Google Chrome, Safari, Opera or Firefox!")};return i.prototype={loadROM:function(t){var i=this;i.updateStatus("Downloading..."),e.ajax({url:t,xhr:function(){var t=e.ajaxSettings.xhr();return"undefined"!=typeof t.overrideMimeType&&t.overrideMimeType("text/plain; charset=x-user-defined"),i.xhr=t,t},complete:function(e,t){var n;if(JSNES.Utils.isIE()){var s=JSNESBinaryToArray(e.responseBody).toArray();n=String.fromCharCode.apply(void 0,s)}else n=e.responseText;i.setROM(n)}})},setROM:function(e){this.nes.loadRom(e),this.nes.start()},resetCanvas:function(){this.canvasContext.fillStyle="black",this.canvasContext.fillRect(0,0,256,240);for(var e=3;e<this.canvasImageData.data.length-3;e+=4)this.canvasImageData.data[e]=255},screenshot:function(){var e=this.screen[0].toDataURL("image/png"),t=new Image;return t.src=e,t},updateStatus:function(e){console.log(e)},writeAudio:function(e){return this.dynamicaudio.writeInt(e)},writeFrame:function(e,t){var i,n,s,r=this.canvasImageData.data;for(n=0;n<61440;n++)i=e[n],i!=t[n]&&(s=4*n,r[s]=255&i,r[s+1]=i>>8&255,r[s+2]=i>>16&255,t[n]=i);this.canvasContext.putImageData(this.canvasImageData,0,0)}},i}}(jQuery);var QRCode;!function(){function e(e){this.mode=l.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=0,i=this.data.length;t<i;t++){var n=[],s=this.data.charCodeAt(t);s>65536?(n[0]=240|(1835008&s)>>>18,n[1]=128|(258048&s)>>>12,n[2]=128|(4032&s)>>>6,n[3]=128|63&s):s>2048?(n[0]=224|(61440&s)>>>12,n[1]=128|(4032&s)>>>6,n[2]=128|63&s):s>128?(n[0]=192|(1984&s)>>>6,n[1]=128|63&s):n[0]=s,this.parsedData.push(n)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function t(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function i(e,t){if(void 0==e.length)throw new Error(e.length+"/"+t);for(var i=0;i<e.length&&0==e[i];)i++;this.num=new Array(e.length-i+t);for(var n=0;n<e.length-i;n++)this.num[n]=e[n+i]}function n(e,t){this.totalCount=e,this.dataCount=t}function s(){this.buffer=[],this.length=0}function r(){return"undefined"!=typeof CanvasRenderingContext2D}function a(){var e=!1,t=navigator.userAgent;if(/android/i.test(t)){e=!0;var i=t.toString().match(/android ([0-9]\.[0-9])/i);i&&i[1]&&(e=parseFloat(i[1]))}return e}function o(e,t){for(var i=1,n=h(e),s=0,r=m.length;s<=r;s++){var a=0;switch(t){case c.L:a=m[s][0];break;case c.M:a=m[s][1];break;case c.Q:a=m[s][2];break;case c.H:a=m[s][3]}if(n<=a)break;i++}if(i>m.length)throw new Error("Too long data");return i}function h(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}e.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,i=this.parsedData.length;t<i;t++)e.put(this.parsedData[t],8)}},t.prototype={addData:function(t){var i=new e(t);this.dataList.push(i),this.dataCache=null},isDark:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,i){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var s=0;s<this.moduleCount;s++)this.modules[n][s]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,i),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,i)},setupPositionProbePattern:function(e,t){for(var i=-1;i<=7;i++)if(!(e+i<=-1||this.moduleCount<=e+i))for(var n=-1;n<=7;n++)t+n<=-1||this.moduleCount<=t+n||(0<=i&&i<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==i||6==i)||2<=i&&i<=4&&2<=n&&n<=4?this.modules[e+i][t+n]=!0:this.modules[e+i][t+n]=!1)},getBestMaskPattern:function(){for(var e=0,t=0,i=0;i<8;i++){this.makeImpl(!0,i);var n=p.getLostPoint(this);(0==i||e>n)&&(e=n,t=i)}return t},createMovieClip:function(e,t,i){var n=e.createEmptyMovieClip(t,i),s=1;this.make();for(var r=0;r<this.modules.length;r++)for(var a=r*s,o=0;o<this.modules[r].length;o++){var h=o*s,l=this.modules[r][o];l&&(n.beginFill(0,100),n.moveTo(h,a),n.lineTo(h+s,a),n.lineTo(h+s,a+s),n.lineTo(h,a+s),n.endFill())}return n},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupPositionAdjustPattern:function(){for(var e=p.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var i=0;i<e.length;i++){var n=e[t],s=e[i];if(null==this.modules[n][s])for(var r=-2;r<=2;r++)for(var a=-2;a<=2;a++)r==-2||2==r||a==-2||2==a||0==r&&0==a?this.modules[n+r][s+a]=!0:this.modules[n+r][s+a]=!1}},setupTypeNumber:function(e){for(var t=p.getBCHTypeNumber(this.typeNumber),i=0;i<18;i++){var n=!e&&1==(t>>i&1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=n}for(var i=0;i<18;i++){var n=!e&&1==(t>>i&1);this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=n}},setupTypeInfo:function(e,t){for(var i=this.errorCorrectLevel<<3|t,n=p.getBCHTypeInfo(i),s=0;s<15;s++){var r=!e&&1==(n>>s&1);s<6?this.modules[s][8]=r:s<8?this.modules[s+1][8]=r:this.modules[this.moduleCount-15+s][8]=r}for(var s=0;s<15;s++){var r=!e&&1==(n>>s&1);s<8?this.modules[8][this.moduleCount-s-1]=r:s<9?this.modules[8][15-s-1+1]=r:this.modules[8][15-s-1]=r}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var i=-1,n=this.moduleCount-1,s=7,r=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var o=0;o<2;o++)if(null==this.modules[n][a-o]){var h=!1;r<e.length&&(h=1==(e[r]>>>s&1));var l=p.getMask(t,n,a-o);l&&(h=!h),this.modules[n][a-o]=h,s--,s==-1&&(r++,s=7)}if(n+=i,n<0||this.moduleCount<=n){n-=i,i=-i;break}}}},t.PAD0=236,t.PAD1=17,t.createData=function(e,i,r){for(var a=n.getRSBlocks(e,i),o=new s,h=0;h<r.length;h++){var l=r[h];o.put(l.mode,4),o.put(l.getLength(),p.getLengthInBits(l.mode,e)),l.write(o)}for(var c=0,h=0;h<a.length;h++)c+=a[h].dataCount;if(o.getLengthInBits()>8*c)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*c+")");for(o.getLengthInBits()+4<=8*c&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(!1);for(;;){if(o.getLengthInBits()>=8*c)break;if(o.put(t.PAD0,8),o.getLengthInBits()>=8*c)break;o.put(t.PAD1,8)}return t.createBytes(o,a)},t.createBytes=function(e,t){for(var n=0,s=0,r=0,a=new Array(t.length),o=new Array(t.length),h=0;h<t.length;h++){var l=t[h].dataCount,c=t[h].totalCount-l;s=Math.max(s,l),r=Math.max(r,c),a[h]=new Array(l);for(var u=0;u<a[h].length;u++)a[h][u]=255&e.buffer[u+n];n+=l;var d=p.getErrorCorrectPolynomial(c),f=new i(a[h],d.getLength()-1),m=f.mod(d);o[h]=new Array(d.getLength()-1);for(var u=0;u<o[h].length;u++){var g=u+m.getLength()-o[h].length;o[h][u]=g>=0?m.get(g):0}}for(var v=0,u=0;u<t.length;u++)v+=t[u].totalCount;for(var y=new Array(v),S=0,u=0;u<s;u++)for(var h=0;h<t.length;h++)u<a[h].length&&(y[S++]=a[h][u]);for(var u=0;u<r;u++)for(var h=0;h<t.length;h++)u<o[h].length&&(y[S++]=o[h][u]);return y};for(var l={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},c={L:1,M:0,Q:3,H:2},u={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},p={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;p.getBCHDigit(t)-p.getBCHDigit(p.G15)>=0;)t^=p.G15<<p.getBCHDigit(t)-p.getBCHDigit(p.G15);return(e<<10|t)^p.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;p.getBCHDigit(t)-p.getBCHDigit(p.G18)>=0;)t^=p.G18<<p.getBCHDigit(t)-p.getBCHDigit(p.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return p.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,i){switch(e){case u.PATTERN000:return(t+i)%2==0;case u.PATTERN001:return t%2==0;case u.PATTERN010:return i%3==0;case u.PATTERN011:return(t+i)%3==0;case u.PATTERN100:return(Math.floor(t/2)+Math.floor(i/3))%2==0;case u.PATTERN101:return t*i%2+t*i%3==0;case u.PATTERN110:return(t*i%2+t*i%3)%2==0;case u.PATTERN111:return(t*i%3+(t+i)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new i([1],0),n=0;n<e;n++)t=t.multiply(new i([1,d.gexp(n)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case l.MODE_NUMBER:return 10;case l.MODE_ALPHA_NUM:return 9;case l.MODE_8BIT_BYTE:return 8;case l.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case l.MODE_NUMBER:return 12;case l.MODE_ALPHA_NUM:return 11;case l.MODE_8BIT_BYTE:return 16;case l.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case l.MODE_NUMBER:return 14;case l.MODE_ALPHA_NUM:return 13;case l.MODE_8BIT_BYTE:return 16;case l.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),i=0,n=0;n<t;n++)for(var s=0;s<t;s++){for(var r=0,a=e.isDark(n,s),o=-1;o<=1;o++)if(!(n+o<0||t<=n+o))for(var h=-1;h<=1;h++)s+h<0||t<=s+h||0==o&&0==h||a==e.isDark(n+o,s+h)&&r++;r>5&&(i+=3+r-5)}for(var n=0;n<t-1;n++)for(var s=0;s<t-1;s++){var l=0;e.isDark(n,s)&&l++,e.isDark(n+1,s)&&l++,e.isDark(n,s+1)&&l++,e.isDark(n+1,s+1)&&l++,0!=l&&4!=l||(i+=3)}for(var n=0;n<t;n++)for(var s=0;s<t-6;s++)e.isDark(n,s)&&!e.isDark(n,s+1)&&e.isDark(n,s+2)&&e.isDark(n,s+3)&&e.isDark(n,s+4)&&!e.isDark(n,s+5)&&e.isDark(n,s+6)&&(i+=40);for(var s=0;s<t;s++)for(var n=0;n<t-6;n++)e.isDark(n,s)&&!e.isDark(n+1,s)&&e.isDark(n+2,s)&&e.isDark(n+3,s)&&e.isDark(n+4,s)&&!e.isDark(n+5,s)&&e.isDark(n+6,s)&&(i+=40);for(var c=0,s=0;s<t;s++)for(var n=0;n<t;n++)e.isDark(n,s)&&c++;var u=Math.abs(100*c/t/t-50)/5;return i+=10*u}},d={glog:function(e){if(e<1)throw new Error("glog("+e+")");return d.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return d.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},f=0;f<8;f++)d.EXP_TABLE[f]=1<<f;for(var f=8;f<256;f++)d.EXP_TABLE[f]=d.EXP_TABLE[f-4]^d.EXP_TABLE[f-5]^d.EXP_TABLE[f-6]^d.EXP_TABLE[f-8];for(var f=0;f<255;f++)d.LOG_TABLE[d.EXP_TABLE[f]]=f;i.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),n=0;n<this.getLength();n++)for(var s=0;s<e.getLength();s++)t[n+s]^=d.gexp(d.glog(this.get(n))+d.glog(e.get(s)));return new i(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=d.glog(this.get(0))-d.glog(e.get(0)),n=new Array(this.getLength()),s=0;s<this.getLength();s++)n[s]=this.get(s);for(var s=0;s<e.getLength();s++)n[s]^=d.gexp(d.glog(e.get(s))+t);return new i(n,0).mod(e)}},n.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],n.getRSBlocks=function(e,t){var i=n.getRsBlockTable(e,t);if(void 0==i)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var s=i.length/3,r=[],a=0;a<s;a++)for(var o=i[3*a+0],h=i[3*a+1],l=i[3*a+2],c=0;c<o;c++)r.push(new n(h,l));return r},n.getRsBlockTable=function(e,t){switch(t){case c.L:return n.RS_BLOCK_TABLE[4*(e-1)+0];case c.M:return n.RS_BLOCK_TABLE[4*(e-1)+1];case c.Q:return n.RS_BLOCK_TABLE[4*(e-1)+2];case c.H:return n.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},s.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var i=0;i<t;i++)this.putBit(1==(e>>>t-i-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var m=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],g=function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){function t(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg",e);for(var n in t)t.hasOwnProperty(n)&&i.setAttribute(n,t[n]);return i}var i=this._htOption,n=this._el,s=e.getModuleCount();Math.floor(i.width/s),Math.floor(i.height/s);this.clear();var r=t("svg",{viewBox:"0 0 "+String(s)+" "+String(s),width:"100%",height:"100%",fill:i.colorLight});r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.appendChild(r),r.appendChild(t("rect",{fill:i.colorLight,width:"100%",height:"100%"})),r.appendChild(t("rect",{fill:i.colorDark,width:"1",height:"1",id:"template"}));for(var a=0;a<s;a++)for(var o=0;o<s;o++)if(e.isDark(a,o)){var h=t("use",{x:String(o),y:String(a)});h.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),r.appendChild(h)}},e.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},e}(),v="svg"===document.documentElement.tagName.toLowerCase(),y=v?g:r()?function(){function e(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function t(e,t){var i=this;if(i._fFail=t,i._fSuccess=e,null===i._bSupportDataURI){var n=document.createElement("img"),s=function(){i._bSupportDataURI=!1,i._fFail&&i._fFail.call(i)},r=function(){i._bSupportDataURI=!0,i._fSuccess&&i._fSuccess.call(i)};return n.onabort=s,n.onerror=s,n.onload=r,void(n.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}i._bSupportDataURI===!0&&i._fSuccess?i._fSuccess.call(i):i._bSupportDataURI===!1&&i._fFail&&i._fFail.call(i)}if(this._android&&this._android<=2.1){var i=1/window.devicePixelRatio,n=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,t,s,r,a,o,h,l,c){if("nodeName"in e&&/img/i.test(e.nodeName))for(var u=arguments.length-1;u>=1;u--)arguments[u]=arguments[u]*i;else"undefined"==typeof l&&(arguments[1]*=i,arguments[2]*=i,arguments[3]*=i,arguments[4]*=i);n.apply(this,arguments)}}var s=function(e,t){this._bIsPainted=!1,this._android=a(),this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return s.prototype.draw=function(e){var t=this._elImage,i=this._oContext,n=this._htOption,s=e.getModuleCount(),r=n.width/s,a=n.height/s,o=Math.round(r),h=Math.round(a);
t.style.display="none",this.clear();for(var l=0;l<s;l++)for(var c=0;c<s;c++){var u=e.isDark(l,c),p=c*r,d=l*a;i.strokeStyle=u?n.colorDark:n.colorLight,i.lineWidth=1,i.fillStyle=u?n.colorDark:n.colorLight,i.fillRect(p,d,r,a),i.strokeRect(Math.floor(p)+.5,Math.floor(d)+.5,o,h),i.strokeRect(Math.ceil(p)-.5,Math.ceil(d)-.5,o,h)}this._bIsPainted=!0},s.prototype.makeImage=function(){this._bIsPainted&&t.call(this,e)},s.prototype.isPainted=function(){return this._bIsPainted},s.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},s.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},s}():function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){for(var t=this._htOption,i=this._el,n=e.getModuleCount(),s=Math.floor(t.width/n),r=Math.floor(t.height/n),a=['<table style="border:0;border-collapse:collapse;">'],o=0;o<n;o++){a.push("<tr>");for(var h=0;h<n;h++)a.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+s+"px;height:"+r+"px;background-color:"+(e.isDark(o,h)?t.colorDark:t.colorLight)+';"></td>');a.push("</tr>")}a.push("</table>"),i.innerHTML=a.join("");var l=i.childNodes[0],c=(t.width-l.offsetWidth)/2,u=(t.height-l.offsetHeight)/2;c>0&&u>0&&(l.style.margin=u+"px "+c+"px")},e.prototype.clear=function(){this._el.innerHTML=""},e}();QRCode=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:c.H},"string"==typeof t&&(t={text:t}),t)for(var i in t)this._htOption[i]=t[i];"string"==typeof e&&(e=document.getElementById(e)),this._htOption.useSVG&&(y=g),this._android=a(),this._el=e,this._oQRCode=null,this._oDrawing=new y(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(e){this._oQRCode=new t(o(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=c}(),function(){"use strict";var e=new window.webRtcMaster,t=!0,i=!0,n=!1;$(function(){function s(){i=!1,d.hide(),b.isRunning||b.start()}function r(e){g.hide(),e?(f.show(),m.hide()):(m.show(),f.hide(),o(T)),d.show(),!i&&b.isRunning&&b.stop()}function a(){g.show(),f.hide(),m.hide(),d.show(),b.stop()}function o(e){$("<h1>Loading...</h1>").appendTo(e.empty()),R.filesListFolder({path:""}).then(function(t){e.empty(),t.entries.forEach(function(t){$("<span>"+t.name+"</span>").on("click",function(){h(t.path_lower)}).appendTo(e)})})["catch"](function(e){console.log(e)})}function h(e,t){t||a(),R.filesDownload({path:e}).then(function(e){var i=URL.createObjectURL(e.fileBlob);b.ui.loadROM(i),t||s()})}function l(e,t){var i=$(".player-controls.player"+(e+1));t?($(".keyboard-controls",i).show(),$(".qrcode",i).hide(),$(".controller-keyboard",i).addClass("selected-controller"),$(".controller-phone",i).removeClass("selected-controller")):($(".keyboard-controls",i).hide(),$(".qrcode",i).show(),$(".controller-keyboard",i).removeClass("selected-controller"),$(".controller-phone",i).addClass("selected-controller"))}function c(){return document.exitFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen}function c(){return document.exitFullscreen||document.webkitCancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen}function u(){var e=document.documentElement;n=!0,e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():n=!1}function p(){n=!1,document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():n=!0}var d=$(".content.modal"),f=$(".menu.main"),m=$(".menu.rom"),g=$(".menu.loading"),v=$(".emulator"),y=$(".player-controls .qrcode"),S="https://doctogonzo.github.io/playNESEmulatorOnline/controller?id="+encodeURIComponent(e.key)+"&player=";console.log(S),y.each(function(e){new QRCode(y[e],S+e)});var b=new JSNES({ui:v.JSNESUI()}),C={};e.subscribe("controllerState",null,function(e,t,i){if(i&&(C[t]||(C[t]=i.player),i.keys))for(var n in i.keys)i.keys.hasOwnProperty(n)&&b.keyboard.keys.hasOwnProperty(n)&&b.keyboard.setKeyState(i.player,b.keyboard.keys[n],i.keys[n])},function(e,t){},function(e,t){});var R=new Dropbox({accessToken:"ioETuaQldOAAAAAAAAAADMB1S428Yis0YLE0o6YBf1AZXaWaOBLuGy1lZRiWxHUW"});R.filesListFolder({path:""}).then(function(e){if(!(e.entries.length<=0)){var t=Math.floor(Math.random()*e.entries.length);h(e.entries[t].path_lower,!0)}})["catch"](function(e){console.log(e)}),$(document).bind("keydown",function(e){t||b.keyboard.keyDown(e)}).bind("keyup",function(e){t||b.keyboard.keyUp(e)}).bind("keypress",function(e){t||b.keyboard.keyPress(e)}),v.on("click",function(){r(!0)}),$(".back-btn",d).on("click",function(){r(!0)}),$(".select-btn",d).on("click",function(){r(!1)}),$(".resume-btn",d).on("click",s),$(".restart-btn",d).on("click",function(){b.reloadRom(),b.start(),s()});var _=$(".sound-btn",d).on("click",function(){b.opts.emulateSound?(b.opts.emulateSound=!1,_.html("Sound: Off")):(b.opts.emulateSound=!0,_.html("Sound: On"))}),T=$(".rom.list",m),E=$(".rom.upload input",m).change(function(){var e=this;if(e.files&&!(e.files.length<=0)){var t=e.files[0],i="/"+t.name;a(),R.filesUpload({path:i,contents:t}).then(function(e){h(i),s()})["catch"](function(e){console.log(e)}),E.replaceWith(E=E.clone(!0))}}),w=$(".full-screen-btn").on("click",function(){n?p():u(),n?w.html("Exit Full Screen"):w.html("Full Screen")});c()||w.hide(),$(".player-controls.player1 .controller-keyboard").on("click",function(){l(0,!0)}),$(".player-controls.player1 .controller-phone").on("click",function(){l(0,!1)}),$(".player-controls.player2 .controller-keyboard").on("click",function(){l(1,!0)}),$(".player-controls.player2 .controller-phone").on("click",function(){l(1,!1)}),l(0,!1),l(1,!1),r(!0)})}();